{"id":"clack-00f2","title":"[INFRA] Create mock AI provider test helper","description":"**Category:** Testing Infrastructure\n**Priority:** High\n\n## Problem\n8+ tests fail because TestAIPromptGenerator's `getProviderForSelection()` throws \"Provider factory not implemented in test\". Every test file that needs an AI provider creates its own inconsistent mock.\n\n## Implementation\n\nCreate `tests/__helpers__/mockAIProvider.ts`:\n```typescript\nimport type { AIProvider, GenerateOptions, GenerateResult } from '@/types';\n\nexport interface MockAIProviderOptions {\n  response?: Partial\u003cGenerateResult\u003e;\n  shouldFail?: boolean;\n  failureError?: Error;\n  latencyMs?: number;\n}\n\nexport function createMockAIProvider(options: MockAIProviderOptions = {}): AIProvider {\n  const { \n    response = { text: 'MOCK AI RESPONSE' },\n    shouldFail = false,\n    failureError = new Error('Mock provider failure'),\n    latencyMs = 10\n  } = options;\n\n  return {\n    generate: jest.fn().mockImplementation(async (opts: GenerateOptions) =\u003e {\n      if (shouldFail) throw failureError;\n      return {\n        text: response.text ?? 'MOCK AI RESPONSE',\n        model: response.model ?? 'mock-model',\n        usage: response.usage ?? { promptTokens: 10, completionTokens: 20 },\n        ...response\n      };\n    }),\n    validateConnection: jest.fn().mockResolvedValue({ \n      valid: true, \n      latencyMs \n    })\n  };\n}\n\n// For testing failover scenarios\nexport function createFailingProvider(error: Error): AIProvider {\n  return createMockAIProvider({ shouldFail: true, failureError: error });\n}\n\n// For testing rate limit failover\nexport function createRateLimitedProvider(): AIProvider {\n  const { RateLimitError } = require('@/types/errors');\n  return createFailingProvider(new RateLimitError('Rate limit exceeded'));\n}\n```\n\n## Export from helpers index\n```typescript\n// tests/__helpers__/index.ts\nexport * from './mockAIProvider';\n```\n\n## Usage Example\n```typescript\nimport { createMockAIProvider, createRateLimitedProvider } from '@tests/__helpers__';\n\ndescribe('AIPromptGenerator', () =\u003e {\n  it('should generate content', async () =\u003e {\n    const mockProvider = createMockAIProvider({ \n      response: { text: 'MOTIVATIONAL QUOTE' } \n    });\n    // Use mockProvider in tests\n  });\n\n  it('should failover on rate limit', async () =\u003e {\n    const primary = createRateLimitedProvider();\n    const alternate = createMockAIProvider();\n    // Test failover behavior\n  });\n});\n```\n\n## Acceptance Criteria\n- [ ] Helper file created at `tests/__helpers__/mockAIProvider.ts`\n- [ ] Exported from `tests/__helpers__/index.ts`\n- [ ] Path alias `@tests/` configured in jest.config.cjs if not present\n- [ ] Documentation added as JSDoc comments\n- [ ] ai-prompt-generator.test.ts updated to use helper","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-11-29T05:16:39.538376717Z","updated_at":"2026-01-03T21:41:47.645866918Z","labels":["infrastructure","testing"],"dependencies":[{"issue_id":"clack-00f2","depends_on_id":"clack-s9o","type":"parent-child","created_at":"2025-11-29T05:17:02.000332047Z","created_by":"daemon"},{"issue_id":"clack-00f2","depends_on_id":"clack-d719","type":"parent-child","created_at":"2025-11-29T07:00:35.121253256Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-068","title":"Task 2.1: Create model tier configuration","description":"Create src/config/model-tiers.ts with MODEL_TIERS mapping for OpenAI (gpt-4o-mini, gpt-4o, gpt-4-turbo) and Anthropic (haiku, sonnet, opus) providers.","acceptance_criteria":"- MODEL_TIERS constant with openai and anthropic mappings\n- Light/medium/heavy tiers for each provider\n- Type-safe configuration object\n- Exported for use by ModelTierSelector","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-11-26T22:15:11.153157421Z","updated_at":"2026-01-03T21:41:47.645866918Z","dependencies":[{"issue_id":"clack-068","depends_on_id":"clack-adr","type":"parent-child","created_at":"2025-11-26T22:15:18.610543299Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-0dd","title":"Task 4.4: Create registerNotifications function","description":"Create src/content/registry/register-notifications.ts to register P0 Home Assistant notification generators dynamically.","acceptance_criteria":"- Creates notification generators for common HA events\n- Door opened, person arrived, motion detected patterns\n- Each with eventTriggerPattern regex\n- P0 priority setting","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-11-26T22:16:06.411475877Z","updated_at":"2026-01-03T21:41:47.645866918Z","dependencies":[{"issue_id":"clack-0dd","depends_on_id":"clack-4lg","type":"parent-child","created_at":"2025-11-26T22:16:15.480507673Z","created_by":"daemon"},{"issue_id":"clack-0dd","depends_on_id":"clack-2tg","type":"blocks","created_at":"2025-11-26T22:16:15.931242131Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-0e2m","title":"content-list.test.ts: 11 tests failing - missing Vestaboard config mock","description":"File: tests/unit/cli/commands/content-list.test.ts\nFailures: 11 tests\nRoot cause: Tests call contentListCommand() which calls bootstrap(), but Vestaboard configuration is not mocked.\nError: 'Vestaboard configuration is required for operation' thrown at src/bootstrap.ts:224\n\nFailing tests:\n- should display empty registry message when no generators registered\n- should list all registered generators\n- should display priority group headers in output\n- should show generators under their priority sections\n- should display id, name, modelTier, and applyFrame for each generator\n- should display applyFrame=false correctly\n- should handle default applyFrame value (undefined = true)\n- should display all model tiers correctly\n- should display output with visual structure\n- should show total summary\n- should work with registry from bootstrap","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-03T22:48:01.511764049Z","created_by":"vscode","updated_at":"2026-01-04T00:54:11.739106428Z","closed_at":"2026-01-04T00:54:11.739106428Z","close_reason":"Fixed by adding full bootstrap mock","dependencies":[{"issue_id":"clack-0e2m","depends_on_id":"clack-nltc","type":"parent-child","created_at":"2026-01-03T22:48:46.434983417Z","created_by":"vscode"}]}
{"id":"clack-0f2","title":"Fix test database pollution (tests use production database)","description":"## Root Cause Found\n\n### Issue 1: Stale Compiled JavaScript (FIXED)\nThe `dist/bootstrap.js` was out of date (from 01:33) while `src/bootstrap.ts` had database code added (at 07:24). Running `npm run build` resolved this.\n\n**Status**: Fixed by rebuilding\n\n### Issue 2: Test Database Pollution (STILL OPEN)\nTests in `tests/unit/storage/models/content.test.ts` use production database:\n- `new Database()` without config uses `DATABASE_URL` from env (production)\n- Tests run `TRUNCATE TABLE content` wiping production data\n- Test artifacts (gen1, gen2, \"Failed 14\", etc.) pollute production\n\n## Solution Needed\nTests should use isolated test database:\n1. Use `TEST_DATABASE_URL` for tests, or\n2. Mock the database connection in storage tests\n\n## Files Involved\n- `tests/unit/storage/models/content.test.ts` - needs test database isolation\n\n## Acceptance\n- [ ] Tests use separate test database (not production)\n- [ ] Production database no longer contains test artifacts after test runs\n- [ ] Running tests doesn't wipe production content table","acceptance_criteria":"- [ ] Tests use separate test database (not production)\n- [ ] P3 fallback content is saved with status='success'\n- [ ] Fallback content includes metadata indicating P3 was used\n- [ ] Production database no longer contains test artifacts","status":"tombstone","priority":1,"issue_type":"bug","created_at":"2025-11-28T07:30:11.045995628Z","updated_at":"2026-01-03T21:41:47.645866918Z","deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"bug"}
{"id":"clack-0nr","title":"Home Assistant Core Client Implementation","description":"Implement the WebSocket client for Home Assistant communication with connection management, event subscriptions, and helper methods.","status":"tombstone","priority":0,"issue_type":"epic","created_at":"2025-11-24T00:14:50.431430209Z","updated_at":"2026-01-03T21:41:47.645866918Z","deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"clack-0o5","title":"Add JSDoc comments to SQLiteDatabase class methods","description":"The SQLiteDatabase class in `src/storage/sqlite-database.ts` lacks JSDoc documentation on its public methods.\n\n**Methods to document:**\n- `connect()` - explain singleton behavior\n- `disconnect()` - explain shared instance handling\n- `migrate()` - document schema created\n- `get()`, `all()`, `run()` - query methods\n- `transaction()` - transaction handling\n- `resetSharedInstance()` - static cleanup method\n\nThis improves maintainability and IDE support.","status":"tombstone","priority":3,"issue_type":"chore","created_at":"2025-11-28T08:52:31.246226887Z","updated_at":"2026-01-03T21:41:47.645866918Z","deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"chore"}
{"id":"clack-0rij","title":"Remove top navbar, add floating nav with logo","description":"## Objective\nRemove the top navigation bar entirely in favor of a unified floating navigation. Add a floating logo at the top of the screen with 'Clack Track' in brush script and 'BY HOUSEBOY' in elegant sans-serif, with a gradient blur effect.\n\n## Success Criteria\n- Desktop navbar (Navigation.tsx) removed\n- BottomTabBar contains all navigation options and is visible on all screen sizes\n- Floating logo fixed at top with gradient blur fade effect\n- All tests passing at 80%+ coverage","status":"closed","priority":1,"issue_type":"epic","owner":"ryan@spice.cc","created_at":"2026-01-26T04:45:25.102710671Z","created_by":"Ryan Brodkin","updated_at":"2026-01-26T07:47:57.117988846Z","closed_at":"2026-01-26T07:47:57.117988846Z","close_reason":"Closed"}
{"id":"clack-0rij.1","title":"Consolidate navigation items into BottomTabBar","description":"## Objective\nUpdate BottomTabBar to include all navigation options currently in Navigation.tsx. Add logout functionality, ensure all links from desktop nav are accessible, and make the component visible on all screen sizes.\n\n## TDD Approach\n1. RED: Write tests for logout button visibility when authenticated\n2. RED: Write tests for all nav links being present\n3. GREEN: Implement logout button and complete link set\n4. BLUE: Refactor for cleaner code\n\n## Acceptance Criteria\n- [ ] BottomTabBar visible on all screen sizes (remove md:hidden)\n- [ ] Logout button present when user is authenticated\n- [ ] All routes accessible: Home, Flipside, Account, Admin, Login, Style Guide\n- [ ] Style Guide link only visible in dev/test environments\n- [ ] Auth-based filtering works correctly\n- [ ] Haptic feedback maintained on mobile\n- [ ] All tests pass\n- [ ] Code coverage meets threshold\n\n## Scope\nFiles: src/web/frontend/components/BottomTabBar.tsx, tests/web/components/BottomTabBar.test.tsx\n\n## Related Issues\n- clack-0rij.3: This component consolidation enables Navigation.tsx removal\n\n## Parallel Execution Note\nCan run in parallel with clack-0rij.2 and clack-0rij.4. No file overlap.","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-26T04:45:31.831961508Z","created_by":"Ryan Brodkin","updated_at":"2026-01-26T07:47:51.268128968Z","closed_at":"2026-01-26T07:47:51.268128968Z","close_reason":"Closed","dependencies":[{"issue_id":"clack-0rij.1","depends_on_id":"clack-0rij","type":"parent-child","created_at":"2026-01-26T04:45:31.835610508Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-0rij.2","title":"Create FloatingLogo component with blur effect","description":"## Objective\nCreate a new FloatingLogo component that displays 'Clack Track' in brush script and 'BY HOUSEBOY' in elegant sans-serif. The logo should be fixed at the top of the screen with a gradient blur effect that fades into the page content below.\n\n## TDD Approach\n1. RED: Write tests for logo rendering with correct text content\n2. RED: Write tests for fixed positioning and z-index\n3. GREEN: Implement component with styling\n4. BLUE: Refactor gradient blur implementation\n\n## Acceptance Criteria\n- [ ] 'Clack Track' displayed in brush script font\n- [ ] 'BY HOUSEBOY' displayed in elegant modern sans-serif\n- [ ] Byline evokes premium retail/celebrity aesthetic\n- [ ] Component fixed at top of viewport\n- [ ] Gradient blur effect fades into page content\n- [ ] Logo remains visible while scrolling\n- [ ] Proper z-index (above content, below modals)\n- [ ] Dark mode support\n- [ ] All tests pass\n- [ ] Code coverage meets threshold\n\n## Scope\nFiles: src/web/frontend/components/FloatingLogo.tsx, tests/web/components/FloatingLogo.test.tsx\n\n## Related Issues\n- clack-0rij.4: Uses fonts defined there (brush script for title, sans-serif for byline)\n- clack-0rij.3: This component will be integrated into PageLayout","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-26T04:45:38.649849427Z","created_by":"Ryan Brodkin","updated_at":"2026-01-26T07:47:51.277575926Z","closed_at":"2026-01-26T07:47:51.277575926Z","close_reason":"Closed","dependencies":[{"issue_id":"clack-0rij.2","depends_on_id":"clack-0rij","type":"parent-child","created_at":"2026-01-26T04:45:38.651356011Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-0rij.3","title":"Remove Navigation.tsx and update PageLayout","description":"## Objective\nDelete the Navigation.tsx component entirely and update PageLayout to use only BottomTabBar and the new FloatingLogo component. Adjust spacing to account for the floating logo at the top.\n\n## TDD Approach\n1. RED: Update PageLayout tests to expect no Navigation import\n2. RED: Write tests for FloatingLogo integration in PageLayout\n3. GREEN: Remove Navigation, add FloatingLogo to PageLayout\n4. BLUE: Clean up any unused imports/styles\n\n## Acceptance Criteria\n- [ ] Navigation.tsx file deleted\n- [ ] PageLayout no longer imports Navigation\n- [ ] FloatingLogo integrated into PageLayout\n- [ ] Top padding/margin adjusted for logo height\n- [ ] No visual regressions on any page\n- [ ] All 7 pages still render correctly with new layout\n- [ ] All tests pass\n- [ ] Code coverage meets threshold\n\n## Scope\nFiles: src/web/frontend/components/PageLayout.tsx, src/web/frontend/components/Navigation.tsx (delete)\n\n## Related Issues\nDepends on: clack-0rij.1 (BottomTabBar consolidation), clack-0rij.2 (FloatingLogo component)","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-26T04:45:45.755163208Z","created_by":"Ryan Brodkin","updated_at":"2026-01-26T07:47:51.28238726Z","closed_at":"2026-01-26T07:47:51.28238726Z","close_reason":"Closed","dependencies":[{"issue_id":"clack-0rij.3","depends_on_id":"clack-0rij","type":"parent-child","created_at":"2026-01-26T04:45:45.759790042Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-0rij.3","depends_on_id":"clack-0rij.1","type":"blocks","created_at":"2026-01-26T04:46:03.220290883Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-0rij.3","depends_on_id":"clack-0rij.2","type":"blocks","created_at":"2026-01-26T04:46:03.285002967Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-0rij.4","title":"Add custom fonts for logo typography","description":"## Objective\nAdd Google Fonts or self-hosted fonts for the brush script (Clack Track) and modern sans-serif (BY HOUSEBOY). Update CSS/Tailwind config to make fonts available.\n\n## TDD Approach\n1. RED: Write tests that check for font-family application\n2. GREEN: Add font imports and CSS classes\n3. BLUE: Optimize font loading (preload, display:swap)\n\n## Acceptance Criteria\n- [ ] Brush script font loaded (e.g., Pacifico, Sacramento, Dancing Script)\n- [ ] Modern sans-serif font loaded (e.g., Montserrat, Bebas Neue, Oswald)\n- [ ] Fonts available via Tailwind utility classes or CSS\n- [ ] Font loading optimized (preload, display:swap)\n- [ ] Fallback fonts specified\n- [ ] All tests pass\n- [ ] Code coverage meets threshold\n\n## Scope\nFiles: src/web/frontend/index.css, index.html (font links), tailwind.config.ts\n\n## Related Issues\n- clack-0rij.2: FloatingLogo component uses these fonts for title and byline\n\n## Parallel Execution Note\nCan run in parallel with clack-0rij.1 and clack-0rij.2. The FloatingLogo component will reference font classes defined here.","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-26T04:45:51.464385503Z","created_by":"Ryan Brodkin","updated_at":"2026-01-26T07:47:51.28593751Z","closed_at":"2026-01-26T07:47:51.28593751Z","close_reason":"Closed","dependencies":[{"issue_id":"clack-0rij.4","depends_on_id":"clack-0rij","type":"parent-child","created_at":"2026-01-26T04:45:51.465463544Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-0rij.5","title":"Update tests for navigation changes","description":"## Objective\nUpdate all existing tests that reference Navigation.tsx to work with the new layout. Add integration tests for the complete navigation flow.\n\n## TDD Approach\n1. RED: Run existing tests to identify failures\n2. GREEN: Fix failing tests to match new architecture\n3. BLUE: Add new integration tests for complete flow\n\n## Acceptance Criteria\n- [ ] All existing tests pass or are updated\n- [ ] No references to deleted Navigation component\n- [ ] Integration tests cover navigation flow\n- [ ] Test coverage maintained at 80%+\n- [ ] All tests pass\n\n## Scope\nFiles: tests/web/components/*.test.tsx, tests/web/pages/*.test.tsx\n\n## Related Issues\nDepends on: clack-0rij.3 (Remove Navigation + Update PageLayout)","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-26T04:45:56.901510589Z","created_by":"Ryan Brodkin","updated_at":"2026-01-26T07:47:51.289755676Z","closed_at":"2026-01-26T07:47:51.289755676Z","close_reason":"Closed","dependencies":[{"issue_id":"clack-0rij.5","depends_on_id":"clack-0rij","type":"parent-child","created_at":"2026-01-26T04:45:56.903671339Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-0rij.5","depends_on_id":"clack-0rij.3","type":"blocks","created_at":"2026-01-26T04:46:03.356634925Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-102","title":"Fix orchestrator-data-provider.test.ts - generateWithRetry mock returns undefined","description":"The mock generateWithRetry function returns undefined instead of GeneratedContent, causing content.outputMode to fail.\n\n**Failures:** 5 tests\n- should call dataProvider.fetchData() before generation on major updates\n- should skip dataProvider.fetchData() on minor updates\n- should work without dataProvider for backward compatibility\n- should pass pre-fetched weather data to FrameDecorator\n- should continue with null data if dataProvider.fetchData() fails\n\n**Fix:** Review mock setup order and ensure generateWithRetry mock is properly configured.\n\n**Files:** tests/unit/content/orchestrator-data-provider.test.ts","status":"tombstone","priority":1,"issue_type":"bug","created_at":"2025-11-28T02:24:25.141950887Z","updated_at":"2026-01-03T21:41:47.645866918Z","deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"bug"}
{"id":"clack-10k","title":"[MEDIUM] Fix factory.test.ts duplicate test cases","description":"**File:** tests/unit/api/ai/factory.test.ts\n**Lines:** 26-57\n**Category:** Doesn't Make Sense\n**Severity:** Medium\n\n## Problem\n1. Lines 26-33, 35-42: Tests only check `toBeDefined()` and `toHaveProperty()`, not that API key was actually passed\n2. Lines 45-50, 52-57: Duplicate of tests at lines 9-19 with same parameters and assertions\n\n## Evidence\n```typescript\n// Lines 45-50 - Duplicate of lines 9-13\nit('should create OpenAI client without model parameter (backward compatibility)', () =\u003e {\n  const provider = createAIProvider(AIProviderType.OPENAI, 'test-key');\n  expect(provider).toBeInstanceOf(OpenAIClient);\n});\n// Same as line 9-13!\n```\n\n## Implementation Instructions\n1. **Remove duplicate tests** at lines 45-50 and 52-57\n2. **Enhance API key tests** at lines 26-42 to verify key was actually used:\n```typescript\nexpect(provider['apiKey']).toBe('test-key');\n// OR mock constructor and verify call args\n```\n\n## Acceptance Criteria\n- [ ] No duplicate test cases\n- [ ] API key tests verify key was actually passed/stored\n- [ ] Tests add unique value beyond instanceof checks","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-11-29T05:08:35.476016549Z","updated_at":"2026-01-03T21:41:47.645866918Z","close_reason":"Verified complete by code review","labels":["medium","testing"],"dependencies":[{"issue_id":"clack-10k","depends_on_id":"clack-ini3","type":"parent-child","created_at":"2025-11-29T07:01:30.767729379Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-10tc","title":"Critical AI Generator Test Fixes","description":"CRITICAL and HIGH priority bugs in core AI generators. These tests have incorrect assertions or non-functional checks that give false confidence.\n\nIncludes:\n- ai-prompt-generator.test.ts provider failover test (CRITICAL)\n- ai-prompt-generator.test.ts generate() tests (CRITICAL)\n- bootstrap.test.ts alternate provider test (HIGH)\n- register-notifications.test.ts RegExp assertion (HIGH)","status":"tombstone","priority":1,"issue_type":"epic","created_at":"2025-11-29T07:00:20.397490888Z","updated_at":"2026-01-03T21:41:47.645866918Z","dependencies":[{"issue_id":"clack-10tc","depends_on_id":"clack-d719","type":"blocks","created_at":"2025-11-29T07:06:00.922905129Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"clack-15vn","title":"Add 'More Info' URL Support for News Content","description":"## Goal\nEnable viewers to access full news articles by adding 'More Info' URL support to the Clack Track system.\n\n## Scope\n- Add moreInfoUrl field to content metadata (no database migration needed)\n- Update news generators to populate URLs from RSS feed links\n- Create frontend button component for opening external links\n- Integrate buttons in Welcome page and History cards\n\n## Success Criteria\n- News content includes clickable 'More Info' button when URL available\n- Button opens article in new tab with proper security attributes\n- All 4 news generators (news, tech, global, local) automatically populate URLs\n- Tests verify end-to-end flow from generator → database → API → frontend\n\n## Technical Approach\n- Use existing metadata JSON column for storage\n- Single BaseNewsGenerator change applies to all news generators\n- RSS feeds already provide link URLs in standard format\n- Reusable MoreInfoButton component for consistency","status":"closed","priority":1,"issue_type":"epic","owner":"ryan@spice.cc","created_at":"2026-01-26T05:22:35.944581547Z","created_by":"Ryan Brodkin","updated_at":"2026-01-26T07:51:10.369335379Z","closed_at":"2026-01-26T07:51:10.369337754Z"}
{"id":"clack-15vn.1","title":"Add moreInfoUrl to type system","description":"## Objective\nAdd `moreInfoUrl?: string` field to GenerationMetadata interface and verify it flows through serialization/deserialization pipeline.\n\n## TDD Approach\nFollow Red-Green-Blue cycle:\n1. RED: Write failing tests for metadata serialization with moreInfoUrl\n2. GREEN: Add moreInfoUrl to GenerationMetadata interface\n3. BLUE: Verify type safety and test coverage\n\n## Acceptance Criteria\n- [ ] GenerationMetadata interface includes `moreInfoUrl?: string`\n- [ ] ContentModel serialization tests pass with moreInfoUrl\n- [ ] ContentRepository tests verify moreInfoUrl round-trip\n- [ ] Type definitions exported correctly\n- [ ] All tests pass\n- [ ] Code coverage meets threshold\n\n## Scope\nFiles:\n- src/types/content-generator.ts (GenerationMetadata interface at line ~292)\n- tests/unit/storage/models/content.test.ts (serialization tests)\n- tests/unit/storage/repositories/content-repo.test.ts (round-trip tests)\n\n## Cross-References\n- Related: clack-15vn.2 (news generator changes, can be developed in parallel)\n- Blocks: clack-15vn.3 (integration tests depend on this type definition)","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-26T05:22:46.080359343Z","created_by":"Ryan Brodkin","updated_at":"2026-01-26T07:50:58.954936846Z","closed_at":"2026-01-26T07:50:58.954942721Z","dependencies":[{"issue_id":"clack-15vn.1","depends_on_id":"clack-15vn","type":"parent-child","created_at":"2026-01-26T05:22:46.081788552Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-15vn.2","title":"Update news generators to populate moreInfoUrl","description":"## Objective\nModify BaseNewsGenerator to cache first RSS link and add to metadata via getCustomMetadata hook.\n\n## TDD Approach\nFollow Red-Green-Blue cycle:\n1. RED: Write failing tests for BaseNewsGenerator.getCustomMetadata() returning moreInfoUrl\n2. GREEN: Cache first RSSItem.link in getTemplateVariables(), return in getCustomMetadata()\n3. BLUE: Refactor for clarity, ensure all news generators inherit behavior\n\n## Acceptance Criteria\n- [ ] BaseNewsGenerator caches first RSS link from fetched items\n- [ ] getCustomMetadata() returns moreInfoUrl when headlines available\n- [ ] Unit tests verify link extraction from RSSItem\n- [ ] All 4 news generators (news, tech, global, local) inherit behavior\n- [ ] Graceful fallback when no RSS items fetched (moreInfoUrl absent)\n- [ ] All tests pass\n- [ ] Code coverage meets threshold\n\n## Scope\nFiles:\n- src/content/generators/ai/base-news-generator.ts (add lastFetchedLink cache, update getCustomMetadata)\n- tests/unit/content/generators/ai/base-news-generator.test.ts (add moreInfoUrl tests)\n\n## Cross-References\n- Related: clack-15vn.1 (type system changes, can be developed in parallel)\n- Blocks: clack-15vn.3 (integration tests depend on this implementation)","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-26T05:22:56.942426043Z","created_by":"Ryan Brodkin","updated_at":"2026-01-26T07:50:59.048248972Z","closed_at":"2026-01-26T07:50:59.04825243Z","dependencies":[{"issue_id":"clack-15vn.2","depends_on_id":"clack-15vn","type":"parent-child","created_at":"2026-01-26T05:22:56.943430293Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-15vn.3","title":"Add integration tests for moreInfoUrl API flow","description":"## Objective\nAdd integration tests verifying moreInfoUrl flows from generator -\u003e database -\u003e API response.\n\n## TDD Approach\nFollow Red-Green-Blue cycle:\n1. RED: Write failing integration tests for /api/content/latest with moreInfoUrl\n2. GREEN: Verify existing code already passes (no changes needed, types flow automatically)\n3. BLUE: Add edge case tests (null metadata, missing moreInfoUrl)\n\n## Acceptance Criteria\n- [ ] Integration test: Save content with moreInfoUrl, verify API returns it\n- [ ] Integration test: /api/content/latest includes moreInfoUrl in response\n- [ ] Integration test: /api/content/history includes moreInfoUrl in items\n- [ ] Edge case: Content without moreInfoUrl returns null/undefined gracefully\n- [ ] All tests pass\n- [ ] Code coverage meets threshold\n\n## Scope\nFiles:\n- tests/integration/web/routes/content.test.ts (NEW FILE - API response tests)\n\nNote: This file does not exist yet. It should be created in the integration routes test directory.\n\n## Cross-References\n- Depends on: clack-15vn.1 (type system must be updated first)\n- Depends on: clack-15vn.2 (generators must populate moreInfoUrl first)\n- Blocks: clack-15vn.4, clack-15vn.5, clack-15vn.6 (frontend needs API contract verified)","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-26T05:23:06.568674547Z","created_by":"Ryan Brodkin","updated_at":"2026-01-26T07:50:59.13147818Z","closed_at":"2026-01-26T07:50:59.131480888Z","dependencies":[{"issue_id":"clack-15vn.3","depends_on_id":"clack-15vn","type":"parent-child","created_at":"2026-01-26T05:23:06.569587006Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-15vn.3","depends_on_id":"clack-15vn.1","type":"blocks","created_at":"2026-01-26T05:23:40.742399966Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-15vn.3","depends_on_id":"clack-15vn.2","type":"blocks","created_at":"2026-01-26T05:23:40.856682258Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-15vn.4","title":"Create MoreInfoButton component","description":"## Objective\nCreate reusable MoreInfoButton component with external link icon and conditional rendering.\n\n## TDD Approach\nFollow Red-Green-Blue cycle:\n1. RED: Write failing React component tests for MoreInfoButton rendering\n2. GREEN: Implement component with shadcn Button + ExternalLink icon\n3. BLUE: Refactor for accessibility (aria-label, target=\"_blank\", rel=\"noopener noreferrer\")\n\n## Acceptance Criteria\n- [ ] Component renders button with \"More Info\" text + ExternalLink icon\n- [ ] Opens link in new tab with security attributes (rel=\"noopener noreferrer\")\n- [ ] Supports size variants (default for Welcome, sm for ContentCard)\n- [ ] Accessibility: aria-label describes action\n- [ ] Unit tests verify rendering and click behavior\n- [ ] All tests pass\n- [ ] Code coverage meets threshold\n\n## Scope\nFiles:\n- src/web/frontend/components/MoreInfoButton.tsx (NEW component)\n- tests/web/components/MoreInfoButton.test.tsx (NEW component tests)\n\n## Cross-References\n- Depends on: clack-15vn.3 (API contract must be verified first)\n- Related: clack-15vn.5, clack-15vn.6 (these issues use this component, can be developed in parallel after .3)","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-26T05:23:16.609927052Z","created_by":"Ryan Brodkin","updated_at":"2026-01-26T07:50:59.20030118Z","closed_at":"2026-01-26T07:50:59.200303847Z","dependencies":[{"issue_id":"clack-15vn.4","depends_on_id":"clack-15vn","type":"parent-child","created_at":"2026-01-26T05:23:16.61143551Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-15vn.4","depends_on_id":"clack-15vn.3","type":"blocks","created_at":"2026-01-26T05:23:47.429368052Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-15vn.5","title":"Integrate button in Welcome page","description":"## Objective\nAdd medium-sized MoreInfoButton below VestaboardPreview on Welcome page when moreInfoUrl present.\n\n## TDD Approach\nFollow Red-Green-Blue cycle:\n1. RED: Write failing test for Welcome page rendering MoreInfoButton\n2. GREEN: Add MoreInfoButton component with conditional rendering\n3. BLUE: Verify layout spacing and responsive behavior\n\n## Acceptance Criteria\n- [ ] MoreInfoButton renders below VestaboardPreview when moreInfoUrl exists\n- [ ] Button hidden when moreInfoUrl is null/undefined\n- [ ] Medium size variant used (default Button size)\n- [ ] Integration test: Welcome page with/without moreInfoUrl\n- [ ] All tests pass\n- [ ] Code coverage meets threshold\n\n## Scope\nFiles:\n- src/web/frontend/pages/Welcome.tsx (add MoreInfoButton import and render)\n- tests/web/pages/Welcome.test.tsx (add moreInfoUrl integration tests)\n\n## Cross-References\n- Depends on: clack-15vn.3 (API contract must be verified first)\n- Depends on: clack-15vn.4 (MoreInfoButton component must exist)\n- Related: clack-15vn.6 (parallel frontend integration, different file)","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-26T05:23:25.611643667Z","created_by":"Ryan Brodkin","updated_at":"2026-01-26T07:50:59.286615805Z","closed_at":"2026-01-26T07:50:59.286618555Z","dependencies":[{"issue_id":"clack-15vn.5","depends_on_id":"clack-15vn","type":"parent-child","created_at":"2026-01-26T05:23:25.612973084Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-15vn.5","depends_on_id":"clack-15vn.3","type":"blocks","created_at":"2026-01-26T05:23:47.540435719Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-15vn.5","depends_on_id":"clack-15vn.4","type":"blocks","created_at":"2026-01-26T05:36:00.494407086Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-15vn.6","title":"Integrate button in ContentCard","description":"## Objective\nAdd small MoreInfoButton to ContentCard component when moreInfoUrl present.\n\n## TDD Approach\nFollow Red-Green-Blue cycle:\n1. RED: Write failing test for ContentCard rendering MoreInfoButton\n2. GREEN: Add MoreInfoButton in CardContent or CardFooter with conditional rendering\n3. BLUE: Verify button placement and interaction with expandable state\n\n## Acceptance Criteria\n- [ ] MoreInfoButton renders in ContentCard when moreInfoUrl exists\n- [ ] Button hidden when moreInfoUrl is null/undefined\n- [ ] Small size variant used (Button size=\"sm\")\n- [ ] Button positioned appropriately (CardContent or CardFooter)\n- [ ] Integration test: History page cards with/without moreInfoUrl\n- [ ] All tests pass\n- [ ] Code coverage meets threshold\n\n## Scope\nFiles:\n- src/web/frontend/components/ContentCard.tsx (add MoreInfoButton import and render)\n- tests/web/components/ContentCard.test.tsx (NEW - component tests for moreInfoUrl)\n- tests/web/pages/History.test.tsx (add moreInfoUrl integration tests)\n\nNote: ContentCard.test.tsx does not exist yet - needs to be created.\n\n## Cross-References\n- Depends on: clack-15vn.3 (API contract must be verified first)\n- Depends on: clack-15vn.4 (MoreInfoButton component must exist)\n- Related: clack-15vn.5 (parallel frontend integration, different file)","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-26T05:23:33.337556296Z","created_by":"Ryan Brodkin","updated_at":"2026-01-26T07:50:59.360417222Z","closed_at":"2026-01-26T07:50:59.360419888Z","dependencies":[{"issue_id":"clack-15vn.6","depends_on_id":"clack-15vn","type":"parent-child","created_at":"2026-01-26T05:23:33.339259254Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-15vn.6","depends_on_id":"clack-15vn.3","type":"blocks","created_at":"2026-01-26T05:23:47.636847969Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-15vn.6","depends_on_id":"clack-15vn.4","type":"blocks","created_at":"2026-01-26T05:36:01.98223992Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-1bte","title":"Add database migrations to deploy workflow","status":"closed","priority":1,"issue_type":"epic","owner":"ryan@spice.cc","created_at":"2026-01-21T23:55:21.659047263Z","created_by":"Ryan Brodkin","updated_at":"2026-01-22T02:03:32.912699795Z","closed_at":"2026-01-22T02:03:32.912699795Z","close_reason":"Epic complete. Migration infrastructure deployed to production. Known issue: db:migrate CLI command doesn't work (workaround: direct Knex invocation). New agent will fix CLI bug."}
{"id":"clack-1bte.1","title":"Add db:migrate CLI command handler","description":"Create a CLI command handler for db:migrate in the switch statement (like db:reset has). Uses Knex API programmatically (knex.migrate.latest()) so it works in production without tsx or knexfile.ts.\n\nAcceptance Criteria:\n- Create src/cli/commands/migrate.ts with dbMigrateCommand function\n- Command runs knex.migrate.latest() using programmatic Knex configuration\n- Command outputs migration status (which migrations ran, or 'already up to date')\n- Command handles errors gracefully with exit code 1 on failure\n- Export from src/cli/commands/index.ts\n- Register in src/cli/index.ts as db:migrate case\n- Update existing db:migrate npm script to use CLI: tsx src/cli/index.ts db:migrate\n- Unit tests for the command\n\nFiles: src/cli/commands/migrate.ts (new), src/cli/commands/index.ts, src/cli/index.ts, package.json, tests/unit/cli/commands/migrate.test.ts (new)","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-21T23:55:32.571923212Z","created_by":"Ryan Brodkin","updated_at":"2026-01-22T02:03:24.096299263Z","closed_at":"2026-01-22T02:03:24.096299263Z","close_reason":"Implemented and deployed. db:migrate CLI has a bug (no output, migrations don't run) - new issue needed for fix.","dependencies":[{"issue_id":"clack-1bte.1","depends_on_id":"clack-1bte","type":"parent-child","created_at":"2026-01-21T23:55:32.572762171Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-1bte.2","title":"Update Dockerfile for migrations","description":"Modify the Dockerfile to include the migrations directory in the production image so migrations can run inside the container.\n\nAcceptance Criteria:\n- Copy migrations/ directory to production stage\n- Verify migrations directory exists in built image\n- Image size increase is minimal (migrations are small)\n- Test: docker run --rm clack-track:latest ls /app/migrations shows migration files\n\nFiles: Dockerfile","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-21T23:55:34.354507338Z","created_by":"Ryan Brodkin","updated_at":"2026-01-22T02:03:24.125543097Z","closed_at":"2026-01-22T02:03:24.125543097Z","close_reason":"Implemented and deployed. db:migrate CLI has a bug (no output, migrations don't run) - new issue needed for fix.","dependencies":[{"issue_id":"clack-1bte.2","depends_on_id":"clack-1bte","type":"parent-child","created_at":"2026-01-21T23:55:34.35808713Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-1bte.3","title":"Add migration step to deploy skill","description":"Update the deploy skill to run migrations as a one-shot container BEFORE the service update, with proper error handling and rollback guidance.\n\nAcceptance Criteria:\n- Add new 'Step 2: Run Migrations' section BEFORE current 'Step 2: Deploy to Swarm'\n- Migration runs as one-shot container with --rm flag\n- Container joins Swarm network: --network clack-track_clack-network\n- Environment variables passed for database connection\n- Deployment fails if migrations fail (exit code check)\n- Add migration rollback section to Rollback Procedure\n- Renumber subsequent steps (Deploy becomes Step 3, etc.)\n\nFiles: .claude/skills/deploy/SKILL.md","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-21T23:55:46.250737886Z","created_by":"Ryan Brodkin","updated_at":"2026-01-22T02:03:24.13689243Z","closed_at":"2026-01-22T02:03:24.13689243Z","close_reason":"Implemented and deployed. db:migrate CLI has a bug (no output, migrations don't run) - new issue needed for fix.","dependencies":[{"issue_id":"clack-1bte.3","depends_on_id":"clack-1bte","type":"parent-child","created_at":"2026-01-21T23:55:46.261762219Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-1bte.3","depends_on_id":"clack-1bte.1","type":"blocks","created_at":"2026-01-21T23:55:54.552309167Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-1bte.3","depends_on_id":"clack-1bte.2","type":"blocks","created_at":"2026-01-21T23:55:54.596081959Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-1bte.4","title":"Update troubleshooting documentation","description":"Fix the incorrect migration reference and add comprehensive migration troubleshooting guidance.\n\nAcceptance Criteria:\n- Fix line 149: Change 'npm run migrate' to 'node dist/cli/index.js db:migrate'\n- Add 'Migration Rollback' subsection under Database Issues\n- Document how to check migration status\n- Document how to rollback a failed migration\n- Add migration-specific entries to Quick Reference table\n\nFiles: .claude/skills/deploy/troubleshooting.md","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-21T23:55:47.434803845Z","created_by":"Ryan Brodkin","updated_at":"2026-01-22T02:03:24.144391888Z","closed_at":"2026-01-22T02:03:24.144391888Z","close_reason":"Implemented and deployed. db:migrate CLI has a bug (no output, migrations don't run) - new issue needed for fix.","dependencies":[{"issue_id":"clack-1bte.4","depends_on_id":"clack-1bte","type":"parent-child","created_at":"2026-01-21T23:55:47.438708178Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-1bte.4","depends_on_id":"clack-1bte.3","type":"blocks","created_at":"2026-01-21T23:55:54.640295667Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-1h3","title":"Install Dependencies","description":"Install home-assistant-js-websocket, ws package for Node.js WebSocket support, and @types/ws as dev dependency. Update package.json with proper version constraints.","acceptance_criteria":"- home-assistant-js-websocket installed\n- ws package installed\n- @types/ws dev dependency installed\n- package.json updated with version constraints","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-11-24T00:16:18.852391333Z","updated_at":"2026-01-03T21:41:47.645866918Z","dependencies":[{"issue_id":"clack-1h3","depends_on_id":"clack-0nr","type":"parent-child","created_at":"2025-11-24T04:18:46.558407216Z","created_by":"vscode"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-1jab","title":"Final cleanup and documentation","description":"After all fixes: Update test documentation if patterns changed. Remove any orphaned test utilities. Verify coverage still meets 80% threshold. Document new testing patterns in CLAUDE.md if significant. Run final validation. Acceptance: Clean test suite, documentation updated, coverage maintained.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-11T21:03:47.986208677Z","created_by":"vscode","updated_at":"2026-01-11T22:39:20.420614136Z","closed_at":"2026-01-11T22:39:20.420614136Z","close_reason":"Test suite overhaul complete, all documentation is current","dependencies":[{"issue_id":"clack-1jab","depends_on_id":"clack-82ep","type":"parent-child","created_at":"2026-01-11T21:04:05.438321088Z","created_by":"vscode"},{"issue_id":"clack-1jab","depends_on_id":"clack-2c4c","type":"blocks","created_at":"2026-01-11T21:04:14.741336884Z","created_by":"vscode"}]}
{"id":"clack-1ls","title":"Create CLI Testing Tool","description":"Create src/cli/commands/test-ha.ts with commands to test connection, list entities, and subscribe to events.","acceptance_criteria":"- CLI tool file created\n- Test connection command\n- Validate authentication\n- --list option (list all entities)\n- --entity option (get specific state)\n- --watch option (subscribe to event for 30s)\n- Added to commander index\n- npm script added (test:ha)\n- Colored output for success/failure\n- Error diagnostics","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-11-24T00:18:58.84187713Z","updated_at":"2026-01-03T21:41:47.645866918Z","dependencies":[{"issue_id":"clack-1ls","depends_on_id":"clack-ar9","type":"blocks","created_at":"2025-11-24T00:20:12.412759094Z","created_by":"daemon"},{"issue_id":"clack-1ls","depends_on_id":"clack-2w5","type":"blocks","created_at":"2025-11-24T00:20:13.594353095Z","created_by":"daemon"},{"issue_id":"clack-1ls","depends_on_id":"clack-y4k","type":"blocks","created_at":"2025-11-24T00:20:14.812887679Z","created_by":"daemon"},{"issue_id":"clack-1ls","depends_on_id":"clack-926","type":"parent-child","created_at":"2025-11-24T04:20:33.152792459Z","created_by":"vscode"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-1oxn","title":"Frontend Living Style Guide Page","description":"Develop a React page for the frontend that displays all typography, colors, and component styles - a living style guide for the app.","status":"closed","priority":2,"issue_type":"epic","owner":"ryan@spice.cc","created_at":"2026-01-22T02:47:04.614511336Z","created_by":"Ryan Brodkin","updated_at":"2026-01-22T05:05:57.688060468Z","closed_at":"2026-01-22T05:05:57.688060468Z","close_reason":"All child tasks completed, style guide merged to develop"}
{"id":"clack-1oxn.1","title":"Create style guide page with typography section","description":"Create StyleGuide.tsx page with PageLayout wrapper and typography showcase section displaying font families, heading scales (text-3xl, 2xl, lg, sm), body text, and code/monospace styles.\n\nThis issue CREATES the StyleGuide.tsx file. All subsequent issues (clack-1oxn.2 through clack-1oxn.6) add sections to this file.\n\nAcceptance Criteria:\n- Page renders with PageLayout wrapper\n- Typography section shows all heading levels\n- Font families displayed (Inter, system-ui, monospace)\n- Body text and paragraph styles shown\n- Code/monospace text examples included\n\nFiles: src/web/frontend/pages/StyleGuide.tsx (creates file)\n\nCross-References:\n- clack-1oxn.2 adds color section to this file\n- clack-1oxn.3 through clack-1oxn.6 add component sections to this file","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-22T02:47:18.502942968Z","created_by":"Ryan Brodkin","updated_at":"2026-01-22T05:05:53.036989466Z","closed_at":"2026-01-22T05:05:53.036989466Z","close_reason":"Implemented in feature/clack-1oxn-style-guide, merged to develop","dependencies":[{"issue_id":"clack-1oxn.1","depends_on_id":"clack-1oxn","type":"parent-child","created_at":"2026-01-22T02:47:18.511894218Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-1oxn.2","title":"Add color system documentation section","description":"Add section displaying all CSS custom property colors including backgrounds, foregrounds, primary, secondary, accent, destructive, muted, and chart colors with light/dark mode comparison.\n\nNOTE: This issue depends on clack-1oxn.1 creating the StyleGuide.tsx file first. This issue adds the color section to the existing file.\n\nAcceptance Criteria:\n- Color swatches display all theme colors\n- Color names and CSS variable names shown\n- Light mode and dark mode values visible\n- Semantic color groupings (backgrounds, foregrounds, accents)\n\nFiles: src/web/frontend/pages/StyleGuide.tsx (modifies existing file)\n\nCross-References:\n- Depends on clack-1oxn.1 (file creation)\n- clack-1oxn.3 through clack-1oxn.6 also modify this file","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-22T02:47:25.91782518Z","created_by":"Ryan Brodkin","updated_at":"2026-01-22T05:05:53.045062508Z","closed_at":"2026-01-22T05:05:53.045062508Z","close_reason":"Implemented in feature/clack-1oxn-style-guide, merged to develop","dependencies":[{"issue_id":"clack-1oxn.2","depends_on_id":"clack-1oxn","type":"parent-child","created_at":"2026-01-22T02:47:25.994526388Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-1oxn.2","depends_on_id":"clack-1oxn.1","type":"blocks","created_at":"2026-01-22T02:51:25.977658804Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-1oxn.3","title":"Add Button component showcase with all variants","description":"Create Buttons section displaying all 6 Button variants (default, destructive, outline, secondary, ghost, link) in all 4 sizes (default, sm, lg, icon), including disabled states.\n\nAcceptance Criteria:\n- All 6 variants displayed in grid\n- All 4 sizes shown for each variant\n- Disabled state examples included\n- Icon-only button examples with lucide icons\n\nFiles: src/web/frontend/pages/StyleGuide.tsx (modifies existing file)\n\nCross-References:\n- Blocked by clack-1oxn.1 (file creation)\n- clack-1oxn.4 through clack-1oxn.6 also modify this file","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-22T02:47:44.089586257Z","created_by":"Ryan Brodkin","updated_at":"2026-01-22T05:05:53.050648466Z","closed_at":"2026-01-22T05:05:53.050648466Z","close_reason":"Implemented in feature/clack-1oxn-style-guide, merged to develop","dependencies":[{"issue_id":"clack-1oxn.3","depends_on_id":"clack-1oxn","type":"parent-child","created_at":"2026-01-22T02:47:44.162975591Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-1oxn.3","depends_on_id":"clack-1oxn.1","type":"blocks","created_at":"2026-01-22T02:48:41.549035839Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-1oxn.4","title":"Add Card and Badge component showcase","description":"Add Card section showing full Card composition (header, title, description, content, footer) and Badge section with all 4 variants.\n\nAcceptance Criteria:\n- Card with all subcomponents demonstrated\n- Multiple Card layout examples (stacked, grid)\n- Badge variants: default, secondary, destructive, outline\n- Badges in context (on Cards, with icons)\n\nFiles: src/web/frontend/pages/StyleGuide.tsx (modifies existing file)\n\nCross-References:\n- Blocked by clack-1oxn.3 (sequential content addition)\n- clack-1oxn.5 and clack-1oxn.6 also modify this file","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-22T02:47:51.982056428Z","created_by":"Ryan Brodkin","updated_at":"2026-01-22T05:05:53.056912508Z","closed_at":"2026-01-22T05:05:53.056912508Z","close_reason":"Implemented in feature/clack-1oxn-style-guide, merged to develop","dependencies":[{"issue_id":"clack-1oxn.4","depends_on_id":"clack-1oxn","type":"parent-child","created_at":"2026-01-22T02:47:51.990308553Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-1oxn.4","depends_on_id":"clack-1oxn.3","type":"blocks","created_at":"2026-01-22T02:48:46.824490175Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-1oxn.5","title":"Add form elements and interactive components","description":"Add sections for Input component, Separator usage, Sheet/modal examples, and Sonner toast demonstrations.\n\nAcceptance Criteria:\n- Input with various states (default, focus, disabled, error)\n- Separator horizontal and vertical examples\n- Sheet trigger button with mobile nav example\n- Toast notification trigger buttons\n\nFiles: src/web/frontend/pages/StyleGuide.tsx (modifies existing file)\n\nCross-References:\n- Blocked by clack-1oxn.4 (sequential content addition)\n- clack-1oxn.6 also modifies this file","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-22T02:48:00.585631459Z","created_by":"Ryan Brodkin","updated_at":"2026-01-22T05:05:53.062451133Z","closed_at":"2026-01-22T05:05:53.062451133Z","close_reason":"Implemented in feature/clack-1oxn-style-guide, merged to develop","dependencies":[{"issue_id":"clack-1oxn.5","depends_on_id":"clack-1oxn","type":"parent-child","created_at":"2026-01-22T02:48:00.687930876Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-1oxn.5","depends_on_id":"clack-1oxn.4","type":"blocks","created_at":"2026-01-22T02:48:51.268683386Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-1oxn.6","title":"Add feature components section","description":"Showcase app-specific feature components: VestaboardPreview with sample content, VotingButtons in various states, and ContentCard with metadata.\n\nAcceptance Criteria:\n- VestaboardPreview with sample character codes\n- VotingButtons showing all states (default, loading, voted)\n- ContentCard with realistic metadata badges\n- Component prop documentation inline\n\nFiles: src/web/frontend/pages/StyleGuide.tsx (modifies existing file)\n\nCross-References:\n- Blocked by clack-1oxn.5 (sequential content addition)\n- Final content section before routing/tests","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-22T02:48:07.458833629Z","created_by":"Ryan Brodkin","updated_at":"2026-01-22T05:05:53.067747925Z","closed_at":"2026-01-22T05:05:53.067747925Z","close_reason":"Implemented in feature/clack-1oxn-style-guide, merged to develop","dependencies":[{"issue_id":"clack-1oxn.6","depends_on_id":"clack-1oxn","type":"parent-child","created_at":"2026-01-22T02:48:07.466599504Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-1oxn.6","depends_on_id":"clack-1oxn.5","type":"blocks","created_at":"2026-01-22T02:48:55.508379429Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-1oxn.7","title":"Add route and navigation link","description":"Add /style-guide route to App.tsx with lazy loading and conditionally show link in Navigation.tsx (dev environment only).\n\nAcceptance Criteria:\n- Route added at /style-guide path\n- Lazy loaded like other routes\n- Navigation link visible only in development\n- Uses import.meta.env.DEV for conditional display\n\nFiles: src/web/frontend/App.tsx, src/web/frontend/components/Navigation.tsx","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-22T02:48:17.362821551Z","created_by":"Ryan Brodkin","updated_at":"2026-01-22T05:05:53.072497258Z","closed_at":"2026-01-22T05:05:53.072497258Z","close_reason":"Implemented in feature/clack-1oxn-style-guide, merged to develop","dependencies":[{"issue_id":"clack-1oxn.7","depends_on_id":"clack-1oxn","type":"parent-child","created_at":"2026-01-22T02:48:17.448754342Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-1oxn.7","depends_on_id":"clack-1oxn.6","type":"blocks","created_at":"2026-01-22T02:48:59.808347042Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-1oxn.8","title":"Add tests for style guide page","description":"Create tests verifying style guide page renders all sections, components display correctly, and navigation works.\n\nAcceptance Criteria:\n- Test page renders without errors\n- Test typography section present\n- Test component sections render\n- Test route is accessible\n\nFiles: tests/web/style-guide.test.tsx","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-22T02:48:28.972782583Z","created_by":"Ryan Brodkin","updated_at":"2026-01-22T05:05:53.076935883Z","closed_at":"2026-01-22T05:05:53.076935883Z","close_reason":"Implemented in feature/clack-1oxn-style-guide, merged to develop","dependencies":[{"issue_id":"clack-1oxn.8","depends_on_id":"clack-1oxn","type":"parent-child","created_at":"2026-01-22T02:48:29.062438708Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-1oxn.8","depends_on_id":"clack-1oxn.7","type":"blocks","created_at":"2026-01-22T02:49:04.910914086Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-1sk","title":"[HIGH] Fix http-client.test.ts exponential backoff timing assertion","description":"**File:** tests/unit/api/vestaboard/http-client.test.ts\n**Lines:** 190-205\n**Category:** Too Brittle\n**Severity:** High\n\n## Problem\nTest expects `elapsed \u003e= 500ms` but with 3 retries and exponential backoff (1s + 2s delays), total should be ~3s. The assertion is far too lenient and would pass even if backoff isn't actually happening.\n\n## Evidence\n```typescript\nit('should use exponential backoff between retries', async () =\u003e {\n  // Setup 3 retries\n  const startTime = Date.now();\n  await client.post(testData);\n  const elapsed = Date.now() - startTime;\n  expect(elapsed).toBeGreaterThanOrEqual(500);  // ← Too lenient!\n});\n```\n\n## Implementation Instructions\n1. **Use jest.useFakeTimers()** for deterministic testing\n2. **Verify actual delay values** in backoff sequence\n3. OR tighten assertion to match expected backoff: `expect(elapsed).toBeGreaterThanOrEqual(2500)`\n\n## Acceptance Criteria\n- [ ] Test verifies actual exponential backoff timing\n- [ ] Either uses fake timers OR has appropriate timing assertions\n- [ ] Test fails if backoff is not implemented correctly","status":"tombstone","priority":1,"issue_type":"bug","created_at":"2025-11-29T05:07:07.893171467Z","updated_at":"2026-01-03T21:41:47.645866918Z","labels":["high","testing"],"dependencies":[{"issue_id":"clack-1sk","depends_on_id":"clack-s9o","type":"parent-child","created_at":"2025-11-29T05:09:59.612973004Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"bug"}
{"id":"clack-1su1","title":"Display Framed Content on Welcome Page","status":"closed","priority":2,"issue_type":"epic","owner":"ryan@spice.cc","created_at":"2026-01-22T23:55:56.468358004Z","created_by":"Ryan Brodkin","updated_at":"2026-01-23T01:25:52.713523418Z","closed_at":"2026-01-23T01:25:52.713523418Z","close_reason":"Epic complete - frame display pipeline merged to develop"}
{"id":"clack-1su1.1","title":"Add outputMode column to content table","description":"Create migration adding outputMode column to content table to track whether content needs frame decoration. Column should be VARCHAR, nullable for existing records, default 'text' for backwards compatibility. Update ContentRecord interface.\n\n---\nFiles:\n- migrations/006_add_output_mode.cjs (new migration file)\n- src/storage/models/content.ts (add outputMode to interface and SELECT_FIELDS)\n\nAcceptance Criteria:\n- Migration creates outputMode column with VARCHAR type\n- Column allows NULL for backwards compatibility with existing records\n- Column defaults to 'text' for new records\n- ContentRecord interface includes outputMode?: 'text' | 'layout' | null\n- SELECT_FIELDS includes 'outputMode'\n- mapRowToContentRecord handles outputMode field\n\nEstimated: 2 files, ~50 LOC","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-22T23:56:11.340376094Z","created_by":"Ryan Brodkin","updated_at":"2026-01-23T01:25:47.057769055Z","closed_at":"2026-01-23T01:25:47.057769055Z","close_reason":"Merged to develop in commit 6cabf8f","dependencies":[{"issue_id":"clack-1su1.1","depends_on_id":"clack-1su1","type":"parent-child","created_at":"2026-01-22T23:56:11.342490594Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-1su1.2","title":"Persist outputMode when saving content","description":"Update ContentOrchestrator to include outputMode when saving content to database. Both saveSuccessfulContent() and saveFailedContent() should include outputMode from GeneratedContent. Update existing tests.\n\n---\nFiles:\n- src/content/orchestrator.ts (add outputMode to saveSuccessfulContent and saveFailedContent)\n- src/storage/models/content.ts (update create() to handle outputMode)\n- tests/unit/content/orchestrator.test.ts (update tests for outputMode persistence)\n\nCross-References:\n- Depends on clack-1su1.1 (outputMode column must exist first)\n- Shares src/storage/models/content.ts with clack-1su1.1 (different methods, no conflict)\n\nAcceptance Criteria:\n- saveSuccessfulContent() includes content.outputMode in database insert\n- saveFailedContent() includes content.outputMode in database insert\n- ContentModel.create() handles outputMode field\n- Existing orchestrator tests pass\n- New test verifies outputMode is persisted correctly\n\nEstimated: 2-3 files, ~80 LOC","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-22T23:56:12.607372095Z","created_by":"Ryan Brodkin","updated_at":"2026-01-23T01:25:47.064750138Z","closed_at":"2026-01-23T01:25:47.064750138Z","close_reason":"Merged to develop in commit 6cabf8f","dependencies":[{"issue_id":"clack-1su1.2","depends_on_id":"clack-1su1","type":"parent-child","created_at":"2026-01-22T23:56:12.610844387Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-1su1.2","depends_on_id":"clack-1su1.1","type":"blocks","created_at":"2026-01-22T23:56:25.193035212Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-1su1.3","title":"Apply frame server-side in /api/content/latest","description":"Modify content API to apply frame decoration for outputMode='text' content before returning to frontend. Server-side application ensures time and weather always reflect current conditions. Return characterCodes field in response. Leverage FrameDecorator's existing graceful degradation for missing weather.\n\n---\nFiles:\n- src/web/routes/content.ts (apply frame decoration in getLatestContent)\n- src/storage/repositories/content-repo.ts (ensure outputMode returned in queries)\n\nCross-References:\n- Depends on clack-1su1.2 (outputMode must be persisted to determine decoration)\n- Related to clack-1su1.4 (frontend consumes characterCodes this endpoint produces)\n\nAcceptance Criteria:\n- /api/content/latest returns characterCodes field with 6x22 number[][]\n- When outputMode='text', frame decoration applied with current time/weather\n- When outputMode='layout', characterCodes returned as-is from stored layout\n- When outputMode=null (legacy), treated as 'text' for backwards compatibility\n- Weather unavailable gracefully degrades (frame without weather)\n- Response includes both text and characterCodes fields\n\nEstimated: 2 files, ~100 LOC","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-22T23:56:13.870229012Z","created_by":"Ryan Brodkin","updated_at":"2026-01-23T01:25:47.069583055Z","closed_at":"2026-01-23T01:25:47.069583055Z","close_reason":"Merged to develop in commit 6cabf8f","dependencies":[{"issue_id":"clack-1su1.3","depends_on_id":"clack-1su1","type":"parent-child","created_at":"2026-01-22T23:56:13.873628096Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-1su1.3","depends_on_id":"clack-1su1.2","type":"blocks","created_at":"2026-01-22T23:56:25.227063128Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-1su1.4","title":"Update frontend to use framed character codes","description":"Update Welcome page to use pre-framed characterCodes from API instead of converting text client-side. Fall back to textToCharacterCodes() for legacy data. Handle graceful degradation when server returns partial frame data (missing weather). Update History page similarly if applicable.\n\n---\nFiles:\n- src/web/frontend/pages/Welcome.tsx (use characterCodes from API response)\n- src/web/frontend/services/apiClient.ts (ensure ContentRecord type includes characterCodes)\n\nCross-References:\n- Depends on clack-1su1.3 (API must return characterCodes first)\n- Related to clack-1su1.3 (consumes characterCodes produced by API)\n\nAcceptance Criteria:\n- Welcome page uses content.characterCodes when present in API response\n- Falls back to textToCharacterCodes(content.text) when characterCodes missing\n- VestaboardPreview displays correct frame with time/weather\n- Graceful degradation when characterCodes partially available\n- No visible regression for existing functionality\n\nEstimated: 2 files, ~50 LOC","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-22T23:56:14.992359221Z","created_by":"Ryan Brodkin","updated_at":"2026-01-23T01:25:47.074139513Z","closed_at":"2026-01-23T01:25:47.074139513Z","close_reason":"Merged to develop in commit 6cabf8f","dependencies":[{"issue_id":"clack-1su1.4","depends_on_id":"clack-1su1","type":"parent-child","created_at":"2026-01-22T23:56:14.996081179Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-1su1.4","depends_on_id":"clack-1su1.3","type":"blocks","created_at":"2026-01-22T23:56:25.261786503Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-1su1.5","title":"Write tests for frame display pipeline","description":"Add integration tests verifying frame is displayed correctly on welcome page. Test cases: outputMode='text' shows frame, outputMode='layout' shows as-is, legacy content (null outputMode) treated as 'text', weather unavailable still renders frame without weather.\n\n---\nFiles:\n- tests/integration/web/content-frame.test.ts (new integration test file)\n- tests/unit/web/routes/content.test.ts (unit tests for API frame decoration)\n\nCross-References:\n- Depends on clack-1su1.4 (full pipeline must work before integration testing)\n- Tests functionality from clack-1su1.1, clack-1su1.2, clack-1su1.3, clack-1su1.4\n\nAcceptance Criteria:\n- Test: outputMode='text' content returns decorated characterCodes\n- Test: outputMode='layout' content returns original characterCodes unchanged\n- Test: null outputMode (legacy) treated as 'text' with frame decoration\n- Test: Weather API unavailable still returns frame (time only, no weather)\n- Test: Frontend renders characterCodes correctly in VestaboardPreview\n- All tests pass with 80%+ coverage on new code\n\nEstimated: 2 files, ~150 LOC","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-22T23:56:16.274863305Z","created_by":"Ryan Brodkin","updated_at":"2026-01-23T01:25:47.078980846Z","closed_at":"2026-01-23T01:25:47.078980846Z","close_reason":"Merged to develop in commit 6cabf8f","dependencies":[{"issue_id":"clack-1su1.5","depends_on_id":"clack-1su1","type":"parent-child","created_at":"2026-01-22T23:56:16.279060013Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-1su1.5","depends_on_id":"clack-1su1.4","type":"blocks","created_at":"2026-01-22T23:56:25.297210837Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-1wi","title":"Implement Service Call Method","description":"Implement callService(domain, service, data) method with parameter validation and error handling.","acceptance_criteria":"- callService(domain, service, data) method\n- Parameter validation\n- Service call error handling\n- Service call response return\n- Error types for common failures","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-11-24T00:18:47.44143118Z","updated_at":"2026-01-03T21:41:47.645866918Z","dependencies":[{"issue_id":"clack-1wi","depends_on_id":"clack-ar9","type":"blocks","created_at":"2025-11-24T00:19:56.547744003Z","created_by":"daemon"},{"issue_id":"clack-1wi","depends_on_id":"clack-4qv","type":"blocks","created_at":"2025-11-24T00:19:57.852601504Z","created_by":"daemon"},{"issue_id":"clack-1wi","depends_on_id":"clack-0nr","type":"parent-child","created_at":"2025-11-24T04:19:12.141776714Z","created_by":"vscode"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-201","title":"Test isolation failure: env.test.ts loads real .env file","description":"Environment configuration tests fail due to test isolation issues where the real .env file is loaded during test execution, overriding mocked environment variables.\n\nROOT CAUSE:\nThe src/config/env.ts module executes dotenv.config() at module initialization (lines 2-3):\n```typescript\nimport dotenv from 'dotenv';\ndotenv.config({ override: true });\n```\n\nWhen tests use require('@/config/env') to reload the module for test isolation, this code re-executes and loads the actual .env file from the repository, overriding test-mocked environment variables.\n\nIMPACT:\n- 16 out of 48 tests in tests/unit/config/env.test.ts fail\n- Tests cannot properly verify validation logic for missing required variables\n- Tests cannot verify default values because real values override them\n- Tests cannot verify error handling because real credentials succeed\n\nFAILING TESTS:\n- \"should throw error when VESTABOARD_LOCAL_API_KEY is missing\" - loads real key\n- \"should use default AI_PROVIDER as openai\" - gets \"anthropic\" from .env\n- \"should use default OPENAI_MODEL\" - gets undefined (Anthropic provider active)\n- And 13 more tests with similar isolation issues\n\nEXPECTED BEHAVIOR:\nTests should execute in complete isolation with only mocked environment variables, allowing validation of error conditions, defaults, and edge cases.\n\nDISCOVERED DURING:\nTask workspace-n94 (Home Assistant configuration) - all new HA tests pass, but existing test suite failures revealed during quality gate validation.","design":"SOLUTION OPTIONS:\n\n1. **Lazy initialization** (Recommended):\n   - Move dotenv.config() call into loadConfig() function\n   - Only execute on first call\n   - Tests can mock process.env before calling loadConfig()\n\n2. **Test-aware configuration**:\n   - Check NODE_ENV === 'test' and skip dotenv in tests\n   - Tests explicitly control environment\n\n3. **Mock dotenv module**:\n   - Already attempted (line 5: jest.mock('dotenv/config'))\n   - Not effective because dotenv is imported directly\n\n4. **Separate test configuration module**:\n   - Create test-specific config loader\n   - More overhead but complete isolation","acceptance_criteria":"- All 48 tests in env.test.ts pass with proper isolation\n- No real .env file values leak into test execution\n- Tests can properly verify missing variable errors\n- Tests can properly verify default values\n- jest.resetModules() properly clears config cache\n- Coverage for src/config/env.ts reaches 80%+ branch coverage","status":"tombstone","priority":2,"issue_type":"bug","created_at":"2025-11-24T04:59:31.358366208Z","updated_at":"2026-01-03T21:41:47.645866918Z","labels":["infrastructure","priority-2","testing"],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"bug"}
{"id":"clack-274","title":"[MEDIUM] Remove brittle ANSI code assertions in CLI tests","description":"**File:** tests/unit/cli/commands/test-ha.test.ts (lines 263-285), tests/unit/cli/commands/frame.test.ts (lines 320-331)\n**Category:** Too Brittle\n**Severity:** Medium\n\n## Problem\nTests check for exact ANSI escape codes (`\\x1b[32m` for green, `\\x1b[31m` for red). If the implementation switches to a different coloring library, tests break even though semantic behavior is fine.\n\n## Evidence\n```typescript\n// test-ha.test.ts lines 263-276\nexpect(output).toContain('\\x1b[32m');  // Green ANSI code\n\n// frame.test.ts lines 320-331\nexpect(preview).toMatch(/\\x1b\\[\\d+/);  // ANSI code pattern\n```\n\n## Implementation Instructions\n1. **Test semantic output** instead of encoding:\n   - Verify output contains expected messages\n   - Use a color-aware test helper or strip colors before comparison\n2. **Or use snapshot testing** if exact formatting is critical\n3. **Alternative**: Mock the color library to verify correct color function calls\n\n## Acceptance Criteria\n- [ ] Tests don't depend on specific ANSI escape codes\n- [ ] Color behavior verified through semantic assertions or mocks\n- [ ] Tests pass if color library changes","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-11-29T05:08:31.057093338Z","updated_at":"2026-01-03T21:41:47.645866918Z","close_reason":"Verified complete by code review","labels":["medium","testing"],"dependencies":[{"issue_id":"clack-274","depends_on_id":"clack-n81p","type":"parent-child","created_at":"2025-11-29T07:01:03.263998713Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-28n","title":"Add timezone support with TZ environment variable","description":"Add configurable timezone support using the POSIX standard TZ environment variable (default: America/Los_Angeles). Create a centralized timezone utility module that all components use for consistent time handling across LLM prompts, display frame, and greeting logic.","acceptance_criteria":"- TZ environment variable configures timezone (default: America/Los_Angeles)\n- New src/utils/timezone.ts provides centralized time formatting functions\n- All time displays use configured timezone: LLM prompts, info bar, color bar, greeting generator\n- Tests cover timezone utility with DST handling\n- 80%+ test coverage maintained","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2025-11-27T22:16:53.262300471Z","updated_at":"2026-01-03T21:41:47.645866918Z","deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature"}
{"id":"clack-2b9","title":"Task 6.1: Update EventHandler with orchestrator integration","description":"Modify src/scheduler/event-handler.ts to use ContentOrchestrator for major updates and handle P0 notifications via state_changed events.","acceptance_criteria":"- Constructor accepts HomeAssistantClient and ContentOrchestrator\n- handleContentTrigger() calls orchestrator.generateAndSend()\n- handleStateChanged() for P0 notification matching\n- P0 events immediately interrupt current display\n- Unit tests with mocked orchestrator","status":"tombstone","priority":1,"issue_type":"task","assignee":"claude","created_at":"2025-11-26T22:16:50.298934175Z","updated_at":"2026-01-03T21:41:47.645866918Z","dependencies":[{"issue_id":"clack-2b9","depends_on_id":"clack-zoy","type":"parent-child","created_at":"2025-11-26T22:16:57.812110679Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-2bf6","title":"Generator Formatting Control Enhancements","description":"Give generators finer control over content formatting by allowing them to specify text alignment, reduced dimensions (fewer lines/characters), and word-wrap behavior that get applied programmatically after AI generation.\n\n## Success Criteria\n- Generators can specify alignment via configuration property\n- Generators can specify reduced maxLines/maxCharsPerLine that substitute into system prompts\n- Generators can disable automatic word-wrapping\n- All existing generators continue working unchanged (backwards compatible)\n- 80%+ test coverage maintained\n\n## Scope\n- Included: Text alignment (left/center/right), reduced dimension constraints with system prompt substitution, word-wrap control\n- Excluded: Frame decorator changes, new generators, breaking changes to existing generator behavior","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-05T20:52:23.506774804Z","created_by":"vscode","updated_at":"2026-01-06T02:18:30.489564013Z","closed_at":"2026-01-06T02:18:30.489564013Z","close_reason":"Epic complete: All 7 work items implemented and merged to develop. 2,652 tests passing at 92.27% coverage."}
{"id":"clack-2bf6.1","title":"Add GeneratorFormatOptions type and extend ContentRegistration","description":"Define the new type interface for formatting options and add it to the ContentRegistration interface.\n\n## Objective\nCreate a GeneratorFormatOptions interface with optional properties for textAlign (left/center/right), maxLines (1-5), maxCharsPerLine (1-21), and wordWrap (enabled/disabled). Extend ContentRegistration to include an optional formatOptions property.\n\n## Acceptance Criteria\n- [ ] GeneratorFormatOptions interface defined in src/types/content-generator.ts\n- [ ] ContentRegistration interface includes optional formatOptions?: GeneratorFormatOptions\n- [ ] Type exports updated in src/types/index.ts\n- [ ] Unit tests verify type constraints (maxLines 1-5, maxCharsPerLine 1-21)\n- [ ] Existing generators compile without changes (backwards compatible)\n\n## Files\n- src/types/content-generator.ts\n- src/types/index.ts\n\n## Parallel Group: A (can start immediately)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T20:52:31.146351127Z","created_by":"vscode","updated_at":"2026-01-06T20:05:24.892764802Z","closed_at":"2026-01-06T20:05:24.892764802Z","close_reason":"Implemented in 944791e - GeneratorFormatOptions type added","dependencies":[{"issue_id":"clack-2bf6.1","depends_on_id":"clack-2bf6","type":"parent-child","created_at":"2026-01-05T20:52:31.151785585Z","created_by":"vscode"}]}
{"id":"clack-2bf6.2","title":"Update TextLayoutFormatter with alignment support","description":"Modify the TextLayoutFormatter to support left, center, and right alignment options passed at format time.\n\n## Objective\nCurrently centerText() is hardcoded. Add an alignment option to the format() method that controls whether text is left-aligned (no padding), centered (existing behavior), or right-aligned (left padding). Default to 'center' for backwards compatibility.\n\n## Acceptance Criteria\n- [ ] format() accepts optional alignment parameter ('left' | 'center' | 'right')\n- [ ] Left alignment: no left padding, right-padded to width\n- [ ] Center alignment: existing behavior (default)\n- [ ] Right alignment: left-padded to width\n- [ ] Unit tests cover all three alignment modes\n- [ ] Existing tests pass unchanged\n\n## Files\n- src/content/formatters/text-layout.ts\n- tests/unit/content/formatters/text-layout.test.ts\n\n## Related Issues\n- clack-2bf6.5 also modifies text-layout.ts (word-wrap control) - MUST complete this issue first\n\n## Parallel Group: A (can start immediately)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T20:52:50.723396678Z","created_by":"vscode","updated_at":"2026-01-06T20:05:25.757381802Z","closed_at":"2026-01-06T20:05:25.757381802Z","close_reason":"Implemented in 9666439 - textAlign parameter added to TextLayoutFormatter","dependencies":[{"issue_id":"clack-2bf6.2","depends_on_id":"clack-2bf6","type":"parent-child","created_at":"2026-01-05T20:52:50.73546372Z","created_by":"vscode"}]}
{"id":"clack-2bf6.3","title":"Create DimensionSubstitutor for system prompt template variables","description":"Create a utility that substitutes dimension constraints (maxLines, maxCharsPerLine) into system prompt template variables.\n\n## Objective\nThe current system prompt has hardcoded '21 CHARACTER LIMIT' and '1-5 LINES' constraints. Create a DimensionSubstitutor that:\n1. Adds new template variables {{maxChars}} and {{maxLines}} to the system prompt\n2. Updates the major-update-base.txt prompt to use these variables instead of hardcoded values\n3. Provides sensible defaults (21 chars, 5 lines) when generators don't specify overrides\n\n## Acceptance Criteria\n- [ ] DimensionSubstitutor class created in src/content/dimension-substitutor.ts\n- [ ] System prompt updated to use {{maxChars}} and {{maxLines}} template variables\n- [ ] Default values: maxChars=21, maxLines=5 (current behavior)\n- [ ] Unit tests verify variable substitution with custom and default values\n- [ ] Existing prompts work unchanged with defaults\n\n## Files\n- src/content/dimension-substitutor.ts (new) - same level as prompt-loader.ts\n- prompts/system/major-update-base.txt\n- tests/unit/content/dimension-substitutor.test.ts (new)\n\n## Parallel Group: A (can start immediately)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T20:52:52.285946637Z","created_by":"vscode","updated_at":"2026-01-06T20:05:26.485345303Z","closed_at":"2026-01-06T20:05:26.485345303Z","close_reason":"Implemented in 5a5efb6 - DimensionSubstitutor created","dependencies":[{"issue_id":"clack-2bf6.3","depends_on_id":"clack-2bf6","type":"parent-child","created_at":"2026-01-05T20:52:52.324172137Z","created_by":"vscode"}]}
{"id":"clack-2bf6.4","title":"Integrate GeneratorFormatOptions into AIPromptGenerator","description":"Modify AIPromptGenerator to accept and use GeneratorFormatOptions from registration metadata.\n\n## Objective\nUpdate AIPromptGenerator to:\n1. Accept optional formatOptions in constructor or via registration lookup\n2. Pass dimension overrides to DimensionSubstitutor when building template variables\n3. Store formatting options in generation metadata for downstream use\n4. Provide a protected method getFormatOptions() for subclass overrides\n\n## Acceptance Criteria\n- [ ] AIPromptGenerator constructor accepts optional formatOptions\n- [ ] buildTemplateVariables() includes maxChars/maxLines from formatOptions\n- [ ] GeneratedContent metadata includes applied formatOptions\n- [ ] Subclasses can override getFormatOptions() for dynamic options\n- [ ] Unit tests verify options flow through to prompts and metadata\n\n## Files\n- src/content/generators/ai-prompt-generator.ts\n- tests/unit/content/generators/ai-prompt-generator.test.ts\n\n## Related Issues\n- Depends on: clack-2bf6.1 (GeneratorFormatOptions type)\n- Depends on: clack-2bf6.2 (TextLayoutFormatter alignment)\n- Depends on: clack-2bf6.3 (DimensionSubstitutor)\n\n## Parallel Group: B (after Group A)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T20:52:53.409786388Z","created_by":"vscode","updated_at":"2026-01-06T20:05:27.586425553Z","closed_at":"2026-01-06T20:05:27.586425553Z","close_reason":"Implemented in 5354f93 - AIPromptGenerator format options integrated","dependencies":[{"issue_id":"clack-2bf6.4","depends_on_id":"clack-2bf6","type":"parent-child","created_at":"2026-01-05T20:52:53.418001554Z","created_by":"vscode"},{"issue_id":"clack-2bf6.4","depends_on_id":"clack-2bf6.1","type":"blocks","created_at":"2026-01-05T20:53:09.171013923Z","created_by":"vscode"},{"issue_id":"clack-2bf6.4","depends_on_id":"clack-2bf6.2","type":"blocks","created_at":"2026-01-05T20:53:09.190847423Z","created_by":"vscode"},{"issue_id":"clack-2bf6.4","depends_on_id":"clack-2bf6.3","type":"blocks","created_at":"2026-01-05T20:53:09.207407423Z","created_by":"vscode"}]}
{"id":"clack-2bf6.5","title":"Add word-wrap control to TextLayoutFormatter","description":"Allow disabling automatic word-wrapping in TextLayoutFormatter for generators that want manual line control.\n\n## Objective\nAdd a wordWrap option (default: true) to format(). When disabled, respect explicit newlines in the content but don't add additional line breaks for long lines (truncate instead). This allows generators to get AI output with exact line breaks as specified.\n\n## Acceptance Criteria\n- [ ] format() accepts optional wordWrap parameter (default: true)\n- [ ] When wordWrap=false, lines are truncated at maxWidth instead of wrapped\n- [ ] Explicit newlines in content are always respected\n- [ ] Unit tests cover wordWrap=true and wordWrap=false scenarios\n- [ ] Existing behavior unchanged when wordWrap not specified\n\n## Files\n- src/content/formatters/text-layout.ts\n- tests/unit/content/formatters/text-layout.test.ts\n\n## Related Issues\n- clack-2bf6.2 also modifies text-layout.ts (alignment support) - this issue DEPENDS on clack-2bf6.2 completing first\n- File overlap with clack-2bf6.2: both modify TextLayoutFormatter.format() method signature\n\n## Parallel Group: B (after Group A)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T20:52:55.717189333Z","created_by":"vscode","updated_at":"2026-01-06T20:05:28.283198137Z","closed_at":"2026-01-06T20:05:28.283198137Z","close_reason":"Implemented in 29147ce - wordWrap control added","dependencies":[{"issue_id":"clack-2bf6.5","depends_on_id":"clack-2bf6","type":"parent-child","created_at":"2026-01-05T20:52:55.755426833Z","created_by":"vscode"},{"issue_id":"clack-2bf6.5","depends_on_id":"clack-2bf6.2","type":"blocks","created_at":"2026-01-05T20:53:10.961218048Z","created_by":"vscode"}]}
{"id":"clack-2bf6.6","title":"Wire formatting options through ContentOrchestrator","description":"Pass formatting options from ContentRegistration through the orchestrator pipeline to TextLayoutFormatter.\n\n## Objective\nWhen ContentOrchestrator generates content, it should:\n1. Retrieve formatOptions from the selected generator's registration\n2. Pass options through FrameDecorator (or bypass it) to TextLayoutFormatter\n3. Apply alignment and word-wrap settings during layout creation\n\n## Acceptance Criteria\n- [ ] ContentOrchestrator retrieves formatOptions from registration\n- [ ] Options passed through to frame generation pipeline\n- [ ] TextLayoutFormatter receives alignment and wordWrap settings\n- [ ] Integration test verifies end-to-end formatting with custom options\n- [ ] Existing orchestrator tests pass unchanged\n\n## Files\n- src/content/orchestrator.ts\n- src/content/frame/frame-generator.ts\n- tests/integration/content/orchestrator.test.ts\n\n## Related Issues\n- Depends on: clack-2bf6.4 (AIPromptGenerator integration)\n\n## Parallel Group: C (after Group B)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T20:52:57.663279Z","created_by":"vscode","updated_at":"2026-01-06T20:05:29.398631429Z","closed_at":"2026-01-06T20:05:29.398631429Z","close_reason":"Implemented in f78e3e6 - formatOptions wired through ContentOrchestrator","dependencies":[{"issue_id":"clack-2bf6.6","depends_on_id":"clack-2bf6","type":"parent-child","created_at":"2026-01-05T20:52:57.67193975Z","created_by":"vscode"},{"issue_id":"clack-2bf6.6","depends_on_id":"clack-2bf6.4","type":"blocks","created_at":"2026-01-05T20:53:12.887294341Z","created_by":"vscode"}]}
{"id":"clack-2bf6.7","title":"Create demo generator showcasing new formatting features","description":"Create a sample generator that demonstrates the new formatting options for documentation and testing purposes.\n\n## Objective\nCreate a FormattingDemoGenerator (or update an existing generator like HaikuGenerator) that uses:\n- Custom maxLines (e.g., 3 lines)\n- Custom maxCharsPerLine (e.g., 18 chars to leave room for decoration)\n- Left alignment\n- Word-wrap disabled\n\nThis serves as documentation and integration test for the new features.\n\n## Acceptance Criteria\n- [ ] Demo generator created or existing generator updated with formatOptions\n- [ ] Generator properly uses reduced dimensions in system prompt\n- [ ] Generated content respects specified alignment\n- [ ] Word-wrap behavior matches configuration\n- [ ] Tests verify the generator works with custom formatting\n\n## Files\n- src/content/generators/ai/formatting-demo-generator.ts (new or update existing)\n- src/content/registry/register-core.ts\n- tests/unit/content/generators/ai/formatting-demo-generator.test.ts\n\n## Related Issues\n- Depends on: clack-2bf6.4 (AIPromptGenerator integration)\n- Depends on: clack-2bf6.6 (Orchestrator wiring)\n\n## Parallel Group: C (after Group B)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T20:52:58.918402959Z","created_by":"vscode","updated_at":"2026-01-06T20:05:30.822925221Z","closed_at":"2026-01-06T20:05:30.822925221Z","close_reason":"Implemented in 056d600 - FormattingDemoGenerator created","dependencies":[{"issue_id":"clack-2bf6.7","depends_on_id":"clack-2bf6","type":"parent-child","created_at":"2026-01-05T20:52:58.926790043Z","created_by":"vscode"},{"issue_id":"clack-2bf6.7","depends_on_id":"clack-2bf6.4","type":"blocks","created_at":"2026-01-05T20:53:14.543602092Z","created_by":"vscode"},{"issue_id":"clack-2bf6.7","depends_on_id":"clack-2bf6.6","type":"blocks","created_at":"2026-01-05T20:53:14.561923009Z","created_by":"vscode"}]}
{"id":"clack-2c4c","title":"Validate tests pass without .env","description":"CRITICAL GATE: After all other tasks complete, run full test suite with NO .env file present. This proves tests properly mock all external dependencies and don't require API keys or config. Fix any tests that fail without .env. Acceptance: npm test passes with zero .env file in worktree.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T21:03:45.912992301Z","created_by":"vscode","updated_at":"2026-01-11T22:38:16.711510509Z","closed_at":"2026-01-11T22:38:16.711510509Z","close_reason":"Closed","dependencies":[{"issue_id":"clack-2c4c","depends_on_id":"clack-82ep","type":"parent-child","created_at":"2026-01-11T21:04:05.435670838Z","created_by":"vscode"},{"issue_id":"clack-2c4c","depends_on_id":"clack-4w3l","type":"blocks","created_at":"2026-01-11T21:04:13.625203925Z","created_by":"vscode"},{"issue_id":"clack-2c4c","depends_on_id":"clack-wq6j","type":"blocks","created_at":"2026-01-11T21:04:13.6441868Z","created_by":"vscode"},{"issue_id":"clack-2c4c","depends_on_id":"clack-bunp","type":"blocks","created_at":"2026-01-11T21:04:13.667041842Z","created_by":"vscode"},{"issue_id":"clack-2c4c","depends_on_id":"clack-ebji","type":"blocks","created_at":"2026-01-11T21:04:13.7070228Z","created_by":"vscode"},{"issue_id":"clack-2c4c","depends_on_id":"clack-m280","type":"blocks","created_at":"2026-01-11T21:04:13.7289488Z","created_by":"vscode"},{"issue_id":"clack-2c4c","depends_on_id":"clack-kvoj","type":"blocks","created_at":"2026-01-11T21:04:13.748079134Z","created_by":"vscode"},{"issue_id":"clack-2c4c","depends_on_id":"clack-y8rf","type":"blocks","created_at":"2026-01-11T21:04:13.766895884Z","created_by":"vscode"},{"issue_id":"clack-2c4c","depends_on_id":"clack-y8qe","type":"blocks","created_at":"2026-01-11T21:04:13.8080743Z","created_by":"vscode"},{"issue_id":"clack-2c4c","depends_on_id":"clack-lwca","type":"blocks","created_at":"2026-01-11T21:17:13.940892342Z","created_by":"vscode"}]}
{"id":"clack-2jo","title":"Vestaboard API Wrapper - Testable Architecture","description":"Design and implement a highly testable, modular Vestaboard API wrapper following separation of concerns and dependency injection patterns. Split character conversion, HTTP communication, and orchestration into distinct, independently testable components with comprehensive test coverage (80%+).","design":"## Architecture Design\n\n### Component Separation\n1. **Character Converter** - Pure functions for text → character codes (no dependencies)\n2. **HTTP Client** - Fetch-based HTTP communication to Vestaboard Local API\n3. **Vestaboard Client** - Thin orchestration layer coordinating converter + HTTP\n4. **Factory Pattern** - Consistent with existing AI provider pattern\n\n### Dependency Injection\n- Constructor injection for all components\n- Interface-based design for mockability\n- No global state or singletons\n\n### Testability Strategy\n- Pure functions require zero mocks (character converter)\n- HTTP layer isolated and mockable\n- Mix real/mock implementations for different test levels\n- 80%+ coverage target across all components\n\n### File Structure\n```\nsrc/api/vestaboard/\n  character-converter.ts  # Pure functions + lookup table\n  http-client.ts          # VestaboardHTTPClient implementation\n  client.ts               # VestaboardClient orchestrator\n  errors.ts               # Error hierarchy\n  types.ts                # TypeScript interfaces\n  index.ts                # Factory + public exports\n```\n\n### References\n- Pattern: src/api/ai/index.ts (factory pattern)\n- Mocks: tests/__mocks__/ai-providers.ts\n- Tests: tests/unit/api/ai/openai.test.ts","acceptance_criteria":"- Character converter achieves 100% test coverage (pure functions)\n- HTTP client achieves 80%+ coverage with mocked fetch\n- Vestaboard client achieves 80%+ coverage with mocked dependencies\n- Integration tests pass with real converter + mock HTTP\n- Factory pattern matches AI provider conventions\n- All tests run in isolated environments (no real HTTP calls)\n- Existing usage sites (CronScheduler, EventHandler) work unchanged\n- Mock utilities available in tests/__mocks__/vestaboard.ts\n- Fixtures available in tests/fixtures/vestaboard-responses.json","status":"tombstone","priority":2,"issue_type":"epic","created_at":"2025-11-26T05:23:59.213789466Z","updated_at":"2026-01-03T21:41:47.645866918Z","deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"clack-2n6","title":"Create GlobalNewsGenerator (BBC, NYT)","description":"News generator for global/world news headlines.\n\n**Files:**\n- `src/content/generators/ai/global-news-generator.ts` (new)\n- `prompts/user/news-global.txt` (new)\n\n**Default Feeds:**\n- BBC News World: `https://feeds.bbci.co.uk/news/world/rss.xml`\n- NYT Headlines: `https://rss.nytimes.com/services/xml/rss/nyt/HomePage.xml`\n\n**Requirements:**\n- Extends base NewsGenerator\n- Uses `prompts/user/news-global.txt` for user prompt\n- Configurable via `RSS_GLOBAL_FEEDS` env var","status":"tombstone","priority":2,"issue_type":"task","assignee":"claude","created_at":"2025-11-27T09:20:59.010624216Z","updated_at":"2026-01-03T21:41:47.645866918Z","labels":["content","news"],"dependencies":[{"issue_id":"clack-2n6","depends_on_id":"clack-viu","type":"parent-child","created_at":"2025-11-27T09:21:47.408452794Z","created_by":"daemon"},{"issue_id":"clack-2n6","depends_on_id":"clack-42e","type":"blocks","created_at":"2025-11-27T09:22:12.524192458Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-2tg","title":"Task 4.2: Create ContentSelector for priority-based selection","description":"Create src/content/registry/content-selector.ts with select() method implementing P0 immediate interrupt, P2 random selection, P3 fallback logic.","acceptance_criteria":"- Constructor accepts ContentRegistry\n- select(context) returns RegisteredGenerator or null\n- P0: Match event pattern, immediate priority\n- P2: Random selection from normal priority\n- P3: Fallback selection\n- Unit tests for all priority scenarios","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-11-26T22:16:06.083678418Z","updated_at":"2026-01-03T21:41:47.645866918Z","dependencies":[{"issue_id":"clack-2tg","depends_on_id":"clack-4lg","type":"parent-child","created_at":"2025-11-26T22:16:15.235615089Z","created_by":"daemon"},{"issue_id":"clack-2tg","depends_on_id":"clack-nux","type":"blocks","created_at":"2025-11-26T22:16:15.646631173Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-2tqn","title":"Add missing getVestaboardConfig mock to App.test.tsx","description":"## Problem\nThe test \"renders Welcome page on default route\" in `tests/web/components/App.test.tsx` fails intermittently with:\n- Unable to find role=\"heading\" and name `/latest content/i`\n- Component shows \"Loading...\" state instead of expected heading\n\n## Root Cause\nThe apiClient mock is missing the `getVestaboardConfig` method. The Welcome component calls this on mount, causing a TypeError that creates a race condition.\n\n## Fix\n1. Add `getVestaboardConfig: jest.fn()` to the mock object (around line 23)\n2. Add `mockApiClient.getVestaboardConfig.mockResolvedValue({ model: 'black' });` to beforeEach\n\n## Acceptance Criteria\n- [ ] Add `getVestaboardConfig: jest.fn()` to the mock object\n- [ ] Add mock return value setup in beforeEach\n- [ ] Test passes consistently (run 10+ times to verify no flakiness)\n\n## Files\n- `tests/web/components/App.test.tsx`","status":"closed","priority":2,"issue_type":"bug","owner":"ryan@spice.cc","created_at":"2026-01-23T21:57:42.915579178Z","created_by":"Ryan Brodkin","updated_at":"2026-01-23T22:31:26.169301003Z","closed_at":"2026-01-23T22:31:26.169320128Z"}
{"id":"clack-2w5","title":"Implement Event Subscription System","description":"Implement subscribeToEvents(eventType, callback) with support for multiple subscribers per event type, auto-resubscribe on reconnection.","acceptance_criteria":"- subscribeToEvents(eventType, callback) method\n- Returns unsubscribe function\n- Multiple subscribers per event type\n- Event type filtering support\n- Internal event handler map\n- unsubscribeFromEvents(eventType) method\n- Auto-resubscribe on reconnection","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-11-24T00:18:44.33442047Z","updated_at":"2026-01-03T21:41:47.645866918Z","dependencies":[{"issue_id":"clack-2w5","depends_on_id":"clack-ar9","type":"blocks","created_at":"2025-11-24T00:19:52.130242835Z","created_by":"daemon"},{"issue_id":"clack-2w5","depends_on_id":"clack-4qv","type":"blocks","created_at":"2025-11-24T00:19:53.28286096Z","created_by":"daemon"},{"issue_id":"clack-2w5","depends_on_id":"clack-0nr","type":"parent-child","created_at":"2025-11-24T04:19:01.927242417Z","created_by":"vscode"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-2wk","title":"Update WeatherGenerator to use context.data.weather","description":"Modify WeatherGenerator to receive weather data through GenerationContext instead of fetching directly.\n\n**Files:**\n- `src/content/generators/ai-prompt-generator.ts`\n- `src/content/generators/ai/weather-generator.ts`\n- `prompts/user/weather-focus.txt`\n\n**Requirements:**\n- Modify `formatUserPrompt()` in base class to include `context.data.weather`\n- Format weather as structured context section\n- Update weather-focus.txt to reference CURRENT WEATHER section\n- Benefits from single fetch shared with FrameDecorator","status":"tombstone","priority":2,"issue_type":"task","assignee":"claude","created_at":"2025-11-27T09:21:01.261381967Z","updated_at":"2026-01-03T21:41:47.645866918Z","labels":["content","weather"],"dependencies":[{"issue_id":"clack-2wk","depends_on_id":"clack-viu","type":"parent-child","created_at":"2025-11-27T09:21:52.305895421Z","created_by":"daemon"},{"issue_id":"clack-2wk","depends_on_id":"clack-xu0","type":"blocks","created_at":"2025-11-27T09:22:15.88140521Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-2yw","title":"Weather display blank in frame info bar despite configured WEATHER_ENTITY","description":"## Problem\nThe weather section on Row 5 (info bar) of the Vestaboard frame is blank. Weather should display as a color code followed by temperature (e.g., `⬜72F`), but currently shows nothing.\n\n## Expected Behavior\nInfo bar should display: `WED 26NOV 10:30 [color]72F` where `[color]` is a Vestaboard color code (63-69) based on temperature/conditions.\n\n## Actual Behavior\nInfo bar shows: `WED 26NOV 10:30      ` with blank weather section.\n\n## Configuration\n- `$WEATHER_ENTITY` environment variable should specify the Home Assistant entity (e.g., `weather.apple`)\n- WeatherService defaults to `weather.apple` if not set\n\n## Data Flow (where bug may exist)\n```\nHomeAssistant → WeatherService.getWeather() → ContentDataProvider.fetchData()\n    → orchestrator context.data → FrameDecorator.decorate() → formatInfoBar()\n```\n\n## Potential Root Causes\n1. **HA Client not injected** - WeatherService may not receive HomeAssistantClient\n2. **Entity lookup failing** - `haClient.getState(entityId)` returns null/error silently\n3. **Data not passed through pipeline** - ContentDataProvider result not reaching FrameDecorator\n4. **formatInfoBar() issue** - Weather data received but not rendered\n\n## Key Files to Investigate\n- `src/services/weather-service.ts` - WeatherService.getWeather(), entity lookup\n- `src/services/content-data-provider.ts` - fetchData() parallel weather fetch\n- `src/content/frame/frame-generator.ts:50-74` - Weather fetch logic\n- `src/content/frame/info-bar.ts` - formatInfoBar() weather rendering\n- `src/content/orchestrator.ts:122-181` - Pipeline data passing\n- `src/bootstrap.ts:230, 254-264` - Component wiring","acceptance_criteria":"- [ ] Weather displays correctly on Row 5 when WEATHER_ENTITY is configured\n- [ ] Temperature shows with correct unit (°F or °C based on HA entity)\n- [ ] Color code (63-69) renders based on temperature/condition\n- [ ] Graceful degradation: blank weather section only when HA unavailable\n- [ ] Unit tests cover the fixed code path\n- [ ] Integration test validates end-to-end weather display","status":"tombstone","priority":2,"issue_type":"bug","created_at":"2025-11-27T20:40:55.488639958Z","updated_at":"2026-01-03T21:41:47.645866918Z","labels":["frame","home-assistant","weather"],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"bug"}
{"id":"clack-37ai","title":"PWA Enhancement","description":"Progressive Web App improvements for better mobile experience.\n\nIncludes:\n- Create PWA app icons\n- Document PWA setup and VAPID key configuration","notes":"Created in 2025 - stale issue cleanup","status":"closed","priority":3,"issue_type":"epic","created_at":"2025-11-29T07:00:22.14759375Z","updated_at":"2026-01-23T22:36:28.952742004Z","closed_at":"2026-01-23T22:36:28.952743879Z"}
{"id":"clack-3ekl","title":"Add Traefik Labels for clack.rybro.io","description":"Configure Traefik reverse proxy labels in docker-compose.prod.yml to enable web interface access at clack.rybro.io with TLS","status":"closed","priority":1,"issue_type":"epic","owner":"ryan@spice.cc","created_at":"2026-01-24T00:17:04.283715838Z","created_by":"Ryan Brodkin","updated_at":"2026-01-24T00:58:49.661254636Z","closed_at":"2026-01-24T00:58:49.661254636Z","close_reason":"Closed"}
{"id":"clack-3ekl.1","title":"Add Traefik labels to production docker-compose","description":"## Objective\nAdd Traefik reverse proxy labels to the app service in docker-compose.prod.yml to enable routing from clack.rybro.io to the containerized web interface.\n\n## Changes Required\n1. Add traefik_traefik as external network in networks section\n2. Attach app service to traefik_traefik network (in addition to clack-network)\n3. Add Traefik labels to app service deploy section\n\n## Traefik Labels to Add\n- traefik.enable=true\n- traefik.docker.network=traefik_traefik\n- traefik.http.routers.clack-track.rule=Host(\\`clack.rybro.io\\`)\n- traefik.http.routers.clack-track.tls.certResolver=myresolver\n- traefik.http.routers.clack-track.tls.domains[0].main=*.rybro.io\n- traefik.http.services.clack-track-service.loadbalancer.server.port=3000\n\n## Acceptance Criteria\n- [ ] traefik_traefik added as external network\n- [ ] App service attached to traefik_traefik network\n- [ ] Traefik labels configured for clack.rybro.io routing\n- [ ] TLS configured with myresolver cert resolver\n- [ ] Load balancer targets internal port 3000\n\n## Scope\nFiles: docker-compose.prod.yml","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-24T00:17:13.645130051Z","created_by":"Ryan Brodkin","updated_at":"2026-01-24T00:34:34.369795546Z","closed_at":"2026-01-24T00:34:34.369795546Z","close_reason":"Closed","dependencies":[{"issue_id":"clack-3ekl.1","depends_on_id":"clack-3ekl","type":"parent-child","created_at":"2026-01-24T00:17:13.646516717Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-3fx","title":"Remove deprecated @simplewebauthn/types package","description":"npm warns about deprecated @simplewebauthn/types@12.0.0 on install. The v13 packages (@simplewebauthn/server, @simplewebauthn/browser) now bundle types directly, making the separate types package unnecessary.","design":"1. Update imports in `src/web/routes/auth.ts` - change `from '@simplewebauthn/types'` to `from '@simplewebauthn/server'`\n2. Update imports in `src/web/routes/account.ts` - same change\n3. Remove `@simplewebauthn/types` from package.json dependencies\n4. Run `npm install` to update package-lock.json\n5. Run tests to verify no breakage","acceptance_criteria":"- No deprecation warning for @simplewebauthn/types on npm install\n- All passkey authentication tests pass\n- TypeScript compilation succeeds","status":"tombstone","priority":2,"issue_type":"bug","created_at":"2025-11-29T00:39:46.735613541Z","updated_at":"2026-01-03T21:41:47.645866918Z","deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"bug"}
{"id":"clack-3lm","title":"CLI argument parser captures positional args as flag values","description":"## Problem\n\nThe CLI argument parser in `src/cli/index.ts` incorrectly captures positional arguments as values for preceding boolean flags.\n\n## Steps to Reproduce\n\n```bash\nnpm run frame -- --skip-weather --skip-colors TEST\n```\n\n**Expected:** `{ text: \"TEST\", skipWeather: true, skipColors: true }`\n**Actual:** `{ text: undefined, skipWeather: true, skipColors: \"TEST\" }`\n\nSince `skipColors` becomes `\"TEST\"` instead of `true`, the check `options['skip-colors'] === true` fails, and colors are NOT skipped.\n\n## Root Cause\n\nIn `src/cli/index.ts:19`:\n```typescript\nconst value = args[i + 1] \u0026\u0026 !args[i + 1].startsWith('--') ? args[i + 1] : true;\n```\n\nThis logic assumes any non-flag argument following a flag is that flag's value. It doesn't distinguish between:\n- Flags that expect values (e.g., `--provider openai`)\n- Boolean flags (e.g., `--skip-colors`)\n\n## Impact\n\n- Users must put text BEFORE flags: `npm run frame \"TEXT\" --skip-colors` (works)\n- Flags after text are silently misinterpreted, causing unexpected behavior\n- No error is shown, making debugging difficult\n\n## Suggested Fix\n\nOptions:\n1. Define which flags are boolean vs value-expecting\n2. Use a proper argument parsing library (e.g., `commander`, `yargs`)\n3. Require `=` syntax for value flags: `--provider=openai`","status":"tombstone","priority":2,"issue_type":"bug","created_at":"2025-11-26T19:58:41.391390755Z","updated_at":"2026-01-03T21:41:47.645866918Z","labels":["cli","usability"],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"bug"}
{"id":"clack-3my","title":"Documentation","description":"Document the Home Assistant client API, configuration, and usage patterns.","status":"tombstone","priority":1,"issue_type":"epic","created_at":"2025-11-24T00:14:50.922107751Z","updated_at":"2026-01-03T21:41:47.645866918Z","deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"clack-3n0y","title":"Testing Foundations \u0026 Quick Wins","description":"## Overview\nSafe foundation work: delete unnecessary tests, fix performance anti-patterns, establish migration patterns for all subsequent epics.\n\n## Risk Level\nLOW - All changes are safe improvements\n\n## Files Affected\n14 files (6 deletions, 8 modifications)\n\n## Success Criteria\n- [ ] 6 TypeScript/library tests deleted\n- [ ] 3 DB connection patterns fixed\n- [ ] 3 timer issues resolved\n- [ ] 2 CLI integration tests refactored\n- [ ] All tests pass\n- [ ] Patterns established for Epics 2-7\n\n## Orchestration Notes\nAfter this epic completes, the following epics can run IN PARALLEL:\n- clack-b8xx: CLI Command Test Migration\n- clack-7yso: Storage Layer Test Migration\n- clack-uotb: AI Generators - Hot Take \u0026 Personality\n- clack-rjyb: AI Generators - News \u0026 Learning\n- clack-te4l: AI Generators - Philosophical \u0026 Misc\n- clack-5tjn: Core Orchestration Tests\n\nThese 6 epics are domain-isolated and have NO file overlap. They all depend only on this foundation epic.","status":"open","priority":1,"issue_type":"epic","owner":"ryan@spice.cc","created_at":"2026-01-27T22:07:56.780541097Z","created_by":"Ryan Brodkin","updated_at":"2026-01-27T22:35:51.139593594Z"}
{"id":"clack-3n0y.1","title":"Delete TypeScript/library behavior tests","description":"## Objective\nRemove tests that verify TypeScript compiler behavior or library internals, not application code.\n\n## TDD Approach\nNo test creation needed - this is test deletion. Verify remaining tests still provide adequate coverage.\n\n## Acceptance Criteria\n- [ ] Delete tests/unit/types/ai.test.ts\n- [ ] Delete tests/unit/types/content-generator.test.ts\n- [ ] Delete tests/unit/types/data-sources.test.ts\n- [ ] Delete tests/unit/fixtures/anthropic-responses.test.ts\n- [ ] Delete tests/unit/fixtures/openai-responses.test.ts\n- [ ] Delete tests/unit/fixtures/index.test.ts\n- [ ] Verify test suite still passes\n- [ ] Verify coverage thresholds still met (80%+)\n\n## Scope\nFiles: 6 test files to delete","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-27T22:08:08.21393963Z","created_by":"Ryan Brodkin","updated_at":"2026-01-28T02:33:15.678175096Z","closed_at":"2026-01-28T02:33:15.678178221Z","dependencies":[{"issue_id":"clack-3n0y.1","depends_on_id":"clack-3n0y","type":"parent-child","created_at":"2026-01-27T22:08:08.214959338Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-3n0y.2","title":"Fix per-test database connections","description":"## Objective\nChange per-test beforeEach database resets to beforeAll to improve test performance and follow best practices.\n\n## TDD Approach\n1. RED: Tests should already pass with current beforeEach pattern\n2. GREEN: Change beforeEach to beforeAll, tests should still pass\n3. BLUE: Verify improved test performance\n\n## Acceptance Criteria\n- [ ] Update tests/unit/storage/validation-attempts.test.ts (move resetKnexInstance to beforeAll)\n- [ ] Update tests/unit/storage/models/vote.test.ts (move resetKnexInstance to beforeAll)\n- [ ] Update tests/unit/storage/models/log.test.ts (move resetKnexInstance to beforeAll)\n- [ ] All tests pass after changes\n- [ ] Measure performance improvement (test execution time)\n\n## Scope\nFiles: 3 storage test files","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-27T22:08:21.265389344Z","created_by":"Ryan Brodkin","updated_at":"2026-01-28T02:33:15.741941304Z","closed_at":"2026-01-28T02:33:15.741944846Z","dependencies":[{"issue_id":"clack-3n0y.2","depends_on_id":"clack-3n0y","type":"parent-child","created_at":"2026-01-27T22:08:21.266233677Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-3n0y.3","title":"Fix real timer usage in unit tests","description":"## Objective\nReplace real timers with jest.useFakeTimers() to improve test speed and determinism.\n\n## TDD Approach\n1. RED: Identify tests using real timers (setTimeout, setInterval)\n2. GREEN: Add jest.useFakeTimers() in beforeEach, use jest.advanceTimersByTime()\n3. BLUE: Verify tests run faster and are deterministic\n\n## Acceptance Criteria\n- [ ] Update tests/unit/cli/commands/content-test.test.ts (add jest.useFakeTimers)\n- [ ] Update tests/unit/scheduler/event-handler.test.ts (add jest.useFakeTimers)\n- [ ] Update tests/unit/services/content-data-provider.test.ts (add jest.useFakeTimers)\n- [ ] Replace setTimeout/setInterval waits with jest.advanceTimersByTime()\n- [ ] All tests pass with fake timers\n- [ ] Tests run faster than before (measure execution time)\n\n## Scope\nFiles: 3 test files with timer issues","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-27T22:08:35.108161795Z","created_by":"Ryan Brodkin","updated_at":"2026-01-28T02:33:15.809342596Z","closed_at":"2026-01-28T02:33:15.809346013Z","dependencies":[{"issue_id":"clack-3n0y.3","depends_on_id":"clack-3n0y","type":"parent-child","created_at":"2026-01-27T22:08:35.109169795Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-3n0y.4","title":"Refactor CLI integration tests (process spawning)","description":"## Objective\nReplace CLI process spawning (execSync('npm run ...')) with direct function imports and calls. Establishes patterns for Epic 2.\n\n## TDD Approach\n1. RED: Write integration tests calling exported functions directly (initially fail if functions not exported)\n2. GREEN: Export command functions, update tests to import and call directly\n3. BLUE: Remove process spawning code, verify all tests pass\n\n## Acceptance Criteria\n- [ ] Update tests/integration/cli/content-commands.test.ts (replace execSync with direct function calls)\n- [ ] Update tests/integration/cli/npm-scripts-validation.test.ts (replace execSync with direct function calls)\n- [ ] Import command functions from @/cli/commands/ modules\n- [ ] Mock external boundaries (AI providers, Vestaboard client, HA client)\n- [ ] Use real ContentRegistry and bootstrap pattern\n- [ ] All tests pass without spawning processes\n- [ ] Tests run faster and are more reliable\n\n## Scope\nFiles: 2 test files, potentially 4-5 CLI command modules","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-27T22:09:03.313542252Z","created_by":"Ryan Brodkin","updated_at":"2026-01-28T02:33:15.87669568Z","closed_at":"2026-01-28T02:33:15.876697805Z","dependencies":[{"issue_id":"clack-3n0y.4","depends_on_id":"clack-3n0y","type":"parent-child","created_at":"2026-01-27T22:09:03.314738502Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-3qrp","title":"Add chapter prefix to serial story output","status":"closed","priority":1,"issue_type":"epic","owner":"ryan@spice.cc","created_at":"2026-01-23T20:18:47.302204377Z","created_by":"Ryan Brodkin","updated_at":"2026-01-23T22:17:25.975935419Z","closed_at":"2026-01-23T22:17:25.975935419Z","close_reason":"Closed"}
{"id":"clack-3qrp.1","title":"Update chapter 1 prompt with prefix instruction","description":"Modify prompts/user/serial-story-chapter1.txt to instruct AI to prefix output with \"CHAPTER {{currentChapter}}.\" on line 1. Include format example and character budget guidance (10 chars remaining after prefix).\n\n---\n[Verification Added]\nFILE: prompts/user/serial-story-chapter1.txt (EXCLUSIVE)\nRELATED: clack-3qrp.2 (similar change to continuation prompt)\nACCEPTANCE CRITERIA:\n- Prompt instructs AI to output \"CHAPTER 1.\" prefix on first line\n- Uses {{currentChapter}} template variable\n- Format example shows expected output\n- Character budget guidance included (~10 chars for prefix)\n- Existing prompt structure preserved","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-23T20:18:53.996408297Z","created_by":"Ryan Brodkin","updated_at":"2026-01-23T22:17:25.659004044Z","closed_at":"2026-01-23T22:17:25.659004044Z","close_reason":"Closed","dependencies":[{"issue_id":"clack-3qrp.1","depends_on_id":"clack-3qrp","type":"parent-child","created_at":"2026-01-23T20:18:53.998257297Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-3qrp.2","title":"Update continuation prompt with prefix instruction","description":"Modify prompts/user/serial-story-continuation.txt to instruct AI to prefix output with \"CHAPTER {{currentChapter}}.\" on line 1. Include format example and character budget guidance.\n\n---\n[Verification Added]\nFILE: prompts/user/serial-story-continuation.txt (EXCLUSIVE)\nRELATED: clack-3qrp.1 (similar change to chapter 1 prompt)\nACCEPTANCE CRITERIA:\n- Prompt instructs AI to output \"CHAPTER N.\" prefix on first line\n- Uses existing {{currentChapter}} template variable (already available)\n- Format example shows expected output\n- Character budget guidance included (~10 chars for prefix)\n- Existing prompt structure preserved","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-23T20:18:55.506363089Z","created_by":"Ryan Brodkin","updated_at":"2026-01-23T22:17:25.747944794Z","closed_at":"2026-01-23T22:17:25.747944794Z","close_reason":"Closed","dependencies":[{"issue_id":"clack-3qrp.2","depends_on_id":"clack-3qrp","type":"parent-child","created_at":"2026-01-23T20:18:55.507339964Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-3qrp.3","title":"Add currentChapter template variable for chapter 1","description":"Modify SerialStoryGenerator.getTemplateVariables() to return currentChapter: \"1\" for new stories so the chapter 1 prompt can use {{currentChapter}} template variable.\n\n---\n[Verification Added]\nFILE: src/content/generators/ai/serial-story-generator.ts (EXCLUSIVE)\nCHANGE LOCATION: getTemplateVariables() method, lines 362-376\nRELATED: clack-3qrp.1 (prompt that uses this variable)\nACCEPTANCE CRITERIA:\n- Chapter 1 template variables include currentChapter: \"1\"\n- Continuation behavior unchanged (already returns currentChapter)\n- No breaking changes to existing functionality\n- Type safety maintained","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-23T20:19:02.572778259Z","created_by":"Ryan Brodkin","updated_at":"2026-01-23T22:17:25.814172628Z","closed_at":"2026-01-23T22:17:25.814172628Z","close_reason":"Closed","dependencies":[{"issue_id":"clack-3qrp.3","depends_on_id":"clack-3qrp","type":"parent-child","created_at":"2026-01-23T20:19:02.585922301Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-3qrp.4","title":"Add tests for chapter prefix template variables","description":"Add test cases to verify template variables include currentChapter for both chapter 1 and continuation. Test that chapter 1 receives currentChapter: \"1\".\n\n---\n[Verification Added]\nFILE: tests/unit/content/generators/ai/serial-story-generator.test.ts (EXCLUSIVE)\nRELATED: clack-3qrp.3 (code being tested)\nACCEPTANCE CRITERIA:\n- Test case: chapter 1 getTemplateVariables() returns currentChapter: \"1\"\n- Test case: continuation getTemplateVariables() returns currentChapter as string\n- Verify scenario and emotionalBeat still returned for chapter 1\n- Tests pass with existing test patterns in file\n- No reduction in existing test coverage","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-23T20:19:04.087914343Z","created_by":"Ryan Brodkin","updated_at":"2026-01-23T22:17:25.888642294Z","closed_at":"2026-01-23T22:17:25.888642294Z","close_reason":"Closed","dependencies":[{"issue_id":"clack-3qrp.4","depends_on_id":"clack-3qrp","type":"parent-child","created_at":"2026-01-23T20:19:04.093090301Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-3qrp.4","depends_on_id":"clack-3qrp.3","type":"blocks","created_at":"2026-01-23T20:19:12.477641722Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-40n","title":"API route tests in wrong directory structure","description":"API route tests are located in `tests/web/api-routes/` but should be in `tests/e2e/web/` or `tests/integration/web/` to match the project's test organization pattern.\n\nCurrent location:\n- `tests/web/api-routes/content.test.ts`\n- `tests/web/api-routes/voting.test.ts`\n- `tests/web/api-routes/logs.test.ts`\n\nThe `tests/` directory structure uses `unit/`, `integration/`, `e2e/`, and `web/` as top-level categories. Having `api-routes/` nested under `web/` is inconsistent with this pattern.","design":"## Analysis\n\nThe API route tests in `tests/web/api-routes/` are:\n- **Mislabeled** as \"Integration tests\" but are actually **unit tests** (all dependencies mocked)\n- Using `@jest-environment node` annotation to override jsdom (a workaround)\n- Making **NO real API calls** - repositories and models are fully mocked\n\nThe `tests/web/` project is configured for jsdom environment (React component tests), which is why these tests need the override annotation.\n\n## Solution\n\nMove tests to `tests/unit/web/routes/` to match existing patterns:\n- `tests/unit/web/server.test.ts` - Unit tests for web server\n- `tests/unit/web/middleware/rate-limit.test.ts` - Unit tests for middleware\n\n## Files to Move\n\n| From | To |\n|------|-----|\n| `tests/web/api-routes/content.test.ts` | `tests/unit/web/routes/content.test.ts` |\n| `tests/web/api-routes/voting.test.ts` | `tests/unit/web/routes/voting.test.ts` |\n| `tests/web/api-routes/logs.test.ts` | `tests/unit/web/routes/logs.test.ts` |\n\n## Changes Per File\n\n1. **Update doc comment**: \"Integration tests\" → \"Unit tests\"\n2. **Remove `@jest-environment node`**: Not needed (unit project uses node)\n3. **Update import paths**: Add one more `../` level (3 → 4 levels up)\n\n## No Jest Config Changes Needed\n\nThe unit project already matches `tests/unit/**/*.test.ts` with node environment.","acceptance_criteria":"- [ ] Create `tests/unit/web/routes/` directory\n- [ ] Move `content.test.ts`, `voting.test.ts`, `logs.test.ts` to new location\n- [ ] Update doc comments from \"Integration tests\" to \"Unit tests\"\n- [ ] Remove `@jest-environment node` annotations (not needed in unit project)\n- [ ] Update import paths (add one `../` level to all imports)\n- [ ] Delete empty `tests/web/api-routes/` directory\n- [ ] Verify tests pass: `npm run test:unit -- --testPathPattern=\"routes\"`","status":"tombstone","priority":3,"issue_type":"bug","created_at":"2025-11-28T10:29:03.244842429Z","updated_at":"2026-01-03T21:41:47.645866918Z","deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"bug"}
{"id":"clack-41qs","title":"Stateful Circuit Breaker System","description":"Implement a persistent circuit breaker system with manual control circuits (Master, Sleep) and automatic per-provider circuit breakers that trip on failures.\n\n## Goals\n- Circuit state persists across application restarts\n- Master circuit (off) blocks ALL update paths (CLI, HA events, scheduled)\n- Provider circuits auto-trip after configurable failure threshold\n- CLI can query, toggle, and poll circuit states in real-time\n- HA vestaboard_circuit_control events can toggle any circuit\n\n## Circuits\n| Circuit ID | Type | Default | Purpose |\n|------------|------|---------|---------|\n| MASTER | manual | ON | Global kill switch - blocks all updates when off |\n| SLEEP_MODE | manual | OFF | Future use - reserved for quiet hours |\n| PROVIDER_OPENAI | provider | ON | Auto-trips on OpenAI failures |\n| PROVIDER_ANTHROPIC | provider | ON | Auto-trips on Anthropic failures |\n\n## Success Criteria\n- 80%+ test coverage on all new code\n- All circuits functional via CLI and HA events\n- Provider circuits integrate with existing retry/failover logic","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-12T01:50:04.359509127Z","created_by":"vscode","updated_at":"2026-01-12T19:46:26.389793254Z","closed_at":"2026-01-12T19:46:26.389793254Z","close_reason":"All implementation complete. MySQL connectivity verified, circuit commands working."}
{"id":"clack-41qs.1","title":"Create circuit breaker database migration","description":"Create Knex migration for circuit_breaker_state table supporting both manual and provider circuits.\n\n## Acceptance Criteria\n- Migration file in migrations/ following naming convention\n- Table schema:\n  - id, circuit_id (unique), circuit_type ('manual' | 'provider')\n  - state (boolean), default_state (boolean), description\n  - failure_count (int), success_count (int), failure_threshold (int)\n  - last_failure_at, last_success_at, state_changed_at\n  - created_at, updated_at\n- Migration runs successfully on both SQLite and MySQL\n- Rollback drops table cleanly\n\n## Files\n- migrations/004_create_circuit_breaker_state.cjs","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T01:50:50.88201626Z","created_by":"vscode","updated_at":"2026-01-12T06:45:08.587610793Z","closed_at":"2026-01-12T06:45:08.587610793Z","close_reason":"Implemented in feature/clack-41qs-review branch","dependencies":[{"issue_id":"clack-41qs.1","depends_on_id":"clack-41qs","type":"parent-child","created_at":"2026-01-12T01:50:50.885613593Z","created_by":"vscode"}]}
{"id":"clack-41qs.10","title":"Add circuit checks to EventHandler","description":"Check Master circuit before triggering updates from HA events.\n\n## Acceptance Criteria\n- Both vestaboard_refresh and state_changed handlers check Master circuit\n- Blocked events are logged but not processed\n- Does NOT interfere with vestaboard_circuit_control events (those always process)\n- Unit tests verify circuit blocking for each event type\n\n## Related Issues\n- clack-41qs.7 (HA event listener) also modifies event-handler.ts - runs in prior layer, no conflict\n\n## Files\n- src/scheduler/event-handler.ts (edit)\n- tests/unit/scheduler/event-handler.test.ts (edit)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T01:51:00.716672167Z","created_by":"vscode","updated_at":"2026-01-12T06:45:08.623299127Z","closed_at":"2026-01-12T06:45:08.623299127Z","close_reason":"Implemented in feature/clack-41qs-review branch","dependencies":[{"issue_id":"clack-41qs.10","depends_on_id":"clack-41qs","type":"parent-child","created_at":"2026-01-12T01:51:00.720167125Z","created_by":"vscode"},{"issue_id":"clack-41qs.10","depends_on_id":"clack-41qs.3","type":"blocks","created_at":"2026-01-12T01:51:26.188913054Z","created_by":"vscode"},{"issue_id":"clack-41qs.10","depends_on_id":"clack-41qs.8","type":"blocks","created_at":"2026-01-12T01:51:26.211318929Z","created_by":"vscode"}]}
{"id":"clack-41qs.11","title":"Bootstrap integration and configuration","description":"Wire CircuitBreakerService into bootstrap and add configuration.\n\n## Acceptance Criteria\n- CircuitBreakerService created in bootstrap after database connection\n- Injected into ContentOrchestrator, EventHandler, retry logic\n- Added to BootstrapResult interface\n- Environment variables for thresholds:\n  - CIRCUIT_BREAKER_FAILURE_THRESHOLD (default: 5)\n  - CIRCUIT_BREAKER_RESET_TIMEOUT_MS (default: 300000)\n  - CIRCUIT_BREAKER_HALF_OPEN_ATTEMPTS (default: 2)\n- Config documented in .env.example\n- Integration test verifying full circuit flow (manual and provider)\n\n## Related\n- Depends on: All other issues in this epic\n- This is the final integration issue\n\n## Files\n- src/bootstrap.ts (edit)\n- src/config/env.ts (edit)\n- .env.example (edit)\n- tests/integration/circuit-breaker.test.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T01:51:02.012231876Z","created_by":"vscode","updated_at":"2026-01-12T06:45:08.627156585Z","closed_at":"2026-01-12T06:45:08.627156585Z","close_reason":"Implemented in feature/clack-41qs-review branch","dependencies":[{"issue_id":"clack-41qs.11","depends_on_id":"clack-41qs","type":"parent-child","created_at":"2026-01-12T01:51:02.015859876Z","created_by":"vscode"},{"issue_id":"clack-41qs.11","depends_on_id":"clack-41qs.3","type":"blocks","created_at":"2026-01-12T01:51:28.050337596Z","created_by":"vscode"},{"issue_id":"clack-41qs.11","depends_on_id":"clack-41qs.4","type":"blocks","created_at":"2026-01-12T01:51:28.071573346Z","created_by":"vscode"},{"issue_id":"clack-41qs.11","depends_on_id":"clack-41qs.5","type":"blocks","created_at":"2026-01-12T01:51:28.092124638Z","created_by":"vscode"},{"issue_id":"clack-41qs.11","depends_on_id":"clack-41qs.6","type":"blocks","created_at":"2026-01-12T01:51:28.119410888Z","created_by":"vscode"},{"issue_id":"clack-41qs.11","depends_on_id":"clack-41qs.7","type":"blocks","created_at":"2026-01-12T01:51:28.14201268Z","created_by":"vscode"},{"issue_id":"clack-41qs.11","depends_on_id":"clack-41qs.8","type":"blocks","created_at":"2026-01-12T01:51:28.212127805Z","created_by":"vscode"},{"issue_id":"clack-41qs.11","depends_on_id":"clack-41qs.9","type":"blocks","created_at":"2026-01-12T01:51:28.251610847Z","created_by":"vscode"},{"issue_id":"clack-41qs.11","depends_on_id":"clack-41qs.10","type":"blocks","created_at":"2026-01-12T01:51:28.283200888Z","created_by":"vscode"}]}
{"id":"clack-41qs.2","title":"Implement CircuitBreakerRepository","description":"Create repository class for CRUD operations on circuit breaker state with Knex.\n\n## Acceptance Criteria\n- Repository in src/storage/repositories/circuit-breaker-repo.ts\n- Methods: getState(circuitId), setState(circuitId, state), getAllStates(), initializeCircuit(...), recordFailure(circuitId), recordSuccess(circuitId), resetCounters(circuitId)\n- Graceful handling when database unavailable (returns default state)\n- Exports from src/storage/repositories/index.ts\n- Unit tests with 80%+ coverage\n\n## Files\n- src/storage/repositories/circuit-breaker-repo.ts\n- src/storage/repositories/index.ts (edit)\n- tests/unit/storage/repositories/circuit-breaker-repo.test.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T01:50:51.719193135Z","created_by":"vscode","updated_at":"2026-01-12T06:45:08.593273043Z","closed_at":"2026-01-12T06:45:08.593273043Z","close_reason":"Implemented in feature/clack-41qs-review branch","dependencies":[{"issue_id":"clack-41qs.2","depends_on_id":"clack-41qs","type":"parent-child","created_at":"2026-01-12T01:50:51.725711177Z","created_by":"vscode"}]}
{"id":"clack-41qs.3","title":"Create CircuitBreakerService core","description":"Service layer for manual circuits (Master, Sleep) with state persistence.\n\n## Acceptance Criteria\n- Service in src/services/circuit-breaker-service.ts\n- Manual circuit definitions: MASTER (default: on), SLEEP_MODE (default: off)\n- Methods: isCircuitOpen(circuitId), setCircuitState(circuitId, state), getCircuitStatus(circuitId), getAllCircuits(), getCircuitsByType(type)\n- Uses repository for persistence, falls back to defaults when DB unavailable\n- Initializes circuits on first run (inserts defaults if not present)\n- Type definitions in src/types/circuit-breaker.ts\n- Unit tests with 80%+ coverage\n\n## Related Issues\n- clack-41qs.4 (provider circuits) extends this service file - run sequentially\n\n## Files\n- src/services/circuit-breaker-service.ts\n- src/types/circuit-breaker.ts\n- src/types/index.ts (edit)\n- tests/unit/services/circuit-breaker-service.test.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T01:50:52.987999302Z","created_by":"vscode","updated_at":"2026-01-12T06:45:08.597360418Z","closed_at":"2026-01-12T06:45:08.597360418Z","close_reason":"Implemented in feature/clack-41qs-review branch","dependencies":[{"issue_id":"clack-41qs.3","depends_on_id":"clack-41qs","type":"parent-child","created_at":"2026-01-12T01:50:52.991604594Z","created_by":"vscode"},{"issue_id":"clack-41qs.3","depends_on_id":"clack-41qs.1","type":"blocks","created_at":"2026-01-12T01:51:16.491902424Z","created_by":"vscode"},{"issue_id":"clack-41qs.3","depends_on_id":"clack-41qs.2","type":"blocks","created_at":"2026-01-12T01:51:16.517470299Z","created_by":"vscode"}]}
{"id":"clack-41qs.4","title":"Add provider circuit state machine","description":"Extend CircuitBreakerService with automatic provider circuits that trip on failures.\n\n## Acceptance Criteria\n- Provider circuits: PROVIDER_OPENAI, PROVIDER_ANTHROPIC (default: on)\n- State machine: CLOSED (on) → OPEN (off after threshold) → HALF_OPEN (test recovery) → CLOSED\n- Methods: recordProviderFailure(providerId, error), recordProviderSuccess(providerId), isProviderAvailable(providerId), getProviderStatus(providerId)\n- Configurable: failure threshold (default: 5), reset timeout (default: 5 min), half-open max attempts (default: 2)\n- Differentiates error types: RateLimitError/OverloadedError count toward threshold; AuthenticationError trips immediately\n- Manual override capability (force open/close regardless of auto-state)\n- Unit tests with 80%+ coverage including state transitions\n\n## Related Issues\n- clack-41qs.3 (service core) creates the base - this issue extends it\n- clack-41qs.9 (retry integration) consumes provider circuit methods\n\n## Files (shared with clack-41qs.3 - run sequentially)\n- src/services/circuit-breaker-service.ts (edit)\n- src/types/circuit-breaker.ts (edit)\n- tests/unit/services/circuit-breaker-service.test.ts (edit)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T01:50:54.183668761Z","created_by":"vscode","updated_at":"2026-01-12T06:45:08.601386127Z","closed_at":"2026-01-12T06:45:08.601386127Z","close_reason":"Implemented in feature/clack-41qs-review branch","dependencies":[{"issue_id":"clack-41qs.4","depends_on_id":"clack-41qs","type":"parent-child","created_at":"2026-01-12T01:50:54.188301011Z","created_by":"vscode"},{"issue_id":"clack-41qs.4","depends_on_id":"clack-41qs.1","type":"blocks","created_at":"2026-01-12T01:51:17.633257342Z","created_by":"vscode"},{"issue_id":"clack-41qs.4","depends_on_id":"clack-41qs.2","type":"blocks","created_at":"2026-01-12T01:51:17.661657758Z","created_by":"vscode"},{"issue_id":"clack-41qs.4","depends_on_id":"clack-41qs.3","type":"blocks","created_at":"2026-01-12T01:53:33.243655126Z","created_by":"vscode"}]}
{"id":"clack-41qs.5","title":"Add CLI commands for circuit control","description":"CLI commands to view and control all circuit breaker states.\n\n## Acceptance Criteria\n- Commands: circuit:status (list all), circuit:on \u003cid\u003e, circuit:off \u003cid\u003e, circuit:reset \u003cid\u003e (reset counters)\n- Output shows: circuit ID, type, current state, default state, failure count, last state change\n- Provider circuits show additional: threshold, success count, time until auto-reset\n- Validates circuit ID exists before operations\n- Updates src/cli/index.ts command routing\n- Unit tests for command parsing and output formatting\n\n## Related Issues\n- clack-41qs.6 (watch command) extends this file - run sequentially\n\n## Files\n- src/cli/commands/circuit.ts\n- src/cli/index.ts (edit)\n- tests/unit/cli/commands/circuit.test.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T01:50:55.11725722Z","created_by":"vscode","updated_at":"2026-01-12T06:45:08.604841293Z","closed_at":"2026-01-12T06:45:08.604841293Z","close_reason":"Implemented in feature/clack-41qs-review branch","dependencies":[{"issue_id":"clack-41qs.5","depends_on_id":"clack-41qs","type":"parent-child","created_at":"2026-01-12T01:50:55.12123872Z","created_by":"vscode"},{"issue_id":"clack-41qs.5","depends_on_id":"clack-41qs.3","type":"blocks","created_at":"2026-01-12T01:51:19.167561842Z","created_by":"vscode"},{"issue_id":"clack-41qs.5","depends_on_id":"clack-41qs.4","type":"blocks","created_at":"2026-01-12T01:51:19.193455259Z","created_by":"vscode"}]}
{"id":"clack-41qs.6","title":"Add CLI polling/watch command","description":"CLI command to continuously poll and display circuit states.\n\n## Acceptance Criteria\n- Command: circuit:watch [--interval=\u003cms\u003e] (default: 2000ms)\n- Clears terminal and refreshes display at interval\n- Shows all circuits in formatted table with live state\n- Highlights state changes (e.g., circuit that just tripped)\n- Graceful exit on Ctrl+C\n- Option: circuit:watch --json for machine-readable output\n- Unit tests for formatting, integration test for polling behavior\n\n## Related Issues\n- clack-41qs.5 (base CLI commands) must complete first - shares file\n\n## Files (shared with clack-41qs.5 - run sequentially)\n- src/cli/commands/circuit.ts (edit)\n- tests/unit/cli/commands/circuit.test.ts (edit)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T01:50:56.237727971Z","created_by":"vscode","updated_at":"2026-01-12T06:45:08.608603335Z","closed_at":"2026-01-12T06:45:08.608603335Z","close_reason":"Implemented in feature/clack-41qs-review branch","dependencies":[{"issue_id":"clack-41qs.6","depends_on_id":"clack-41qs","type":"parent-child","created_at":"2026-01-12T01:50:56.241479804Z","created_by":"vscode"},{"issue_id":"clack-41qs.6","depends_on_id":"clack-41qs.3","type":"blocks","created_at":"2026-01-12T01:51:20.267573718Z","created_by":"vscode"},{"issue_id":"clack-41qs.6","depends_on_id":"clack-41qs.4","type":"blocks","created_at":"2026-01-12T01:51:20.296447676Z","created_by":"vscode"},{"issue_id":"clack-41qs.6","depends_on_id":"clack-41qs.5","type":"blocks","created_at":"2026-01-12T01:53:34.195989293Z","created_by":"vscode"}]}
{"id":"clack-41qs.7","title":"Integrate HA event listener for circuits","description":"Subscribe to vestaboard_circuit_control events and toggle circuit states.\n\n## Acceptance Criteria\n- Event payload schema: { circuit_id: string, state: 'on' | 'off' | 'reset' }\n- EventHandler subscribes to vestaboard_circuit_control event type\n- Supports all circuits (manual and provider)\n- 'reset' action resets failure counters for provider circuits\n- Validates payload, logs invalid events\n- Calls CircuitBreakerService to perform action\n- Unit tests with mocked HA client\n\n## Related Issues\n- clack-41qs.10 (circuit checks in EventHandler) also modifies event-handler.ts - different layer, no overlap\n\n## Files\n- src/scheduler/event-handler.ts (edit)\n- tests/unit/scheduler/event-handler.test.ts (edit)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T01:50:57.220995054Z","created_by":"vscode","updated_at":"2026-01-12T06:45:08.612521918Z","closed_at":"2026-01-12T06:45:08.612521918Z","close_reason":"Implemented in feature/clack-41qs-review branch","dependencies":[{"issue_id":"clack-41qs.7","depends_on_id":"clack-41qs","type":"parent-child","created_at":"2026-01-12T01:50:57.221862804Z","created_by":"vscode"},{"issue_id":"clack-41qs.7","depends_on_id":"clack-41qs.3","type":"blocks","created_at":"2026-01-12T01:51:21.887987469Z","created_by":"vscode"},{"issue_id":"clack-41qs.7","depends_on_id":"clack-41qs.4","type":"blocks","created_at":"2026-01-12T01:51:21.914689052Z","created_by":"vscode"}]}
{"id":"clack-41qs.8","title":"Add circuit checks to ContentOrchestrator","description":"Check Master circuit and provider circuits before generating/sending content.\n\n## Acceptance Criteria\n- generateAndSend() checks isCircuitOpen('MASTER') first - blocks all if off\n- Before AI generation, checks provider circuit availability\n- If preferred provider circuit is open, uses alternate provider (existing failover)\n- If both provider circuits are open, skips to P3 fallback\n- Returns result indicating which circuit(s) affected the update\n- Unit tests verify circuit blocking behavior for all scenarios\n\n## Related\n- Depends on: Service core, Provider state machine\n- Related to: Retry integration (provider checking), EventHandler checks\n\n## Files\n- src/content/orchestrator.ts (edit)\n- tests/unit/content/orchestrator.test.ts (edit)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T01:50:58.604237597Z","created_by":"vscode","updated_at":"2026-01-12T06:45:08.616402252Z","closed_at":"2026-01-12T06:45:08.616402252Z","close_reason":"Implemented in feature/clack-41qs-review branch","dependencies":[{"issue_id":"clack-41qs.8","depends_on_id":"clack-41qs","type":"parent-child","created_at":"2026-01-12T01:50:58.607431513Z","created_by":"vscode"},{"issue_id":"clack-41qs.8","depends_on_id":"clack-41qs.3","type":"blocks","created_at":"2026-01-12T01:51:23.424769844Z","created_by":"vscode"},{"issue_id":"clack-41qs.8","depends_on_id":"clack-41qs.4","type":"blocks","created_at":"2026-01-12T01:51:23.454367511Z","created_by":"vscode"}]}
{"id":"clack-41qs.9","title":"Integrate provider circuits with retry logic","description":"Connect provider circuits to existing retry/failover mechanism.\n\n## Acceptance Criteria\n- generateWithRetry() calls recordProviderFailure() on retryable errors\n- generateWithRetry() calls recordProviderSuccess() on successful generation\n- Before attempting provider, checks isProviderAvailable() - skips unavailable\n- Half-open state allows limited test requests through\n- Existing FailoverMetadata extended with circuit breaker state info\n- Unit tests verify failure counting and state transitions during retry\n\n## Related\n- Depends on: Provider state machine, Orchestrator checks\n- Related to: orchestrator-retry.ts is the main consumer of provider circuits\n\n## Files\n- src/content/orchestrator-retry.ts (edit)\n- src/types/content.ts (edit - FailoverMetadata)\n- tests/unit/content/orchestrator-retry.test.ts (edit)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T01:50:59.827973125Z","created_by":"vscode","updated_at":"2026-01-12T06:45:08.620162085Z","closed_at":"2026-01-12T06:45:08.620162085Z","close_reason":"Implemented in feature/clack-41qs-review branch","dependencies":[{"issue_id":"clack-41qs.9","depends_on_id":"clack-41qs","type":"parent-child","created_at":"2026-01-12T01:50:59.828836083Z","created_by":"vscode"},{"issue_id":"clack-41qs.9","depends_on_id":"clack-41qs.4","type":"blocks","created_at":"2026-01-12T01:51:24.684471887Z","created_by":"vscode"},{"issue_id":"clack-41qs.9","depends_on_id":"clack-41qs.8","type":"blocks","created_at":"2026-01-12T01:51:24.72355172Z","created_by":"vscode"}]}
{"id":"clack-42e","title":"Create base NewsGenerator class with RSS self-fetching","description":"Abstract base class for all news generators that fetches RSS headlines before AI generation.\n\n**Files:** `src/content/generators/ai/base-news-generator.ts` (new)\n\n**Requirements:**\n- Extends `AIPromptGenerator`\n- Accepts `RSSClient` and `feedUrls: string[]` via constructor\n- Override `generate()` to fetch headlines before AI call\n- Format headlines and inject into user prompt context\n- Graceful fallback if RSS unavailable (AI generates without news)\n- Abstract `getUserPromptFile()` for subclasses to implement","status":"tombstone","priority":2,"issue_type":"task","assignee":"claude","created_at":"2025-11-27T09:20:42.363066167Z","updated_at":"2026-01-03T21:41:47.645866918Z","labels":["content","news"],"dependencies":[{"issue_id":"clack-42e","depends_on_id":"clack-viu","type":"parent-child","created_at":"2025-11-27T09:21:47.134196044Z","created_by":"daemon"},{"issue_id":"clack-42e","depends_on_id":"clack-y91","type":"blocks","created_at":"2025-11-27T09:22:12.403816958Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-454f","title":"Improve content-generator-designer skill discovery","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-11T22:55:40.687714964Z","created_by":"vscode","updated_at":"2026-01-12T01:15:49.305553259Z","closed_at":"2026-01-12T01:15:49.305553259Z","close_reason":"Skill renamed to content-generator-designer with updated frontmatter"}
{"id":"clack-454f.1","title":"Rename skill and rewrite frontmatter description","description":"Rename vestaboard-prompt skill directory to content-generator-designer and update frontmatter description to clearly signal end-to-end generator design authority.\n\nCurrent description leads with 'prompts', buries 'generators' as secondary.\n\nFiles:\n- .claude/skills/vestaboard-prompt/ → .claude/skills/content-generator-designer/\n- .claude/skills/content-generator-designer/SKILL.md (frontmatter only)\n\nAcceptance Criteria:\n- Directory renamed to content-generator-designer\n- Frontmatter name updated to content-generator-designer\n- Description leads with 'generator design', lists implementation scope\n- Includes explicit 'Use for...' trigger phrase\n\nProposed description:\nEnd-to-end content generator design for Vestaboard displays. Covers generator architecture (AI, programmatic, notification types), prompt design, TypeScript implementation patterns, registry integration, and quality validation. Use for creating, modifying, or debugging any content generator.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T22:55:48.156654968Z","created_by":"vscode","updated_at":"2026-01-12T01:15:49.295639343Z","closed_at":"2026-01-12T01:15:49.295639343Z","close_reason":"Skill renamed to content-generator-designer with updated frontmatter","dependencies":[{"issue_id":"clack-454f.1","depends_on_id":"clack-454f","type":"parent-child","created_at":"2026-01-11T22:55:48.157554676Z","created_by":"vscode"}]}
{"id":"clack-4a7","title":"Document PWA setup and VAPID key configuration","description":"Add PWA documentation to README.md covering setup, VAPID key generation, and push notification configuration.\n\n**Topics to document:**\n- PWA features overview (offline support, installable, push notifications)\n- VAPID key generation: `npx web-push generate-vapid-keys`\n- Environment variables required (VAPID_PUBLIC_KEY, VAPID_PRIVATE_KEY, VAPID_SUBJECT)\n- How to test \"Add to Home Screen\" on iOS/Android\n- Push notification API endpoints (/api/push/*)\n- Service worker caching strategies","notes":"3-char identifier cleanup","status":"closed","priority":3,"issue_type":"task","created_at":"2025-11-29T00:35:24.656272045Z","updated_at":"2026-01-23T22:36:20.312202708Z","closed_at":"2026-01-23T22:36:20.312205708Z","labels":["docs","pwa"],"dependencies":[{"issue_id":"clack-4a7","depends_on_id":"clack-37ai","type":"parent-child","created_at":"2025-11-29T07:01:41.0868818Z","created_by":"daemon"}]}
{"id":"clack-4g0","title":"[HIGH] Fix server.test.ts brittle middleware order assertions","description":"**File:** tests/unit/web/server.test.ts\n**Lines:** 115-129, 222-305\n**Category:** Too Brittle\n**Severity:** High\n\n## Problem\nTests check implementation details by verifying middleware call order by array index position. If middleware setup order changes slightly (e.g., adding logging before helmet), tests break even though functionality is correct.\n\n## Evidence\n```typescript\n// Lines 125-128 - Checks index position\nit('should set up helmet security middleware first', async () =\u003e {\n  // ...\n  const helmetCallIndex = mockHelmet.mock.invocationCallOrder[0];\n  expect(helmetCallIndex).toBeLessThan(otherMiddleware.mock.invocationCallOrder[0]);\n});\n```\n\nSignal handling tests (lines 222-305) also extract handlers from spy calls at runtime, coupling tightly to how handlers are registered.\n\n## Implementation Instructions\n1. **For middleware order tests:**\n   - If order is critical for security, test that helmet headers appear in responses\n   - Use `mock.invocationCallOrder` comparisons rather than index positions\n   - Or test the actual security effect (verify CSP header exists, etc.)\n\n2. **For signal handling tests:**\n   - Refactor to emit actual signals and verify cleanup behavior\n   - Or use callback patterns to verify handlers work\n   - Remove try-catch wrapping around mocked process.exit()\n\n## Acceptance Criteria\n- [ ] Middleware tests verify security headers in responses, not call order\n- [ ] OR if order matters, use invocationCallOrder comparisons\n- [ ] Signal handling tests don't depend on spy call extraction patterns\n- [ ] Tests remain stable if internal middleware registration changes","status":"tombstone","priority":1,"issue_type":"bug","created_at":"2025-11-29T05:06:04.705274673Z","updated_at":"2026-01-03T21:41:47.645866918Z","close_reason":"Verified complete by code review","labels":["high","testing"],"dependencies":[{"issue_id":"clack-4g0","depends_on_id":"clack-s9o","type":"parent-child","created_at":"2025-11-29T05:09:50.274514333Z","created_by":"daemon"},{"issue_id":"clack-4g0","depends_on_id":"clack-ofzp","type":"parent-child","created_at":"2025-11-29T07:01:18.417546762Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"bug"}
{"id":"clack-4jw","title":"Welcome page with Vestaboard display and voting","description":"Build mobile-first home page displaying current Vestaboard content in a 6×22 character grid with thumbs up/down voting buttons connected to API.","design":"**Components:**\n1. VestaboardDisplay - 6×22 grid, split-flap aesthetic (amber/black)\n2. VotingButtons - Large touch-friendly thumbs up/down\n3. WelcomePage - Fetches content, handles voting\n\n**API Integration:**\n- Fetch latest content via apiClient.getLatestContent()\n- Submit votes via apiClient.submitVote()\n- Loading/error states\n\n**Styling:**\n- Split-flap aesthetic with shadows\n- Mobile-first responsive design\n- Success feedback after voting","acceptance_criteria":"- [ ] VestaboardDisplay renders 6×22 grid correctly\n- [ ] Split-flap aesthetic styling (amber/black with shadows)\n- [ ] Voting buttons large and touch-friendly (min 44×44px)\n- [ ] Vote submission shows loading state\n- [ ] Success feedback displayed after vote\n- [ ] Error handling with user-friendly messages\n- [ ] Mobile-first responsive design (320px min)\n- [ ] Empty state when no content available\n- [ ] Unit tests with 80%+ coverage\n- [ ] Integration test for voting flow","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-11-26T05:05:07.607553595Z","updated_at":"2026-01-03T21:41:47.645866918Z","labels":["frontend","ui","web"],"dependencies":[{"issue_id":"clack-4jw","depends_on_id":"clack-dor","type":"parent-child","created_at":"2025-11-26T05:05:20.453093337Z","created_by":"daemon"},{"issue_id":"clack-4jw","depends_on_id":"clack-ias","type":"blocks","created_at":"2025-11-26T05:05:30.446459675Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-4lg","title":"Epic 4: Content Registry \u0026 Selection","description":"Implement registration and priority-based selection system. Singleton registry for all generators with priority selection (P0 immediate interrupt, P2 general, P3 fallback).","status":"tombstone","priority":1,"issue_type":"epic","assignee":"claude","created_at":"2025-11-26T22:14:23.961499135Z","updated_at":"2026-01-03T21:41:47.645866918Z","labels":["content-system","registry","selection"],"dependencies":[{"issue_id":"clack-4lg","depends_on_id":"clack-6vv","type":"blocks","created_at":"2025-11-26T22:14:35.235232168Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"clack-4qv","title":"Update Type Definitions","description":"Extend HomeAssistantConfig and add event types, state types, and error types in src/types/data-sources.ts.","acceptance_criteria":"- Extended HomeAssistantConfig type\n- HomeAssistantEvent type with event_type\n- StateChangedEvent type\n- HomeAssistantEntityState type with context\n- UnsubscribeFunc type\n- ServiceCallResponse type\n- Error types (extends base Error)\n- All types exported from src/types/index.ts","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-11-24T00:18:53.296351752Z","updated_at":"2026-01-03T21:41:47.645866918Z","dependencies":[{"issue_id":"clack-4qv","depends_on_id":"clack-n94","type":"parent-child","created_at":"2025-11-24T04:19:55.831357845Z","created_by":"vscode"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-4w3l","title":"Delete meta-tests for test utilities","description":"Delete tests/unit/example.test.ts (trivial true===true tests) and tests/unit/__mocks__/index.test.ts (only tests exports exist). KEEP tests/unit/__helpers__/*.test.ts (these test actual utility functions with complex behavior like ANSI stripping, timezone manipulation). KEEP tests/unit/__mocks__/ai-providers.test.ts (verifies mock interface conformance). Note: tests/unit/fixtures/*.test.ts does not exist. Acceptance: All remaining tests pass with no .env file present.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T21:03:29.17209396Z","created_by":"vscode","updated_at":"2026-01-11T22:38:16.679278884Z","closed_at":"2026-01-11T22:38:16.679278884Z","close_reason":"Closed","dependencies":[{"issue_id":"clack-4w3l","depends_on_id":"clack-82ep","type":"parent-child","created_at":"2026-01-11T21:04:05.402714088Z","created_by":"vscode"}]}
{"id":"clack-56km","title":"[MEDIUM] Fix minor-update.test.ts hardcoded structure assertion","description":"**File:** tests/unit/content/generators/minor-update.test.ts\n**Lines:** 106-150\n**Category:** Too Brittle\n**Severity:** Medium\n\n## Problem\nTest asserts exact object structure including `rows: []` (empty array added by implementation). If layout structure changes slightly, test breaks even if functionality is correct.\n\n## Evidence\n```typescript\nexpect(result).toEqual({\n  text: 'CACHED MESSAGE',\n  outputMode: 'layout',\n  layout: {\n    rows: [],  // ← Implementation detail\n    characterCodes: decoratedLayout,\n  },\n  metadata: { ... },\n});\n```\n\n## Implementation Instructions\n1. **Use partial matching** for properties that matter:\n```typescript\nexpect(result).toMatchObject({\n  outputMode: 'layout',\n  layout: expect.objectContaining({\n    characterCodes: decoratedLayout\n  }),\n  metadata: expect.objectContaining({\n    minorUpdate: true\n  })\n});\n```\n2. **Assert on specific important properties** rather than full structure\n\n## Acceptance Criteria\n- [ ] Tests verify important properties, not exact structure\n- [ ] Implementation details like empty `rows: []` not asserted\n- [ ] Tests remain stable with minor structure changes","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-11-29T05:08:38.347037883Z","updated_at":"2026-01-03T21:41:47.645866918Z","close_reason":"Verified complete by code review","labels":["medium","testing"],"dependencies":[{"issue_id":"clack-56km","depends_on_id":"clack-ini3","type":"parent-child","created_at":"2025-11-29T07:01:30.394183337Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-57qe","title":"[LOW] Fix openai-responses.test.ts hardcoded model ID","description":"**File:** tests/unit/fixtures/openai-responses.test.ts\n**Lines:** 83-89\n**Category:** Too Brittle\n**Severity:** Low\n\n## Problem\nTest asserts that model IDs include `'gpt-4-turbo-preview'`. This is a hardcoded model ID that will break if OpenAI deprecates this model or fixture is updated.\n\n## Evidence\n```typescript\nit('should include GPT-4 models', () =\u003e {\n  const modelIds = responses.models.data.map(m =\u003e m.id);\n  expect(modelIds).toContain('gpt-4-turbo-preview');  // ← Specific model version\n});\n```\n\n## Implementation Instructions\n1. **Use flexible pattern matching**:\n```typescript\nexpect(modelIds.some(id =\u003e id.includes('gpt-4'))).toBe(true);\n```\n2. **Or verify fixture structure** without specific model IDs\n3. **Document** if specific model IDs are intentionally tested\n\n## Acceptance Criteria\n- [ ] No hardcoded model IDs that may be deprecated\n- [ ] Tests verify fixture structure, not specific data\n- [ ] Or specific models documented as intentional test data","status":"tombstone","priority":3,"issue_type":"task","created_at":"2025-11-29T05:09:26.550147794Z","updated_at":"2026-01-03T21:41:47.645866918Z","close_reason":"Verified complete by code review","labels":["low","testing"],"dependencies":[{"issue_id":"clack-57qe","depends_on_id":"clack-ini3","type":"parent-child","created_at":"2025-11-29T07:01:31.254730171Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-57t","title":"Write Unit Tests","description":"Create comprehensive unit tests in tests/unit/api/data-sources/home-assistant.test.ts with 80%+ coverage.","acceptance_criteria":"- Test file created\n- Test connection establishment (success)\n- Test connection failure scenarios\n- Test disconnect cleanup\n- Test event subscription/unsubscription\n- Test event callback invocation\n- Test multiple subscribers\n- Test getState() success/failure\n- Test getAllStates()\n- Test callService() success/failure\n- Test reconnection logic\n- Test max reconnection attempts\n- Test auto-resubscribe\n- Test graceful degradation\n- 80%+ coverage verified","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-11-24T00:18:57.490100296Z","updated_at":"2026-01-03T21:41:47.645866918Z","dependencies":[{"issue_id":"clack-57t","depends_on_id":"clack-wxg","type":"blocks","created_at":"2025-11-24T00:20:03.807708674Z","created_by":"daemon"},{"issue_id":"clack-57t","depends_on_id":"clack-ar9","type":"blocks","created_at":"2025-11-24T00:20:05.051381299Z","created_by":"daemon"},{"issue_id":"clack-57t","depends_on_id":"clack-iwr","type":"blocks","created_at":"2025-11-24T00:20:06.299932341Z","created_by":"daemon"},{"issue_id":"clack-57t","depends_on_id":"clack-2w5","type":"blocks","created_at":"2025-11-24T00:20:07.4258858Z","created_by":"daemon"},{"issue_id":"clack-57t","depends_on_id":"clack-y4k","type":"blocks","created_at":"2025-11-24T00:20:08.558567134Z","created_by":"daemon"},{"issue_id":"clack-57t","depends_on_id":"clack-1wi","type":"blocks","created_at":"2025-11-24T00:20:09.939995635Z","created_by":"daemon"},{"issue_id":"clack-57t","depends_on_id":"clack-p30","type":"blocks","created_at":"2025-11-24T00:20:11.177343969Z","created_by":"daemon"},{"issue_id":"clack-57t","depends_on_id":"clack-926","type":"parent-child","created_at":"2025-11-24T04:20:28.049451763Z","created_by":"vscode"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-5ey","title":"Throttled Error Logging","description":"Implement throttled logging to prevent error spam (same error logged 60 times/hour).\n\n**Files to create**:\n- `src/utils/throttled-logger.ts` - ThrottledLogger class\n\n**Files to modify**:\n- `src/scheduler/cron.ts` - Use throttled logger for errors\n\n**Implementation**:\n- Log same error type at most once per 5 minutes\n- Track suppressed count per error key\n- Show suppressed count when logging resumes","acceptance_criteria":"- Same error type logged at most once per 5 minutes\n- Suppressed count shown when logging resumes\n- Different error types logged independently\n- Tests verify throttling behavior","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-11-27T21:49:12.494968633Z","updated_at":"2026-01-03T21:41:47.645866918Z","labels":["utility"],"dependencies":[{"issue_id":"clack-5ey","depends_on_id":"clack-hfu","type":"parent-child","created_at":"2025-11-27T21:49:45.809881259Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-5fz","title":"[HIGH] Fix push.test.ts non-functional VAPID key test","description":"**File:** tests/integration/web/routes/push.test.ts\n**Lines:** 139-152\n**Category:** Does Nothing\n**Severity:** High\n\n## Problem\nTest \"should return 500 when VAPID key not configured\" (lines 139-152) is completely non-functional. It sets up an Express app but never sends any request to it, makes no assertions, and explicitly acknowledges it cannot work with the comment \"would require module re-loading\".\n\n## Evidence\n```typescript\nit('should return 500 when VAPID key not configured', async () =\u003e {\n  const originalKey = process.env.VAPID_PUBLIC_KEY;\n  process.env.VAPID_PUBLIC_KEY = '';\n  \n  const testApp = express();\n  testApp.use(express.json());\n  \n  // Re-import router to pick up empty key\n  // Note: In practice, this would require module re-loading\n  // For this test, we'll just verify the endpoint exists\n  \n  process.env.VAPID_PUBLIC_KEY = originalKey;\n  // ← No request sent, no assertions made!\n});\n```\n\n## Implementation Instructions\n**Option A: Implement properly using jest.resetModules()**\n```typescript\nit('should return 500 when VAPID key not configured', async () =\u003e {\n  // Save and clear\n  const originalKey = process.env.VAPID_PUBLIC_KEY;\n  process.env.VAPID_PUBLIC_KEY = '';\n  \n  // Reset module cache\n  jest.resetModules();\n  \n  // Re-import with empty key\n  const { createPushRouter } = await import('@/web/routes/push.js');\n  const testApp = express();\n  testApp.use(express.json());\n  testApp.use('/api/push', createPushRouter());\n  \n  // Make request\n  const response = await request(testApp).get('/api/push/vapid-public-key');\n  expect(response.status).toBe(500);\n  \n  // Restore\n  process.env.VAPID_PUBLIC_KEY = originalKey;\n});\n```\n\n**Option B: Remove the test** if this behavior cannot be tested\n\n## Acceptance Criteria\n- [ ] Test either makes actual HTTP request and asserts 500 status\n- [ ] OR test is removed with comment explaining why\n- [ ] No empty tests that make no assertions","status":"tombstone","priority":1,"issue_type":"bug","created_at":"2025-11-29T05:06:03.255165506Z","updated_at":"2026-01-03T21:41:47.645866918Z","close_reason":"Verified complete by code review","labels":["high","testing"],"dependencies":[{"issue_id":"clack-5fz","depends_on_id":"clack-s9o","type":"parent-child","created_at":"2025-11-29T05:09:49.998785125Z","created_by":"daemon"},{"issue_id":"clack-5fz","depends_on_id":"clack-ofzp","type":"parent-child","created_at":"2025-11-29T07:01:29.766440503Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"bug"}
{"id":"clack-5gp","title":"Write Integration Tests (Real Converter + Mock HTTP)","description":"Create integration tests combining real character converter with mocked HTTP client. Verify end-to-end text → character codes → HTTP flow.","design":"## Integration Test Strategy\n- Real character converter (production implementation)\n- Mock HTTP client (no network calls)\n- Verify exact character codes sent\n- Compare against fixtures\n\nCoverage:\n1. Simple text conversion and send\n2. Multi-line layout conversion\n3. Invalid characters handling\n4. Character code accuracy verification","acceptance_criteria":"- tests/integration/api/vestaboard/client-integration.test.ts created\n- Test sendText() with real converter, mock HTTP\n- Test sendLayout() with multi-line text, real converter\n- Verify exact character codes sent match expected values\n- Compare against vestaboard-responses.json fixtures\n- Test \"HELLO WORLD\" produces correct codes [8,5,12,12,15,0,23,15,18,12,4]\n- Test motivational quote with centering\n- Test invalid character throws error (via real converter)\n- Test full 6-row layout\n- All integration tests pass\n- Uses createMockVestaboardHTTPClient() for HTTP\n- Uses real character converter implementation","notes":"3-char identifier cleanup","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-26T05:25:59.536056549Z","updated_at":"2026-01-23T22:36:20.303762042Z","closed_at":"2026-01-23T22:36:20.303766042Z","dependencies":[{"issue_id":"clack-5gp","depends_on_id":"clack-q4k","type":"blocks","created_at":"2025-11-26T05:25:59.541509882Z","created_by":"daemon"},{"issue_id":"clack-5gp","depends_on_id":"clack-9u3","type":"blocks","created_at":"2025-11-26T05:25:59.543419674Z","created_by":"daemon"},{"issue_id":"clack-5gp","depends_on_id":"clack-y4i","type":"blocks","created_at":"2025-11-26T05:25:59.544384966Z","created_by":"daemon"},{"issue_id":"clack-5gp","depends_on_id":"clack-z37n","type":"parent-child","created_at":"2025-11-29T07:01:17.854101512Z","created_by":"daemon"}]}
{"id":"clack-5i1","title":"Document Token Creation","description":"Add step-by-step token creation instructions, security best practices, and .env setup examples.","acceptance_criteria":"- Step-by-step token creation instructions\n- HA UI navigation documented\n- Security best practices\n- Token permissions documented\n- .env setup examples\n- CLI tool connectivity testing documented","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-11-24T00:19:02.953628507Z","updated_at":"2026-01-03T21:41:47.645866918Z","dependencies":[{"issue_id":"clack-5i1","depends_on_id":"clack-1ls","type":"blocks","created_at":"2025-11-24T00:20:24.960259461Z","created_by":"daemon"},{"issue_id":"clack-5i1","depends_on_id":"clack-3my","type":"parent-child","created_at":"2025-11-24T04:21:10.91151938Z","created_by":"vscode"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-5tjn","title":"Core Orchestration Tests","description":"## Overview\nMove orchestration, bootstrap, scheduler, and service tests from unit to integration.\n\n## Risk Level\nHIGH - Core system logic. If orchestration mocking breaks, it is isolated from generator tests.\n\n## Dependencies\nRequires Epic 1 (Testing Foundations) to establish patterns.\n\n## Files Affected\n12 test files from tests/unit/ -\u003e tests/integration/\n\n## Success Criteria\n- [ ] All 12 orchestration test files moved to integration directory\n- [ ] Use real ContentRegistry, ContentSelector, FrameDecorator\n- [ ] Mock only external APIs (AI providers, Vestaboard, HA)\n- [ ] Replace fixed counts with flexible assertions\n- [ ] Test behavior, not implementation details\n- [ ] All tests pass in integration environment\n\n## Parallel Execution Context\nThis epic runs IN PARALLEL with these sibling epics (no file overlap):\n- clack-b8xx: CLI Command Test Migration\n- clack-7yso: Storage Layer Test Migration\n- clack-uotb: AI Generators - Hot Take \u0026 Personality\n- clack-rjyb: AI Generators - News \u0026 Learning\n- clack-te4l: AI Generators - Philosophical \u0026 Misc\n\nEach domain is isolated - failures in this epic do NOT affect sibling epics.","status":"open","priority":1,"issue_type":"epic","owner":"ryan@spice.cc","created_at":"2026-01-27T22:27:43.358555299Z","created_by":"Ryan Brodkin","updated_at":"2026-01-27T22:36:22.43688397Z","dependencies":[{"issue_id":"clack-5tjn","depends_on_id":"clack-3n0y","type":"blocks","created_at":"2026-01-27T22:28:41.103979756Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-5tjn.1","title":"Move orchestration tests to integration","description":"## Objective\nMove orchestration, bootstrap, scheduler, and service tests from unit to integration.\n\n## TDD Approach\n1. RED: Move test files, update imports\n2. GREEN: Replace internal mocks with real components, mock only external APIs\n3. BLUE: Verify complete workflows with real orchestration\n\n## Acceptance Criteria\n- [ ] Move all 12 orchestration test files to integration directory\n- [ ] Use real ContentRegistry, ContentSelector, FrameDecorator\n- [ ] Mock only external APIs (AI providers, Vestaboard, HA)\n- [ ] Replace fixed counts with flexible assertions\n- [ ] Test behavior, not implementation details\n- [ ] All tests pass in integration environment\n\n## Scope\nFiles: orchestrator-tool-based, notification-generator, ai-prompt-generator (2 files), sleep-mode-generator, minor-update, bootstrap, event-handler, cron-scheduler, weather-service, content-data-provider, circuit-breaker-service (12 test files)","status":"open","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-27T22:27:55.340612429Z","created_by":"Ryan Brodkin","updated_at":"2026-01-27T22:27:55.340612429Z","dependencies":[{"issue_id":"clack-5tjn.1","depends_on_id":"clack-5tjn","type":"parent-child","created_at":"2026-01-27T22:27:55.341555096Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-5uh","title":"[MEDIUM] Fix home-assistant.test.ts exponential backoff tests","description":"**File:** tests/unit/api/data-sources/home-assistant.test.ts\n**Lines:** 611-710\n**Category:** Too Brittle\n**Severity:** Medium\n\n## Problem\nMultiple tests in the \"exponential backoff\" group:\n1. Access private properties with `(client as any).connection = null`\n2. Tightly coupled to implementation details of state management\n3. Timing assertions rely on precise scheduling\n\n## Evidence\n```typescript\n// Directly manipulating private state\n(clientWithReconnect as any).connection = null;\n(clientWithReconnect as any).state = 'disconnected';\n```\n\n## Implementation Instructions\n1. **Use public API** to trigger disconnection (actual WebSocket close simulation)\n2. **Create helper methods** for test state management\n3. **Or mock WebSocket** to emit close events naturally\n4. **Avoid `as any` casts** - if needed, create test-specific subclass\n\n## Acceptance Criteria\n- [ ] No `as any` casts to access private properties\n- [ ] State changes triggered through public API or events\n- [ ] Tests remain stable if internal state management changes","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-11-29T05:08:34.043943465Z","updated_at":"2026-01-03T21:41:47.645866918Z","close_reason":"Verified complete by code review","labels":["medium","testing"],"dependencies":[{"issue_id":"clack-5uh","depends_on_id":"clack-rokx","type":"parent-child","created_at":"2025-11-29T07:01:16.349266095Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-5wz","title":"Pass content to saveFailedContent in catch block","description":"Update the catch block in `generateAndSend()` to pass `content` to `saveFailedContent`.\n\n**File**: `src/content/orchestrator.ts`\n\n**Current** (lines 172-177):\n```typescript\nif (this.contentRepository \u0026\u0026 context.updateType === 'major') {\n  this.saveFailedContent(context, registeredGenerator, generationError).catch(() =\u003e {\n    // Silently catch database errors\n  });\n}\n```\n\n**Target**:\n```typescript\nif (this.contentRepository \u0026\u0026 context.updateType === 'major') {\n  this.saveFailedContent(context, registeredGenerator, generationError, content).catch(() =\u003e {\n    // Silently catch database errors\n  });\n}\n```\n\nFor validation failures, `content` will have the generated text + metadata.\nFor provider failures, `content` will be undefined (handled by optional param).","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-11-28T07:50:50.991463383Z","updated_at":"2026-01-03T21:41:47.645866918Z","dependencies":[{"issue_id":"clack-5wz","depends_on_id":"clack-rvq","type":"parent-child","created_at":"2025-11-28T07:51:11.508776462Z","created_by":"daemon"},{"issue_id":"clack-5wz","depends_on_id":"clack-83a","type":"blocks","created_at":"2025-11-28T07:52:52.282574092Z","created_by":"daemon"},{"issue_id":"clack-5wz","depends_on_id":"clack-cim","type":"blocks","created_at":"2025-11-28T07:52:52.440783425Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-69j","title":"Create TechNewsGenerator (HN, TechCrunch, Ars)","description":"News generator for tech/startup news headlines.\n\n**Files:**\n- `src/content/generators/ai/tech-news-generator.ts` (new)\n- `prompts/user/news-tech.txt` (new)\n\n**Default Feeds:**\n- Hacker News: `https://hnrss.org/frontpage`\n- TechCrunch: `https://techcrunch.com/feed/`\n- Ars Technica: `https://feeds.arstechnica.com/arstechnica/index`\n\n**Requirements:**\n- Extends base NewsGenerator\n- Uses `prompts/user/news-tech.txt` for user prompt\n- Configurable via `RSS_TECH_FEEDS` env var","status":"tombstone","priority":2,"issue_type":"task","assignee":"claude","created_at":"2025-11-27T09:20:59.156966175Z","updated_at":"2026-01-03T21:41:47.645866918Z","labels":["content","news"],"dependencies":[{"issue_id":"clack-69j","depends_on_id":"clack-viu","type":"parent-child","created_at":"2025-11-27T09:21:48.645144878Z","created_by":"daemon"},{"issue_id":"clack-69j","depends_on_id":"clack-42e","type":"blocks","created_at":"2025-11-27T09:22:12.655530333Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-6bd","title":"Implement placeholder model methods (VoteModel, ContentModel, LogModel)","description":"Model implementations (VoteModel, ContentModel, LogModel) are currently stubs that throw \"Not implemented\" errors. These need to be implemented for full integration testing of API routes.\n\nCurrent Status: Models exist but all methods throw errors with TODO comments\n\nAffected Models:\n- VoteModel: create(), getStats(), findByContentId() methods\n- ContentModel: getLatest(), getHistory() methods  \n- LogModel: findRecent(), deleteOlderThan() methods\n\nImpact: Cannot run full integration tests for API routes until these are implemented","design":"Models should implement database operations using existing Database/Repository patterns in the codebase. Follow TDD methodology:\n1. Write tests for model methods\n2. Implement database queries\n3. Integrate with existing repositories","acceptance_criteria":"- All model methods implemented with database operations\n- Unit tests for model methods with 80%+ coverage\n- Integration tests with repositories passing\n- No \"Not implemented\" errors remaining","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-11-24T15:46:13.591253708Z","updated_at":"2026-01-03T21:41:47.645866918Z","labels":["database","models","task"],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-6oq","title":"Task 3.3: Create base ProgrammaticGenerator abstract class","description":"Create src/content/generators/programmatic-generator.ts with abstract base for non-AI content generation.","acceptance_criteria":"- Abstract class implementing ContentGenerator\n- Default validate() returns { valid: true }\n- Abstract generate() method\n- Unit tests","status":"tombstone","priority":1,"issue_type":"task","assignee":"claude","created_at":"2025-11-26T22:15:39.295873503Z","updated_at":"2026-01-03T21:41:47.645866918Z","dependencies":[{"issue_id":"clack-6oq","depends_on_id":"clack-6vv","type":"parent-child","created_at":"2025-11-26T22:15:50.392094217Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-6pj","title":"Update Votes and Logs Tables for MySQL","description":"Migrate votes and logs tables to MySQL with proper foreign keys.\n\n**Files to modify**:\n- `src/storage/models/vote.ts` - Update for MySQL\n- `src/storage/models/log.ts` - Update for MySQL\n- `src/storage/migrations/001_initial_schema.sql` - Add tables\n\n**Schema additions**:\n- votes table with FK to content(id) ON DELETE CASCADE\n- logs table with level ENUM and metadata JSON\n- Proper indexes for each table","acceptance_criteria":"- Foreign key constraint works (cascade delete)\n- Vote and log operations work\n- Indexes created","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-11-27T21:49:08.752934089Z","updated_at":"2026-01-03T21:41:47.645866918Z","labels":["database","schema"],"dependencies":[{"issue_id":"clack-6pj","depends_on_id":"clack-hsa","type":"blocks","created_at":"2025-11-27T21:49:31.759669961Z","created_by":"daemon"},{"issue_id":"clack-6pj","depends_on_id":"clack-hfu","type":"parent-child","created_at":"2025-11-27T21:49:45.366972926Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-6pp","title":"Refactor content-list.test.ts - remove brittle fixed-count assertion","description":"The test asserts a fixed count (/total.*2/i) which breaks whenever generators are added/removed.\n\n**Failures:** 1 test\n- should show total count at the end\n\n**Fix:** Refactor assertion to test format, not exact count:\n- Change from: expect(output).toMatch(/total.*2/i)\n- Change to: expect(output).toMatch(/Total: \\d+ generator/)\n\n**Files:** tests/unit/cli/commands/content-list.test.ts","status":"tombstone","priority":2,"issue_type":"bug","created_at":"2025-11-28T02:24:32.299082001Z","updated_at":"2026-01-03T21:41:47.645866918Z","deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"bug"}
{"id":"clack-6vv","title":"Epic 3: Content Generator Implementations","description":"Create concrete generator classes for AI-powered content, programmatic content, static fallback, and notifications. Includes base classes and specific implementations.","status":"tombstone","priority":1,"issue_type":"epic","assignee":"claude","created_at":"2025-11-26T22:14:23.679796885Z","updated_at":"2026-01-03T21:41:47.645866918Z","labels":["content-system","generators"],"dependencies":[{"issue_id":"clack-6vv","depends_on_id":"clack-b5o","type":"blocks","created_at":"2025-11-26T22:14:34.944487668Z","created_by":"daemon"},{"issue_id":"clack-6vv","depends_on_id":"clack-adr","type":"blocks","created_at":"2025-11-26T22:14:35.051321918Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"clack-6yc","title":"[MEDIUM] Remove tautological compile-time tests in notification-generator.test.ts","description":"**File:** tests/unit/content/generators/notification-generator.test.ts\n**Lines:** 56-71\n**Category:** Tests That Do Nothing\n**Severity:** Medium\n\n## Problem\nThree tests have tautological assertions or test implementation details that TypeScript already enforces:\n- Line 56-60: `expect(true).toBe(true)` - always passes\n- Line 62-66: Property existence check instead of behavior\n- Line 68-71: Accessing private method with bracket notation\n\n## Evidence\n```typescript\nit('should not be directly instantiable at compile time', () =\u003e {\n  const compileTimeCheck = true;\n  expect(compileTimeCheck).toBe(true);  // ← Always passes!\n});\n```\n\n## Implementation Instructions\n1. **Remove lines 56-60** - TypeScript compilation handles abstract class enforcement\n2. **Replace lines 62-66** with behavior test - Test that `generate()` actually calls `formatNotification()` with correct event data\n3. **Replace lines 68-71** - Test the public API behavior instead of private method existence\n\n## Acceptance Criteria\n- [ ] No `expect(true).toBe(true)` assertions\n- [ ] Tests verify behavior, not property existence\n- [ ] No bracket notation access to private methods","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-11-29T05:07:08.931382509Z","updated_at":"2026-01-03T21:41:47.645866918Z","labels":["medium","testing"],"dependencies":[{"issue_id":"clack-6yc","depends_on_id":"clack-anr5","type":"parent-child","created_at":"2025-11-29T07:00:50.637118805Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-745","title":"Implement Vestaboard Client Orchestrator","description":"Create main VestaboardClient class that orchestrates character conversion and HTTP communication via dependency injection. Thin delegation layer with no business logic.","design":"## Dependency Injection Pattern\nConstructor receives:\n- VestaboardHTTPClient (for HTTP communication)\n- CharacterConverter (for text conversion)\n\n## Responsibilities\n- Coordinate conversion + HTTP (thin orchestration)\n- NO direct HTTP calls (delegate to httpClient)\n- NO character conversion logic (delegate to converter)\n- Error propagation from dependencies\n\n## Methods\n- sendLayout(layout: VestaboardLayout): Promise\u0026lt;void\u0026gt;\n- sendText(text: string): Promise\u0026lt;void\u0026gt;\n- validateConnection(): Promise\u0026lt;boolean\u0026gt;","acceptance_criteria":"- src/api/vestaboard/client.ts created\n- VestaboardClient class implements VestaboardSender interface\n- Constructor accepts (httpClient: VestaboardHTTPClient, converter: CharacterConverter)\n- sendLayout() converts layout to codes, delegates to httpClient\n- sendText() creates simple layout, converts, sends\n- validateConnection() delegates to httpClient\n- No business logic in orchestrator (pure delegation)\n- Error propagation from dependencies preserved\n- Exported from src/api/vestaboard/index.ts","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-11-26T05:24:39.501424596Z","updated_at":"2026-01-03T21:41:47.645866918Z","dependencies":[{"issue_id":"clack-745","depends_on_id":"clack-u7h","type":"blocks","created_at":"2025-11-26T05:24:39.502905971Z","created_by":"daemon"},{"issue_id":"clack-745","depends_on_id":"clack-ko4","type":"blocks","created_at":"2025-11-26T05:24:39.503698971Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-7fx","title":"Task 3.5: Create StaticFallbackGenerator for P3 content","description":"Create src/content/generators/static-fallback-generator.ts that randomly selects content from prompts/static/*.txt files.","acceptance_criteria":"- Reads .txt files from fallback directory\n- Random selection on each generate() call\n- validate() checks directory exists and has files\n- Graceful error handling\n- Unit tests with mocked filesystem","status":"tombstone","priority":1,"issue_type":"task","assignee":"claude","created_at":"2025-11-26T22:15:40.12343617Z","updated_at":"2026-01-03T21:41:47.645866918Z","dependencies":[{"issue_id":"clack-7fx","depends_on_id":"clack-6vv","type":"parent-child","created_at":"2025-11-26T22:15:50.655355384Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-7l3","title":"Task 6.3: Update CronScheduler wiring","description":"Modify src/scheduler/cron.ts to wire up updated MinorUpdateGenerator with orchestrator dependency.","acceptance_criteria":"- CronScheduler uses updated MinorUpdateGenerator\n- Minute-aligned scheduling maintained\n- Integration test for full minor update flow","status":"tombstone","priority":2,"issue_type":"task","assignee":"claude","created_at":"2025-11-26T22:16:50.638834842Z","updated_at":"2026-01-03T21:41:47.645866918Z","dependencies":[{"issue_id":"clack-7l3","depends_on_id":"clack-zoy","type":"parent-child","created_at":"2025-11-26T22:16:58.021510429Z","created_by":"daemon"},{"issue_id":"clack-7l3","depends_on_id":"clack-b1m","type":"blocks","created_at":"2025-11-26T22:16:58.278353596Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-7tb","title":"Define TypeScript Interfaces and Error Types","description":"Create type definitions for Vestaboard API wrapper interfaces and custom error hierarchy in src/api/vestaboard/types.ts and errors.ts. Foundation for type-safe implementation.","acceptance_criteria":"- types.ts created with VestaboardConfig, VestaboardResponse, VestaboardMessage interfaces\n- CharacterConverter interface defined\n- VestaboardHTTPClient interface defined\n- VestaboardSender interface defined\n- errors.ts created with VestaboardError base class\n- VestaboardConnectionError, VestaboardAuthenticationError, VestaboardInvalidMessageError defined\n- VestaboardUnsupportedCharacterError defined\n- All error types extend base VestaboardError\n- Types exported from src/api/vestaboard/index.ts","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-11-26T05:24:07.547998428Z","updated_at":"2026-01-03T21:41:47.645866918Z","dependencies":[{"issue_id":"clack-7tb","depends_on_id":"clack-2jo","type":"blocks","created_at":"2025-11-26T05:24:07.54868972Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-7yso","title":"Storage Layer Test Migration","description":"## Overview\nMove 17 storage tests from unit to integration since they use real database connections.\n\n## Risk Level\nMEDIUM - Database domain is self-contained. If database setup patterns break, it is isolated to storage tests only.\n\n## Dependencies\nRequires Epic 1 (Testing Foundations) to establish patterns.\n\n## Files Affected\n17 test files from tests/unit/storage/ -\u003e tests/integration/storage/\n\n## Success Criteria\n- [ ] All 17 storage test files moved to integration directory\n- [ ] beforeAll/afterAll database lifecycle hooks work correctly\n- [ ] Test isolation maintained (beforeEach cleanup patterns)\n- [ ] All tests pass in integration environment\n\n## Parallel Execution Context\nThis epic runs IN PARALLEL with these sibling epics (no file overlap):\n- clack-b8xx: CLI Command Test Migration\n- clack-uotb: AI Generators - Hot Take \u0026 Personality\n- clack-rjyb: AI Generators - News \u0026 Learning\n- clack-te4l: AI Generators - Philosophical \u0026 Misc\n- clack-5tjn: Core Orchestration Tests\n\nEach domain is isolated - failures in this epic do NOT affect sibling epics.","status":"open","priority":1,"issue_type":"epic","owner":"ryan@spice.cc","created_at":"2026-01-27T22:15:05.527629837Z","created_by":"Ryan Brodkin","updated_at":"2026-01-27T22:36:17.346306092Z","dependencies":[{"issue_id":"clack-7yso","depends_on_id":"clack-3n0y","type":"blocks","created_at":"2026-01-27T22:28:40.891554047Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-7yso.1","title":"Move storage tests to integration","description":"## Objective\nRelocate storage tests from tests/unit/storage/ to tests/integration/storage/ since they use real database connections.\n\n## TDD Approach\n1. RED: Move test files, update imports (tests may fail due to path changes)\n2. GREEN: Verify database setup patterns work in integration environment\n3. BLUE: Consolidate shared database setup patterns\n\n## Acceptance Criteria\n- [ ] Move 17 storage test files from unit to integration directory\n- [ ] Update imports to use @/ paths correctly\n- [ ] Verify beforeAll/afterAll database lifecycle hooks work correctly\n- [ ] Ensure test isolation (beforeEach cleanup patterns)\n- [ ] All tests pass in integration environment\n- [ ] Coverage maintained or improved\n\n## Scope\nFiles: content-repository, knex, validation-attempts, 6 repositories/*, 7 models/*, migrations/* (17 test files)","status":"open","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-27T22:15:19.138506343Z","created_by":"Ryan Brodkin","updated_at":"2026-01-27T22:15:19.138506343Z","dependencies":[{"issue_id":"clack-7yso.1","depends_on_id":"clack-7yso","type":"parent-child","created_at":"2026-01-27T22:15:19.139238426Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-82ep","title":"Test Suite Quality Overhaul","description":"Comprehensive cleanup of test suite to eliminate flaky, trivial, and brittle tests. Reduces test count by ~150-200 while improving reliability and maintainability. Key requirement: ALL tests must pass with no .env file present (proving tests work without config or API keys).","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-11T21:02:57.917823793Z","created_by":"vscode","updated_at":"2026-01-11T22:44:04.960447628Z","closed_at":"2026-01-11T22:44:04.960447628Z","close_reason":"Test suite overhaul complete - all 13 child tasks closed"}
{"id":"clack-83a","title":"Hoist content variable scope in orchestrator","description":"Move `let content: GeneratedContent | undefined;` before the try block in `generateAndSend()` so the variable remains accessible in the catch block.\n\n**File**: `src/content/orchestrator.ts`\n\n**Current** (line 148):\n```typescript\nlet content: GeneratedContent;\n```\n\n**Target**:\n```typescript\nlet content: GeneratedContent | undefined;\n```\n\nThis allows the catch block to access `content` when validation throws.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-11-28T07:50:45.665437547Z","updated_at":"2026-01-03T21:41:47.645866918Z","dependencies":[{"issue_id":"clack-83a","depends_on_id":"clack-rvq","type":"parent-child","created_at":"2025-11-28T07:51:07.114837876Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-8kd","title":"Task 5.3: Implement retry logic with alternate provider fallback","description":"Add generateWithRetry() private method to ContentOrchestrator handling AI failure with cross-provider retry before falling to P3.","acceptance_criteria":"- generateWithRetry(generator, context) method\n- Try preferred provider first\n- On RateLimitError or AuthenticationError, try alternate\n- Throw after both fail (triggers P3 fallback in main method)\n- Unit tests for all failure scenarios","status":"tombstone","priority":1,"issue_type":"task","assignee":"claude","created_at":"2025-11-26T22:16:30.04526093Z","updated_at":"2026-01-03T21:41:47.645866918Z","dependencies":[{"issue_id":"clack-8kd","depends_on_id":"clack-zoc","type":"parent-child","created_at":"2025-11-26T22:16:38.009328586Z","created_by":"daemon"},{"issue_id":"clack-8kd","depends_on_id":"clack-8wd","type":"blocks","created_at":"2025-11-26T22:16:38.251086253Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-8v1","title":"Fix orchestrator.test.ts - FrameDecorator.decorate() expects 3 args","description":"The FrameDecorator.decorate() method signature was changed to accept a third parameter (context.data), but test assertions weren't updated.\n\n**Failures:** 2 tests\n- should select generator, generate content, decorate, cache, and send\n- should fall back to StaticFallbackGenerator when retry fails\n\n**Fix:** Update test assertions at lines 141 and 314 to expect the third argument.\n\n**Files:** tests/unit/content/orchestrator.test.ts","status":"tombstone","priority":1,"issue_type":"bug","created_at":"2025-11-28T02:24:18.754712301Z","updated_at":"2026-01-03T21:41:47.645866918Z","deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"bug"}
{"id":"clack-8wd","title":"Task 5.1: Create ContentOrchestrator main pipeline","description":"Create src/content/orchestrator.ts coordinating selection, generation, retry, P3 fallover, frame decoration, and content caching for minor updates.","acceptance_criteria":"- Constructor accepts ContentSelector, FrameDecorator, VestaboardClient, StaticFallbackGenerator\n- generateAndSend(context) method with full pipeline\n- Retry logic: try alternate provider once before P3 fallback\n- Apply frame if outputMode === 'text'\n- Cache last successful content (cachedContent property)\n- getCachedContent() method for minor updates\n- Unit tests with mocked dependencies","status":"tombstone","priority":1,"issue_type":"task","assignee":"claude","created_at":"2025-11-26T22:16:29.778729346Z","updated_at":"2026-01-03T21:41:47.645866918Z","dependencies":[{"issue_id":"clack-8wd","depends_on_id":"clack-zoc","type":"parent-child","created_at":"2025-11-26T22:16:37.745629586Z","created_by":"daemon"},{"issue_id":"clack-8wd","depends_on_id":"clack-r0g","type":"blocks","created_at":"2025-11-26T22:16:38.133131086Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-90ga","title":"Fix deployment system defects","description":"Fix two critical deployment defects: (1) inability to update secrets without data loss, and (2) containers not updating when deploying new code.\n\nSuccess Criteria:\n- Secrets can be rotated without removing the stack or losing volumes\n- New deployments trigger Swarm rolling updates naturally via image tag changes\n- Rollback capability via image tags","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-04T21:00:58.440667507Z","created_by":"vscode","updated_at":"2026-01-04T22:53:35.937526343Z","closed_at":"2026-01-04T22:53:35.937526343Z","close_reason":"All child issues completed. Deployment fixes merged to develop and tested in production."}
{"id":"clack-90ga.1","title":"Implement git SHA image tagging","description":"Replace clack-track:latest with git commit SHA-based tags. Swarm will detect the tag change and perform rolling updates automatically.\n\nAcceptance Criteria:\n- [ ] Image tagged with short git SHA (e.g., clack-track:abc123f)\n- [ ] stack.yml uses environment variable for image tag\n- [ ] deploy.sh passes image tag to stack deploy\n- [ ] latest tag still created as alias for convenience\n- [ ] Swarm performs rolling update when tag changes\n\nFiles:\n- deploy.sh (modify)\n- stack.yml (modify - parameterize image tag)\n\nRelated: clack-90ga.2 (also modifies stack.yml for secret versioning - coordinate changes)\n\nNote: stack.yml overlap with clack-90ga.2 - changes are in different sections (image vs secrets) so parallel work is safe, but final integration should verify no conflicts.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T21:01:10.605308929Z","created_by":"vscode","updated_at":"2026-01-04T22:53:27.500533922Z","closed_at":"2026-01-04T22:53:27.500533922Z","close_reason":"Implemented and tested in production. Image tagging with git SHA working correctly.","dependencies":[{"issue_id":"clack-90ga.1","depends_on_id":"clack-90ga","type":"parent-child","created_at":"2026-01-04T21:01:10.609995471Z","created_by":"vscode"}]}
{"id":"clack-90ga.2","title":"Add secret rotation command","description":"Implement secret rotation that updates secrets without requiring full stack removal. Uses Docker's versioned secret pattern.\n\nAcceptance Criteria:\n- [ ] New secrets.sh rotate \u003csecret-name\u003e command\n- [ ] Creates versioned secret (e.g., openai_api_key_v2)\n- [ ] Updates stack.yml reference to new secret version\n- [ ] Triggers service update to pick up new secret\n- [ ] Old secret can be cleaned up after confirming success\n- [ ] Volumes and data preserved throughout\n\nFiles:\n- secrets.sh (modify)\n- stack.yml (may need versioned secret references)\n\nRelated: clack-90ga.1 (also modifies stack.yml for image tagging - coordinate changes)\n\nNote: stack.yml overlap with clack-90ga.1 - changes are in different sections (secrets vs image) so parallel work is safe, but final integration should verify no conflicts.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T21:01:11.81098893Z","created_by":"vscode","updated_at":"2026-01-04T22:53:27.521997172Z","closed_at":"2026-01-04T22:53:27.521997172Z","close_reason":"Secret rotation command implemented and tested. Includes bug fix for version detection.","dependencies":[{"issue_id":"clack-90ga.2","depends_on_id":"clack-90ga","type":"parent-child","created_at":"2026-01-04T21:01:11.823999013Z","created_by":"vscode"}]}
{"id":"clack-90ga.3","title":"Document deployment workflow","description":"Document the new deployment workflow including secret rotation and rollback procedures.\n\nAcceptance Criteria:\n- [ ] Deployment commands documented\n- [ ] Secret rotation procedure documented\n- [ ] Rollback procedure (using old image tags) documented\n\nRelated: clack-90ga.1, clack-90ga.2\n\nFiles:\n- docs/DEPLOYMENT.md (create or update existing)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T21:01:20.502440211Z","created_by":"vscode","updated_at":"2026-01-04T22:53:27.540650839Z","closed_at":"2026-01-04T22:53:27.540650839Z","close_reason":"Comprehensive deployment documentation created at docs/DEPLOYMENT.md","dependencies":[{"issue_id":"clack-90ga.3","depends_on_id":"clack-90ga","type":"parent-child","created_at":"2026-01-04T21:01:20.508847003Z","created_by":"vscode"},{"issue_id":"clack-90ga.3","depends_on_id":"clack-90ga.1","type":"blocks","created_at":"2026-01-04T21:01:26.247742381Z","created_by":"vscode"},{"issue_id":"clack-90ga.3","depends_on_id":"clack-90ga.2","type":"blocks","created_at":"2026-01-04T21:01:26.263995589Z","created_by":"vscode"}]}
{"id":"clack-926","title":"Testing Infrastructure","description":"Create comprehensive test suite with mocks, fixtures, and testing tools for the Home Assistant client.","status":"tombstone","priority":0,"issue_type":"epic","created_at":"2025-11-24T00:14:50.680916834Z","updated_at":"2026-01-03T21:41:47.645866918Z","deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"clack-940","title":"Test coverage below 80% threshold - multiple files at 0%","description":"Test coverage is at 79.64%, below the 80% threshold. Several files have 0% test coverage:\n\n**Zero Coverage Files:**\n- `src/utils/error-handler.ts` - No tests written\n- `src/cli/commands/test-board.ts` - No tests written  \n- `src/content/formatters/text-layout.ts` - No tests written\n\n**Low Coverage Files:**\n- `src/content/generators/ai-prompt-generator.ts` - 33.33% (lines 119,127,153-318 uncovered)\n- `src/scheduler/cron.ts` - 42.85% (lines 57-58, 82-126 uncovered)\n\n**Impact:** CI quality gates may fail, reducing confidence in code changes.","acceptance_criteria":"- [ ] Add unit tests for src/utils/error-handler.ts\n- [ ] Add unit tests for src/cli/commands/test-board.ts\n- [ ] Add unit tests for src/content/formatters/text-layout.ts\n- [ ] Improve coverage for ai-prompt-generator.ts to 80%+\n- [ ] Improve coverage for cron.ts to 80%+\n- [ ] Overall coverage reaches 80% threshold","notes":"3-char identifier cleanup","status":"closed","priority":3,"issue_type":"bug","created_at":"2025-11-28T17:39:42.619084458Z","updated_at":"2026-01-23T22:36:20.316279708Z","closed_at":"2026-01-23T22:36:20.316281917Z","labels":["tech-debt","testing"],"dependencies":[{"issue_id":"clack-940","depends_on_id":"clack-ini3","type":"parent-child","created_at":"2025-11-29T07:01:41.255440509Z","created_by":"daemon"}]}
{"id":"clack-941","title":"90-Day Retention Cleanup","description":"Add scheduled cleanup job to delete content older than 90 days.\n\n**Files to modify**:\n- `src/storage/models/content.ts` - Add `deleteOlderThan()` method\n- `src/scheduler/cron.ts` or new file - Add daily cleanup job\n\n**Implementation**:\n```typescript\n// ContentModel\nasync deleteOlderThan(days: number): Promise\u003cnumber\u003e {\n  const result = await this.db.run(\n    'DELETE FROM content WHERE generated_at \u003c DATE_SUB(NOW(), INTERVAL ? DAY)',\n    [days]\n  );\n  return result.changes;\n}\n```\n\nRun cleanup daily or on startup.","acceptance_criteria":"- Records older than 90 days deleted\n- Cleanup runs daily (or on startup)\n- Deletion count logged\n- Doesn't affect votes FK (cascade handles this)","status":"tombstone","priority":3,"issue_type":"task","created_at":"2025-11-27T21:49:13.4711153Z","updated_at":"2026-01-03T21:41:47.645866918Z","labels":["maintenance"],"dependencies":[{"issue_id":"clack-941","depends_on_id":"clack-hfu","type":"parent-child","created_at":"2025-11-27T21:49:45.931624801Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-95p","title":"[MEDIUM] Remove typeof checks in motivational-generator.test.ts","description":"**File:** tests/unit/content/generators/ai/motivational-generator.test.ts\n**Lines:** 116-160\n**Category:** Doesn't Make Sense\n**Severity:** Medium\n\n## Problem\nMultiple tests don't test what they claim:\n- Lines 116-128: Named \"generate()\" but only calls getters\n- Lines 130-139: Only checks typeof\n- Lines 142-160: Only typeof checks for inherited methods\n\n## Evidence\n```typescript\nit('should load correct prompts and use LIGHT tier', () =\u003e {\n  // Named as generate() test but never calls generate()!\n  expect(generator.getSystemPromptFile()).toBe('...');\n  expect(generator.getUserPromptFile()).toBe('...');\n});\n```\n\n## Implementation Instructions\n1. **Remove lines 130-139 and 142-160** - typeof checks\n2. **Fix lines 116-128** - Either rename to \"getter methods\" OR actually call generate() and verify prompts are used\n\n## Acceptance Criteria\n- [ ] Test names match what is being tested\n- [ ] No typeof checks for inherited methods\n- [ ] generate() tests actually call generate()","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-11-29T05:07:12.774914052Z","updated_at":"2026-01-03T21:41:47.645866918Z","labels":["medium","testing"],"dependencies":[{"issue_id":"clack-95p","depends_on_id":"clack-anr5","type":"parent-child","created_at":"2025-11-29T07:00:49.558036929Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-96v","title":"Update content:test CLI with validation and prompt display","description":"Enhance npm run content:test CLI output to show the user prompt sent to LLM and the validation result (pass/fail with detailed metrics).","design":"File: src/cli/commands/content-test.ts\n\nAdd new output sections:\n1. USER PROMPT SENT TO LLM - show content.metadata.userPrompt\n2. VALIDATION RESULT - call validateGeneratorOutput() and display:\n   - Status: ✅ PASSED or ❌ FAILED\n   - Lines: X/5\n   - Max line length: X/21\n   - Invalid characters: none or list","acceptance_criteria":"- Shows user prompt when available (AI generators)\n- Shows validation pass/fail status\n- Shows detailed metrics (line count, max length, invalid chars)\n- Gracefully handles validation failures in display","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2025-11-27T20:03:12.5614148Z","updated_at":"2026-01-03T21:41:47.645866918Z","dependencies":[{"issue_id":"clack-96v","depends_on_id":"clack-foo","type":"parent-child","created_at":"2025-11-27T20:03:23.39776618Z","created_by":"daemon"},{"issue_id":"clack-96v","depends_on_id":"clack-rnx","type":"blocks","created_at":"2025-11-27T20:03:30.262537044Z","created_by":"daemon"},{"issue_id":"clack-96v","depends_on_id":"clack-pds","type":"blocks","created_at":"2025-11-27T20:03:30.391189294Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature"}
{"id":"clack-9jrw","title":"Register LanguageLessonGenerator in core content system","description":"Wire up the existing LanguageLessonGenerator (Duolingo-style micro-lessons) to the content registry.\n\n## Changes Required\n\n### 1. register-core.ts\n- Add `languageLesson: ContentGenerator` property to CoreGenerators interface\n- Add registration call in `registerCoreContent()`:\n  ```typescript\n  registry.register(\n    {\n      id: 'language-lesson',\n      name: 'Language Lesson Generator',\n      priority: ContentPriority.NORMAL,\n      modelTier: ModelTier.LIGHT,\n      applyFrame: true,\n    },\n    generators.languageLesson\n  );\n  ```\n\n### 2. bootstrap.ts\n- Add import: `import { LanguageLessonGenerator } from './content/generators/ai/language-lesson-generator.js';`\n- Add to `createCoreGenerators()` return object:\n  ```typescript\n  languageLesson: new LanguageLessonGenerator(promptLoader, modelTierSelector, apiKeys),\n  ```\n\n## Acceptance Criteria\n- [ ] CoreGenerators interface includes `languageLesson: ContentGenerator` property\n- [ ] `registerCoreContent()` registers with id 'language-lesson', P2 priority, LIGHT tier, applyFrame: true\n- [ ] `createCoreGenerators()` instantiates LanguageLessonGenerator\n- [ ] `npm run content:list` shows language-lesson generator at P2 priority\n- [ ] `npm run content:test language-lesson` executes successfully (dry-run)\n- [ ] All existing tests pass (`npm test`)\n\n## Files\n- src/content/registry/register-core.ts (interface + registration)\n- src/bootstrap.ts (import + instantiation)\n\n## Size Estimate\n- 2 files\n- ~25 lines of code changes\n- Single-agent task, no dependencies","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-21T17:40:28.953053797Z","created_by":"Ryan Brodkin","updated_at":"2026-01-21T19:38:26.115269753Z","closed_at":"2026-01-21T19:38:26.115269753Z","close_reason":"Merged to main - LanguageLessonGenerator registered with P2 priority, LIGHT tier, applyFrame: true"}
{"id":"clack-9mi","title":"Install and configure Tailwind CSS and shadcn/ui","description":"Set up Tailwind CSS build pipeline and initialize shadcn/ui component system with mobile-first responsive design configuration.","design":"**Package Installation:**\n- tailwindcss, postcss, autoprefixer (dev dependencies)\n- class-variance-authority, clsx, tailwind-merge (shadcn deps)\n- react-router-dom (routing)\n\n**Configuration Files:**\n- tailwind.config.ts - Mobile-first breakpoints, dark mode class strategy\n- postcss.config.cjs - Tailwind processor\n- src/web/frontend/index.css - @tailwind directives\n\n**shadcn/ui Setup:**\n- Run: npx shadcn@latest init\n- Install base components: button, card, input, badge, separator, sheet, toast\n- Components dir: src/web/frontend/components/ui\n\n**Directory Structure:**\n- components/ui/ (shadcn generated)\n- components/layout/ (navigation, page layouts)\n- components/features/ (vestaboard-preview, voting, etc.)\n- lib/utils.ts (cn() helper)","acceptance_criteria":"- [ ] Tailwind CSS installed and configured with mobile-first breakpoints\n- [ ] PostCSS configuration working with Vite build\n- [ ] shadcn/ui initialized with button, card, input, badge, separator, sheet, toast\n- [ ] Component directory structure created (ui/, layout/, features/)\n- [ ] index.css with Tailwind directives imported in main.tsx\n- [ ] Dev server starts with HMR for Tailwind changes\n- [ ] Production build completes without errors\n- [ ] All existing tests pass\n- [ ] Linting passes","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-11-26T05:05:06.736838136Z","updated_at":"2026-01-03T21:41:47.645866918Z","labels":["tooling","ui","web"],"dependencies":[{"issue_id":"clack-9mi","depends_on_id":"clack-dor","type":"parent-child","created_at":"2025-11-26T05:05:20.145453545Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-9rsz","title":"Implement versioned secrets for zero-downtime updates","description":"Current secrets.sh uses destructive update pattern requiring stack removal and causing downtime.\n\n**Problem:**\n- Docker Swarm secrets are immutable\n- secrets.sh deletes and recreates secrets with same name\n- Services referencing deleted secrets fail\n- Stack must be removed first (documented in DEPLOY.md lines 82-86)\n\n**Solution:**\nImplement versioned secrets pattern:\n1. secrets.sh creates new version (e.g., home_assistant_url_v2)\n2. deploy.sh updates stack.yml to reference new version\n3. docker stack deploy does rolling update\n4. Old secret cleaned up after confirmation\n\n**Benefits:**\n- Zero-downtime secret rotation\n- Automatic rollback via Swarm's update_config\n- Idempotent operations\n\n**Files to modify:**\n- secrets.sh - add version tracking\n- deploy.sh - update stack.yml references\n- stack.yml - parameterize secret names","status":"closed","priority":3,"issue_type":"feature","created_at":"2026-01-04T02:37:49.771475375Z","created_by":"vscode","updated_at":"2026-01-05T20:09:19.79503997Z","closed_at":"2026-01-05T20:09:19.79503997Z","close_reason":"Fully implemented - secrets.sh has rotate command with versioned pattern, deploy.sh updated"}
{"id":"clack-9tr9","title":"Final Polish \u0026 Documentation","description":"## Overview\nFix fixed count assertions across ALL migrated integration tests, update documentation.\n\n## Risk Level\nLOW - Non-breaking refinements after all risky migrations are complete and validated.\n\n## Dependencies\nRequires ALL 6 domain migration epics to complete:\n- clack-b8xx: CLI Command Test Migration\n- clack-7yso: Storage Layer Test Migration\n- clack-uotb: AI Generators - Hot Take \u0026 Personality\n- clack-rjyb: AI Generators - News \u0026 Learning\n- clack-te4l: AI Generators - Philosophical \u0026 Misc\n- clack-5tjn: Core Orchestration Tests\n\n## Files Affected\n2-3 test files + documentation\n\n## Success Criteria\n- [ ] Fixed count assertions replaced with flexible assertions\n- [ ] Documentation updated with final metrics\n- [ ] 100% standards compliance achieved\n- [ ] All tests pass\n\n## Orchestration Notes\nThis epic cannot start until ALL 6 sibling domain epics complete successfully.\nIt performs final polish work that touches files modified by the domain epics.","status":"open","priority":1,"issue_type":"epic","owner":"ryan@spice.cc","created_at":"2026-01-27T22:28:04.795279128Z","created_by":"Ryan Brodkin","updated_at":"2026-01-27T22:36:31.795644543Z","dependencies":[{"issue_id":"clack-9tr9","depends_on_id":"clack-b8xx","type":"blocks","created_at":"2026-01-27T22:33:49.010629301Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-9tr9","depends_on_id":"clack-7yso","type":"blocks","created_at":"2026-01-27T22:33:49.068217635Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-9tr9","depends_on_id":"clack-uotb","type":"blocks","created_at":"2026-01-27T22:33:49.126142385Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-9tr9","depends_on_id":"clack-rjyb","type":"blocks","created_at":"2026-01-27T22:33:49.17989676Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-9tr9","depends_on_id":"clack-te4l","type":"blocks","created_at":"2026-01-27T22:33:49.233176551Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-9tr9","depends_on_id":"clack-5tjn","type":"blocks","created_at":"2026-01-27T22:33:49.28560726Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-9tr9.1","title":"Fix fixed count assertions","description":"## Objective\nReplace fixed count assertions in existing integration tests with flexible presence-based assertions.\n\n## TDD Approach\n1. RED: Identify fixed count assertions that break when features added\n2. GREEN: Replace with flexible assertions (toBeGreaterThan, toContainEqual)\n3. BLUE: Verify tests still validate behavior without brittleness\n\n## Acceptance Criteria\n- [ ] Update tests/integration/web/routes/content.test.ts (replace toHaveLength with flexible assertions)\n- [ ] Update tests/integration/web/server-database.test.ts (replace toHaveLength with presence checks)\n- [ ] Use toBeGreaterThan(0) for array length checks\n- [ ] Use toContainEqual(expect.objectContaining(...)) for specific item presence\n- [ ] All tests pass with flexible assertions\n- [ ] Tests remain robust when new features added\n\n## Scope\nFiles: 2-3 existing integration test files","status":"open","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-27T22:28:16.604476425Z","created_by":"Ryan Brodkin","updated_at":"2026-01-27T22:28:16.604476425Z","dependencies":[{"issue_id":"clack-9tr9.1","depends_on_id":"clack-9tr9","type":"parent-child","created_at":"2026-01-27T22:28:16.605106175Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-9tr9.2","title":"Update documentation and metrics","description":"## Objective\nUpdate TEST_FIXES_REQUIRED.md with completion status and final metrics showing standards compliance improvement.\n\n## TDD Approach\nNo test creation needed - documentation update only.\n\n## Acceptance Criteria\n- [ ] Add completion summary to TEST_FIXES_REQUIRED.md\n- [ ] Update metrics table with final counts (unit tests, integration tests, deleted tests)\n- [ ] Document any deviations from original plan\n- [ ] Verify 100% standards compliance achieved\n- [ ] Update CLAUDE.md testing section if patterns changed\n- [ ] Commit documentation updates\n\n## Scope\nFiles: 2 documentation files (TEST_FIXES_REQUIRED.md, CLAUDE.md)","status":"open","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-27T22:28:27.717028305Z","created_by":"Ryan Brodkin","updated_at":"2026-01-27T22:28:27.717028305Z","dependencies":[{"issue_id":"clack-9tr9.2","depends_on_id":"clack-9tr9","type":"parent-child","created_at":"2026-01-27T22:28:27.717710472Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-9u3","title":"Write Unit Tests for HTTP Client","description":"Create unit tests for VestaboardHTTPClient with mocked fetch API. Target: 80%+ coverage covering success cases, error handling, and connection validation.","design":"## Test Strategy\nMock global.fetch using jest.fn()\n\nCoverage areas:\n1. Successful message send\n2. Error handling (401, 403, 400, timeout)\n3. Header injection (X-Vestaboard-Local-Api-Key)\n4. Request body format\n5. Response parsing\n6. Connection validation\n7. Custom error types\n\nReference: tests/unit/api/ai/openai.test.ts (SDK mocking pattern)","acceptance_criteria":"- tests/unit/api/vestaboard/http-client.test.ts created\n- Test sendMessage() success with mocked fetch\n- Test sendMessage() with 401 auth error → VestaboardAuthenticationError\n- Test sendMessage() with 403 auth error → VestaboardAuthenticationError\n- Test sendMessage() with 400 error → VestaboardInvalidMessageError\n- Test sendMessage() with network error → VestaboardConnectionError\n- Test sendMessage() with timeout → VestaboardConnectionError\n- Test getCurrentMessage() success\n- Test validateConnection() returns true on success\n- Test validateConnection() returns false on failure\n- Test X-Vestaboard-Local-Api-Key header injection\n- Test request body format (character codes array)\n- Test response parsing\n- 80%+ coverage achieved\n- All tests pass\n- Uses mocked fetch (no real HTTP)","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-11-26T05:25:29.379422841Z","updated_at":"2026-01-03T21:41:47.645866918Z","dependencies":[{"issue_id":"clack-9u3","depends_on_id":"clack-ko4","type":"blocks","created_at":"2025-11-26T05:25:29.380145091Z","created_by":"daemon"},{"issue_id":"clack-9u3","depends_on_id":"clack-suz","type":"blocks","created_at":"2025-11-26T05:25:29.381288507Z","created_by":"daemon"},{"issue_id":"clack-9u3","depends_on_id":"clack-jc1","type":"blocks","created_at":"2025-11-26T05:25:29.381920091Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-9zv","title":"WeatherGenerator doesn't inject weather data into prompts","description":"When running `npm run content:test weather-focus`, the generated content never references actual local weather data. The prompt expects weather data but never receives it.\n\n**Root Cause**: `WeatherGenerator` extends `AIPromptGenerator` but doesn't override `generate()` to fetch and inject weather data. The prompt file `weather-focus.txt` references \"CURRENT WEATHER section above\" that doesn't exist.\n\n**Evidence**:\n- `WeatherGenerator` only implements `getSystemPromptFile()` and `getUserPromptFile()`\n- No `WeatherService` dependency injection\n- No template variables for weather data in prompt loading\n- `BaseNewsGenerator` shows the correct pattern (fetches RSS, injects as `{{headlines}}`)","design":"Follow the `BaseNewsGenerator` pattern:\n\n1. Accept `WeatherService` in constructor (dependency injection)\n2. Override `generate()` method\n3. Fetch weather data via `WeatherService.getWeather()`\n4. Format weather as template variable\n5. Pass to `loadPromptWithVariables()` with `{ weather: formattedWeather }`\n6. Update prompt to use `{{weather}}` placeholder","acceptance_criteria":"- [ ] `npm run content:test weather-focus` shows actual weather data in generated content\n- [ ] WeatherGenerator fetches weather via WeatherService\n- [ ] Weather data injected via template variable `{{weather}}`\n- [ ] Graceful fallback when weather unavailable\n- [ ] Unit tests cover weather injection and fallback\n- [ ] Existing tests continue to pass","status":"tombstone","priority":2,"issue_type":"bug","created_at":"2025-11-27T19:41:55.004805625Z","updated_at":"2026-01-03T21:41:47.645866918Z","deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"bug"}
{"id":"clack-a13","title":"Add security headers middleware (helmet.js)","description":"Configure helmet middleware in Express server to set security headers: X-Frame-Options, Content-Security-Policy, X-Content-Type-Options, etc.","design":"Install helmet package and add middleware to src/web/server.ts:\n- npm install helmet @types/helmet\n- import helmet from 'helmet'\n- app.use(helmet())\n- Configure CSP for static assets and API endpoints","acceptance_criteria":"- helmet middleware added to Express server\n- Security headers present in HTTP responses\n- Tests verify headers are set correctly\n- No breaking changes to existing functionality","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-11-23T18:47:55.610565297Z","updated_at":"2026-01-03T21:41:47.645866918Z","labels":["priority-2","security","web"],"dependencies":[{"issue_id":"clack-a13","depends_on_id":"clack-ddj","type":"parent-child","created_at":"2025-11-23T23:47:45.270440846Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-a139","title":"VestaboardPreview component doesn't render color tiles","description":"The VestaboardPreview component in src/web/frontend/components/VestaboardPreview.tsx does not render Vestaboard color tiles (codes 63-69) as colored backgrounds.\n\nCurrent behavior: Color codes are mapped to symbols (°, ♥, ★, ♪) or render as blank spaces.\n\nExpected behavior: Codes 63-69 should render as colored tile backgrounds:\n- 63 = red\n- 64 = orange\n- 65 = yellow\n- 66 = green\n- 67 = blue\n- 68 = violet\n- 69 = white/black (model-dependent)\n\nThis affects the color bar display in framed content - the rightmost column should show colored tiles but instead shows blank/symbol characters.\n\nFiles:\n- src/web/frontend/components/VestaboardPreview.tsx\n\nAcceptance Criteria:\n- Color codes 63-69 render as colored background tiles\n- Colors match actual Vestaboard hardware colors\n- Works correctly for both black and white board models","status":"closed","priority":2,"issue_type":"bug","owner":"ryan@spice.cc","created_at":"2026-01-23T01:24:16.153024221Z","created_by":"Ryan Brodkin","updated_at":"2026-01-23T23:56:42.197927509Z","closed_at":"2026-01-23T23:56:42.197927509Z","close_reason":"Fixed: Color tiles (codes 63-69) now render as colored backgrounds with desaturated colors for realistic appearance. Code 69 handles model-dependent behavior correctly."}
{"id":"clack-adr","title":"Epic 2: Model Tier \u0026 AI Provider Enhancement","description":"Extend AI provider system to support tiered model selection (light/medium/heavy) with cross-provider fallback. Includes model tier configuration, selector class, and factory enhancement.","status":"tombstone","priority":1,"issue_type":"epic","created_at":"2025-11-26T22:14:23.398764635Z","updated_at":"2026-01-03T21:41:47.645866918Z","labels":["ai","content-system","model-tiers"],"dependencies":[{"issue_id":"clack-adr","depends_on_id":"clack-b5o","type":"blocks","created_at":"2025-11-26T22:14:34.833081959Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"clack-ae2","title":"[MEDIUM] Remove typeof checks in global-news-generator.test.ts","description":"**File:** tests/unit/content/generators/ai/global-news-generator.test.ts\n**Lines:** 152-176\n**Category:** Doesn't Make Sense\n**Severity:** Medium\n\n## Problem\nTwo tests (lines 153-163 and 165-175) only verify that `generate` and `validate` methods exist and are functions. These test the mock's interface rather than actual behavior.\n\n## Evidence\n```typescript\nit('should inherit generate method from BaseNewsGenerator', () =\u003e {\n  expect(typeof generator.generate).toBe('function');\n  // ← Tests JavaScript runtime, not business logic\n});\n```\n\n## Implementation Instructions\n1. **Remove lines 152-176** entirely\n2. OR **Replace with behavior tests**:\n```typescript\nit('should generate content using global news sources', async () =\u003e {\n  mockRssClient.fetchHeadlines.mockResolvedValue(['Global headline']);\n  const result = await generator.generate(mockContext);\n  expect(result.text).toContain('headline');\n});\n```\n\n## Acceptance Criteria\n- [ ] No `typeof === 'function'` assertions\n- [ ] Tests verify actual behavior or are removed\n- [ ] Inheritance is verified through actual method calls","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-11-29T05:07:09.695907676Z","updated_at":"2026-01-03T21:41:47.645866918Z","labels":["medium","testing"],"dependencies":[{"issue_id":"clack-ae2","depends_on_id":"clack-anr5","type":"parent-child","created_at":"2025-11-29T07:00:50.03004643Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-anr5","title":"TypeOf Check Removal - Redundant Type Assertions","description":"Remove all TypeScript-redundant typeof checks across the test suite. These are compile-time guaranteed in TS and add no runtime value.\n\nCan be parallelized - each file is independent:\n- Global typeof cleanup task\n- news-generator.test.ts\n- motivational-generator.test.ts\n- local-news-generator.test.ts\n- global-news-generator.test.ts\n- programmatic-generator.test.ts tautological tests\n- notification-generator.test.ts tautological tests","status":"tombstone","priority":1,"issue_type":"epic","created_at":"2025-11-29T07:00:20.641183972Z","updated_at":"2026-01-03T21:41:47.645866918Z","deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"clack-aqq","title":"Create LocalNewsGenerator (LA Times, KTLA)","description":"News generator for local LA area news headlines.\n\n**Files:**\n- `src/content/generators/ai/local-news-generator.ts` (new)\n- `prompts/user/news-local.txt` (new)\n\n**Default Feeds:**\n- LA Times: `https://www.latimes.com/local/rss2.0.xml`\n- KTLA: `https://ktla.com/feed/`\n\n**Requirements:**\n- Extends base NewsGenerator\n- Uses `prompts/user/news-local.txt` for user prompt\n- Configurable via `RSS_LOCAL_FEEDS` env var","status":"tombstone","priority":2,"issue_type":"task","assignee":"claude","created_at":"2025-11-27T09:21:00.515239384Z","updated_at":"2026-01-03T21:41:47.645866918Z","labels":["content","news"],"dependencies":[{"issue_id":"clack-aqq","depends_on_id":"clack-viu","type":"parent-child","created_at":"2025-11-27T09:21:49.776614128Z","created_by":"daemon"},{"issue_id":"clack-aqq","depends_on_id":"clack-42e","type":"blocks","created_at":"2025-11-27T09:22:12.807178084Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-ar9","title":"Implement Connection Management","description":"Create WebSocket polyfill for Node.js, implement connect/disconnect methods with long-lived token auth, add connection state tracking and validation.","acceptance_criteria":"- connect() method with long-lived token auth\n- disconnect() method with cleanup\n- isConnected() status check\n- validateConnection() for testing\n- Connection state tracking","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-11-24T00:18:26.514526878Z","updated_at":"2026-01-03T21:41:47.645866918Z","dependencies":[{"issue_id":"clack-ar9","depends_on_id":"clack-1h3","type":"blocks","created_at":"2025-11-24T00:19:43.129430136Z","created_by":"daemon"},{"issue_id":"clack-ar9","depends_on_id":"clack-d1q","type":"blocks","created_at":"2025-11-24T00:19:49.270928667Z","created_by":"daemon"},{"issue_id":"clack-ar9","depends_on_id":"clack-0nr","type":"parent-child","created_at":"2025-11-24T04:18:51.689510551Z","created_by":"vscode"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-avo","title":"Update AI model tiers to latest 2025 models (GPT-4.1 + Claude 4.5)","description":"Update the MODEL_TIERS configuration to use the latest 2025 models from both providers:\n\nOpenAI (GPT-4.1 family):\n- light: gpt-4.1-nano\n- medium: gpt-4.1-mini  \n- heavy: gpt-4.1\n\nAnthropic (Claude 4.5 family):\n- light: claude-haiku-4-5-20251001\n- medium: claude-sonnet-4-5-20250929\n- heavy: claude-opus-4-5-20251101\n\nCurrent models (gpt-4o-mini, gpt-4o, gpt-4-turbo and claude-3-haiku, claude-3-5-sonnet, claude-3-opus) are outdated.","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2025-11-27T07:32:22.990906548Z","updated_at":"2026-01-03T21:41:47.645866918Z","deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"chore"}
{"id":"clack-b1m","title":"Task 6.2: Update MinorUpdateGenerator for cached content","description":"Modify src/content/generators/minor-update.ts to use orchestrator's cached content and reapply frame with updated time/weather.","acceptance_criteria":"- Constructor accepts ContentOrchestrator and FrameDecorator\n- generate() retrieves cached content from orchestrator\n- Reapplies frame with current timestamp if outputMode === 'text'\n- Returns cached content directly if outputMode === 'layout'\n- Unit tests","status":"tombstone","priority":1,"issue_type":"task","assignee":"claude","created_at":"2025-11-26T22:16:50.455256092Z","updated_at":"2026-01-03T21:41:47.645866918Z","dependencies":[{"issue_id":"clack-b1m","depends_on_id":"clack-zoy","type":"parent-child","created_at":"2025-11-26T22:16:57.91667997Z","created_by":"daemon"},{"issue_id":"clack-b1m","depends_on_id":"clack-2b9","type":"blocks","created_at":"2025-11-26T22:16:58.162699721Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-b4hs","title":"Add time template variable to system prompts","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-11T19:45:24.452122Z","created_by":"vscode","updated_at":"2026-01-11T19:46:14.976639635Z","closed_at":"2026-01-11T19:46:14.976639635Z","close_reason":"Closed"}
{"id":"clack-b4r","title":"Update WebSocket documentation to use wss:// for security","description":"Security audit identified that documentation examples use ws:// (unencrypted WebSocket) instead of wss:// (encrypted WebSocket over TLS). Production deployments should use wss:// to prevent man-in-the-middle attacks.\n\n**Files to update:**\n- src/api/data-sources/home-assistant.ts (line 36 - JSDoc example)\n- .env.example (if Home Assistant URL example exists)\n\n**Changes needed:**\n- Replace ws://homeassistant.local:8123 with wss://homeassistant.local:8123\n- Add note about TLS/SSL certificate requirements\n- Consider adding runtime warning in production mode if ws:// detected","status":"tombstone","priority":1,"issue_type":"bug","created_at":"2025-11-24T07:02:44.112893297Z","updated_at":"2026-01-03T21:41:47.645866918Z","labels":["documentation","security"],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"bug"}
{"id":"clack-b5o","title":"Epic 1: Core Type Definitions \u0026 Interfaces","description":"Establish foundational types and interfaces for the content generation system including ContentGenerator interface, GenerationContext, GeneratedContent, priority enums, and registration metadata types.","status":"tombstone","priority":1,"issue_type":"epic","created_at":"2025-11-26T22:14:23.159968843Z","updated_at":"2026-01-03T21:41:47.645866918Z","labels":["content-system","foundation","types"],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"clack-b7e","title":"Task 7.2: Update CLI generate command","description":"Update src/cli/commands/generate.ts to use ContentOrchestrator instead of legacy generator.","acceptance_criteria":"- Uses bootstrap() to initialize system\n- Calls orchestrator.generateAndSend()\n- Displays generated content and metadata\n- Error handling for all failure modes","status":"tombstone","priority":2,"issue_type":"task","assignee":"claude","created_at":"2025-11-26T22:17:15.203631631Z","updated_at":"2026-01-03T21:41:47.645866918Z","dependencies":[{"issue_id":"clack-b7e","depends_on_id":"clack-f33","type":"parent-child","created_at":"2025-11-26T22:17:25.897185136Z","created_by":"daemon"},{"issue_id":"clack-b7e","depends_on_id":"clack-bra","type":"blocks","created_at":"2025-11-26T22:17:26.43973097Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-b8xx","title":"CLI Command Test Migration","description":"## Overview\nMove 11 CLI command unit tests to integration with boundary-only mocking.\n\n## Risk Level\nMEDIUM - CLI domain is self-contained. If bootstrap mocking breaks, it is isolated to CLI tests only.\n\n## Dependencies\nRequires Epic 1 (Testing Foundations) to establish patterns.\n\n## Files Affected\n11 test files from tests/unit/cli/commands/ -\u003e tests/integration/cli/commands/\n\n## Success Criteria\n- [ ] All 11 CLI test files moved to integration directory\n- [ ] Bootstrap mocking removed - use real bootstrap()\n- [ ] Mock only external APIs (createAIProvider, VestaboardClient, HomeAssistantClient)\n- [ ] Verify scheduler.stop() cleanup in finally blocks\n- [ ] All tests pass in integration environment\n\n## Parallel Execution Context\nThis epic runs IN PARALLEL with these sibling epics (no file overlap):\n- clack-7yso: Storage Layer Test Migration\n- clack-uotb: AI Generators - Hot Take \u0026 Personality\n- clack-rjyb: AI Generators - News \u0026 Learning\n- clack-te4l: AI Generators - Philosophical \u0026 Misc\n- clack-5tjn: Core Orchestration Tests\n\nEach domain is isolated - failures in this epic do NOT affect sibling epics.","status":"open","priority":1,"issue_type":"epic","owner":"ryan@spice.cc","created_at":"2026-01-27T22:09:32.103555377Z","created_by":"Ryan Brodkin","updated_at":"2026-01-27T22:36:15.893638216Z","dependencies":[{"issue_id":"clack-b8xx","depends_on_id":"clack-3n0y","type":"blocks","created_at":"2026-01-27T22:28:40.838255756Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-b8xx.1","title":"Move CLI command tests to integration","description":"## Objective\nRelocate CLI command tests from tests/unit/cli/commands/ to tests/integration/cli/commands/ and refactor to use real components with boundary-only mocking.\n\n## TDD Approach\n1. RED: Move test files, update imports (tests may fail due to path changes)\n2. GREEN: Replace internal mocks with real bootstrap components, mock only external APIs\n3. BLUE: Verify tests cover complete workflows with real orchestration\n\n## Acceptance Criteria\n- [ ] Move 11 CLI test files from unit to integration directory\n- [ ] Update imports to use @/ paths correctly\n- [ ] Remove bootstrap mocking - use real bootstrap()\n- [ ] Mock only external APIs (createAIProvider, VestaboardClient, HomeAssistantClient)\n- [ ] Verify scheduler.stop() cleanup in finally blocks\n- [ ] All tests pass in integration environment\n- [ ] Coverage maintained or improved\n\n## Scope\nFiles: test-ai, generate, content-test, test-ha, content-list, frame, db-migrate, circuit, test-board, db-reset, auth (11 test files)","status":"open","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-27T22:09:56.400264263Z","created_by":"Ryan Brodkin","updated_at":"2026-01-27T22:09:56.400264263Z","dependencies":[{"issue_id":"clack-b8xx.1","depends_on_id":"clack-b8xx","type":"parent-child","created_at":"2026-01-27T22:09:56.401528472Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-bg34","title":"[CLEANUP] Remove all TypeScript-redundant typeof checks","description":"**Category:** Test Cleanup\n**Priority:** High\n\n## Problem\nMultiple test files contain tests that verify things TypeScript already enforces at compile time:\n- `typeof generator.generate === 'function'`\n- `expect(true).toBe(true)` for abstract class instantiation\n- Property existence checks for interface compliance\n\nThese tests add zero value - TypeScript compilation already verifies these constraints. They clutter the test suite and give false confidence.\n\n## Files to Clean Up\n\n### Remove entirely (tautological assertions):\n1. **notification-generator.test.ts** (lines 56-60): `expect(true).toBe(true)` compile-time check\n2. **programmatic-generator.test.ts** (lines 56-62): `expect(true).toBe(true)` compile-time check\n3. **global-news-generator.test.ts** (lines 152-176): typeof checks for inherited methods\n4. **local-news-generator.test.ts** (lines 184-195, 213-248): typeof checks\n5. **motivational-generator.test.ts** (lines 130-139, 142-160): typeof checks\n6. **news-generator.test.ts** (lines 130-139, 142-160): typeof checks\n7. **tech-news-generator.test.ts** (lines 129-140): typeof property existence\n8. **model-tiers.test.ts** (lines 6-15): Runtime type checking TypeScript handles\n9. **ai-prompt-generator.test.ts** (lines 410-432): Abstract method \"enforcement\" tests\n\n### Pattern to Remove:\n```typescript\n// DELETE tests like these:\nit('should not be directly instantiable at compile time', () =\u003e {\n  const compileTimeCheck = true;\n  expect(compileTimeCheck).toBe(true);\n});\n\nit('should inherit generate method', () =\u003e {\n  expect(typeof generator.generate).toBe('function');\n});\n\nit('should require eventPattern property', () =\u003e {\n  expect(generator).toHaveProperty('eventPattern');\n});\n```\n\n## Implementation Instructions\nFor each file:\n1. **Delete the identified test cases entirely** - do not refactor\n2. **Update test count expectations** if any exist\n3. **Run tests** to ensure nothing broke\n4. **Commit** with message: `test(cleanup): remove TypeScript-redundant tests from \u003cfile\u003e`\n\n## Acceptance Criteria\n- [ ] All 9 files cleaned up\n- [ ] No `typeof x === 'function'` assertions for inherited/interface methods\n- [ ] No `expect(true).toBe(true)` assertions\n- [ ] No property existence checks that TypeScript enforces\n- [ ] All tests still pass\n- [ ] Coverage percentage may decrease slightly (acceptable)","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-11-29T05:16:45.219408053Z","updated_at":"2026-01-03T21:41:47.645866918Z","labels":["cleanup","testing"],"dependencies":[{"issue_id":"clack-bg34","depends_on_id":"clack-s9o","type":"parent-child","created_at":"2025-11-29T05:17:02.705615047Z","created_by":"daemon"},{"issue_id":"clack-bg34","depends_on_id":"clack-anr5","type":"parent-child","created_at":"2025-11-29T07:00:49.001003179Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-biv","title":"[MEDIUM] Fix weather-generator.test.ts brittle try-catch patterns","description":"**File:** tests/unit/content/generators/ai/weather-generator.test.ts\n**Lines:** 156-197, 199-225, 312-345\n**Category:** Too Brittle\n**Severity:** Medium\n\n## Problem\n1. Lines 156-197: Tests wrap generate() in try-catch that swallows all errors with \"Expected to fail due to AI provider\"\n2. Lines 199-225, 312-345: Use `mock.calls.find()` with unsafe `?.` chaining and `as string` casting\n\n## Evidence\n```typescript\ntry {\n  await generator.generate(mockContext);\n} catch {\n  // Expected to fail due to AI provider\n}\n// ← Swallows all errors, test behavior unpredictable\n```\n\n## Implementation Instructions\n1. **Mock the AI provider completely** so generate() succeeds without throwing\n2. **Remove try-catch error swallowing** - tests should succeed or fail cleanly\n3. **Use deterministic mock call assertions** instead of `.find()` searching\n\n## Acceptance Criteria\n- [ ] AI provider properly mocked for successful generation\n- [ ] No try-catch blocks swallowing expected errors\n- [ ] Mock call assertions use direct indexing, not searching","notes":"3-char identifier cleanup","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-29T05:07:16.641328471Z","updated_at":"2026-01-23T22:36:20.290563291Z","closed_at":"2026-01-23T22:36:20.290567333Z","labels":["medium","testing"],"dependencies":[{"issue_id":"clack-biv","depends_on_id":"clack-ini3","type":"parent-child","created_at":"2025-11-29T07:01:30.950277212Z","created_by":"daemon"}]}
{"id":"clack-bphg","title":"[LOW] Fix web route tests with inconsistent function signatures","description":"**File:** tests/unit/web/routes/content.test.ts, voting.test.ts, logs.test.ts\n**Category:** Doesn't Make Sense\n**Severity:** Low\n\n## Problem\nMultiple web route tests have inconsistent function signatures - some pass 2 parameters, some pass 3. This suggests tests are checking mock setup behavior rather than actual route behavior.\n\n## Evidence\n```typescript\n// content.test.ts line 68 - 2 params\ngetLatestContent(mockRequest, mockResponse);\n\n// content.test.ts line 79 - 3 params  \ngetLatestContent(mockRequest, mockResponse, mockRepository);\n```\n\n## Implementation Instructions\n1. **Standardize function signatures** across all tests\n2. **Verify tests match actual route implementation**\n3. **Document if different signatures are intentional**\n\n## Acceptance Criteria\n- [ ] Consistent function signatures across test suite\n- [ ] Tests verify actual route behavior\n- [ ] Mock setup clearly separated from assertions","status":"tombstone","priority":3,"issue_type":"task","created_at":"2025-11-29T05:09:48.721718972Z","updated_at":"2026-01-03T21:41:47.645866918Z","close_reason":"Verified complete by code review","labels":["low","testing"],"dependencies":[{"issue_id":"clack-bphg","depends_on_id":"clack-ofzp","type":"parent-child","created_at":"2025-11-29T07:01:30.14136242Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-bra","title":"Task 7.1: Create bootstrap function","description":"Create src/bootstrap.ts to wire all components together at application startup - config loading, AI providers, registry, orchestrator, event handler, and scheduler.","acceptance_criteria":"- bootstrap() async function\n- Loads configuration from env\n- Creates AI providers and ModelTierSelector\n- Creates and populates ContentRegistry\n- Creates ContentOrchestrator with dependencies\n- Creates and initializes EventHandler\n- Creates and starts CronScheduler\n- Returns { orchestrator, eventHandler, scheduler }\n- Integration test","status":"tombstone","priority":1,"issue_type":"task","assignee":"claude","created_at":"2025-11-26T22:17:15.052262381Z","updated_at":"2026-01-03T21:41:47.645866918Z","dependencies":[{"issue_id":"clack-bra","depends_on_id":"clack-f33","type":"parent-child","created_at":"2025-11-26T22:17:25.732184094Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-bunp","title":"Fix integration test timing issues","description":"Address flaky timing patterns: bootstrap-cleanup.test.ts:123 (3-second arbitrary wait), trigger-config.test.ts (acknowledged race condition in comments). Use proper async/await patterns, event-based waiting, or fake timers. Acceptance: Tests pass with no .env file, no arbitrary waits, no race conditions.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T21:03:31.96523267Z","created_by":"vscode","updated_at":"2026-01-11T22:38:16.684005051Z","closed_at":"2026-01-11T22:38:16.684005051Z","close_reason":"Closed","dependencies":[{"issue_id":"clack-bunp","depends_on_id":"clack-82ep","type":"parent-child","created_at":"2026-01-11T21:04:05.411589213Z","created_by":"vscode"}]}
{"id":"clack-c19h","title":"[LOW] Remove arithmetic test in cron-minor-update.test.ts","description":"**File:** tests/integration/scheduler/cron-minor-update.test.ts\n**Lines:** 408-415\n**Category:** Does Nothing\n**Severity:** Low\n\n## Problem\nTest \"should use 60-second interval for recurring updates\" only verifies arithmetic (60 * 1000 = 60000), not scheduler behavior.\n\n## Evidence\n```typescript\nit('should use 60-second interval for recurring updates', () =\u003e {\n  const MINUTE_IN_MS = 60 * 1000;\n  expect(MINUTE_IN_MS).toBe(60000);  // ← Tests JavaScript math!\n});\n```\n\n## Implementation Instructions\n1. **Remove this test entirely** - it tests nothing useful\n2. **Or replace with actual scheduler test** that verifies setInterval is called with 60000ms\n3. **Document expected interval** in scheduler code, not in a test\n\n## Acceptance Criteria\n- [ ] No tests verifying JavaScript arithmetic\n- [ ] Scheduler interval verified through mock if needed\n- [ ] Test file focuses on actual scheduler behavior","status":"tombstone","priority":3,"issue_type":"task","created_at":"2025-11-29T05:09:25.581305377Z","updated_at":"2026-01-03T21:41:47.645866918Z","close_reason":"Verified complete by code review","labels":["low","testing"],"dependencies":[{"issue_id":"clack-c19h","depends_on_id":"clack-ini3","type":"parent-child","created_at":"2025-11-29T07:01:40.604129842Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-c606","title":"Alien Field Report Generator","description":"Create a new AI-powered content generator that produces Earth observations from an alien anthropologist studying humans. Format: EARTH LOG XXX: followed by deadpan scientific observations about mundane human behaviors.","status":"closed","priority":2,"issue_type":"epic","owner":"ryan@spice.cc","created_at":"2026-01-21T23:41:56.602279793Z","created_by":"Ryan Brodkin","updated_at":"2026-01-22T00:00:58.161688794Z","closed_at":"2026-01-22T00:00:58.161688794Z","close_reason":"Merged to develop"}
{"id":"clack-c606.1","title":"Create alien-field-report user prompt","description":"Create the user prompt file at prompts/user/alien-field-report.txt that establishes the alien anthropologist voice and observation format.\n\nAcceptance Criteria:\n- Prompt uses {{logNumber}}, {{subjectCategory}}, {{observationFocus}}, {{observationAngle}} template variables\n- Opening hook enforced: 'EARTH LOG {{logNumber}}:' on first line\n- Tone guidance: clinically detached, occasionally bewildered, never mocking\n- 3+ examples showing proper alien voice with different log numbers\n- OBSERVATION ANGLE GUIDANCE section with 5 angle descriptions\n- CRITICAL RULES section emphasizing third-person, absurd-in-mundane, earnest misunderstanding\n- NO hardware constraints (system prompt handles via {{maxChars}}/{{maxLines}})\n\nFiles: prompts/user/alien-field-report.txt","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-21T23:42:03.224631296Z","created_by":"Ryan Brodkin","updated_at":"2026-01-22T00:00:58.131530502Z","closed_at":"2026-01-22T00:00:58.131530502Z","close_reason":"Merged to develop","dependencies":[{"issue_id":"clack-c606.1","depends_on_id":"clack-c606","type":"parent-child","created_at":"2026-01-21T23:42:03.225744213Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-c606.2","title":"Create AlienFieldReportGenerator class","description":"Implement the generator class extending AIPromptGenerator with template variable injection for 200+ unique combinations.\n\nAcceptance Criteria:\n- Extends AIPromptGenerator base class\n- Implements getSystemPromptFile() returning major-update-base.txt\n- Implements getUserPromptFile() returning alien-field-report.txt\n- Exports SUBJECT_CATEGORIES constant with 8 categories, 5 focuses each\n- Exports OBSERVATION_ANGLES constant with 5 angles\n- Implements getTemplateVariables() with:\n  - Random log number (001-999, zero-padded)\n  - Random category and focus selection\n  - Random angle selection\n- Implements getCustomMetadata() to track logNumber, category, focus, and angle\n- Uses ModelTier.LIGHT for cost efficiency\n- Follows DailyRoastGenerator pattern for dictionary-based variability\n\nFiles: src/content/generators/ai/alien-field-report-generator.ts","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-21T23:42:10.336187175Z","created_by":"Ryan Brodkin","updated_at":"2026-01-22T00:00:58.143449544Z","closed_at":"2026-01-22T00:00:58.143449544Z","close_reason":"Merged to develop","dependencies":[{"issue_id":"clack-c606.2","depends_on_id":"clack-c606","type":"parent-child","created_at":"2026-01-21T23:42:10.337454216Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-c606.3","title":"Register generator in core registry","description":"Add AlienFieldReportGenerator to the core content registry with P2 priority.\n\nAcceptance Criteria:\n- Generator imported in register-core.ts\n- Registered with id: alien-field-report\n- Priority: ContentPriority.NORMAL (P2)\n- ModelTier: ModelTier.LIGHT\n- applyFrame: true (time/weather frame appropriate for this content)\n\nFiles: src/content/registry/register-core.ts","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-21T23:42:16.978063094Z","created_by":"Ryan Brodkin","updated_at":"2026-01-22T00:00:58.15004346Z","closed_at":"2026-01-22T00:00:58.15004346Z","close_reason":"Merged to develop","dependencies":[{"issue_id":"clack-c606.3","depends_on_id":"clack-c606","type":"parent-child","created_at":"2026-01-21T23:42:16.978859344Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-c606.3","depends_on_id":"clack-c606.1","type":"blocks","created_at":"2026-01-21T23:42:28.821771002Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-c606.3","depends_on_id":"clack-c606.2","type":"blocks","created_at":"2026-01-21T23:42:28.873918836Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-c606.4","title":"Write unit tests for generator","description":"Create comprehensive unit tests for the AlienFieldReportGenerator.\n\nAcceptance Criteria:\n- Test log number is within valid range (001-999) and zero-padded\n- Test subject category is from valid pool (8 categories)\n- Test observation focus is from selected category's pool (5 per category)\n- Test observation angle is from valid pool (5 angles)\n- Test all four template variables are correctly injected\n- Test metadata includes logNumber, category, focus, and angle\n- Mock AI provider responses following project patterns\n- Static access to constants (SUBJECT_CATEGORIES, OBSERVATION_ANGLES) for testing\n\nFiles: tests/unit/content/generators/alien-field-report-generator.test.ts","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-21T23:42:22.68623675Z","created_by":"Ryan Brodkin","updated_at":"2026-01-22T00:00:58.155767877Z","closed_at":"2026-01-22T00:00:58.155767877Z","close_reason":"Merged to develop","dependencies":[{"issue_id":"clack-c606.4","depends_on_id":"clack-c606","type":"parent-child","created_at":"2026-01-21T23:42:22.687032541Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-c606.4","depends_on_id":"clack-c606.2","type":"blocks","created_at":"2026-01-21T23:42:28.908960211Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-cbe","title":"[MEDIUM] Fix generate.test.ts timing-dependent timestamp test","description":"**File:** tests/unit/cli/commands/generate.test.ts\n**Lines:** 258-270\n**Category:** Too Brittle\n**Severity:** Medium\n\n## Problem\nTest waits 10ms and expects timestamps to be different. This is timing-dependent and may fail on slow systems or if both calls execute within the same millisecond.\n\n## Evidence\n```typescript\nit('should use fresh timestamp for each command execution', async () =\u003e {\n  await generateCommand({});\n  await new Promise(resolve =\u003e setTimeout(resolve, 10));  // ← Real time wait\n  await generateCommand({});\n  // Compare timestamps...\n});\n```\n\n## Implementation Instructions\n1. **Mock Date** to return predictable values:\n```typescript\njest.useFakeTimers();\nawait generateCommand({});\njest.advanceTimersByTime(1000);\nawait generateCommand({});\n// Now timestamps are guaranteed different\n```\n2. **Or use jest.setSystemTime()** for deterministic timestamps\n\n## Acceptance Criteria\n- [ ] Test uses fake timers or mocked Date\n- [ ] No real time delays in tests\n- [ ] Timestamps are deterministically different","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-11-29T05:08:32.706280589Z","updated_at":"2026-01-03T21:41:47.645866918Z","close_reason":"Verified complete by code review","labels":["medium","testing"],"dependencies":[{"issue_id":"clack-cbe","depends_on_id":"clack-rokx","type":"parent-child","created_at":"2025-11-29T07:01:16.636438803Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-cg6v","title":"New Content Generators","description":"Implement 7 new AI-powered content generators for Clack Track: Word of the Day, Language Lesson (Duolingo-style), Daily Roast, Story Fragment, Breath Anchor, Time Perspective, and Paradox Engine. All prompts must be created using the vestaboard-prompt skill.\n\n**Execution Strategy:**\nAll 7 generator issues are PARALLELIZABLE with one caveat:\n- Each issue owns exclusive files (generator class, prompt file, test file)\n- All issues share ONE file: src/content/registry/register-core.ts\n\n**Recommended Approach:**\n1. Run all 7 agents in parallel for their exclusive files\n2. Each agent adds its registration block to register-core.ts\n3. Final consolidation merges all registration additions (append-only, no conflicts expected)\n\n**Parallel Groups:**\n- Group 1 (all parallel): clack-cg6v.8, .9, .10, .11, .12, .13, .14\n\n**Quality Gates:**\n- Each generator must pass unit tests with 80%+ coverage\n- Each prompt must be validated by vestaboard-prompt skill\n- Final integration test after consolidation\n\n**Model Tiers:**\n- LIGHT: word-of-the-day, language-lesson, daily-roast, breath-anchor, time-perspective\n- MEDIUM: story-fragment, paradox-engine (require coherence/logic)","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-11T21:55:38.307658339Z","created_by":"vscode","updated_at":"2026-01-12T00:37:37.177631962Z","closed_at":"2026-01-12T00:37:37.177631962Z","close_reason":"Implemented and merged to develop","comments":[{"id":9,"issue_id":"clack-cg6v","author":"vscode","text":"## Post-Critique Status Update\n\n### Removed\n- clack-cg6v.12 (Breath Anchor) - CLOSED: UX mismatch with static display\n\n### Children Remaining: 6\nAll have been updated with design revisions based on vestaboard-prompt skill critique.\n\n### Model Tier Updates\n- clack-cg6v.10 (Daily Roast): LIGHT -\u003e MEDIUM\n- clack-cg6v.13 (Time Perspective): LIGHT -\u003e MEDIUM\n- clack-cg6v.14 (Paradox Engine): MEDIUM -\u003e LIGHT\n\n### Key Design Patterns Applied\n1. Dictionary injection for variability (all generators)\n2. Romanization for non-Latin scripts (Language Lesson)\n3. Scope reduction for ambitious concepts (Story Fragment, Paradox Engine)\n4. Curated database approach (Paradox Engine)\n5. Tone guardrails with examples (Daily Roast)\n6. Cliche exclusion lists (Time Perspective)","created_at":"2026-01-11T22:40:00Z"}]}
{"id":"clack-cg6v.10","title":"Daily Roast Generator","description":"Affectionate mockery of everyday life topics (Monday mornings, coffee culture, productivity culture, dating apps, etc.) delivered with comedic edge.\n\n**Acceptance Criteria:**\n- Generator class extends AIPromptGenerator with LIGHT tier\n- Target dictionary (100+ roast topics)\n- Tone: Savage but fundamentally kind - roast the situation, not the viewer\n- User prompt created using vestaboard-prompt skill -\u003e prompts/user/daily-roast.txt\n- Registered with id 'daily-roast'\n- Unit tests with 80%+ coverage\n\n**Files:**\n- src/content/generators/ai/daily-roast-generator.ts (new)\n- prompts/user/daily-roast.txt (new, via vestaboard-prompt skill)\n- src/content/registry/register-core.ts (modify - SHARED with all generator issues)\n- tests/unit/content/generators/ai/daily-roast-generator.test.ts (new)\n\n**Related Issues (all modify register-core.ts):**\n- clack-cg6v.8 (word-of-the-day)\n- clack-cg6v.9 (language-lesson)\n- clack-cg6v.11 (story-fragment)\n- clack-cg6v.12 (breath-anchor)\n- clack-cg6v.13 (time-perspective)\n- clack-cg6v.14 (paradox-engine)\n\n**Parallel Execution Note:**\nGenerator, prompt, and test files are exclusive per issue. Only register-core.ts is shared. Recommend: each agent adds its registration block independently; final merge consolidates.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-11T21:56:44.544039217Z","created_by":"vscode","updated_at":"2026-01-12T00:37:37.15758267Z","closed_at":"2026-01-12T00:37:37.15758267Z","close_reason":"Implemented and merged to develop","dependencies":[{"issue_id":"clack-cg6v.10","depends_on_id":"clack-cg6v","type":"parent-child","created_at":"2026-01-11T21:56:44.568257092Z","created_by":"vscode"}],"comments":[{"id":5,"issue_id":"clack-cg6v.10","author":"vscode","text":"## Design Revision (Post-Critique)\n\n### Dictionaries to Implement\n\nTOPIC_DOMAINS:\n- WORK_LIFE: meetings, reply-all, inbox zero, slack, zoom fatigue\n- MORNING_RITUALS: snooze button, coffee dependency, alarm clocks\n- TECHNOLOGY: passwords, captchas, updates, wifi, charging cables\n- SOCIAL: small talk, networking, linkedin, group chats\n- LIFESTYLE: gym memberships, meal prep, plants dying, laundry\n- DATING: dating apps, ghosting, situationships, texting back\n\nROAST_FORMAT: OBSERVATION, ACCUSATION, CONFESSION, COMPARISON\n\n### Tone Guardrails (for prompt)\nROAST THE SITUATION, NEVER THE VIEWER:\nGood: MONDAY EMAILS HIT DIFFERENT WHEN YOU HAVENT HAD COFFEE\nBad: YOURE STILL NOT A MORNING PERSON HUH\n\nThe viewer should feel IN ON THE JOKE, not targeted.\n\n### Model Tier: MEDIUM (tone calibration requires nuance)","created_at":"2026-01-11T22:39:47Z"}]}
{"id":"clack-cg6v.11","title":"Story Fragment Generator","description":"Micro-fiction scenes with character, conflict, and implied narrative in 5 lines. Complete standalone scenes with emotional resonance.\n\n**Acceptance Criteria:**\n- Generator class extends AIPromptGenerator with MEDIUM tier (needs coherence across lines)\n- Scenario dictionaries (settings, relationships, emotional beats)\n- Random injection of scenario elements into prompts via loadPromptVariables()\n- User prompt created using vestaboard-prompt skill -\u003e prompts/user/story-fragment.txt\n- Registered with id 'story-fragment'\n- Unit tests with 80%+ coverage\n\n**Files:**\n- src/content/generators/ai/story-fragment-generator.ts (new)\n- prompts/user/story-fragment.txt (new, via vestaboard-prompt skill)\n- src/content/registry/register-core.ts (modify - SHARED with all generator issues)\n- tests/unit/content/generators/ai/story-fragment-generator.test.ts (new)\n\n**Related Issues (all modify register-core.ts):**\n- clack-cg6v.8 (word-of-the-day)\n- clack-cg6v.9 (language-lesson)\n- clack-cg6v.10 (daily-roast)\n- clack-cg6v.12 (breath-anchor)\n- clack-cg6v.13 (time-perspective)\n- clack-cg6v.14 (paradox-engine)\n\n**Parallel Execution Note:**\nGenerator, prompt, and test files are exclusive per issue. Only register-core.ts is shared. Recommend: each agent adds its registration block independently; final merge consolidates.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-11T21:56:45.778118801Z","created_by":"vscode","updated_at":"2026-01-12T00:37:37.160750712Z","closed_at":"2026-01-12T00:37:37.160750712Z","close_reason":"Implemented and merged to develop","dependencies":[{"issue_id":"clack-cg6v.11","depends_on_id":"clack-cg6v","type":"parent-child","created_at":"2026-01-11T21:56:45.809543967Z","created_by":"vscode"}],"comments":[{"id":6,"issue_id":"clack-cg6v.11","author":"vscode","text":"## Design Revision (Post-Critique)\n\n### Concept Reframe\nRename: Story Fragment -\u003e Scene Snapshot\n- One character, one moment, one emotional beat\n- Drop implied narrative requirement (too ambitious)\n- Drop random element combination (produces incoherence)\n\n### Dictionaries to Implement\n\nSCENARIO (complete packages, 50+): KEEPING_OBJECT, AFTER_PHONE_CALL, ALMOST_SPOKE, LAST_TIME, WAITING, FOUND_NOTE, EMPTY_CHAIR, HELD_DOOR, PACKED_BOX, KEPT_SECRET\n\nEMOTIONAL_BEAT: LOSS, HOPE, REGRET, RELIEF, LONGING, RESOLVE, TENDERNESS, ACCEPTANCE\n\n### Prompt Rules\n- Include ONE specific object or detail\n- Show emotion through action, never name it\n- The MOMENT lands, not the STORY resolves\n- No ellipses, no trailing off\n\n### Example Output\nHE KEPT HER COFFEE\nMUG IN THE CABINET\nTHREE YEARS NOW\nSTILL DONT USE IT\n\n### Model Tier: MEDIUM (scene coherence)","created_at":"2026-01-11T22:39:48Z"}]}
{"id":"clack-cg6v.12","title":"Breath Anchor Generator","description":"Actionable breathing/grounding micro-practices (box breathing, 5-4-3-2-1 grounding, tactical breathing, etc.) with pragmatic, slightly edgy tone.\n\n**Acceptance Criteria:**\n- Generator class extends AIPromptGenerator with LIGHT tier\n- Technique dictionary (15+ breathing/grounding techniques)\n- Pragmatic tone ('IT ACTUALLY WORKS' energy, not spiritual/soft)\n- User prompt created using vestaboard-prompt skill -\u003e prompts/user/breath-anchor.txt\n- Registered with id 'breath-anchor'\n- Unit tests with 80%+ coverage\n\n**Files:**\n- src/content/generators/ai/breath-anchor-generator.ts (new)\n- prompts/user/breath-anchor.txt (new, via vestaboard-prompt skill)\n- src/content/registry/register-core.ts (modify - SHARED with all generator issues)\n- tests/unit/content/generators/ai/breath-anchor-generator.test.ts (new)\n\n**Related Issues (all modify register-core.ts):**\n- clack-cg6v.8 (word-of-the-day)\n- clack-cg6v.9 (language-lesson)\n- clack-cg6v.10 (daily-roast)\n- clack-cg6v.11 (story-fragment)\n- clack-cg6v.13 (time-perspective)\n- clack-cg6v.14 (paradox-engine)\n\n**Parallel Execution Note:**\nGenerator, prompt, and test files are exclusive per issue. Only register-core.ts is shared. Recommend: each agent adds its registration block independently; final merge consolidates.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-11T21:56:47.559132343Z","created_by":"vscode","updated_at":"2026-01-11T22:35:34.970901045Z","closed_at":"2026-01-11T22:35:34.970901045Z","close_reason":"Design critique revealed fundamental UX mismatch: static display cannot effectively deliver timed breathing exercises. Concept not viable for Vestaboard medium.","dependencies":[{"issue_id":"clack-cg6v.12","depends_on_id":"clack-cg6v","type":"parent-child","created_at":"2026-01-11T21:56:47.568467968Z","created_by":"vscode"}]}
{"id":"clack-cg6v.13","title":"Time Perspective Generator","description":"Temporal reframing through cosmic, historical, or absurdist lenses for productivity/wellness. Combats decision paralysis with perspective shifts.\n\n**Acceptance Criteria:**\n- Generator class extends AIPromptGenerator with LIGHT tier\n- Seven temporal lenses (cosmic, historical, absurdist, gratitude, relational, decision-focused, zoom-out)\n- Time-of-day awareness for contextual content via loadPromptVariables()\n- User prompt created using vestaboard-prompt skill -\u003e prompts/user/time-perspective.txt\n- Registered with id 'time-perspective'\n- Unit tests with 80%+ coverage\n\n**Files:**\n- src/content/generators/ai/time-perspective-generator.ts (new)\n- prompts/user/time-perspective.txt (new, via vestaboard-prompt skill)\n- src/content/registry/register-core.ts (modify - SHARED with all generator issues)\n- tests/unit/content/generators/ai/time-perspective-generator.test.ts (new)\n\n**Related Issues (all modify register-core.ts):**\n- clack-cg6v.8 (word-of-the-day)\n- clack-cg6v.9 (language-lesson)\n- clack-cg6v.10 (daily-roast)\n- clack-cg6v.11 (story-fragment)\n- clack-cg6v.12 (breath-anchor)\n- clack-cg6v.14 (paradox-engine)\n\n**Parallel Execution Note:**\nGenerator, prompt, and test files are exclusive per issue. Only register-core.ts is shared. Recommend: each agent adds its registration block independently; final merge consolidates.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-11T21:56:48.615720177Z","created_by":"vscode","updated_at":"2026-01-12T00:37:37.167127087Z","closed_at":"2026-01-12T00:37:37.167127087Z","close_reason":"Implemented and merged to develop","dependencies":[{"issue_id":"clack-cg6v.13","depends_on_id":"clack-cg6v","type":"parent-child","created_at":"2026-01-11T21:56:48.622979719Z","created_by":"vscode"}],"comments":[{"id":7,"issue_id":"clack-cg6v.13","author":"vscode","text":"## Design Revision (Post-Critique)\n\n### Scope Reduction: 7 to 5 Lenses\nRemoved: Zoom-out (redundant), Historical (merged to Ancestor)\nMerged: Gratitude + Relational -\u003e Connection\n\n### Dictionaries to Implement\n\nLENS (5 distinct): COSMIC, ABSURDIST, ANCESTOR, CONNECTION, FUTURE_SELF\n\nSTRESS_CONTEXT (30+): FACING_DECISION, OVERWHELMED_TODO, DREADING_MEETING, AFTER_MISTAKE, WAITING_NEWS, FEELING_STUCK, INTERPERSONAL_CONFLICT, DEADLINE_PRESSURE, STARTING_SOMETHING_NEW, LETTING_GO, IMPOSTER_SYNDROME, COMPARISON_SPIRAL\n\n### Cliche Exclusions (COSMIC lens)\nNEVER: stardust, pale blue dot, universe doesnt care, visible from space, in the grand scheme\nINSTEAD: specific numbers, time comparisons, cosmic events vs mundane worries\n\n### Variability Math\n5 lenses x 30 contexts x 4 time buckets = 600+ combinations\n\n### Model Tier: MEDIUM (psychological reframing needs nuance)","created_at":"2026-01-11T22:39:49Z"}]}
{"id":"clack-cg6v.14","title":"Paradox Engine Generator","description":"Brain-bending logical paradoxes delivered as intellectual humor. Logical impossibilities as comedy.\n\n**Acceptance Criteria:**\n- Generator class extends AIPromptGenerator with MEDIUM tier (needs logical consistency)\n- Paradox type dictionary (logical, temporal, ontological, linguistic, perceptual)\n- Maintains logical consistency for genuine paradoxes\n- User prompt created using vestaboard-prompt skill -\u003e prompts/user/logical-paradox.txt\n- Registered with id 'logical-paradox'\n- Unit tests with 80%+ coverage\n\n**Files:**\n- src/content/generators/ai/paradox-engine-generator.ts (new)\n- prompts/user/logical-paradox.txt (new, via vestaboard-prompt skill)\n- src/content/registry/register-core.ts (modify - SHARED with all generator issues)\n- tests/unit/content/generators/ai/paradox-engine-generator.test.ts (new)\n\n**Related Issues (all modify register-core.ts):**\n- clack-cg6v.8 (word-of-the-day)\n- clack-cg6v.9 (language-lesson)\n- clack-cg6v.10 (daily-roast)\n- clack-cg6v.11 (story-fragment)\n- clack-cg6v.12 (breath-anchor)\n- clack-cg6v.13 (time-perspective)\n\n**Parallel Execution Note:**\nGenerator, prompt, and test files are exclusive per issue. Only register-core.ts is shared. Recommend: each agent adds its registration block independently; final merge consolidates.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-11T21:56:50.045838344Z","created_by":"vscode","updated_at":"2026-01-12T00:37:37.171832295Z","closed_at":"2026-01-12T00:37:37.171832295Z","close_reason":"Implemented and merged to develop","dependencies":[{"issue_id":"clack-cg6v.14","depends_on_id":"clack-cg6v","type":"parent-child","created_at":"2026-01-11T21:56:50.050833594Z","created_by":"vscode"}],"comments":[{"id":8,"issue_id":"clack-cg6v.14","author":"vscode","text":"## Design Revision (Post-Critique)\n\n### Fundamental Scope Change\nNO AI-generated novel paradoxes. Novel paradox generation is unsolved.\nInstead: Curated paradox database + relatable applications.\nHumor comes from APPLICATION, not paradox generation.\n\n### Dictionaries to Implement\n\nPARADOX_DATABASE (50 curated): SHIP_OF_THESEUS, LIARS_PARADOX, GRANDFATHER, BOOTSTRAP, ZENO_ARROW, SORITES, OMNIPOTENCE, FERMI, etc.\n\nAPPLICATION (30+): YOUR_COUCH, YOUR_PLAYLIST, YOUR_RELATIONSHIP, MONDAY_MORNINGS, YOUR_COFFEE_ORDER, YOUR_CHILDHOOD_HOME, YOUR_FAVORITE_BAND\n\n### Output Format\nSHIP OF THESEUS:\nIS YOUR COUCH STILL\nTHE SAME COUCH AFTER\nALL THOSE STAINS\n\n### Model Tier: LIGHT (selection + application, not generation)","created_at":"2026-01-11T22:39:50Z"}]}
{"id":"clack-cg6v.8","title":"Word of the Day Generator","description":"English vocabulary builder with definitions, pronunciation hints, and witty Houseboy-style usage examples.\n\n**Acceptance Criteria:**\n- Generator class extends AIPromptGenerator with LIGHT tier\n- System prompt uses major-update-base.txt\n- User prompt created using vestaboard-prompt skill -\u003e prompts/user/word-of-the-day.txt\n- Registered in register-core.ts with id 'word-of-the-day'\n- Unit tests with 80%+ coverage\n\n**Files:**\n- src/content/generators/ai/word-of-the-day-generator.ts (new)\n- prompts/user/word-of-the-day.txt (new, via vestaboard-prompt skill)\n- src/content/registry/register-core.ts (modify - SHARED with all generator issues)\n- tests/unit/content/generators/ai/word-of-the-day-generator.test.ts (new)\n\n**Related Issues (all modify register-core.ts):**\n- clack-cg6v.9 (language-lesson)\n- clack-cg6v.10 (daily-roast)\n- clack-cg6v.11 (story-fragment)\n- clack-cg6v.12 (breath-anchor)\n- clack-cg6v.13 (time-perspective)\n- clack-cg6v.14 (paradox-engine)\n\n**Parallel Execution Note:**\nGenerator, prompt, and test files are exclusive per issue. Only register-core.ts is shared. Recommend: each agent adds its registration block independently; final merge consolidates.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-11T21:56:41.196725757Z","created_by":"vscode","updated_at":"2026-01-12T00:37:37.143904379Z","closed_at":"2026-01-12T00:37:37.143904379Z","close_reason":"Implemented and merged to develop","dependencies":[{"issue_id":"clack-cg6v.8","depends_on_id":"clack-cg6v","type":"parent-child","created_at":"2026-01-11T21:56:41.201042924Z","created_by":"vscode"}],"comments":[{"id":3,"issue_id":"clack-cg6v.8","author":"vscode","text":"## Design Revision (Post-Critique)\n\n### Scope Changes\n- Drop pronunciation hints (saves 15+ chars)\n- Limit words to 10 characters max\n- Let LLM choose words; dictionaries shape selection\n\n### Dictionaries to Implement\n\nWORD_DOMAIN: EMOTION_WORDS, SITUATION_WORDS, RELATIONSHIP_WORDS, WORK_WORDS, NATURE_WORDS, FOREIGN_LOANWORDS\n\nWORD_VIBE: SATISFYING_TO_SAY, SURPRISINGLY_USEFUL, OBSCURE_BUT_RELATABLE, COMEBACK_WORTHY\n\nSTYLE: DEADPAN_DEFINITION, BACKHANDED_COMPLIMENT, WORKPLACE_APPLICATION, RELATIONSHIP_CONTEXT, EXISTENTIAL_SPIN\n\n### Prompt Template Variables\n- {{wordDomain}} - Type of word to select\n- {{wordVibe}} - Energy/feel of the word\n- {{style}} - Presentation style for usage example\n\n### Constraints for Prompt\n- Word must be 10 chars or less\n- Definition must be 15 chars or less\n- Usage example must be complete, standalone funny\n\n### Model Tier: LIGHT (appropriate with dictionary guidance)","created_at":"2026-01-11T22:39:44Z"}]}
{"id":"clack-cg6v.9","title":"Language Lesson Generator (Duolingo-style)","description":"Micro-lessons capturing the Duolingo *experience* — absurd-but-educational phrases, character-voiced lessons, and story mode snapshots. Educational content wrapped in memorable weirdness.\n\n**The Duolingo Vibe:**\n- **Absurd phrases that stick** — \"The cat is a lawyer\", \"I'm allergic to work\" — grammatically real, contextually unhinged\n- **Character ensemble** — Lily (goth sass), Oscar (dramatic flair), Eddy (awkward apologies), Zari (perfectionist), Junior (earnest)\n- **Story mode snapshots** — Mini soap opera moments in target language\n- **Format variety** — Translate, fill-the-blank, story fragment\n\n**Languages:** Czech, Russian, Chinese, Japanese, French, German, Spanish\n\n**Color Usage:**\n- Character attribution tile (violet=Lily, orange=Oscar, green=Duo, yellow=Eddy)\n- Optional language flag hints (2-3 tiles)\n- Color bar separators between target language and translation\n- Restrained use — accent, don't overwhelm\n\n**Acceptance Criteria:**\n- Generator class extends AIPromptGenerator with LIGHT tier\n- Language roster with script/pronunciation considerations\n- Character roster with personality tags for AI voice selection\n- Absurd phrase exemplars in prompt to set tone\n- Phonetic pronunciation guides for non-Latin scripts\n- Color integration via existing FrameDecorator patterns\n- User prompt created using vestaboard-prompt skill → prompts/user/language-lesson.txt\n- Registered with id 'language-lesson'\n- Unit tests with 80%+ coverage\n\n**Files:**\n- src/content/generators/ai/language-lesson-generator.ts (new)\n- prompts/user/language-lesson.txt (new, via vestaboard-prompt skill)\n- src/content/registry/register-core.ts (modify)\n- tests/unit/content/generators/ai/language-lesson-generator.test.ts (new)\n\n**Related Issues (all modify register-core.ts):**\n- clack-cg6v.8 (word-of-the-day)\n- clack-cg6v.10 (daily-roast)\n- clack-cg6v.11 (story-fragment)\n- clack-cg6v.12 (breath-anchor)\n- clack-cg6v.13 (time-perspective)\n- clack-cg6v.14 (paradox-engine)\n\n**Parallel Execution Note:**\nGenerator, prompt, and test files are exclusive per issue. Only register-core.ts is shared. Recommend: each agent adds its registration block independently; final merge consolidates.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-11T21:56:42.845925299Z","created_by":"vscode","updated_at":"2026-01-12T00:37:37.154002379Z","closed_at":"2026-01-12T00:37:37.154002379Z","close_reason":"Implemented and merged to develop","dependencies":[{"issue_id":"clack-cg6v.9","depends_on_id":"clack-cg6v","type":"parent-child","created_at":"2026-01-11T21:56:42.859045424Z","created_by":"vscode"}],"comments":[{"id":4,"issue_id":"clack-cg6v.9","author":"vscode","text":"## Design Revision (Post-Critique)\n\n### Romanization for Non-Latin Scripts\nAll languages use Latin characters:\n- Chinese: Pinyin (NI HAO)\n- Japanese: Romaji (KONNICHIWA)  \n- Russian: Transliteration (PRIVET)\n- Czech: Without diacritics (DEKUJI)\n\n### Scope Reduction\n- ONE format per display (phrase OR fill-blank)\n- Drop explicit character attribution (space constraint)\n- Drop story mode (too complex)\n- Preserve Duolingo energy via voice/phrase-type dictionaries\n\n### Dictionaries to Implement\n\nDUOLINGO_VOICE: LILY_GOTH_SASS, OSCAR_DRAMATIC, EDDY_AWKWARD, ZARI_PERFECTIONIST, JUNIOR_EARNEST, DUO_CHAOTIC\n\nPHRASE_TYPE: ABSURD_LITERAL, PASSIVE_AGGRESSIVE, EXISTENTIAL_FOOD, WORKPLACE_CHAOS, RELATIONSHIP_DRAMA, SELF_AWARE\n\nLANGUAGE: SPANISH, FRENCH, GERMAN, CHINESE, JAPANESE, RUSSIAN, CZECH\n\nFORMAT: PHRASE_TRANSLATION, FILL_THE_BLANK\n\n### Duolingo Humor Rules (for prompt)\n- Grammatically correct, contextually unhinged\n- Memorable BECAUSE it is weird\n- Educational content wrapped in absurdity\n- Screenshot-worthy out of context\n\n### Model Tier: LIGHT (appropriate with reduced scope)","created_at":"2026-01-11T22:39:45Z"}]}
{"id":"clack-cim","title":"Update saveFailedContent to accept optional content","description":"Modify `saveFailedContent` signature to accept optional `GeneratedContent` parameter for validation failures.\n\n**File**: `src/content/orchestrator.ts`\n\n**Current signature**:\n```typescript\nprivate async saveFailedContent(\n  context: GenerationContext,\n  registeredGenerator: { registration: { id: string; name: string; priority: number } },\n  error: Error\n): Promise\u003cvoid\u003e\n```\n\n**New signature**:\n```typescript\nprivate async saveFailedContent(\n  context: GenerationContext,\n  registeredGenerator: { registration: { id: string; name: string; priority: number } },\n  error: Error,\n  content?: GeneratedContent  // NEW\n): Promise\u003cvoid\u003e\n```\n\nThen update the save call to extract metadata from content when available:\n- `text`: Use `content?.text || ''`\n- `aiProvider`: Use `content?.metadata?.aiProvider`\n- `aiModel`: Use `content?.metadata?.aiModel`\n- `modelTier`: Use `content?.metadata?.modelTier`\n- `tokensUsed`: Use `content?.metadata?.tokensUsed`\n- `failedOver`: Use `content?.metadata?.failedOver`\n- `primaryProvider`: Use `content?.metadata?.primaryProvider`\n- `primaryError`: Use `content?.metadata?.primaryError`","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-11-28T07:50:47.75257859Z","updated_at":"2026-01-03T21:41:47.645866918Z","dependencies":[{"issue_id":"clack-cim","depends_on_id":"clack-rvq","type":"parent-child","created_at":"2025-11-28T07:51:09.147528669Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-cji","title":"Task 1.3: Create ContentRegistration metadata type","description":"Add ContentRegistration interface with id, name, priority, modelTier, applyFrame, eventTriggerPattern, and tags fields.","acceptance_criteria":"- ContentRegistration interface complete\n- Optional fields have sensible defaults documented\n- eventTriggerPattern supports RegExp for P0 matching\n- Exported from types/index.ts","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-11-26T22:14:49.272548258Z","updated_at":"2026-01-03T21:41:47.645866918Z","dependencies":[{"issue_id":"clack-cji","depends_on_id":"clack-b5o","type":"parent-child","created_at":"2025-11-26T22:14:57.876175845Z","created_by":"daemon"},{"issue_id":"clack-cji","depends_on_id":"clack-k7g","type":"blocks","created_at":"2025-11-26T22:14:58.177821804Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-cooj","title":"Content Submission Tool for AI Self-Validation","description":"Implement a submit_content tool that LLMs use to submit generated content. The tool validates server-side and returns accept/reject with visual preview. Includes loop protection (max 3 attempts) and graceful degradation to code truncation or P3 fallback.","status":"closed","priority":1,"issue_type":"epic","owner":"dev@container.local","created_at":"2026-01-18T23:30:23.692995587Z","created_by":"Dev Container","updated_at":"2026-01-20T00:58:25.239900254Z","closed_at":"2026-01-20T00:58:25.239900254Z","close_reason":"Closed"}
{"id":"clack-cooj.1","title":"Extend AIProvider interface for tool calling","description":"Add tool/function calling types to AIProvider interface. Support both tool definitions and tool result handling.\n\nAcceptance Criteria:\n- AIGenerationRequest extended with optional tools array\n- AIGenerationResponse extended with optional toolCalls array\n- ToolDefinition type with name, description, parameters (JSON Schema)\n- ToolCall type with id, name, arguments\n- ToolResult type for returning tool execution results\n- Backwards compatible - existing text-only usage unchanged\n\nFiles: src/types/ai.ts","notes":"Parent epic complete - tool-based generation implemented","status":"closed","priority":2,"issue_type":"task","owner":"dev@container.local","created_at":"2026-01-18T23:30:29.429755798Z","created_by":"Dev Container","updated_at":"2026-01-23T22:36:39.913353968Z","closed_at":"2026-01-23T22:36:39.913357509Z","dependencies":[{"issue_id":"clack-cooj.1","depends_on_id":"clack-cooj","type":"parent-child","created_at":"2026-01-18T23:30:29.430574964Z","created_by":"Dev Container"}]}
{"id":"clack-cooj.2","title":"Implement OpenAI tool calling support","description":"Extend OpenAIClient to handle tools parameter and parse tool_calls responses.\n\nAcceptance Criteria:\n- Pass tools array to chat.completions.create() when provided\n- Parse tool_calls from response choices\n- Handle finish_reason: \"tool_calls\" vs \"stop\"\n- Support multi-turn tool conversations\n- Unit tests with mocked OpenAI responses\n\nFiles: src/api/ai/openai.ts, tests/unit/api/ai/openai.test.ts\n\n---\nCross-Reference: Parallel implementation with clack-cooj.3 (Anthropic). Both implement tool calling for their respective providers and can be developed concurrently.","notes":"Parent epic complete - tool-based generation implemented","status":"closed","priority":2,"issue_type":"task","owner":"dev@container.local","created_at":"2026-01-18T23:30:37.129960301Z","created_by":"Dev Container","updated_at":"2026-01-23T22:36:39.916878843Z","closed_at":"2026-01-23T22:36:39.916881384Z","dependencies":[{"issue_id":"clack-cooj.2","depends_on_id":"clack-cooj","type":"parent-child","created_at":"2026-01-18T23:30:37.131628385Z","created_by":"Dev Container"},{"issue_id":"clack-cooj.2","depends_on_id":"clack-cooj.1","type":"blocks","created_at":"2026-01-18T23:31:39.913197053Z","created_by":"Dev Container"}]}
{"id":"clack-cooj.3","title":"Implement Anthropic tool calling support","description":"Extend AnthropicClient to handle tools parameter and parse tool_use content blocks.\n\nAcceptance Criteria:\n- Pass tools array to messages.create() when provided\n- Parse tool_use content blocks from response\n- Handle stop_reason: \"tool_use\" vs \"end_turn\"\n- Support multi-turn tool conversations\n- Unit tests with mocked Anthropic responses\n\nFiles: src/api/ai/anthropic.ts, tests/unit/api/ai/anthropic.test.ts\n\n---\nCross-Reference: Parallel implementation with clack-cooj.2 (OpenAI). Both implement tool calling for their respective providers and can be developed concurrently.","notes":"Parent epic complete - tool-based generation implemented","status":"closed","priority":2,"issue_type":"task","owner":"dev@container.local","created_at":"2026-01-18T23:30:37.491285093Z","created_by":"Dev Container","updated_at":"2026-01-23T22:36:39.919693801Z","closed_at":"2026-01-23T22:36:39.919696551Z","dependencies":[{"issue_id":"clack-cooj.3","depends_on_id":"clack-cooj","type":"parent-child","created_at":"2026-01-18T23:30:37.491980343Z","created_by":"Dev Container"},{"issue_id":"clack-cooj.3","depends_on_id":"clack-cooj.1","type":"blocks","created_at":"2026-01-18T23:31:40.444893636Z","created_by":"Dev Container"}]}
{"id":"clack-cooj.4","title":"Create validation preview renderer","description":"Render content as it will appear on Vestaboard for inclusion in tool rejection messages.\n\nAcceptance Criteria:\n- Shows 5x21 grid (content area) or 6x22 (full display)\n- Marks lines that exceed limits with indicators\n- Shows where word-wrap would break lines\n- ASCII art format suitable for LLM consumption\n- Example: 'FORTUNE FAVORS THE |✓ 18 chars' per line\n\nFiles: src/content/tools/preview-renderer.ts, tests/unit/content/tools/preview-renderer.test.ts","notes":"Parent epic complete - tool-based generation implemented","status":"closed","priority":2,"issue_type":"task","owner":"dev@container.local","created_at":"2026-01-18T23:30:37.893139593Z","created_by":"Dev Container","updated_at":"2026-01-23T22:36:39.922418343Z","closed_at":"2026-01-23T22:36:39.922421176Z","dependencies":[{"issue_id":"clack-cooj.4","depends_on_id":"clack-cooj","type":"parent-child","created_at":"2026-01-18T23:30:37.893791177Z","created_by":"Dev Container"}]}
{"id":"clack-cooj.5","title":"Create SubmitContent tool definition and executor","description":"Define the submit_content tool that LLMs call to submit their generated content. Executor validates and returns acceptance or rejection with preview.\n\nAcceptance Criteria:\n- Tool definition with content string parameter\n- Executor calls existing validateTextContent() from src/utils/validators.ts\n- On success: Returns { accepted: true, preview: [...] }\n- On failure: Returns { accepted: false, preview: [...], errors: [...], hint: \"...\" }\n- Preview shows exactly how content renders on 6x22 grid (or 5x21 content area)\n- Errors are actionable: \"Line 3 is 24 chars (max 21)\" not just \"too long\"\n\nFiles: src/content/tools/submit-content.ts, tests/unit/content/tools/submit-content.test.ts\n\nNote: Uses validateTextContent() from src/utils/validators.ts (read-only dependency, not modified).","notes":"Parent epic complete - tool-based generation implemented","status":"closed","priority":2,"issue_type":"task","owner":"dev@container.local","created_at":"2026-01-18T23:30:52.244779253Z","created_by":"Dev Container","updated_at":"2026-01-23T22:36:39.925203509Z","closed_at":"2026-01-23T22:36:39.925205634Z","dependencies":[{"issue_id":"clack-cooj.5","depends_on_id":"clack-cooj","type":"parent-child","created_at":"2026-01-18T23:30:52.245776419Z","created_by":"Dev Container"},{"issue_id":"clack-cooj.5","depends_on_id":"clack-cooj.1","type":"blocks","created_at":"2026-01-18T23:31:39.367312136Z","created_by":"Dev Container"},{"issue_id":"clack-cooj.5","depends_on_id":"clack-cooj.4","type":"blocks","created_at":"2026-01-18T23:31:40.849494512Z","created_by":"Dev Container"}]}
{"id":"clack-cooj.6","title":"Build ToolBasedGenerator with loop protection","description":"Create a generator wrapper that uses tool-based generation with configurable max attempts before giving up.\n\nAcceptance Criteria:\n- Wraps existing AIPromptGenerator subclasses\n- Injects submit_content tool into generation request\n- Processes tool calls and feeds results back to LLM\n- Loop protection: Max 3 submission attempts (configurable)\n- After max attempts: Option A) Use last submission with code truncation, or B) Throw for P3 fallback\n- Tracks attempt count in metadata\n- Clean interface: ToolBasedGenerator.wrap(existingGenerator, options)\n\nFiles: src/content/generators/tool-based-generator.ts, tests/unit/content/generators/tool-based-generator.test.ts","notes":"Parent epic complete - tool-based generation implemented","status":"closed","priority":2,"issue_type":"task","owner":"dev@container.local","created_at":"2026-01-18T23:30:52.548097044Z","created_by":"Dev Container","updated_at":"2026-01-23T22:36:39.927624551Z","closed_at":"2026-01-23T22:36:39.927626718Z","dependencies":[{"issue_id":"clack-cooj.6","depends_on_id":"clack-cooj","type":"parent-child","created_at":"2026-01-18T23:30:52.548758628Z","created_by":"Dev Container"},{"issue_id":"clack-cooj.6","depends_on_id":"clack-cooj.5","type":"blocks","created_at":"2026-01-18T23:31:41.160206137Z","created_by":"Dev Container"},{"issue_id":"clack-cooj.6","depends_on_id":"clack-cooj.2","type":"blocks","created_at":"2026-01-18T23:31:41.501089887Z","created_by":"Dev Container"},{"issue_id":"clack-cooj.6","depends_on_id":"clack-cooj.3","type":"blocks","created_at":"2026-01-18T23:31:41.886584345Z","created_by":"Dev Container"}]}
{"id":"clack-cooj.7","title":"Integrate with ContentOrchestrator retry logic","description":"Integrate tool-based generation into the existing orchestrator pipeline and retry logic.\n\nAcceptance Criteria:\n- generateWithRetry() supports tool-based generators\n- Provider failover still works (OpenAI fails → try Anthropic with tools)\n- Circuit breaker integration preserved\n- Metadata includes tool attempt counts\n- Configuration flag to enable/disable tool-based generation per generator\n\nFiles: src/content/orchestrator-retry.ts, src/content/orchestrator.ts","notes":"Parent epic complete - tool-based generation implemented","status":"closed","priority":2,"issue_type":"task","owner":"dev@container.local","created_at":"2026-01-18T23:30:52.871859961Z","created_by":"Dev Container","updated_at":"2026-01-23T22:36:39.929875551Z","closed_at":"2026-01-23T22:36:39.929878009Z","dependencies":[{"issue_id":"clack-cooj.7","depends_on_id":"clack-cooj","type":"parent-child","created_at":"2026-01-18T23:30:52.872582586Z","created_by":"Dev Container"},{"issue_id":"clack-cooj.7","depends_on_id":"clack-cooj.6","type":"blocks","created_at":"2026-01-18T23:31:42.215507721Z","created_by":"Dev Container"}]}
{"id":"clack-cooj.8","title":"Add submission attempt tracking to database","description":"Track validation attempts and loop counts in content table for monitoring and debugging.\n\nAcceptance Criteria:\n- Add validationAttempts column to content table\n- Store rejection reasons per attempt in metadata\n- Migration script for schema update\n- Update content repository save method\n\nFiles: src/storage/models/content.ts, src/storage/repositories/content-repository.ts, src/storage/migrations/","notes":"Parent epic complete - tool-based generation implemented","status":"closed","priority":2,"issue_type":"task","owner":"dev@container.local","created_at":"2026-01-18T23:30:53.210491128Z","created_by":"Dev Container","updated_at":"2026-01-23T22:36:39.932123051Z","closed_at":"2026-01-23T22:36:39.932125218Z","dependencies":[{"issue_id":"clack-cooj.8","depends_on_id":"clack-cooj","type":"parent-child","created_at":"2026-01-18T23:30:53.211528503Z","created_by":"Dev Container"},{"issue_id":"clack-cooj.8","depends_on_id":"clack-cooj.7","type":"blocks","created_at":"2026-01-18T23:31:42.557698887Z","created_by":"Dev Container"}]}
{"id":"clack-cpl1","title":"Happy To See Me Joke Generator","description":"AI-powered generator that riffs on the classic 'Is that a X in your Y or are you just Z to see me?' innuendo format. Uses triple dictionary injection (thing, container, emotion) for variety. The humor comes from wildly specific and unexpected combinations.","status":"closed","priority":2,"issue_type":"feature","owner":"ryan@spice.cc","created_at":"2026-01-22T00:30:52.923900097Z","created_by":"Ryan Brodkin","updated_at":"2026-01-22T03:13:41.210768921Z","closed_at":"2026-01-22T03:13:41.210768921Z","close_reason":"Implemented Happy To See Me Generator with vibe-based design"}
{"id":"clack-cpl1.1","title":"Create user prompt file for happy-to-see-me","description":"Create prompts/user/happy-to-see-me.txt with format instructions. Tell AI to riff on the classic innuendo format using injected variables {{thing}}, {{container}}, {{emotion}}. Allow creative compression while maintaining recognizable structure. Do NOT duplicate display constraints (those are in system prompt).\n\nFiles: prompts/user/happy-to-see-me.txt\n\nRelated: clack-cpl1.2 (uses these template variables)\n\nAcceptance Criteria:\n- Prompt file created at prompts/user/happy-to-see-me.txt\n- Contains {{thing}}, {{container}}, {{emotion}} template variables\n- Follows format of existing prompts (alien-field-report.txt as reference)\n- Does NOT duplicate display constraints from system prompt","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-22T00:31:03.849979213Z","created_by":"Ryan Brodkin","updated_at":"2026-01-22T03:13:41.109853629Z","closed_at":"2026-01-22T03:13:41.109853629Z","close_reason":"Implemented Happy To See Me Generator with vibe-based design","dependencies":[{"issue_id":"clack-cpl1.1","depends_on_id":"clack-cpl1","type":"parent-child","created_at":"2026-01-22T00:31:03.851366005Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-cpl1.2","title":"Create HappyToSeeMeGenerator with dictionaries","description":"Create src/content/generators/ai/happy-to-see-me-generator.ts extending AIPromptGenerator. Define three dictionaries: THINGS (30+ wildly specific objects), CONTAINERS (30+ unexpected locations), EMOTIONS (20+ unexpected states). Implement getTemplateVariables() to randomly select and inject. Implement getCustomMetadata() to track selections. Export dictionaries for test access.\n\nFiles: src/content/generators/ai/happy-to-see-me-generator.ts\n\nRelated: clack-cpl1.1 (depends on prompt file for getUserPromptFile())\n\nReference: Use AlienFieldReportGenerator as implementation pattern\n\nAcceptance Criteria:\n- Class extends AIPromptGenerator\n- getSystemPromptFile() returns major-update-base.txt\n- getUserPromptFile() returns happy-to-see-me.txt\n- THINGS dictionary has 30+ entries\n- CONTAINERS dictionary has 30+ entries\n- EMOTIONS dictionary has 20+ entries\n- getTemplateVariables() returns {thing, container, emotion}\n- getCustomMetadata() tracks all selections\n- Dictionaries exported for test access\n- TypeScript compiles without errors","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-22T00:31:04.860163838Z","created_by":"Ryan Brodkin","updated_at":"2026-01-22T03:13:41.144918046Z","closed_at":"2026-01-22T03:13:41.144918046Z","close_reason":"Implemented Happy To See Me Generator with vibe-based design","dependencies":[{"issue_id":"clack-cpl1.2","depends_on_id":"clack-cpl1","type":"parent-child","created_at":"2026-01-22T00:31:04.86535263Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-cpl1.3","title":"Export HappyToSeeMeGenerator from index","description":"Add export for HappyToSeeMeGenerator from src/content/generators/ai/index.ts\n\nFiles: src/content/generators/ai/index.ts\n\nAcceptance Criteria:\n- Export line added: export { HappyToSeeMeGenerator } from ./happy-to-see-me-generator.js\n- TypeScript compiles without errors\n- Import works from @/content/generators/ai/index.js","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-22T00:31:06.123116547Z","created_by":"Ryan Brodkin","updated_at":"2026-01-22T03:13:41.182792338Z","closed_at":"2026-01-22T03:13:41.182792338Z","close_reason":"Implemented Happy To See Me Generator with vibe-based design","dependencies":[{"issue_id":"clack-cpl1.3","depends_on_id":"clack-cpl1","type":"parent-child","created_at":"2026-01-22T00:31:06.130888547Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-cpl1.3","depends_on_id":"clack-cpl1.2","type":"blocks","created_at":"2026-01-22T00:31:17.722288261Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-cpl1.4","title":"Register happy-to-see-me generator in core","description":"Register the generator in registerCoreContent() and createCoreGenerators(). Use id: happy-to-see-me, priority: ContentPriority.NORMAL (P2), modelTier: ModelTier.LIGHT, applyFrame: true.\n\nFiles:\n- src/content/registry/register-core.ts (add to CoreGenerators interface, add registry.register call)\n- src/bootstrap.ts (add to createCoreGenerators return object)\n\nAcceptance Criteria:\n- CoreGenerators interface includes happyToSeeMe property\n- registerCoreContent() registers with id: happy-to-see-me\n- createCoreGenerators() instantiates HappyToSeeMeGenerator\n- npm run content:list shows happy-to-see-me generator\n- npm run content:test happy-to-see-me succeeds (dry-run)\n- TypeScript compiles without errors","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-22T00:31:07.233052756Z","created_by":"Ryan Brodkin","updated_at":"2026-01-22T03:13:41.192508379Z","closed_at":"2026-01-22T03:13:41.192508379Z","close_reason":"Implemented Happy To See Me Generator with vibe-based design","dependencies":[{"issue_id":"clack-cpl1.4","depends_on_id":"clack-cpl1","type":"parent-child","created_at":"2026-01-22T00:31:07.234035923Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-cpl1.4","depends_on_id":"clack-cpl1.2","type":"blocks","created_at":"2026-01-22T00:31:19.118376595Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-cpl1.4","depends_on_id":"clack-cpl1.3","type":"blocks","created_at":"2026-01-22T00:31:20.414367304Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-cpl1.5","title":"Write unit tests for HappyToSeeMeGenerator","description":"Create tests/unit/content/generators/ai/happy-to-see-me-generator.test.ts (note: in ai/ subdirectory per project convention).\n\nFiles: tests/unit/content/generators/ai/happy-to-see-me-generator.test.ts\n\nReference: Use alien-field-report-generator.test.ts as implementation pattern\n\nTest Coverage:\n- Generator instantiation and constructor\n- getSystemPromptFile() returns major-update-base.txt\n- getUserPromptFile() returns happy-to-see-me.txt\n- getTemplateVariables() returns {thing, container, emotion}\n- getCustomMetadata() returns tracked selections\n- THINGS dictionary has 30+ unique entries\n- CONTAINERS dictionary has 30+ unique entries\n- EMOTIONS dictionary has 20+ unique entries\n- Random selection produces variety (100-output variability test)\n- LIGHT model tier is used\n\nAcceptance Criteria:\n- All tests pass\n- 80%+ code coverage on generator file\n- Follows existing test patterns (mock PromptLoader, ModelTierSelector)","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-22T00:31:08.346683632Z","created_by":"Ryan Brodkin","updated_at":"2026-01-22T03:13:41.202519713Z","closed_at":"2026-01-22T03:13:41.202519713Z","close_reason":"Implemented Happy To See Me Generator with vibe-based design","dependencies":[{"issue_id":"clack-cpl1.5","depends_on_id":"clack-cpl1","type":"parent-child","created_at":"2026-01-22T00:31:08.34998359Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-cpl1.5","depends_on_id":"clack-cpl1.1","type":"blocks","created_at":"2026-01-22T00:31:21.445535305Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-cpl1.5","depends_on_id":"clack-cpl1.2","type":"blocks","created_at":"2026-01-22T00:31:22.75152618Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-cpo","title":"Enhanced Content Schema with Status Column","description":"Update content table schema to support success/failure tracking and generator metadata.\n\n**Files to modify**:\n- `src/storage/models/content.ts` - Enhanced ContentRecord interface\n- `src/storage/migrations/001_initial_schema.sql` - Create migrations directory\n\n**New columns**: status (success/failed), generator_id, generator_name, priority, ai_model, model_tier, failed_over, primary_provider, primary_error, error_type, error_message, tokens_used\n\n**Indexes**: idx_generated_at, idx_status, idx_generator_id, idx_ai_provider","acceptance_criteria":"- Migration runs successfully\n- ContentModel CRUD operations work with new schema\n- Indexes created for analytics queries\n- TypeScript interface matches SQL schema","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-11-27T21:49:07.868927881Z","updated_at":"2026-01-03T21:41:47.645866918Z","labels":["database","schema"],"dependencies":[{"issue_id":"clack-cpo","depends_on_id":"clack-hsa","type":"blocks","created_at":"2025-11-27T21:49:31.637570044Z","created_by":"daemon"},{"issue_id":"clack-cpo","depends_on_id":"clack-hfu","type":"parent-child","created_at":"2025-11-27T21:49:35.255479713Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-cqg","title":"Task 7.4: Add content:test CLI command","description":"Create src/cli/commands/content-test.ts to test a specific content generator by id.","acceptance_criteria":"- Accepts generator id as argument\n- Generates content without sending to Vestaboard\n- Displays generated text, metadata, timing\n- Shows validation results\n- Option to apply frame preview","status":"tombstone","priority":3,"issue_type":"task","assignee":"claude","created_at":"2025-11-26T22:17:15.561909256Z","updated_at":"2026-01-03T21:41:47.645866918Z","dependencies":[{"issue_id":"clack-cqg","depends_on_id":"clack-f33","type":"parent-child","created_at":"2025-11-26T22:17:26.160059761Z","created_by":"daemon"},{"issue_id":"clack-cqg","depends_on_id":"clack-bra","type":"blocks","created_at":"2025-11-26T22:17:27.138277637Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-d1q","title":"Update Configuration Loader","description":"Update src/config/env.ts to load HA variables, add validation for required variables, parse reconnection settings.","acceptance_criteria":"- Load HA variables in src/config/env.ts\n- Validation for required variables\n- Defaults for optional variables\n- Parse reconnection settings\n- WebSocket URL construction logic\n- Export HomeAssistantConfig from config module","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-11-24T00:18:51.975468168Z","updated_at":"2026-01-03T21:41:47.645866918Z","dependencies":[{"issue_id":"clack-d1q","depends_on_id":"clack-wm7","type":"blocks","created_at":"2025-11-24T00:20:02.790752173Z","created_by":"daemon"},{"issue_id":"clack-d1q","depends_on_id":"clack-n94","type":"parent-child","created_at":"2025-11-24T04:19:50.711576301Z","created_by":"vscode"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-d719","title":"Testing Infrastructure Foundation","description":"Foundation utilities and configuration that other test improvements depend on. MUST complete before other test epics can proceed safely.\n\nIncludes:\n- Jest config updates (ignore ./trees, add thresholds)\n- Mock AI provider test helper\n- Timezone test utilities\n- Output assertion helpers\n- CI improvements (flaky detection, parallelization)","status":"tombstone","priority":1,"issue_type":"epic","created_at":"2025-11-29T07:00:20.173706096Z","updated_at":"2026-01-03T21:41:47.645866918Z","deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"clack-d7n","title":"[MEDIUM] Fix frame.test.ts locale-dependent number formatting test","description":"**File:** tests/unit/cli/commands/frame.test.ts\n**Lines:** 543-556\n**Category:** Too Brittle\n**Severity:** Medium\n\n## Problem\nTest checks for either comma OR period separator: `expect(logCalls).toMatch(/2,341|2\\.341/)`. This is extremely brittle because:\n1. Assumes specific timing values (2341ms) that may vary\n2. Different locales format numbers differently\n3. Mock hardcodes exact timing values\n\n## Evidence\n```typescript\nexpect(logCalls).toMatch(/2,341|2\\.341/);\n// ← Hardcoded timing values, locale-dependent formatting\n```\n\n## Implementation Instructions\n1. **Remove exact value assertions** - timing will vary\n2. **Test formatting function separately** with known inputs\n3. **Or use jest.useFakeTimers()** for deterministic timing\n4. **Verify pattern** without specific values: `/\\d{1,3}(,\\d{3})*(\\.\\d+)?/`\n\n## Acceptance Criteria\n- [ ] No hardcoded timing values in assertions\n- [ ] Tests work regardless of system locale\n- [ ] Number formatting verified without exact value matching","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-11-29T05:08:31.44585638Z","updated_at":"2026-01-03T21:41:47.645866918Z","close_reason":"Verified complete by code review","labels":["medium","testing"],"dependencies":[{"issue_id":"clack-d7n","depends_on_id":"clack-n81p","type":"parent-child","created_at":"2025-11-29T07:01:03.821675714Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-ddj","title":"Security Hardening","description":"Implement comprehensive security measures for the web server including security headers (helmet.js) and rate limiting to prevent brute force attacks and common web vulnerabilities.","acceptance_criteria":"- Security headers middleware configured (helmet.js)\n- Rate limiting implemented on all API endpoints\n- Tests verify security measures are active\n- Documentation updated with security policies","status":"tombstone","priority":2,"issue_type":"epic","created_at":"2025-11-23T23:47:22.433898585Z","updated_at":"2026-01-03T21:41:47.645866918Z","labels":["epic","security"],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"clack-dho","title":"Task 3.6: Create NotificationGenerator base for P0 content","description":"Create src/content/generators/notification-generator.ts with abstract base for HA event-triggered notifications with eventPattern regex matching.","acceptance_criteria":"- Abstract class with eventPattern property\n- Abstract formatNotification(eventData) method\n- generate() extracts event data and formats\n- Unit tests for pattern matching","status":"tombstone","priority":1,"issue_type":"task","assignee":"claude","created_at":"2025-11-26T22:15:40.420961879Z","updated_at":"2026-01-03T21:41:47.645866918Z","dependencies":[{"issue_id":"clack-dho","depends_on_id":"clack-6vv","type":"parent-child","created_at":"2025-11-26T22:15:50.79014505Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-dib","title":"Vestaboard API Wrapper Implementation","description":"Implement complete Vestaboard Local API wrapper with:\n- Character code converter (pure functions)\n- HTTP client with retry logic and exponential backoff\n- VestaboardClient orchestrator with animation support\n- Production-grade error handling\n- 80%+ test coverage with live device test option","status":"tombstone","priority":1,"issue_type":"epic","created_at":"2025-11-26T05:30:34.067447385Z","updated_at":"2026-01-03T21:41:47.645866918Z","deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"clack-djhc","title":"Fix sleep-mode-flow integration test failures","description":"11 tests failing in tests/integration/sleep-mode-flow.test.ts due to circuit semantics mismatch.\n\n## Problem\nThe EventHandler was refactored to use \"inverted semantics\" for SLEEP_MODE circuit events:\n- `action='on'` → Enter sleep mode (display sleep-mode-generator, set state to 'off')\n- `action='off'` → Exit sleep mode (set state to 'on', display wakeup-greeting-generator)\n\nHowever, the integration tests expect the opposite:\n- `action='off'` → Enter sleep (expect sleep-mode-generator + state='off')\n- `action='on'` → Exit sleep (expect wakeup-greeting-generator + state='on')\n\n## Failing Tests (11)\n- SLEEP_MODE circuit OFF (entering sleep): 4 failures\n- SLEEP_MODE circuit ON (waking up): 3 failures\n- Content Generation Order: 2 failures\n- Integration with existing circuit enforcement: 1 failure\n- Edge cases: 1 failure\n\n## Root Cause Analysis Needed\nDetermine whether:\n1. The EventHandler refactoring is correct and tests need updating, OR\n2. The tests are correct and EventHandler needs reverting\n\n## Files to Investigate\n- src/scheduler/event-handler.ts (handleCircuitControl method)\n- tests/integration/sleep-mode-flow.test.ts\n- CLAUDE.md \"Circuit Breaker Semantics\" section\n\n## Acceptance Criteria\n- [ ] Determine correct circuit semantics (EventHandler vs tests)\n- [ ] Fix the inconsistency (update tests OR revert EventHandler)\n- [ ] All 16 sleep-mode-flow tests pass\n- [ ] Document the correct semantics in CLAUDE.md if unclear","status":"closed","priority":2,"issue_type":"bug","owner":"ryan@spice.cc","created_at":"2026-01-20T02:06:12.385628512Z","created_by":"Ryan Brodkin","updated_at":"2026-01-20T04:27:36.832919508Z","closed_at":"2026-01-20T04:27:36.832919508Z","close_reason":"Incorrect root cause analysis. The EventHandler was CORRECT (action='on' enters sleep, matching CLI semantics). The TESTS are wrong. Created new planning task to properly research and align sleep mode semantics across codebase."}
{"id":"clack-docs","title":"Update documentation for web server","description":"Update README.md with web server commands, architecture diagrams, API documentation, and development workflow. Add JSDoc comments to public APIs.","acceptance_criteria":"- [ ] README.md updated with web server section\n- [ ] Server commands documented (start, dev)\n- [ ] Architecture diagram for web/API layer\n- [ ] API endpoint documentation with request/response examples\n- [ ] Development workflow documented\n- [ ] JSDoc comments on public APIs\n- [ ] CLAUDE.md updated if needed\n- [ ] .env.example updated with WEB_SERVER_* variables","status":"tombstone","priority":3,"issue_type":"task","created_at":"2025-11-23T01:41:39.376710675Z","updated_at":"2026-01-03T21:41:47.645866918Z","dependencies":[{"issue_id":"clack-docs","depends_on_id":"clack-e2e","type":"blocks","created_at":"2025-11-23T04:14:46.002826927Z","created_by":"import"},{"issue_id":"clack-docs","depends_on_id":"clack-dor","type":"parent-child","created_at":"2025-11-23T23:47:44.647122929Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-dor","title":"Web Server Development","description":"Build Express API backend for debugging web interface with full integration into main Clack Track application. Includes API routes, testing, documentation, and cleanup of legacy code.","acceptance_criteria":"- All API endpoints implemented and tested\n- Web server auto-starts with main app\n- E2E tests passing\n- Legacy vanilla JS code removed\n- Documentation updated\n- Production build working","status":"tombstone","priority":2,"issue_type":"epic","created_at":"2025-11-23T23:47:22.243696877Z","updated_at":"2026-01-03T21:41:47.645866918Z","labels":["epic","web"],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"clack-dpqw","title":"Strip unsupported emojis from AI-generated content","description":"AI generators sometimes produce emojis that cannot be displayed on Vestaboard. Currently, any unsupported emoji causes validation to fail and triggers P3 fallback (static content). This epic implements stripping of unsupported emojis while preserving color emojis that CAN be converted to Vestaboard color codes.\n\n**Root Cause:** Production error showed 🎯 emoji in motivational quote, causing ContentValidationError.\n\n**Solution:** Strip unsupported emojis before validation, preserving content instead of falling back to static.\n\n**Files:** src/utils/validators.ts, tests/unit/utils/validators.test.ts\n\n**Success Criteria:**\n- Unsupported emojis stripped silently\n- Color emojis (🔴, 🟢, etc.) preserved\n- No breaking changes to existing validation","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-05T01:08:20.716577293Z","created_by":"vscode","updated_at":"2026-01-05T01:51:54.993501962Z","closed_at":"2026-01-05T01:51:54.993501962Z","close_reason":"All child issues completed - emoji stripping feature implemented and tested"}
{"id":"clack-dpqw.1","title":"Add stripUnsupportedEmojis() function to validators.ts","description":"Create a function that iterates through text using grapheme clusters, removes any emojis not in SUPPORTED_COLOR_EMOJIS, and returns sanitized text.\n\n**Files:** src/utils/validators.ts\n\n**Implementation:**\n- Function signature: stripUnsupportedEmojis(text: string): string\n- Use Array.from() for proper Unicode grapheme handling\n- Handle variant selectors (U+FE0F) correctly (same pattern as findInvalidCharacters)\n- Preserve color emojis in COLOR_EMOJI_MAP\n- Remove only emoji graphemes, not other invalid chars\n\n**Related:** clack-dpqw.2 also modifies src/utils/validators.ts (integrates this function into pipeline)\n\n**Acceptance Criteria:**\n- Function accepts string, returns sanitized string\n- Color emojis preserved, unsupported emojis removed\n- Handles edge cases: empty string, all-emoji string, variant selectors","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T01:08:49.186605626Z","created_by":"vscode","updated_at":"2026-01-05T01:51:49.198205375Z","closed_at":"2026-01-05T01:51:49.198205375Z","close_reason":"Implemented stripUnsupportedEmojis() function with proper Unicode handling","dependencies":[{"issue_id":"clack-dpqw.1","depends_on_id":"clack-dpqw","type":"parent-child","created_at":"2026-01-05T01:08:49.193942167Z","created_by":"vscode"}]}
{"id":"clack-dpqw.2","title":"Integrate emoji stripping into validation pipeline","description":"Call stripUnsupportedEmojis() in validateTextContent() BEFORE findInvalidCharacters(), after text normalization.\n\n**Files:** src/utils/validators.ts\n\n**Implementation:**\n- Add stripping step in validateTextContent() after normalizeText()\n- Update ValidationResult interface to include emojisStripped?: boolean\n- Log when emojis are stripped for debugging visibility\n\n**Related:** clack-dpqw.1 (depends on stripUnsupportedEmojis function)\n\n**Acceptance Criteria:**\n- Stripping happens after normalizeText() but before findInvalidCharacters()\n- ValidationResult includes indicator when emojis were stripped\n- No breaking changes to existing validation behavior for non-emoji invalid chars","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T01:08:59.400897339Z","created_by":"vscode","updated_at":"2026-01-05T01:51:49.217415709Z","closed_at":"2026-01-05T01:51:49.217415709Z","close_reason":"Integrated emoji stripping into validation pipeline, added emojisStripped flag","dependencies":[{"issue_id":"clack-dpqw.2","depends_on_id":"clack-dpqw","type":"parent-child","created_at":"2026-01-05T01:08:59.406671964Z","created_by":"vscode"},{"issue_id":"clack-dpqw.2","depends_on_id":"clack-dpqw.1","type":"blocks","created_at":"2026-01-05T01:09:15.808101722Z","created_by":"vscode"}]}
{"id":"clack-dpqw.3","title":"Add unit tests for emoji stripping","description":"Write comprehensive tests for the new emoji stripping behavior.\n\n**Files:** tests/unit/utils/validators.test.ts\n\n**Test Cases:**\n- Unsupported emoji (🎯) is stripped from text\n- Color emoji (🔴) is preserved in output\n- Mixed content (text + unsupported + supported emoji) handled correctly\n- Variant selectors (U+FE0F) handled correctly for both types\n- Empty string returned when all content is stripped emojis\n- Multiple unsupported emojis stripped in single pass\n- Integration: validateTextContent with emoji content passes after stripping\n\n**Related:** clack-dpqw.1, clack-dpqw.2\n\n**Acceptance Criteria:**\n- All test cases pass\n- Edge cases covered\n- Tests follow existing test patterns in validators.test.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T01:09:08.58385001Z","created_by":"vscode","updated_at":"2026-01-05T01:51:49.235271584Z","closed_at":"2026-01-05T01:51:49.235271584Z","close_reason":"Added comprehensive unit tests for emoji stripping","dependencies":[{"issue_id":"clack-dpqw.3","depends_on_id":"clack-dpqw","type":"parent-child","created_at":"2026-01-05T01:09:08.588160843Z","created_by":"vscode"},{"issue_id":"clack-dpqw.3","depends_on_id":"clack-dpqw.2","type":"blocks","created_at":"2026-01-05T01:11:21.63155221Z","created_by":"vscode"}]}
{"id":"clack-dpvv","title":"Fix npm audit vulnerabilities and optimize pre-commit hook","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-24T02:02:55.278108554Z","created_by":"Ryan Brodkin","updated_at":"2026-01-24T02:03:44.620408466Z","closed_at":"2026-01-24T02:03:44.620408466Z","close_reason":"Closed"}
{"id":"clack-dq1v","title":"Fix flaky circuitWatchCommand tests in circuit.test.ts","description":"## Summary\nTwo tests in `tests/unit/cli/commands/circuit.test.ts` are flaky and timing out during pre-commit hooks.\n\n## Failing Tests\n1. `circuitWatchCommand › detects and highlights state changes` (lines 617-656)\n2. `circuitWatchCommand › uses default interval of 2000ms when not specified` (lines 658-695)\n\n## Root Cause Analysis\nBoth tests have **timer scope contamination**:\n1. `jest.useFakeTimers()` activated in test body\n2. `jest.resetModules()` and `jest.mock()` called while fake timers active\n3. Async `circuitWatchCommand()` contains `setTimeout` in a while loop (line 635)\n4. `jest.useRealTimers()` called AFTER awaiting promise - race condition\n\n## TDD Approach\nFollow Red-Green-Blue cycle:\n1. RED: Confirm tests fail/timeout consistently before fix\n2. GREEN: Restructure tests to use proper timer lifecycle\n3. BLUE: Refactor for consistency with cron.test.ts patterns\n\n## Fix Strategy\nRestructure tests following the proven pattern from `cron.test.ts`:\n- Move `jest.useFakeTimers()` to `beforeEach` in the `circuitWatchCommand` describe block\n- Move `jest.clearAllTimers()` and `jest.useRealTimers()` to `afterEach`\n- Call `jest.resetModules()` and `jest.mock()` BEFORE `jest.useFakeTimers()`\n- Use `await jest.advanceTimersByTimeAsync()` consistently (not sync version)\n\n## Acceptance Criteria\n- [ ] Tests 'detects and highlights state changes' and 'uses default interval of 2000ms' pass consistently\n- [ ] Timer setup moved to beforeEach in circuitWatchCommand describe block\n- [ ] Timer cleanup moved to afterEach\n- [ ] jest.resetModules() calls happen BEFORE jest.useFakeTimers()\n- [ ] Uses await jest.advanceTimersByTimeAsync() consistently\n- [ ] All circuit.test.ts tests pass (no regressions)\n- [ ] Pre-commit hook completes without timeout\n\n## Scope\nFiles: tests/unit/cli/commands/circuit.test.ts","status":"closed","priority":2,"issue_type":"bug","owner":"ryan@spice.cc","created_at":"2026-01-24T03:02:25.048438345Z","created_by":"Ryan Brodkin","updated_at":"2026-01-26T02:56:11.940744347Z","closed_at":"2026-01-26T02:56:11.940744347Z","close_reason":"Fixed: Timer lifecycle restructured - merged to develop in 07c66dc"}
{"id":"clack-dt1a","title":"Generator Quality Improvement","description":"Improve content quality by removing obsolete generators and adding proper variability mechanisms.\n\n**Goal:** Remove FormattingDemoGenerator (obsolete), add dictionary-based variability to ComplimentGenerator, and overhaul FortuneCookieGenerator.\n\n**Success Criteria:**\n- FormattingDemoGenerator fully removed from codebase\n- ComplimentGenerator passes 100-Output Test with dictionary injection\n- FortuneCookieGenerator displays with:\n  - Fixed '🟥 FORTUNE COOKIE 🟥' title line\n  - Centered 3-line fortune content\n  - Lucky numbers on bottom line\n- All tests pass with 80%+ coverage maintained\n\n**Execution Strategy:**\n- Group A (parallel): Remove FormattingDemo, Improve ComplimentGenerator, Update fortune prompt\n- Group B (parallel with A): Convert fortune generator\n- Sequential: Registration update → Test updates (blocked by generator)\n\n**Skill Reference:**\nUse vestaboard-prompt skill for generator updates (not just prompts).","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-11T23:24:52.791054178Z","created_by":"vscode","updated_at":"2026-01-12T01:22:21.098638885Z","closed_at":"2026-01-12T01:22:21.098638885Z","close_reason":"Epic completed - all 6 child tasks merged to develop"}
{"id":"clack-dt1a.1","title":"Remove FormattingDemoGenerator","description":"Remove the obsolete FormattingDemoGenerator that was used as a reference implementation. The vestaboard-prompt skill now provides comprehensive documentation and scaffolds.\n\n**Acceptance Criteria:**\n- [ ] Generator class deleted: src/content/generators/ai/formatting-demo-generator.ts\n- [ ] Export removed from: src/content/generators/ai/index.ts\n- [ ] Registration removed from: src/content/registry/register-core.ts\n- [ ] Tests deleted: tests/unit/content/generators/ai/formatting-demo-generator.test.ts\n- [ ] Prompt file deleted (if exists): prompts/user/formatting-demo.txt\n- [ ] All tests pass\n\n**Files:**\n- src/content/generators/ai/formatting-demo-generator.ts (delete)\n- src/content/generators/ai/index.ts (edit)\n- src/content/registry/register-core.ts (edit)\n- tests/unit/content/generators/ai/formatting-demo-generator.test.ts (delete)\n- prompts/user/formatting-demo.txt (delete)\n\n**Estimated Time:** 0.5h\n\n**Parallel With:** clack-dt1a.2 (no file overlap - safe to execute simultaneously)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T23:24:59.280040167Z","created_by":"vscode","updated_at":"2026-01-12T01:22:19.501856051Z","closed_at":"2026-01-12T01:22:19.501856051Z","close_reason":"Merged to develop in commit 72aecb3","dependencies":[{"issue_id":"clack-dt1a.1","depends_on_id":"clack-dt1a","type":"parent-child","created_at":"2026-01-11T23:24:59.281421209Z","created_by":"vscode"}]}
{"id":"clack-dt1a.2","title":"Add variability dictionaries to ComplimentGenerator","description":"Following the vestaboard-prompt skill guidance, add topic and style dictionaries to ComplimentGenerator. Currently relies only on personality dimensions (low effectiveness). Needs dictionary injection (high effectiveness).\n\n**Implementation Approach (per vestaboard-prompt skill):**\n1. Create COMPLIMENT_TOPICS dictionary (20+ items) - what to compliment\n2. Create COMPLIMENT_STYLES dictionary (8+ items) - how to compliment\n3. Inject via template variables {{topic}} and {{style}}\n4. Update user prompt to use these variables\n\n**Dictionary Examples:**\n- Topics: your energy today, your taste in music, your hustle, your outfit choice, your creative thinking, your Monday attitude...\n- Styles: sincere, over-the-top dramatic, poetic, absurdist, backhanded-then-genuine, deadpan wholesome...\n\n**Acceptance Criteria:**\n- [ ] COMPLIMENT_TOPICS array with 20+ diverse items\n- [ ] COMPLIMENT_STYLES array with 8+ styles\n- [ ] Random selection injected via {{topic}} and {{style}} template vars\n- [ ] User prompt updated to use new variables\n- [ ] Generator passes 100-Output Test (meaningfully different content each run)\n- [ ] Tests updated with dictionary coverage\n- [ ] All tests pass with 80%+ coverage\n\n**Files:**\n- src/content/generators/ai/compliment-generator.ts (edit - add dictionaries)\n- prompts/user/compliment.txt (edit - use template vars)\n- tests/unit/content/generators/ai/compliment-generator.test.ts (edit)\n\n**Related:** Use vestaboard-prompt skill for implementation guidance\n\n**Estimated Time:** 1.5h\n\n**Parallel With:** clack-dt1a.1 (no file overlap - safe to execute simultaneously)","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-11T23:25:06.615666129Z","created_by":"vscode","updated_at":"2026-01-12T01:22:19.509437843Z","closed_at":"2026-01-12T01:22:19.509437843Z","close_reason":"Merged to develop in commit 72aecb3","dependencies":[{"issue_id":"clack-dt1a.2","depends_on_id":"clack-dt1a","type":"parent-child","created_at":"2026-01-11T23:25:06.616468337Z","created_by":"vscode"}]}
{"id":"clack-dt1a.3","title":"Update fortune-cookie.txt prompt for 3-line content with lucky number newline","description":"Update the user prompt to instruct AI to generate exactly 3 lines of fortune content plus lucky numbers on a separate line. Remove the old 'FORTUNE COOKIE SAY' instruction since title will be added programmatically.\n\n**Acceptance Criteria:**\n- Prompt specifies exactly 3 lines for fortune wisdom\n- Prompt requires lucky numbers on a separate newline (4th line of AI output)\n- Removes reference to 'FORTUNE COOKIE SAY' heading\n- Maintains the clever/humorous tone guidance\n\n**Files:** prompts/user/fortune-cookie.txt\n\n**Execution Notes:**\n- MUST complete before clack-dt1a.4 (generator needs the updated prompt to implement correctly)\n- Part of Group A but BLOCKS Group B\n- Parallel with: clack-dt1a.1, clack-dt1a.2\n- Blocks: clack-dt1a.4 (generator implementation)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T23:29:59.328221375Z","created_by":"vscode","updated_at":"2026-01-12T01:22:19.512447634Z","closed_at":"2026-01-12T01:22:19.512447634Z","close_reason":"Merged to develop in commit 72aecb3","dependencies":[{"issue_id":"clack-dt1a.3","depends_on_id":"clack-dt1a","type":"parent-child","created_at":"2026-01-11T23:29:59.329913959Z","created_by":"vscode"}]}
{"id":"clack-dt1a.4","title":"Convert FortuneCookieGenerator to inject programmatic title line","description":"Extend the generator to override generate() method to inject the fixed '🟥 FORTUNE COOKIE 🟥' title line before the AI-generated content. Use textAlign: 'center' format option for centered display.\n\n**Acceptance Criteria:**\n- Generator prepends '🟥 FORTUNE COOKIE 🟥' as first line\n- Generator calls parent generate() for AI content\n- Passes formatOptions with textAlign: 'center' and maxLines: 3\n- AI output (3 lines fortune + 1 line lucky numbers) combines correctly with title\n- Total output is 5 lines: title + 3 fortune lines + lucky numbers\n\n**Files:** src/content/generators/ai/fortune-cookie-generator.ts\n\n**Dependencies:**\n- Blocked by: clack-dt1a.3 (prompt must be updated first)\n- Blocks: clack-dt1a.5 (registration), clack-dt1a.6 (tests)\n\n**Execution Notes:**\n- Wait for clack-dt1a.3 (prompt update) to complete first\n- Must implement title injection AND format options handling\n- Cross-file coordination: uses updated prompt from clack-dt1a.3","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T23:30:00.754332793Z","created_by":"vscode","updated_at":"2026-01-12T01:22:19.516378051Z","closed_at":"2026-01-12T01:22:19.516378051Z","close_reason":"Merged to develop in commit 72aecb3","dependencies":[{"issue_id":"clack-dt1a.4","depends_on_id":"clack-dt1a","type":"parent-child","created_at":"2026-01-11T23:30:00.759706584Z","created_by":"vscode"},{"issue_id":"clack-dt1a.4","depends_on_id":"clack-dt1a.3","type":"blocks","created_at":"2026-01-11T23:32:05.744991837Z","created_by":"vscode"}]}
{"id":"clack-dt1a.5","title":"Update register-core.ts with formatOptions for fortune-cookie","description":"Add formatOptions to the fortune-cookie registration to enforce centered alignment and proper line limits.\n\n**Acceptance Criteria:**\n- fortune-cookie registration includes formatOptions: { textAlign: 'center', maxLines: 4 }\n- (4 lines because AI generates 3 content + 1 lucky numbers, title is prepended separately)\n- Registration correctly reflects the new generator behavior\n\n**Files:** src/content/registry/register-core.ts\n\n**Dependencies:**\n- Blocked by: clack-dt1a.4 (generator must be implemented first)\n- Blocks: clack-dt1a.6 (tests must verify this registration)\n\n**Execution Notes:**\n- Waits for clack-dt1a.4 (generator implementation) to complete\n- Simple registration update that mirrors generator's formatOptions\n- Cross-file coordination: verifies generator output format is compatible","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T23:30:09.223077172Z","created_by":"vscode","updated_at":"2026-01-12T01:22:19.519498009Z","closed_at":"2026-01-12T01:22:19.519498009Z","close_reason":"Merged to develop in commit 72aecb3","dependencies":[{"issue_id":"clack-dt1a.5","depends_on_id":"clack-dt1a","type":"parent-child","created_at":"2026-01-11T23:30:09.23036588Z","created_by":"vscode"},{"issue_id":"clack-dt1a.5","depends_on_id":"clack-dt1a.4","type":"blocks","created_at":"2026-01-11T23:30:15.80348555Z","created_by":"vscode"}]}
{"id":"clack-dt1a.6","title":"Update fortune cookie generator tests for new title injection behavior","description":"Update unit tests to verify the new behavior including title injection, centered formatting, and lucky number placement.\n\n**Acceptance Criteria:**\n- Tests verify title line '🟥 FORTUNE COOKIE 🟥' is prepended\n- Tests verify AI-generated content follows title\n- Tests verify lucky numbers appear on bottom line of content area\n- Tests verify formatOptions are passed correctly\n\n**Files:** tests/unit/content/generators/ai/fortune-cookie-generator.test.ts\n\n**Dependencies:**\n- Blocked by: clack-dt1a.4 (generator implementation), clack-dt1a.5 (registration)\n- No blocks (leaf node in dependency tree)\n\n**Execution Notes:**\n- Final task in the fortune-cookie overhaul sequence\n- Tests verify implementation of clack-dt1a.4 (title injection, formatting)\n- Tests verify registration from clack-dt1a.5 (formatOptions)\n- Validates output of prompt update from clack-dt1a.3\n- Sequential execution: clack-dt1a.3 → clack-dt1a.4 → clack-dt1a.5 → clack-dt1a.6","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T23:30:10.183219714Z","created_by":"vscode","updated_at":"2026-01-12T01:22:19.522491384Z","closed_at":"2026-01-12T01:22:19.522491384Z","close_reason":"Merged to develop in commit 72aecb3","dependencies":[{"issue_id":"clack-dt1a.6","depends_on_id":"clack-dt1a","type":"parent-child","created_at":"2026-01-11T23:30:10.195561172Z","created_by":"vscode"},{"issue_id":"clack-dt1a.6","depends_on_id":"clack-dt1a.4","type":"blocks","created_at":"2026-01-11T23:30:15.827493633Z","created_by":"vscode"},{"issue_id":"clack-dt1a.6","depends_on_id":"clack-dt1a.5","type":"blocks","created_at":"2026-01-11T23:30:15.853645175Z","created_by":"vscode"}]}
{"id":"clack-e0z","title":"[HIGH] Fix register-notifications.test.ts RegExp vs string assertion mismatch","description":"**File:** tests/unit/content/registry/register-notifications.test.ts\n**Lines:** 144-172\n**Category:** Doesn't make sense\n**Severity:** High\n\n## Problem\nFour tests (lines 144-150, 152-158, 160-166, 168-172) assert that the factory is called with regex patterns as **strings** (e.g., `'/^binary_sensor\\\\..*_door$/'`), but the actual code passes **RegExp objects**. These tests are checking for the wrong expected value type.\n\n## Evidence\n```typescript\n// Lines 144-150 - Expects STRING\nit('should call factory with correct parameters for door notification', () =\u003e {\n  registerNotifications(registry, mockFactory);\n  expect(factoryCreateSpy).toHaveBeenCalledWith(\n    '/^binary_sensor\\\\..*_door$/',  // ← STRING, wrong!\n    'Door Notification'\n  );\n});\n\n// Actual code passes:\nfactory.create(/^binary_sensor\\..*_door$/, 'Door Notification');  // ← RegExp\n```\n\n## Implementation Instructions\n1. **Update all four test expectations** to use actual RegExp objects:\n   ```typescript\n   expect(factoryCreateSpy).toHaveBeenCalledWith(\n     /^binary_sensor\\..*_door$/,  // RegExp, not string\n     'Door Notification'\n   );\n   ```\n2. **Verify the regex patterns match** the actual patterns in the implementation\n3. **Run tests to confirm** they now actually validate the correct behavior\n\n## Acceptance Criteria\n- [ ] Line 147 uses RegExp `/^binary_sensor\\..*_door$/` not string\n- [ ] Line 153 uses RegExp for motion notification pattern\n- [ ] Line 159 uses RegExp for person notification pattern\n- [ ] Line 165 uses RegExp for any other notification patterns\n- [ ] All tests pass with correct RegExp assertions","status":"tombstone","priority":1,"issue_type":"bug","created_at":"2025-11-29T05:06:00.477005255Z","updated_at":"2026-01-03T21:41:47.645866918Z","labels":["high","testing"],"dependencies":[{"issue_id":"clack-e0z","depends_on_id":"clack-s9o","type":"parent-child","created_at":"2025-11-29T05:09:49.615559222Z","created_by":"daemon"},{"issue_id":"clack-e0z","depends_on_id":"clack-10tc","type":"parent-child","created_at":"2025-11-29T07:00:36.29585284Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"bug"}
{"id":"clack-e2e","title":"End-to-end testing and validation","description":"Write comprehensive E2E tests for API endpoints, validate 80%+ test coverage, and verify production build works correctly.","design":"**E2E Test Scenarios:**\n1. GET /api/content/latest - returns latest content\n2. GET /api/content/history - returns content history with pagination\n3. POST /api/votes - submit quality vote\n4. GET /api/logs - returns debug logs\n\n**Validation:**\n- Run full test suite (unit + integration + e2e)\n- Verify 80%+ coverage threshold met\n- Production build test (npm run build \u0026\u0026 npm start)\n- API response validation","acceptance_criteria":"- [ ] E2E tests for all API endpoints in tests/e2e/\n- [ ] Full test suite passes (npm run test:all)\n- [ ] 80%+ coverage achieved for all code\n- [ ] Production build succeeds (npm run build)\n- [ ] API responds correctly in production mode\n- [ ] No server errors or warnings","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-11-23T01:41:33.871556297Z","updated_at":"2026-01-03T21:41:47.645866918Z","dependencies":[{"issue_id":"clack-e2e","depends_on_id":"clack-dor","type":"parent-child","created_at":"2025-11-23T23:47:42.960829428Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-e4i","title":"Task 7.5: Create static fallback content files","description":"Create prompts/static/*.txt with initial fallback messages for P3 content.","acceptance_criteria":"- fallback-1.txt - Generic inspirational message\n- fallback-2.txt - Time-based greeting\n- fallback-3.txt - Welcome message\n- All fit 6x22 Vestaboard constraints\n- Uppercase, limited character set","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-11-26T22:17:16.142075465Z","updated_at":"2026-01-03T21:41:47.645866918Z","dependencies":[{"issue_id":"clack-e4i","depends_on_id":"clack-f33","type":"parent-child","created_at":"2025-11-26T22:17:26.288888261Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-e6l","title":"Task 3.1: Create base AIPromptGenerator abstract class","description":"Create src/content/generators/ai-prompt-generator.ts with abstract base class for AI-powered content. Implements ContentGenerator with retry logic for alternate provider fallback.","acceptance_criteria":"- Abstract class implementing ContentGenerator\n- Constructor accepts PromptLoader, ModelTierSelector, modelTier\n- Abstract getSystemPromptFile() and getUserPromptFile()\n- generate() with retry: preferred provider → alternate → throw\n- validate() checks prompt files exist\n- Unit tests with mocked AI providers","status":"tombstone","priority":1,"issue_type":"task","assignee":"claude","created_at":"2025-11-26T22:15:38.729578503Z","updated_at":"2026-01-03T21:41:47.645866918Z","dependencies":[{"issue_id":"clack-e6l","depends_on_id":"clack-6vv","type":"parent-child","created_at":"2025-11-26T22:15:50.16142855Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-ebji","title":"Remove trivial constructor tests","description":"Remove tests that only verify toBeDefined() or toBeInstanceOf() without testing behavior.\n\nPRIORITY FILES (from analysis):\n- tests/unit/api/ai/factory.test.ts (constructor tests)\n- tests/unit/api/vestaboard/factory.test.ts (constructor tests)\n- tests/unit/storage/knex.test.ts (connection tests)\n- tests/unit/scheduler/cron.test.ts (lines 79-88)\n\nEXCLUDE from removal (legitimate uses):\n- Error class type verification (toBeInstanceOf(RateLimitError))\n- Factory return type tests (core behavior)\n- Optional property existence before value assertion\n\nCross-reference: clack-m280 also modifies web/server.test.ts. Coordinate scope to avoid conflicts.\n\nAcceptance: No pure existence/type-only tests remain that add no regression protection.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T21:03:35.466553921Z","created_by":"vscode","updated_at":"2026-01-11T22:38:16.687935342Z","closed_at":"2026-01-11T22:38:16.687935342Z","close_reason":"Closed","dependencies":[{"issue_id":"clack-ebji","depends_on_id":"clack-82ep","type":"parent-child","created_at":"2026-01-11T21:04:05.416661171Z","created_by":"vscode"}]}
{"id":"clack-erc","title":"Upgrade body-parser to 2.2.1 to patch CVE-2025-13466 (MEDIUM severity DoS vulnerability, CVSS 5.3)","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-11-25T21:18:29.14739476Z","updated_at":"2026-01-03T21:41:47.645866918Z","comments":[{"id":1,"issue_id":"clack-erc","author":"vscode","text":"VULNERABILITY DETAILS:\n- Package: body-parser\n- Current Version: 2.2.0\n- CVE: CVE-2025-13466\n- CVSS Score: 5.3 (MEDIUM)\n- CWE: CWE-400 (Uncontrolled Resource Consumption)\n\nIMPACT:\n- Severity: MEDIUM (Availability impact only)\n- Exploitability: Network accessible, no privileges required\n- Affected: Availability (potential DoS when URL encoding is used)\n- Not affected: Confidentiality, Integrity\n\nREMEDIATION:\nUpgrade body-parser from 2.2.0 to 2.2.1\n\nAFFECTED CODE:\nWeb server request parsing (Express middleware) - indirect dependency through body-parser\n\nVERIFICATION:\n- Trivy scan: Vulnerability confirmed (exit code 0)\n- npm audit: 1 moderate vulnerability reported\n- Fix available: Yes (version 2.2.1)\n\nDISCOVERED DURING:\nSecurity audit for task workspace-201 (test isolation fix)\n\nPRIORITY RATIONALE:\nP2 - Non-critical path, fix available, moderate severity, DoS impact only","created_at":"2025-11-25T21:18:37Z"},{"id":2,"issue_id":"clack-erc","author":"vscode","text":"VULNERABILITY DETAILS:\n- Package: body-parser\n- Current Version: 2.2.0\n- CVE: CVE-2025-13466\n- CVSS Score: 5.3 (MEDIUM)\n- CWE: CWE-400 (Uncontrolled Resource Consumption)\n\nIMPACT:\n- Severity: MEDIUM (Availability impact only)\n- Exploitability: Network accessible, no privileges required\n- Affected: Availability (potential DoS when URL encoding is used)\n- Not affected: Confidentiality, Integrity\n\nREMEDIATION:\nUpgrade body-parser from 2.2.0 to 2.2.1\n\nAFFECTED CODE:\nWeb server request parsing (Express middleware) - indirect dependency through body-parser\n\nVERIFICATION:\n- Trivy scan: Vulnerability confirmed (exit code 0)\n- npm audit: 1 moderate vulnerability reported\n- Fix available: Yes (version 2.2.1)\n\nDISCOVERED DURING:\nSecurity audit for task clack-201 (test isolation fix)\n\nPRIORITY RATIONALE:\nP2 - Non-critical path, fix available, moderate severity, DoS impact only","created_at":"2025-11-25T21:18:37Z"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-evo","title":"Create PWA app icons","description":"Create PWA icons required for the web app manifest and iOS support. These are needed for the \"Add to Home Screen\" functionality to work properly.\n\n**Required Icons:**\n- public/pwa-192x192.png - Standard PWA icon\n- public/pwa-512x512.png - Large PWA icon (also used as maskable)\n- public/apple-touch-icon.png - iOS home screen icon (180x180 recommended)\n- public/favicon.ico - Browser tab icon (optional update)\n\n**Acceptance:**\n- Icons follow Clack Track branding (split-flap aesthetic, dark background with amber)\n- Maskable icon has proper safe zone (inner 80%)\n- Test \"Add to Home Screen\" on iOS and Android","notes":"3-char identifier cleanup","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-29T00:32:18.613069626Z","updated_at":"2026-01-23T22:36:20.294592833Z","closed_at":"2026-01-23T22:36:20.29459875Z","labels":["design","pwa","web"],"dependencies":[{"issue_id":"clack-evo","depends_on_id":"clack-37ai","type":"parent-child","created_at":"2025-11-29T07:01:40.8971473Z","created_by":"daemon"}]}
{"id":"clack-exj","title":"Fix singleton pattern test isolation in API routes","description":"Route handlers (voting.ts, content.ts, logs.ts) use singleton pattern with lazy initialization (getVoteRepository, getContentRepository, getLogModel). This causes test isolation failures because mock implementations only affect the first test - subsequent tests reuse the cached singleton instance.\n\nRoot Cause: Singleton getters cache instances on first call. Jest mock implementations cannot replace cached instances between tests.\n\nImpact: 23 tests failed in clack-002-api-routes validation (5 in voting.test.ts, 5 in content.test.ts, 13 in logs.test.ts)\n\nFiles Affected:\n- src/web/routes/voting.ts (getVoteRepository singleton)\n- src/web/routes/content.ts (getContentRepository singleton)\n- src/web/routes/logs.ts (getLogModel singleton)","design":"Solution Options:\n1. Add test helper to reset singletons between tests (quick fix)\n2. Refactor routes to accept optional dependency injection parameters (better architecture)\n3. Create factory functions that accept optional instances for testing (minimal change)\n\nRecommended: Option 2 (dependency injection) for better testability and SOLID compliance","acceptance_criteria":"- All 23 failing tests pass after fix\n- Test isolation verified (mocks work correctly in all tests)\n- No regression in existing functionality\n- Linting and TypeScript compilation still pass","status":"tombstone","priority":2,"issue_type":"bug","created_at":"2025-11-24T15:46:13.12764843Z","updated_at":"2026-01-03T21:41:47.645866918Z","labels":["architecture","bug","testing"],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"bug"}
{"id":"clack-eyob","title":"Update fortune-cookie.txt prompt for smart lucky numbers","description":"Rewrite the prompt to encourage clever/thematic numbers while providing random fallback.\n\n**Acceptance Criteria:**\n- Adds {{luckyNumbers}} variable placeholder\n- Strongly encourages clever numbers that relate to fortune content (with examples)\n- Provides random numbers as fallback: 'If no numbers feel meaningful, use these: {{luckyNumbers}}'\n- Removes generic lucky number suggestions (7, 8, 88, 42, 1337, etc.) that caused repetition\n- Maintains 4-line output format (3 fortune + 1 lucky numbers)\n\n**Files:** prompts/user/fortune-cookie.txt\n\n**Related Issues:**\n- clack-udlb: Provides {{luckyNumbers}} via getTemplateVariables() (parallel work, no file overlap)\n\n**Parallel Execution:** Can run simultaneously with clack-udlb (different files, no dependencies)","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-21T19:33:51.216598709Z","created_by":"Ryan Brodkin","updated_at":"2026-01-21T20:33:26.803981545Z","closed_at":"2026-01-21T20:33:26.803981545Z","close_reason":"Implemented and merged to main"}
{"id":"clack-f33","title":"Epic 7: Application Bootstrap \u0026 CLI","description":"Wire everything together at application startup. Bootstrap function, CLI commands (generate, content:list, content:test), and static fallback files.","status":"tombstone","priority":1,"issue_type":"epic","assignee":"claude","created_at":"2025-11-26T22:14:24.887687052Z","updated_at":"2026-01-03T21:41:47.645866918Z","labels":["bootstrap","cli","content-system"],"dependencies":[{"issue_id":"clack-f33","depends_on_id":"clack-zoy","type":"blocks","created_at":"2025-11-26T22:14:35.627235918Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"clack-f3lf","title":"Skip tests in pre-commit when no code changes","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-22T21:52:30.580936924Z","created_by":"Ryan Brodkin","updated_at":"2026-01-22T21:53:12.000759637Z","closed_at":"2026-01-22T21:53:12.000759637Z","close_reason":"Closed"}
{"id":"clack-f3zt","title":"CLI command tests fail due to missing bootstrap mock","description":"## Problem\n\nSeveral CLI command tests fail with \"Vestaboard configuration is required for operation\" because they don't properly mock the `bootstrap()` function.\n\n**This is NOT a hardware connectivity issue** - these tests don't need Vestaboard hardware. The problem is test isolation: the tests call real CLI commands which internally call `bootstrap()`, and bootstrap validates that Vestaboard config exists.\n\n## Affected Tests\n\n- `tests/unit/cli/commands/content-test.test.ts` (15 failing tests)\n- `tests/integration/bootstrap-cleanup.test.ts` (1 failing test)\n- Possibly other CLI command tests\n\n## Root Cause\n\nThe failing tests:\n1. Only set `OPENAI_API_KEY` but NOT `VESTABOARD_API_KEY`\n2. Do NOT mock the `bootstrap()` function\n3. Call real CLI commands that invoke `bootstrap()`\n\nCompare with `generate.test.ts` which works correctly:\n```typescript\n// Sets both required env vars\nprocess.env.VESTABOARD_API_KEY = 'test-vestaboard-key';\n\n// Mocks bootstrap to avoid real config validation\njest.mock('../../../../src/bootstrap.js');\n```\n\n## Solution Options\n\n1. **Mock bootstrap()** - Add `jest.mock()` for bootstrap module (consistent with generate.test.ts)\n2. **Set env vars** - Add `process.env.VESTABOARD_API_KEY = 'test-key'` before imports\n3. **Refactor bootstrap()** - Make config validation optional for test mode (architectural change)\n\nOption 1 is recommended for consistency with existing patterns.","acceptance_criteria":"- [ ] All CLI command tests pass without requiring Vestaboard config\n- [ ] Tests properly mock bootstrap() or set required env vars\n- [ ] Pattern is consistent with generate.test.ts\n- [ ] No real hardware/API calls made during unit tests","notes":"Created in 2025 - stale issue cleanup","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-11-29T06:49:48.380709304Z","updated_at":"2026-01-23T22:36:28.958295796Z","closed_at":"2026-01-23T22:36:28.958298129Z","labels":["bug","cli","testing"],"dependencies":[{"issue_id":"clack-f3zt","depends_on_id":"clack-n81p","type":"parent-child","created_at":"2025-11-29T07:00:50.882360722Z","created_by":"daemon"}]}
{"id":"clack-f8gb","title":"Add tests for lucky number injection","description":"Add test coverage for the new random lucky number generation.\n\n**Acceptance Criteria:**\n- Tests that getTemplateVariables() returns object with luckyNumbers property\n- Tests that numbers are space-separated format\n- Tests that each number is 2-digit (10-99)\n- Tests that metadata includes generatedLuckyNumbers\n- Tests that PromptLoader is called with luckyNumbers in variables\n\n**Files:** tests/unit/content/generators/ai/fortune-cookie-generator.test.ts\n\n**Execution Order:**\n- WAIT for clack-udlb (generator implementation) AND clack-eyob (prompt update) to complete\n- clack-udlb and clack-eyob can run in PARALLEL (no file overlap)\n- This test issue runs AFTER both complete\n\n**Parallel Groups:**\n- Group 1 (parallel): clack-udlb, clack-eyob\n- Group 2 (sequential after Group 1): clack-f8gb","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-21T19:33:51.498760001Z","created_by":"Ryan Brodkin","updated_at":"2026-01-21T20:33:26.808302711Z","closed_at":"2026-01-21T20:33:26.808302711Z","close_reason":"Implemented and merged to main","dependencies":[{"issue_id":"clack-f8gb","depends_on_id":"clack-udlb","type":"blocks","created_at":"2026-01-21T19:33:57.539979796Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-f8gb","depends_on_id":"clack-eyob","type":"blocks","created_at":"2026-01-21T19:33:57.929278796Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-fea","title":"[CRITICAL] Fix ai-prompt-generator.test.ts generate() tests expecting incomplete setup failures","description":"**File:** tests/unit/content/generators/ai-prompt-generator.test.ts\n**Lines:** 280-361\n**Category:** Doesn't make sense\n**Severity:** Critical\n\n## Problem\nMultiple tests (lines 280-317, 319-340, 342-361) expect failures due to incomplete test setup rather than testing real behavior. The TestAIPromptGenerator at line 139-143 deliberately throws \"Provider factory not implemented in test\", making these tests verify the broken test implementation rather than actual code behavior.\n\n## Evidence\n```typescript\n// Line 139-143 - TestAIPromptGenerator throws instead of working\ngetProviderForSelection(): AIProvider {\n  throw new Error('Provider factory not implemented in test');\n}\n\n// Lines 280-317 - Test expects failure due to above\nit('should call generate', async () =\u003e {\n  // ... setup ...\n  await expect(generator.generate(mockContext)).rejects.toThrow();\n});\n```\n\n## Implementation Instructions\n1. **Fix the TestAIPromptGenerator** - Implement a working `getProviderForSelection()` that returns a mock provider\n2. **Update tests to expect success** - Tests should verify prompts are loaded correctly when generation succeeds\n3. **Verify the correct tier was selected** - Assert on the model tier used\n4. **Test actual failover behavior** - Create separate tests with providers that intentionally fail to test retry logic\n\n## Acceptance Criteria\n- [ ] TestAIPromptGenerator has working getProviderForSelection()\n- [ ] Tests at lines 280-317 verify successful prompt loading\n- [ ] Tests at lines 319-340 verify correct tier selection on success\n- [ ] Tests at lines 342-361 verify provider configuration\n- [ ] All tests pass without expecting \"not implemented\" errors","status":"tombstone","priority":1,"issue_type":"bug","created_at":"2025-11-29T05:05:57.057858003Z","updated_at":"2026-01-03T21:41:47.645866918Z","labels":["critical","testing"],"dependencies":[{"issue_id":"clack-fea","depends_on_id":"clack-s9o","type":"parent-child","created_at":"2025-11-29T05:09:49.16415468Z","created_by":"daemon"},{"issue_id":"clack-fea","depends_on_id":"clack-10tc","type":"parent-child","created_at":"2025-11-29T07:00:35.93176334Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"bug"}
{"id":"clack-fgag","title":"Add unit test execution to pre-commit hook","description":"Modify .husky/pre-commit to run unit tests before committing. Add the test command after beads sync but before other quality gates so tests run early.\n\n## Acceptance Criteria\n- [ ] Unit tests run during pre-commit hook\n- [ ] Tests fail fast with --bail flag\n- [ ] Hook exits with error if tests fail\n- [ ] Tests run before typecheck/lint for early failure detection\n\n## Files\n- .husky/pre-commit","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-21T22:05:19.932403347Z","created_by":"Ryan Brodkin","updated_at":"2026-01-21T22:19:42.399896135Z","closed_at":"2026-01-21T22:19:42.399896135Z","close_reason":"Implemented: unit tests added to pre-commit hook with --bail, beads sync moved to end"}
{"id":"clack-fjv","title":"The Flip Side - historical messages page","description":"Build scrollable history page showing past Clack Track messages with metadata (prompt name, AI provider, timestamp) and voting capability for each record.","design":"**Components:**\n1. ContentHistoryCard - Compact Vestaboard preview + metadata badges\n2. HistoryList - Vertical list with pagination\n3. FlipSidePage - Fetches history, handles voting\n\n**Metadata Display:**\n- AI Provider badge (OpenAI/Anthropic)\n- Timestamp (relative format)\n- Content type (major/minor)\n- Prompt name from metadata\n\n**Features:**\n- Pagination (20 items, \"Load More\" button)\n- Voting on historical items\n- Card expansion to full-size preview\n- Responsive layout (1/2/3 columns)","acceptance_criteria":"- [ ] ContentHistoryCard displays all metadata correctly\n- [ ] Compact Vestaboard preview renders properly\n- [ ] AI provider badge shows correct provider\n- [ ] Timestamp in user-friendly format\n- [ ] Voting works for historical items\n- [ ] Pagination loads 20 items at a time\n- [ ] \"Load More\" button when more items available\n- [ ] Empty state when no history\n- [ ] Loading skeleton during fetch\n- [ ] Responsive layout (1/2/3 columns)\n- [ ] Unit tests with 80%+ coverage","notes":"Implementation complete - History.tsx updated with API integration, pagination, voting. Tests written at tests/web/pages/History.test.tsx. NEEDS MANUAL: run tests, lint, and commit due to shell session issue.","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-11-26T05:05:08.075919262Z","updated_at":"2026-01-03T21:41:47.645866918Z","labels":["frontend","ui","web"],"dependencies":[{"issue_id":"clack-fjv","depends_on_id":"clack-dor","type":"parent-child","created_at":"2025-11-26T05:05:20.589953753Z","created_by":"daemon"},{"issue_id":"clack-fjv","depends_on_id":"clack-ias","type":"blocks","created_at":"2025-11-26T05:05:30.555702758Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-foo","title":"Generator Output Validation","description":"Add strict validation to content generators to fail and trigger regeneration when content violates Vestaboard constraints (line count, character limits, invalid characters). Currently invalid content is silently truncated/fixed during frame decoration - we need to fail at the generator level instead.","acceptance_criteria":"- Generators that produce invalid content trigger P3 fallback\n- content:test CLI shows user prompt sent to LLM\n- content:test CLI shows validation result (pass/fail with details)\n- Graceful degradation preserved for external content (non-generator)","status":"tombstone","priority":1,"issue_type":"epic","created_at":"2025-11-27T20:02:50.290187054Z","updated_at":"2026-01-03T21:41:47.645866918Z","deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"clack-gjm","title":"Tests fail when OPENAI_API_KEY environment variable missing","description":"Three test suites fail with \"Missing required environment variable: OPENAI_API_KEY\" when the environment variable is not set. This causes test failures in CI/worktree environments without full .env setup.\n\n**Affected Test Files:**\n- `tests/integration/bootstrap-cleanup.test.ts`\n- `tests/unit/cli/commands/content-test.test.ts`\n- `tests/unit/cli/commands/content-list.test.ts`\n\n**Root Cause:** These tests trigger code paths that require AI provider configuration but don't mock the environment variable check.\n\n**Expected Behavior:** Tests should either:\n1. Mock the environment variable validation, or\n2. Skip gracefully when env vars are missing, or\n3. Use test fixtures instead of real provider initialization","acceptance_criteria":"- [ ] Tests pass without OPENAI_API_KEY set\n- [ ] Mock AI provider initialization in affected tests\n- [ ] No real API calls in unit tests\n- [ ] CI pipeline passes without API keys configured","status":"tombstone","priority":2,"issue_type":"bug","created_at":"2025-11-28T17:39:42.76929825Z","updated_at":"2026-01-03T21:41:47.645866918Z","labels":["ci","testing"],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"bug"}
{"id":"clack-gpc","title":"Create ContentValidationError type","description":"Add ContentValidationError class to src/types/errors.ts. This is a non-retryable error that will be thrown when generator output validation fails.","design":"Add to src/types/errors.ts:\n```typescript\nexport class ContentValidationError extends Error {\n  constructor(message: string) {\n    super(message);\n    this.name = 'ContentValidationError';\n  }\n}\n```","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-11-27T20:03:09.735213049Z","updated_at":"2026-01-03T21:41:47.645866918Z","dependencies":[{"issue_id":"clack-gpc","depends_on_id":"clack-foo","type":"parent-child","created_at":"2025-11-27T20:03:22.958526139Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-gwr","title":"[HIGH] Fix bootstrap.test.ts alternate provider test unclear assertions","description":"**File:** tests/unit/bootstrap.test.ts\n**Lines:** 468-512\n**Category:** Doesn't Make Sense\n**Severity:** High\n\n## Problem\nTest \"create alternate provider when both openai and anthropic are configured\" asserts both providers were called but doesn't verify ORDER of calls or that Anthropic was called as ALTERNATE (second call). It just verifies both were called, which doesn't test the \"alternate provider\" behavior claimed in the test name.\n\n## Evidence\n```typescript\nexpect(calls).toContainEqual([aiModule.AIProviderType.OPENAI, 'test-openai-key', 'gpt-4']);\nexpect(calls.some(...)).toBe(true);  // for Anthropic\n// ← Doesn't verify primary vs alternate order!\n```\n\n## Implementation Instructions\n1. **Clarify test intent** - Are you testing (a) both providers are created, or (b) primary then alternate in correct order?\n2. **Add explicit order verification**:\n```typescript\nexpect(calls.length).toBe(2);\nexpect(calls[0][0]).toBe(aiModule.AIProviderType.OPENAI);  // Primary first\nexpect(calls[1][0]).toBe(aiModule.AIProviderType.ANTHROPIC);  // Alternate second\n```\n\n## Acceptance Criteria\n- [ ] Test name matches what is being verified\n- [ ] If testing alternate provider, verify call order\n- [ ] Assertions are explicit about expected behavior","status":"tombstone","priority":1,"issue_type":"bug","created_at":"2025-11-29T05:07:08.574199175Z","updated_at":"2026-01-03T21:41:47.645866918Z","labels":["high","testing"],"dependencies":[{"issue_id":"clack-gwr","depends_on_id":"clack-s9o","type":"parent-child","created_at":"2025-11-29T05:09:59.894547879Z","created_by":"daemon"},{"issue_id":"clack-gwr","depends_on_id":"clack-10tc","type":"parent-child","created_at":"2025-11-29T07:00:36.113923798Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"bug"}
{"id":"clack-h76k","title":"[LOW] Fix pushService.test.ts mock return value tests","description":"**File:** tests/web/services/pushService.test.ts\n**Lines:** 123-206\n**Category:** Doesn't Make Sense\n**Severity:** Low\n\n## Problem\nMultiple tests mock return values and then assert the mocked value was returned. This tests the mock setup, not actual service implementation.\n\n## Evidence\n```typescript\nit('should return null when no subscription exists', async () =\u003e {\n  mockPushManager.getSubscription.mockResolvedValue(null);\n  const result = await service.getSubscription();\n  expect(result).toBeNull();  // ← Testing the mock, not the service\n});\n```\n\n## Implementation Instructions\n1. **Test service logic** instead of mock returns\n2. **Verify service correctly calls dependencies**\n3. **Or remove tests** if behavior is trivial pass-through\n\n## Acceptance Criteria\n- [ ] Tests verify service logic, not mock returns\n- [ ] Dependencies verified through call assertions\n- [ ] Trivial pass-through behavior documented, not tested","status":"tombstone","priority":3,"issue_type":"task","created_at":"2025-11-29T05:09:48.928479763Z","updated_at":"2026-01-03T21:41:47.645866918Z","close_reason":"Verified complete by code review","labels":["low","testing"],"dependencies":[{"issue_id":"clack-h76k","depends_on_id":"clack-ofzp","type":"parent-child","created_at":"2025-11-29T07:01:29.922900462Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-hbce","title":"Admin Menu for Circuit Breaker Control","description":"Add an admin menu to the web interface that allows controlling all available circuit breakers (MASTER, SLEEP_MODE, PROVIDER_OPENAI, PROVIDER_ANTHROPIC). Includes backend API routes and frontend admin page with toggle controls.","status":"closed","priority":1,"issue_type":"epic","owner":"ryan@spice.cc","created_at":"2026-01-24T01:34:40.08835709Z","created_by":"Ryan Brodkin","updated_at":"2026-01-24T03:06:15.65902584Z","closed_at":"2026-01-24T03:06:15.65902584Z","close_reason":"All tasks completed and merged to develop"}
{"id":"clack-hbce.1","title":"Add Circuit Breaker API Routes","description":"## Objective\nCreate REST API endpoints for circuit breaker operations.\n\n## Endpoints\n- GET /api/circuits - List all circuits with state and metadata\n- GET /api/circuits/:id - Get single circuit status\n- POST /api/circuits/:id/on - Enable circuit\n- POST /api/circuits/:id/off - Disable circuit\n- POST /api/circuits/:id/reset - Reset provider circuit (counters to 0, state to ON)\n\n## TDD Approach\n1. RED: Write integration tests for each endpoint (status codes, response shapes, error cases)\n2. GREEN: Implement routes using CircuitBreakerService\n3. BLUE: Refactor for consistent error handling\n\n## Acceptance Criteria\n- [ ] GET /api/circuits returns all circuits with state and metadata\n- [ ] POST /api/circuits/:id/on enables the circuit\n- [ ] POST /api/circuits/:id/off disables the circuit\n- [ ] POST /api/circuits/:id/reset resets provider circuits\n- [ ] Invalid circuit IDs return 404\n- [ ] Tests pass with 80%+ coverage\n\n## Scope\nFiles:\n- src/web/routes/circuit.ts (CREATE)\n- src/web/routes/index.ts (MODIFY)\n- tests/integration/web/circuit-routes.test.ts (CREATE)\n\n## Cross-References\n- Parallel with: clack-hbce.2 (Switch Component) - no file overlap, can execute concurrently\n- Required by: clack-hbce.4 (Admin Page) - API endpoints needed for frontend","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-24T01:34:49.576407636Z","created_by":"Ryan Brodkin","updated_at":"2026-01-24T03:06:06.874883919Z","closed_at":"2026-01-24T03:06:06.874883919Z","close_reason":"Merged to develop","dependencies":[{"issue_id":"clack-hbce.1","depends_on_id":"clack-hbce","type":"parent-child","created_at":"2026-01-24T01:34:49.578031053Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-hbce.2","title":"Add shadcn/ui Switch Component","description":"## Objective\nAdd the Switch component from shadcn/ui for circuit toggle controls. Check if already exists, add if missing.\n\n## TDD Approach\n1. RED: Write component test for Switch rendering and toggle behavior\n2. GREEN: Add Switch component via shadcn CLI or manual creation\n3. BLUE: Verify styling matches design system\n\n## Acceptance Criteria\n- [ ] Switch component available in src/web/frontend/components/ui/switch.tsx\n- [ ] Switch supports checked/unchecked states\n- [ ] Switch triggers onCheckedChange callback\n- [ ] Component test passes\n\n## Scope\nFiles:\n- src/web/frontend/components/ui/switch.tsx (CREATE if missing)\n- tests/web/components/switch.test.tsx (CREATE)\n\n## Cross-References\n- Parallel with: clack-hbce.1 (API Routes) - no file overlap, can execute concurrently\n- Required by: clack-hbce.3 (CircuitBreakerCard) - Switch component used in Card","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-24T01:34:57.286608792Z","created_by":"Ryan Brodkin","updated_at":"2026-01-24T03:06:06.883897544Z","closed_at":"2026-01-24T03:06:06.883897544Z","close_reason":"Merged to develop","dependencies":[{"issue_id":"clack-hbce.2","depends_on_id":"clack-hbce","type":"parent-child","created_at":"2026-01-24T01:34:57.287990917Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-hbce.3","title":"Create CircuitBreakerCard Component","description":"## Objective\nCreate a reusable card component that displays a single circuit breaker with its state and control toggle. Shows circuit name, description, current state, and for provider circuits: failure count and threshold.\n\n## TDD Approach\n1. RED: Write tests for card rendering with different circuit types (manual vs provider)\n2. GREEN: Implement component with Card, Badge, Switch from shadcn/ui\n3. BLUE: Refactor for clean prop handling\n\n## Acceptance Criteria\n- [ ] Displays circuit name and description\n- [ ] Shows current state with colored Badge (green=on, red=off, yellow=half_open)\n- [ ] Toggle switch controls circuit state\n- [ ] Provider circuits show failure count / threshold\n- [ ] Handles loading and error states\n- [ ] Tests pass\n\n## Scope\nFiles:\n- src/web/frontend/components/CircuitBreakerCard.tsx (CREATE)\n- tests/web/components/CircuitBreakerCard.test.tsx (CREATE)","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-24T01:35:08.417970797Z","created_by":"Ryan Brodkin","updated_at":"2026-01-24T03:06:06.887275961Z","closed_at":"2026-01-24T03:06:06.887275961Z","close_reason":"Merged to develop","dependencies":[{"issue_id":"clack-hbce.3","depends_on_id":"clack-hbce","type":"parent-child","created_at":"2026-01-24T01:35:08.419039797Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-hbce.3","depends_on_id":"clack-hbce.2","type":"blocks","created_at":"2026-01-24T01:35:31.001325377Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-hbce.4","title":"Create Admin Page","description":"## Objective\nCreate the Admin page that fetches all circuit breakers and displays them in a grid of CircuitBreakerCard components. Group circuits by type (Manual Controls vs Provider Circuits).\n\n## TDD Approach\n1. RED: Write page tests for loading, error, and success states\n2. GREEN: Implement page with useEffect for data fetching\n3. BLUE: Refactor for clean async handling\n\n## Acceptance Criteria\n- [ ] Page fetches circuits on mount via apiClient\n- [ ] Displays loading state while fetching\n- [ ] Shows error message if fetch fails\n- [ ] Groups circuits: 'System Controls' (MASTER, SLEEP_MODE) and 'Provider Circuits' (OPENAI, ANTHROPIC)\n- [ ] Each circuit rendered via CircuitBreakerCard\n- [ ] Toggle actions call appropriate API endpoints\n- [ ] Tests pass\n\n## Scope\nFiles:\n- src/web/frontend/pages/Admin.tsx (CREATE)\n- src/web/frontend/services/apiClient.ts (MODIFY - add circuit methods)\n- tests/web/pages/Admin.test.tsx (CREATE)","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-24T01:35:17.112587635Z","created_by":"Ryan Brodkin","updated_at":"2026-01-24T03:06:06.890058003Z","closed_at":"2026-01-24T03:06:06.890058003Z","close_reason":"Merged to develop","dependencies":[{"issue_id":"clack-hbce.4","depends_on_id":"clack-hbce","type":"parent-child","created_at":"2026-01-24T01:35:17.114045843Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-hbce.4","depends_on_id":"clack-hbce.1","type":"blocks","created_at":"2026-01-24T01:35:32.277026461Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-hbce.4","depends_on_id":"clack-hbce.3","type":"blocks","created_at":"2026-01-24T01:35:33.556670253Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-hbce.5","title":"Integrate Admin Route and Navigation","description":"## Objective\nAdd /admin route to React Router and add navigation link to the admin page.\n\n## TDD Approach\n1. RED: Write navigation test that verifies admin link appears\n2. GREEN: Add route to App.tsx and link to Navigation.tsx\n3. BLUE: Verify responsive behavior\n\n## Acceptance Criteria\n- [ ] /admin route renders Admin page\n- [ ] Navigation includes 'Admin' link\n- [ ] Admin link appears in both mobile and desktop nav\n- [ ] Navigation to /admin works correctly\n- [ ] Tests pass\n\n## Scope\nFiles:\n- src/web/frontend/App.tsx (MODIFY)\n- src/web/frontend/components/Navigation.tsx (MODIFY)\n- tests/web/navigation.test.tsx (MODIFY or CREATE)","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-24T01:35:24.163338221Z","created_by":"Ryan Brodkin","updated_at":"2026-01-24T03:06:06.892999628Z","closed_at":"2026-01-24T03:06:06.892999628Z","close_reason":"Merged to develop","dependencies":[{"issue_id":"clack-hbce.5","depends_on_id":"clack-hbce","type":"parent-child","created_at":"2026-01-24T01:35:24.16489843Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-hbce.5","depends_on_id":"clack-hbce.4","type":"blocks","created_at":"2026-01-24T01:35:34.47807517Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-helw","title":"[LOW] Fix content-generator.test.ts hardcoded enum values","description":"**File:** tests/unit/types/content-generator.test.ts\n**Lines:** 294-332\n**Category:** Doesn't Make Sense\n**Severity:** Low\n\n## Problem\nTests define hardcoded priority numbers and tier strings instead of importing actual enum values. Comments say \"This will be imported from the actual enum\" but enum isn't imported.\n\n## Evidence\n```typescript\n// Lines 294-306 - Hardcoded values with misleading comments\nconst NOTIFICATION = 0;  // ContentPriority.NOTIFICATION\nconst NORMAL = 2;        // ContentPriority.NORMAL\n// ← Should import and use actual enum\n```\n\n## Implementation Instructions\n1. **Import actual enum values**:\n```typescript\nimport { ContentPriority, ModelTier } from '@/types/content-generator';\nexpect(ContentPriority.NOTIFICATION).toBe(0);\n```\n2. **Or remove tests** if enum values are implementation details\n\n## Acceptance Criteria\n- [ ] Enums imported and used directly\n- [ ] No hardcoded values with misleading comments\n- [ ] Tests verify actual exported enum values","status":"tombstone","priority":3,"issue_type":"task","created_at":"2025-11-29T05:09:26.216108628Z","updated_at":"2026-01-03T21:41:47.645866918Z","close_reason":"Verified complete by code review","labels":["low","testing"],"dependencies":[{"issue_id":"clack-helw","depends_on_id":"clack-ini3","type":"parent-child","created_at":"2025-11-29T07:01:31.462916963Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-hfu","title":"Minor Updates with Database Persistence","description":"Enable minute-by-minute frame updates (time/weather) on Vestaboard while preserving content from the last major update. Store major update content and failures in MySQL for future web interface analytics.\n\n## Key Decisions\n- **Database**: MySQL for long-term scalability\n- **Storage scope**: Major updates only (minor use in-memory cache)\n- **Failure tracking**: Status column in content table\n- **Error handling**: Basic with throttled logging\n\n## Architecture\nMajor Update: ContentOrchestrator → Generate → Save to MySQL → Cache → Send\nMinor Update: CronScheduler → Check cache → Skip if full-frame → Apply frame → Send","status":"tombstone","priority":1,"issue_type":"epic","created_at":"2025-11-27T21:48:26.777316084Z","updated_at":"2026-01-03T21:41:47.645866918Z","deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"clack-hrm","title":"Task 7.3: Add content:list CLI command","description":"Create src/cli/commands/content-list.ts to list all registered content generators with their metadata.","acceptance_criteria":"- Lists all registered generators\n- Shows id, name, priority, modelTier, applyFrame\n- Grouped by priority (P0, P2, P3)\n- Table format output","status":"tombstone","priority":3,"issue_type":"task","assignee":"claude","created_at":"2025-11-26T22:17:15.352901631Z","updated_at":"2026-01-03T21:41:47.645866918Z","dependencies":[{"issue_id":"clack-hrm","depends_on_id":"clack-f33","type":"parent-child","created_at":"2025-11-26T22:17:26.01516847Z","created_by":"daemon"},{"issue_id":"clack-hrm","depends_on_id":"clack-bra","type":"blocks","created_at":"2025-11-26T22:17:26.597218012Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-hsa","title":"Install MySQL Driver and Database Abstraction","description":"Install mysql2 package and implement MySQL-compatible Database class.\n\n**Files to modify**:\n- `package.json` - Add `mysql2` dependency\n- `src/storage/database.ts` - Replace in-memory with MySQL implementation\n- `src/config/env.ts` - Parse DATABASE_URL\n\n**Key implementation**:\n```typescript\nimport mysql from 'mysql2/promise';\n\nexport class Database {\n  private pool: mysql.Pool;\n  async connect(): Promise\u003cvoid\u003e;\n  async run(sql: string, params?: unknown[]): Promise\u003c{ changes: number }\u003e;\n  async all\u003cT\u003e(sql: string, params?: unknown[]): Promise\u003cT[]\u003e;\n  async get\u003cT\u003e(sql: string, params?: unknown[]): Promise\u003cT | null\u003e;\n  async close(): Promise\u003cvoid\u003e;\n}\n```","acceptance_criteria":"- Database class connects to MySQL\n- Basic CRUD operations work\n- Connection pool with proper cleanup\n- Tests pass with real MySQL connection","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-11-27T21:49:06.305044421Z","updated_at":"2026-01-03T21:41:47.645866918Z","labels":["database"],"dependencies":[{"issue_id":"clack-hsa","depends_on_id":"clack-kkr","type":"blocks","created_at":"2025-11-27T21:49:31.517997003Z","created_by":"daemon"},{"issue_id":"clack-hsa","depends_on_id":"clack-hfu","type":"parent-child","created_at":"2025-11-27T21:49:34.369976629Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-i0pv","title":"Sleep Mode Circuit Breaker Implementation","description":"Wire the SLEEP_MODE circuit breaker to function. When activated: block all updates and display dark starfield art with AI bedtime greeting overlay. When deactivated: display good morning message until next major update.\n\n## Execution Plan\n\n### Parallel Group A (no dependencies, can run simultaneously):\n- clack-i0pv.1: Circuit enforcement in orchestrator/scheduler/event-handler\n- clack-i0pv.2: Dark starfield art generator\n- clack-i0pv.3: AI sleep greeting generator\n- clack-i0pv.5: AI wakeup greeting generator\n\n### Sequential After Group A:\n- clack-i0pv.4: Hybrid generator (requires .2 + .3)\n- clack-i0pv.6: Activation flow (requires .1 + .4 + .5)\n\n### Closed:\n- clack-i0pv.7: Tests distributed to individual issues\n\n## File Ownership Map\n| File | Primary Issue | Cross-ref |\n|------|--------------|-----------|\n| orchestrator.ts | .1 | - |\n| cron.ts | .1 | - |\n| event-handler.ts | .1 | .6 (different methods) |\n| sleep-art-generator.ts | .2 | - |\n| sleep-greeting-generator.ts | .3 | - |\n| sleep-mode-generator.ts | .4 | - |\n| wakeup-greeting-generator.ts | .5 | - |\n| circuit.ts | .6 | - |","notes":"Sleep Mode fully implemented - all children complete","status":"closed","priority":1,"issue_type":"epic","owner":"dev@container.local","created_at":"2026-01-19T00:43:22.147029669Z","created_by":"Dev Container","updated_at":"2026-01-23T22:36:37.635974883Z","closed_at":"2026-01-23T22:36:37.635981966Z"}
{"id":"clack-i0pv.1","title":"Enforce SLEEP_MODE circuit in orchestrator and scheduler","description":"Add SLEEP_MODE circuit breaker checks to prevent ALL content updates (major and minor) when sleep mode is active.\n\nAcceptance Criteria:\n- ContentOrchestrator.generateAndSend() checks SLEEP_MODE at Step 0.5 (after MASTER)\n- CronScheduler.runMinorUpdate() checks SLEEP_MODE before generating\n- EventHandler.handleRefreshTrigger() checks SLEEP_MODE (parallel to MASTER)\n- EventHandler.handleStateChange() checks SLEEP_MODE (parallel to MASTER)\n- SLEEP_MODE returns blocked: true with blockReason: sleep_mode_active\n- Unit tests verify blocking behavior (included in this issue)\n\nFiles: orchestrator.ts, cron.ts, event-handler.ts\nTests: tests/unit/scheduler/sleep-mode-blocking.test.ts\n\nCross-Reference: event-handler.ts also modified by clack-i0pv.6 (different methods)\n  - This issue: handleRefreshTrigger(), handleStateChange() add circuit checks\n  - clack-i0pv.6: handleCircuitControlEvent() triggers content on sleep mode toggle\n\nEstimated: ~80 LOC across 3 files + tests","status":"closed","priority":2,"issue_type":"task","owner":"dev@container.local","created_at":"2026-01-19T00:44:06.069992717Z","created_by":"Dev Container","updated_at":"2026-01-19T07:11:14.414645718Z","closed_at":"2026-01-19T07:11:14.414645718Z","close_reason":"Implemented in commit 67e2098","dependencies":[{"issue_id":"clack-i0pv.1","depends_on_id":"clack-i0pv","type":"parent-child","created_at":"2026-01-19T00:44:06.071244092Z","created_by":"Dev Container"}]}
{"id":"clack-i0pv.2","title":"Create dark starfield art generator","description":"Create a ProgrammaticGenerator that produces dark abstract art using primarily black (0) with sparse blue (67) and violet (68) accents, resembling a night sky or starfield.\n\nAcceptance Criteria:\n- Extends ProgrammaticGenerator base class\n- Generates 6x22 layout with outputMode=layout\n- Uses ~85% black, ~10% blue, ~5% violet for dreamy night aesthetic\n- Randomized pattern (not deterministic) for variety\n- Returns characterCodes array suitable for Vestaboard\n- Located in src/content/generators/programmatic/sleep-art-generator.ts\n- Unit tests included (tests/unit/content/generators/sleep-art-generator.test.ts)\n\nFiles: sleep-art-generator.ts, index.ts exports\nTests: tests/unit/content/generators/sleep-art-generator.test.ts\n\nParallel Group: Can run in parallel with clack-i0pv.1, clack-i0pv.3, clack-i0pv.5\nEstimated: ~60 LOC + tests","status":"closed","priority":2,"issue_type":"task","owner":"dev@container.local","created_at":"2026-01-19T00:44:16.359650264Z","created_by":"Dev Container","updated_at":"2026-01-19T07:11:14.421615843Z","closed_at":"2026-01-19T07:11:14.421615843Z","close_reason":"Implemented in commit 67e2098","dependencies":[{"issue_id":"clack-i0pv.2","depends_on_id":"clack-i0pv","type":"parent-child","created_at":"2026-01-19T00:44:16.360440555Z","created_by":"Dev Container"}]}
{"id":"clack-i0pv.3","title":"Create AI sleep greeting generator with dictionary","description":"Create an AIPromptGenerator for bedtime greetings using dictionary injection for variety (per content-generator-designer patterns).\n\nAcceptance Criteria:\n- Extends AIPromptGenerator base class\n- User prompt at prompts/user/sleep-greeting.txt\n- Uses LIGHT model tier (short, simple content)\n- Dictionary of 15+ bedtime themes/styles for variety (cozy blanket, stargazing, counting sheep, dreamland, pillow talk, etc.)\n- Output fits on 2-3 rows maximum (center of 6-row display)\n- Passes 100-output test via dictionary injection\n- Unit tests included\n\nFiles: sleep-greeting-generator.ts, sleep-greeting.txt\nTests: tests/unit/content/generators/sleep-greeting-generator.test.ts\n\nParallel Group: Can run in parallel with clack-i0pv.1, clack-i0pv.2, clack-i0pv.5\nEstimated: ~50 LOC + prompt file + tests","status":"closed","priority":2,"issue_type":"task","owner":"dev@container.local","created_at":"2026-01-19T00:44:25.717640046Z","created_by":"Dev Container","updated_at":"2026-01-19T07:11:14.426533259Z","closed_at":"2026-01-19T07:11:14.426533259Z","close_reason":"Implemented in commit 67e2098","dependencies":[{"issue_id":"clack-i0pv.3","depends_on_id":"clack-i0pv","type":"parent-child","created_at":"2026-01-19T00:44:25.718596296Z","created_by":"Dev Container"}]}
{"id":"clack-i0pv.4","title":"Create hybrid SleepModeContentGenerator combining art + greeting","description":"Create a composite generator that overlays AI-generated greeting text onto the programmatic dark art pattern.\n\nAcceptance Criteria:\n- Combines SleepArtGenerator + SleepGreetingGenerator\n- Generates art first, then overlays text in center rows (rows 2-4)\n- Text uses white character codes (69) for visibility on dark background\n- Preserves art pattern in non-text areas\n- Full screen mode (no frame decoration)\n- outputMode=layout with final combined characterCodes\n- Located in src/content/generators/programmatic/sleep-mode-generator.ts\n- Unit tests included\n\nFiles: sleep-mode-generator.ts\nTests: tests/unit/content/generators/sleep-mode-generator.test.ts\n\nBlocked by: clack-i0pv.2 (art generator), clack-i0pv.3 (greeting generator)\nEstimated: ~80 LOC + tests","status":"closed","priority":2,"issue_type":"task","owner":"dev@container.local","created_at":"2026-01-19T00:44:34.6469103Z","created_by":"Dev Container","updated_at":"2026-01-19T07:11:14.430999009Z","closed_at":"2026-01-19T07:11:14.430999009Z","close_reason":"Implemented in commit 67e2098","dependencies":[{"issue_id":"clack-i0pv.4","depends_on_id":"clack-i0pv","type":"parent-child","created_at":"2026-01-19T00:44:34.64790905Z","created_by":"Dev Container"},{"issue_id":"clack-i0pv.4","depends_on_id":"clack-i0pv.2","type":"blocks","created_at":"2026-01-19T00:45:10.521044469Z","created_by":"Dev Container"},{"issue_id":"clack-i0pv.4","depends_on_id":"clack-i0pv.3","type":"blocks","created_at":"2026-01-19T00:45:10.571895261Z","created_by":"Dev Container"}]}
{"id":"clack-i0pv.5","title":"Create AI wakeup greeting generator","description":"Create an AIPromptGenerator for good morning messages displayed when sleep mode deactivates.\n\nAcceptance Criteria:\n- Extends AIPromptGenerator base class\n- User prompt at prompts/user/wakeup-greeting.txt\n- Uses LIGHT model tier\n- Dictionary of 15+ morning themes for variety (coffee ritual, sunrise, fresh start, stretching, birds chirping, etc.)\n- Standard framed mode (time/weather info bar applies)\n- Follows Houseboy persona (warmer morning tone)\n- Unit tests included\n\nFiles: wakeup-greeting-generator.ts, wakeup-greeting.txt\nTests: tests/unit/content/generators/wakeup-greeting-generator.test.ts\n\nParallel Group: Can run in parallel with clack-i0pv.1, clack-i0pv.2, clack-i0pv.3\nEstimated: ~50 LOC + prompt file + tests","status":"closed","priority":2,"issue_type":"task","owner":"dev@container.local","created_at":"2026-01-19T00:44:42.49857772Z","created_by":"Dev Container","updated_at":"2026-01-19T07:11:14.435851634Z","closed_at":"2026-01-19T07:11:14.435851634Z","close_reason":"Implemented in commit 67e2098","dependencies":[{"issue_id":"clack-i0pv.5","depends_on_id":"clack-i0pv","type":"parent-child","created_at":"2026-01-19T00:44:42.499662679Z","created_by":"Dev Container"}]}
{"id":"clack-i0pv.6","title":"Implement sleep mode activation/deactivation flow","description":"Wire the complete flow: when SLEEP_MODE turns ON, display sleep art; when OFF, display wakeup greeting.\n\nAcceptance Criteria:\n- CLI circuit:off SLEEP_MODE triggers sleep art display\n- CLI circuit:on SLEEP_MODE triggers wakeup greeting display  \n- HA event vestaboard_circuit_control with circuit_id: SLEEP_MODE triggers appropriate display\n- EventHandler.handleCircuitControlEvent() enhanced to trigger content on sleep mode changes\n- Sleep art display happens BEFORE blocking takes effect (display, then block)\n- Wakeup greeting displays immediately, then normal content resumes on next trigger\n- Integration tests included\n\nFiles: event-handler.ts, circuit.ts\nTests: tests/integration/sleep-mode-flow.test.ts\n\nCross-Reference: event-handler.ts also modified by clack-i0pv.1 (different methods)\n  - clack-i0pv.1: handleRefreshTrigger(), handleStateChange() add circuit checks\n  - This issue: handleCircuitControlEvent() triggers content on sleep mode toggle\n\nBlocked by: clack-i0pv.1 (circuit enforcement), clack-i0pv.4 (sleep generator), clack-i0pv.5 (wakeup generator)\nEstimated: ~100 LOC + integration tests","status":"closed","priority":2,"issue_type":"task","owner":"dev@container.local","created_at":"2026-01-19T00:44:52.310117502Z","created_by":"Dev Container","updated_at":"2026-01-19T07:11:14.440871343Z","closed_at":"2026-01-19T07:11:14.440871343Z","close_reason":"Implemented in commit 67e2098","dependencies":[{"issue_id":"clack-i0pv.6","depends_on_id":"clack-i0pv","type":"parent-child","created_at":"2026-01-19T00:44:52.311191294Z","created_by":"Dev Container"},{"issue_id":"clack-i0pv.6","depends_on_id":"clack-i0pv.1","type":"blocks","created_at":"2026-01-19T00:45:16.483331041Z","created_by":"Dev Container"},{"issue_id":"clack-i0pv.6","depends_on_id":"clack-i0pv.4","type":"blocks","created_at":"2026-01-19T00:45:16.595460375Z","created_by":"Dev Container"},{"issue_id":"clack-i0pv.6","depends_on_id":"clack-i0pv.5","type":"blocks","created_at":"2026-01-19T00:45:16.683955375Z","created_by":"Dev Container"}]}
{"id":"clack-i0pv.7","title":"Add tests for sleep mode functionality","description":"DEPRECATED: Tests now distributed to individual issues.\n\nEach implementation issue now includes its own tests:\n- clack-i0pv.1: Unit tests for circuit blocking\n- clack-i0pv.2: Unit tests for sleep art generator\n- clack-i0pv.3: Unit tests for sleep greeting generator\n- clack-i0pv.4: Unit tests for composite generator\n- clack-i0pv.5: Unit tests for wakeup greeting generator\n- clack-i0pv.6: Integration tests for full flow\n\nThis issue should be closed as tests are distributed (better parallelization).\n\nOriginal Acceptance Criteria (now distributed):\n- Unit tests for each generator (moved to .2, .3, .4, .5)\n- Unit tests for circuit breaker enforcement (moved to .1)\n- Integration tests for activation/deactivation flow (moved to .6)\n- 80%+ coverage on new code (enforced by CI)","status":"closed","priority":2,"issue_type":"task","owner":"dev@container.local","created_at":"2026-01-19T00:45:00.743009923Z","created_by":"Dev Container","updated_at":"2026-01-19T00:47:50.753970377Z","closed_at":"2026-01-19T00:47:50.753970377Z","close_reason":"Tests distributed to individual issues for better parallelization","dependencies":[{"issue_id":"clack-i0pv.7","depends_on_id":"clack-i0pv","type":"parent-child","created_at":"2026-01-19T00:45:00.74390309Z","created_by":"Dev Container"}]}
{"id":"clack-ias","title":"Create non-functional mock UI for all pages","description":"Build static React UI mockups for Welcome, History, Account, and Login pages using shadcn components and placeholder data to demonstrate mobile-responsive layout.","design":"**Routing Setup:**\n- BrowserRouter in main.tsx\n- Routes: / (welcome), /flipside (history), /account, /login\n\n**Page Mockups (Static - No API):**\n1. Welcome (/) - Vestaboard preview + vote buttons with placeholder content\n2. The Flip Side (/flipside) - List of 5 placeholder content records with metadata\n3. Account (/account) - Profile info + passkey list with placeholder data\n4. Login (/login) - \"Sign in with Passkey\" button (non-functional)\n\n**Layout Components:**\n- Navigation.tsx - Mobile hamburger (Sheet) + desktop nav bar\n- PageLayout.tsx - Wrapper with navigation + responsive container\n\n**Feature Components:**\n- VestaboardPreview.tsx - 6×22 character grid, split-flap aesthetic\n- ContentCard.tsx - Reusable card for content items\n- VotingButtons.tsx - Thumbs up/down buttons\n\n**Placeholder Data:**\n- lib/mockData.ts - Mock arrays matching API response types\n\n**Mobile Responsiveness:**\n- 320px minimum viewport\n- Touch-friendly buttons (44px min)\n- Responsive breakpoints (mobile/tablet/desktop)","acceptance_criteria":"- [ ] React Router configured with all 4 routes\n- [ ] Navigation works on mobile (hamburger) and desktop (horizontal)\n- [ ] Welcome page displays Vestaboard preview with placeholder content\n- [ ] History page shows placeholder content list with metadata\n- [ ] Account page shows placeholder profile and passkey list\n- [ ] Login page shows passkey button (non-functional)\n- [ ] All pages responsive on mobile (320px), tablet, desktop\n- [ ] VestaboardPreview renders 6×22 character grid correctly\n- [ ] All interactive elements have visible focus states\n- [ ] No console errors\n- [ ] Tests pass, linting passes","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-11-26T05:05:07.200027636Z","updated_at":"2026-01-03T21:41:47.645866918Z","labels":["frontend","ui","web"],"dependencies":[{"issue_id":"clack-ias","depends_on_id":"clack-dor","type":"parent-child","created_at":"2025-11-26T05:05:20.31535342Z","created_by":"daemon"},{"issue_id":"clack-ias","depends_on_id":"clack-9mi","type":"blocks","created_at":"2025-11-26T05:05:30.334591925Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-id0z","title":"Remove compliment generator","description":"Delete the compliment generator implementation, prompt, and tests. Remove all imports, exports, and registrations from the codebase.\n\n## Acceptance Criteria\n- [ ] Delete src/content/generators/ai/compliment-generator.ts\n- [ ] Delete prompts/user/compliment.txt\n- [ ] Delete tests/unit/content/generators/ai/compliment-generator.test.ts\n- [ ] Remove export from src/content/generators/ai/index.ts\n- [ ] Remove from CoreGenerators interface in src/content/registry/register-core.ts\n- [ ] Remove registration call in src/content/registry/register-core.ts\n- [ ] Remove import and instantiation in src/bootstrap.ts\n- [ ] Update test expectations in tests/unit/content/registry/register-core.test.ts (17 generators instead of 18)\n- [ ] All tests pass\n\n## Files\nDelete:\n- src/content/generators/ai/compliment-generator.ts\n- prompts/user/compliment.txt\n- tests/unit/content/generators/ai/compliment-generator.test.ts\n\nModify:\n- src/content/generators/ai/index.ts\n- src/content/registry/register-core.ts\n- src/bootstrap.ts\n- tests/unit/content/registry/register-core.test.ts","status":"closed","priority":2,"issue_type":"task","owner":"dev@container.local","created_at":"2026-01-20T00:30:35.673825176Z","created_by":"Dev Container","updated_at":"2026-01-20T02:05:15.851338138Z","closed_at":"2026-01-20T02:05:15.851338138Z","close_reason":"Compliment generator removed. All files deleted, exports/registrations removed, tests updated. Merged to main."}
{"id":"clack-iic","title":"Full-Frame Skip Logic for Minor Updates","description":"Skip minor updates when cached content is full-frame (outputMode: 'layout').\n\n**Files to modify**:\n- `src/content/generators/minor-update.ts` - Add `shouldSkip()` method\n- `src/scheduler/cron.ts` - Check skip before generating\n\n**Implementation**:\n```typescript\n// MinorUpdateGenerator\nshouldSkip(): boolean {\n  const cached = this.orchestrator.getCachedContent();\n  return cached?.outputMode === 'layout';\n}\n\n// CronScheduler.runMinorUpdate()\nif (this.minorUpdateGenerator.shouldSkip()) {\n  log('Minor update skipped - cached content is full frame');\n  return;\n}\n```","acceptance_criteria":"- Full-frame content (outputMode: 'layout') skips minor update\n- Text content (outputMode: 'text') gets frame refresh\n- Skip is logged\n- No Vestaboard API call when skipped","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-11-27T21:49:11.431705466Z","updated_at":"2026-01-03T21:41:47.645866918Z","labels":["feature"],"dependencies":[{"issue_id":"clack-iic","depends_on_id":"clack-hfu","type":"parent-child","created_at":"2025-11-27T21:49:45.696913843Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-ini3","title":"Low Priority Test Cleanup","description":"Lower priority test improvements that provide incremental quality gains.\n\nIncludes:\n- minor-update.test.ts hardcoded structure assertion\n- http-client.test.ts constructor default assertions\n- factory.test.ts duplicate test cases\n- weather-generator.test.ts brittle try-catch\n- openai-responses.test.ts hardcoded model ID\n- content-generator.test.ts hardcoded enum values\n- model-tiers.test.ts runtime type checking\n- cron-minor-update.test.ts arithmetic test removal\n- vestaboard-live.test.ts tautological assertion","notes":"Created in 2025 - stale issue cleanup","status":"closed","priority":3,"issue_type":"epic","created_at":"2025-11-29T07:00:21.90422Z","updated_at":"2026-01-23T22:36:28.955373462Z","closed_at":"2026-01-23T22:36:28.955376296Z","dependencies":[{"issue_id":"clack-ini3","depends_on_id":"clack-n81p","type":"blocks","created_at":"2025-11-29T07:06:01.149286337Z","created_by":"daemon"},{"issue_id":"clack-ini3","depends_on_id":"clack-rokx","type":"blocks","created_at":"2025-11-29T07:06:01.352827671Z","created_by":"daemon"}]}
{"id":"clack-isp","title":"Replace VestaboardClient Stub with Factory-Created Client","description":"Update existing usage sites (CronScheduler, EventHandler) to use factory-created VestaboardClient instead of stub. Delete old src/api/vestaboard.ts stub file.","design":"## Migration Strategy\n1. Update imports from 'src/api/vestaboard.js' to 'src/api/vestaboard/index.js'\n2. Use createVestaboardClient(config) factory\n3. Update dependency injection in schedulers\n4. Delete old stub file\n5. Update all tests that use VestaboardClient\n\nUsage sites:\n- src/scheduler/cron.ts\n- src/scheduler/event-handler.ts\n- src/index.ts (initialization)","acceptance_criteria":"- src/scheduler/cron.ts imports from src/api/vestaboard/index.ts\n- src/scheduler/event-handler.ts imports from src/api/vestaboard/index.ts\n- src/index.ts creates client using createVestaboardClient(config)\n- Config loaded from src/config/env.ts\n- Old src/api/vestaboard.ts stub file deleted\n- VestaboardClient interface updated in all usage sites\n- All existing tests updated to use new client structure\n- Integration tests verify CronScheduler works with real client\n- Integration tests verify EventHandler works with real client\n- All tests pass\n- No breaking changes to public API","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-11-26T05:26:19.424796128Z","updated_at":"2026-01-03T21:41:47.645866918Z","close_reason":"Verified complete by code review","dependencies":[{"issue_id":"clack-isp","depends_on_id":"clack-nsx","type":"blocks","created_at":"2025-11-26T05:26:19.425515378Z","created_by":"daemon"},{"issue_id":"clack-isp","depends_on_id":"clack-odi","type":"blocks","created_at":"2025-11-26T05:26:19.426276794Z","created_by":"daemon"},{"issue_id":"clack-isp","depends_on_id":"clack-z37n","type":"parent-child","created_at":"2025-11-29T07:01:17.427527845Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-iswx","title":"[LOW] Fix model-tiers.test.ts runtime type checking","description":"**File:** tests/unit/config/model-tiers.test.ts\n**Lines:** 6-15\n**Category:** Doesn't Make Sense\n**Severity:** Low\n\n## Problem\nTests assign string literals to typed variables and assert equality: `expect(light).toBe('light')`. This verifies JavaScript equality, not TypeScript type correctness. Type safety is enforced at compile time, not runtime.\n\n## Evidence\n```typescript\nit('should export ModelTier type with correct literal values', () =\u003e {\n  const light: ModelTier = 'light';\n  expect(light).toBe('light');  // ← Tautological\n});\n```\n\n## Implementation Instructions\n1. **Remove these tests** - TypeScript compiler handles type validation\n2. **Or test actual constant exports**:\n```typescript\nexpect(MODEL_TIERS.LIGHT).toBe('light');\nexpect(MODEL_TIERS).toEqual({ LIGHT: 'light', MEDIUM: 'medium', HEAVY: 'heavy' });\n```\n\n## Acceptance Criteria\n- [ ] Tests verify actual exports, not variable assignments\n- [ ] Type checking left to TypeScript compiler\n- [ ] No tautological string equality checks","status":"tombstone","priority":3,"issue_type":"task","created_at":"2025-11-29T05:09:25.888074461Z","updated_at":"2026-01-03T21:41:47.645866918Z","close_reason":"Verified complete by code review","labels":["low","testing"],"dependencies":[{"issue_id":"clack-iswx","depends_on_id":"clack-ini3","type":"parent-child","created_at":"2025-11-29T07:01:40.482238967Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-iwr","title":"Implement Auto-Reconnection Logic","description":"Create reconnection manager with exponential backoff, handle WebSocket close events, implement graceful degradation (log warnings, don't crash app).","acceptance_criteria":"- Reconnection manager with exponential backoff\n- Max retry attempts (configurable)\n- Reconnection delay configuration\n- Resubscribe to events after reconnection\n- Connection lifecycle event handlers\n- Graceful degradation","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-11-24T00:18:38.421877967Z","updated_at":"2026-01-03T21:41:47.645866918Z","dependencies":[{"issue_id":"clack-iwr","depends_on_id":"clack-ar9","type":"blocks","created_at":"2025-11-24T00:19:50.850865709Z","created_by":"daemon"},{"issue_id":"clack-iwr","depends_on_id":"clack-0nr","type":"parent-child","created_at":"2025-11-24T04:18:56.798581137Z","created_by":"vscode"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-ix1","title":"Add validation call to orchestrator","description":"Insert validateGeneratorOutput() call in src/content/orchestrator.ts after generateWithRetry() returns, inside the try block. This ensures validation failures trigger P3 fallback.","design":"In generateAndSend() method, after line 151:\n```typescript\ntry {\n  content = await generateWithRetry(...);\n  \n  // NEW: Validate generator output\n  validateGeneratorOutput(content);\n  \n} catch (error) {\n  console.warn('Generator failed, using P3 fallback:', \n    error instanceof Error ? error.message : 'Unknown error');\n  content = await this.fallbackGenerator.generate(context);\n}\n```","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-11-27T20:03:11.286660633Z","updated_at":"2026-01-03T21:41:47.645866918Z","dependencies":[{"issue_id":"clack-ix1","depends_on_id":"clack-foo","type":"parent-child","created_at":"2025-11-27T20:03:23.16172118Z","created_by":"daemon"},{"issue_id":"clack-ix1","depends_on_id":"clack-rnx","type":"blocks","created_at":"2025-11-27T20:03:30.158059753Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-jc1","title":"Create Test Fixtures for Vestaboard API","description":"Create JSON fixtures with realistic Vestaboard API responses, character code examples, and error scenarios for comprehensive testing.","design":"## Fixture Categories\nReference: tests/fixtures/openai-responses.json\n\n1. Success responses (message sent)\n2. Error responses (auth, invalid message)\n3. Character code examples (hello world, motivational quotes)\n4. getCurrentMessage responses\n5. Edge cases (empty messages, full board)\n\nAll fixtures based on official Vestaboard API documentation.","acceptance_criteria":"- tests/fixtures/vestaboard-responses.json created\n- sendMessage.success fixture\n- sendMessage.authenticationError fixture\n- sendMessage.invalidMessage fixture\n- getCurrentMessage.success fixture with 6×22 character array\n- characterCodes.helloWorld example (6×22 array)\n- characterCodes.motivational example (multi-line centered text)\n- characterCodes.empty fixture (all zeros)\n- Fixtures match real Vestaboard API response format\n- Character codes validated against official documentation\n- JSON properly formatted and linted","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-11-26T05:25:07.710999386Z","updated_at":"2026-01-03T21:41:47.645866918Z","dependencies":[{"issue_id":"clack-jc1","depends_on_id":"clack-7tb","type":"blocks","created_at":"2025-11-26T05:25:07.711746428Z","created_by":"daemon"},{"issue_id":"clack-jc1","depends_on_id":"clack-2jo","type":"parent-child","created_at":"2025-11-26T23:06:05.164965293Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-jgou","title":"[MEDIUM] Fix static-fallback-generator.test.ts probabilistic randomness test","description":"**File:** tests/unit/content/generators/static-fallback-generator.test.ts\n**Lines:** 134-161\n**Category:** Too Brittle\n**Severity:** Medium\n\n## Problem\nTest \"should select different files on multiple calls (randomness)\" uses statistical probability (~1.6e-7 failure chance). While unlikely, this is not deterministic.\n\n## Evidence\n```typescript\n// With 20 calls across 3 files, we should see at least 2 different files\n// (extremely unlikely to get the same file 20 times in a row)\nexpect(results.size).toBeGreaterThanOrEqual(2);\n```\n\n## Implementation Instructions\n1. **Mock Math.random()** to ensure deterministic selection pattern\n2. **Or test the selection algorithm** separately without testing randomness\n3. **Or document** this is an acceptable probabilistic test\n\n## Acceptance Criteria\n- [ ] Test is deterministic or documented as acceptable probabilistic test\n- [ ] Random selection verified through mock or algorithm test\n- [ ] No unexpected flaky test failures","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-11-29T05:09:24.959011335Z","updated_at":"2026-01-03T21:41:47.645866918Z","close_reason":"Verified complete by code review","labels":["medium","testing"],"dependencies":[{"issue_id":"clack-jgou","depends_on_id":"clack-rokx","type":"parent-child","created_at":"2025-11-29T07:01:04.573212839Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-jnud","title":"Serial Story Generator","description":"Replace disconnected story-fragment-generator with serialized chapter-based story system. Each generation is a new chapter with rising action → climax → resolution arc. LLM controls pacing and signals completion.\n\n**Execution Order for reaper:takeoff:**\n- PARALLEL GROUP 1: [clack-jnud.1, clack-jnud.2, clack-jnud.3] - Foundation work (DB, tool, prompts)\n- SEQUENTIAL: clack-jnud.4 - Implement generator (requires all from Group 1)\n- SEQUENTIAL: clack-jnud.5 - Write tests (requires .4)\n- SEQUENTIAL: clack-jnud.6 - Register and cleanup (requires .4, .5)\n\n**Critical Path:** .1/.2/.3 (parallel) → .4 → .5 → .6","status":"closed","priority":1,"issue_type":"epic","owner":"ryan@spice.cc","created_at":"2026-01-21T23:08:17.482509762Z","created_by":"Ryan Brodkin","updated_at":"2026-01-22T01:41:15.343548134Z","closed_at":"2026-01-22T01:41:15.343548134Z","close_reason":"Serial Story Generator implemented with continueStory parameter, ending criteria, and chapter budget. All tests passing, merged to develop."}
{"id":"clack-jnud.1","title":"Add database query methods for generator history","description":"Add findByGeneratorIdLatest() to ContentModel and findLatestByGenerator() wrapper to ContentRepository.\n\n**Acceptance Criteria:**\n- [ ] ContentModel has findByGeneratorIdLatest(generatorId, limit) method\n- [ ] ContentRepository has findLatestByGenerator(generatorId, limit) wrapper\n- [ ] Methods return records ordered by generatedAt DESC\n- [ ] Unit tests pass for new methods\n\n**Files:** src/storage/models/content.ts, src/storage/repositories/content-repo.ts, tests/unit/storage/models/content.test.ts, tests/unit/storage/repositories/content-repo.test.ts","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-21T23:08:27.603800085Z","created_by":"Ryan Brodkin","updated_at":"2026-01-22T01:41:09.812804423Z","closed_at":"2026-01-22T01:41:09.812804423Z","close_reason":"Implementation complete, merged to develop","dependencies":[{"issue_id":"clack-jnud.1","depends_on_id":"clack-jnud","type":"parent-child","created_at":"2026-01-21T23:08:27.604648169Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-jnud.2","title":"Extend submit_content tool with story params","description":"Add isFinalChapter and chapterSummary optional params to submit_content tool.\n\n**Acceptance Criteria:**\n- [ ] SubmitContentParams interface includes isFinalChapter?: boolean\n- [ ] SubmitContentParams interface includes chapterSummary?: string\n- [ ] SubmitContentResult passes through these values\n- [ ] Tool definition describes new params\n- [ ] Unit tests cover new params\n\n**Files:** src/content/tools/submit-content.ts, tests/unit/content/tools/submit-content.test.ts","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-21T23:08:28.925843336Z","created_by":"Ryan Brodkin","updated_at":"2026-01-22T01:41:09.82781259Z","closed_at":"2026-01-22T01:41:09.82781259Z","close_reason":"Implementation complete, merged to develop","dependencies":[{"issue_id":"clack-jnud.2","depends_on_id":"clack-jnud","type":"parent-child","created_at":"2026-01-21T23:08:28.929372919Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-jnud.3","title":"Create serial story prompts","description":"Create chapter1 and continuation prompt files with arc guidance.\n\n**Acceptance Criteria:**\n- [ ] prompts/user/serial-story-chapter1.txt exists with scenario/emotionalBeat vars\n- [ ] prompts/user/serial-story-continuation.txt exists with chapter vars\n- [ ] Prompts include 8-12 chapter guidance\n- [ ] Prompts explain rising action → climax → resolution\n- [ ] Prompts instruct LLM to use isFinalChapter when story ends\n\n**Files:** prompts/user/serial-story-chapter1.txt, prompts/user/serial-story-continuation.txt","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-21T23:08:30.023576253Z","created_by":"Ryan Brodkin","updated_at":"2026-01-22T01:41:09.833602673Z","closed_at":"2026-01-22T01:41:09.833602673Z","close_reason":"Implementation complete, merged to develop","dependencies":[{"issue_id":"clack-jnud.3","depends_on_id":"clack-jnud","type":"parent-child","created_at":"2026-01-21T23:08:30.026914753Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-jnud.4","title":"Implement SerialStoryGenerator class","description":"Create generator with Chapter 1 vs continuation logic, story state tracking.\n\n**Acceptance Criteria:**\n- [ ] Extends AIPromptGenerator with MEDIUM model tier\n- [ ] Constructor accepts ContentRepository and optional maxChapters\n- [ ] getStoryState() queries previous chapters, detects new vs continuation\n- [ ] getTemplateVariables() returns appropriate vars for chapter type\n- [ ] getCustomMetadata() returns StoryChapterMetadata\n- [ ] DEFAULT_MAX_CHAPTERS = 15, configurable via constructor\n- [ ] Reuses SCENARIO and EMOTIONAL_BEAT dictionaries\n\n**Files:** src/content/generators/ai/serial-story-generator.ts","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-21T23:08:39.171352633Z","created_by":"Ryan Brodkin","updated_at":"2026-01-22T01:41:09.843726757Z","closed_at":"2026-01-22T01:41:09.843726757Z","close_reason":"Implementation complete, merged to develop","dependencies":[{"issue_id":"clack-jnud.4","depends_on_id":"clack-jnud","type":"parent-child","created_at":"2026-01-21T23:08:39.177549799Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-jnud.4","depends_on_id":"clack-jnud.1","type":"blocks","created_at":"2026-01-21T23:08:49.986475388Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-jnud.4","depends_on_id":"clack-jnud.2","type":"blocks","created_at":"2026-01-21T23:08:50.023603138Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-jnud.4","depends_on_id":"clack-jnud.3","type":"blocks","created_at":"2026-01-21T23:08:50.057512721Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-jnud.5","title":"Write unit tests for SerialStoryGenerator","description":"Comprehensive tests for story state detection, chapter flow, safety cap.\n\n**Acceptance Criteria:**\n- [ ] Tests for Chapter 1 detection (no previous, previous complete, over max)\n- [ ] Tests for continuation detection and chapterNumber increment\n- [ ] Tests for template variables (chapter1 vs continuation)\n- [ ] Tests for maxChapters override via constructor\n- [ ] Tests for metadata structure\n- [ ] All tests pass\n\n**Files:** tests/unit/content/generators/ai/serial-story-generator.test.ts","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-21T23:08:40.35622105Z","created_by":"Ryan Brodkin","updated_at":"2026-01-22T01:41:09.855780423Z","closed_at":"2026-01-22T01:41:09.855780423Z","close_reason":"Implementation complete, merged to develop","dependencies":[{"issue_id":"clack-jnud.5","depends_on_id":"clack-jnud","type":"parent-child","created_at":"2026-01-21T23:08:40.361029425Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-jnud.5","depends_on_id":"clack-jnud.4","type":"blocks","created_at":"2026-01-21T23:08:51.261058513Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-jnud.6","title":"Register generator and cleanup old files","description":"Register new generator, update bootstrap, remove old files.\n\n**Acceptance Criteria:**\n- [ ] SerialStoryGenerator registered with id: 'serial-story'\n- [ ] Bootstrap creates instance with ContentRepository injection\n- [ ] Old files deleted:\n  - src/content/generators/ai/story-fragment-generator.ts\n  - prompts/user/story-fragment.txt\n  - tests/unit/content/generators/ai/story-fragment-generator.test.ts\n- [ ] Exports updated in src/content/generators/ai/index.ts\n- [ ] Full test suite passes\n- [ ] Linting passes\n\n**Files (modify):** src/content/registry/register-core.ts, src/bootstrap.ts, src/content/generators/ai/index.ts\n\n**Files (delete):** src/content/generators/ai/story-fragment-generator.ts, prompts/user/story-fragment.txt, tests/unit/content/generators/ai/story-fragment-generator.test.ts","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-21T23:08:41.818014676Z","created_by":"Ryan Brodkin","updated_at":"2026-01-22T01:41:09.861602548Z","closed_at":"2026-01-22T01:41:09.861602548Z","close_reason":"Implementation complete, merged to develop","dependencies":[{"issue_id":"clack-jnud.6","depends_on_id":"clack-jnud","type":"parent-child","created_at":"2026-01-21T23:08:41.824791259Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-jnud.6","depends_on_id":"clack-jnud.4","type":"blocks","created_at":"2026-01-21T23:08:52.344975625Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-jnud.6","depends_on_id":"clack-jnud.5","type":"blocks","created_at":"2026-01-21T23:08:52.379374708Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-jo40","title":"[INFRA] Create timezone test utilities","description":"**Category:** Testing Infrastructure\n**Priority:** Medium\n\n## Problem\nTests in info-bar.test.ts hardcode Pacific timezone expectations (17:05 UTC → 09:05). Tests fail on machines in different timezones.\n\n## Implementation\n\nCreate `tests/__helpers__/timezone.ts`:\n```typescript\n/**\n * Execute a test function with a specific timezone set.\n * Automatically restores original timezone after execution.\n */\nexport function withTimezone\u003cT\u003e(tz: string, fn: () =\u003e T): T {\n  const originalTZ = process.env.TZ;\n  process.env.TZ = tz;\n  \n  try {\n    return fn();\n  } finally {\n    if (originalTZ === undefined) {\n      delete process.env.TZ;\n    } else {\n      process.env.TZ = originalTZ;\n    }\n  }\n}\n\n/**\n * Create a date in a specific timezone for testing.\n * Returns both the date and the expected local time string.\n */\nexport function createTestDate(isoString: string, expectedTimezone: string) {\n  return {\n    date: new Date(isoString),\n    timezone: expectedTimezone\n  };\n}\n\n/**\n * Common timezone constants for testing\n */\nexport const TEST_TIMEZONES = {\n  UTC: 'UTC',\n  PACIFIC: 'America/Los_Angeles',\n  EASTERN: 'America/New_York',\n  LONDON: 'Europe/London',\n  TOKYO: 'Asia/Tokyo'\n} as const;\n```\n\n## Usage Example\n```typescript\nimport { withTimezone, TEST_TIMEZONES } from '@tests/__helpers__';\n\ndescribe('formatInfoBar', () =\u003e {\n  it('should format time in configured timezone', () =\u003e {\n    withTimezone(TEST_TIMEZONES.PACIFIC, () =\u003e {\n      const data = { dateTime: new Date('2024-11-26T17:05:00Z') };\n      const result = formatInfoBar(data);\n      expect(codesToString(result.slice(10, 15))).toBe('09:05');\n    });\n  });\n});\n```\n\n## Acceptance Criteria\n- [ ] Helper file created at `tests/__helpers__/timezone.ts`\n- [ ] Exported from `tests/__helpers__/index.ts`\n- [ ] info-bar.test.ts updated to use withTimezone()\n- [ ] Tests pass regardless of machine timezone","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-11-29T05:16:40.137614843Z","updated_at":"2026-01-03T21:41:47.645866918Z","labels":["infrastructure","testing"],"dependencies":[{"issue_id":"clack-jo40","depends_on_id":"clack-s9o","type":"parent-child","created_at":"2025-11-29T05:17:02.18673113Z","created_by":"daemon"},{"issue_id":"clack-jo40","depends_on_id":"clack-d719","type":"parent-child","created_at":"2025-11-29T07:00:35.439459923Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-js7l","title":"Jest haste-map scans worktrees despite ignore patterns","description":"## Problem\nWhen git worktrees exist in `./trees/`, Jest's haste-map generates 'duplicate manual mock found' warnings during test runs:\n\n```\njest-haste-map: duplicate manual mock found: ai-providers\n  The following files share their name; please delete one of them:\n    * \u003crootDir\u003e/tests/__mocks__/ai-providers.ts\n    * \u003crootDir\u003e/trees/clack-rcgx-nav-redesign/tests/__mocks__/ai-providers.ts\n```\n\n## Impact\n- **Severity:** Low - warnings only, tests pass correctly\n- **Frequency:** Every test run when worktrees exist\n\n## Root Cause\nJest's haste-map builds its file index by crawling from `rootDir` **before** applying `modulePathIgnorePatterns`. The duplicate mock detection happens during this initial crawl phase.\n\n## Current Mitigations (Insufficient)\n- `modulePathIgnorePatterns: ['\u003crootDir\u003e/trees']` - Not applied before crawl\n- `roots: ['\u003crootDir\u003e/src', '\u003crootDir\u003e/tests', '\u003crootDir\u003e/prompts']` - Only affects test discovery\n- `haste.throwOnModuleCollision: false` - Prevents errors but warnings persist\n\n## TDD Approach\nFollow Red-Green-Blue cycle:\n1. RED: Verify warnings appear with worktrees present\n2. GREEN: Implement solution that eliminates warnings\n3. BLUE: Document solution in jest.config.cjs comments\n\n## Potential Solutions\n1. Create `.watchmanconfig` with ignore patterns (if using watchman)\n2. Use Jest's `haste.hasteMapModulePath` option with custom implementation\n3. Set `haste.defaultPlatform` or `haste.platforms` to limit crawling\n4. If no Jest-native solution exists, document as 'won't fix' with upstream issue reference\n\n## Acceptance Criteria\n- [ ] Running `npm test` produces no haste-map warnings when worktrees exist in ./trees/\n- [ ] Worktrees can remain in the ./trees/ directory (no relocation required)\n- [ ] All existing tests continue to pass\n- [ ] Solution documented in jest.config.cjs comments\n\n## Scope\nFiles: jest.config.cjs, possibly .watchmanconfig (new file)","status":"closed","priority":4,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-26T01:35:12.257490334Z","created_by":"Ryan Brodkin","updated_at":"2026-01-26T02:56:13.367263Z","closed_at":"2026-01-26T02:56:13.367263Z","close_reason":"Fixed: modulePathIgnorePatterns per project - merged to develop in 07c66dc","labels":["bug","dx","testing"]}
{"id":"clack-jxm","title":"Task 1.1: Create ContentGenerator interface and core types","description":"Create src/types/content-generator.ts with ContentGenerator interface, GenerationContext, GeneratedContent, ValidationResult types.","acceptance_criteria":"- ContentGenerator interface with generate() and validate() methods\n- GenerationContext with eventData, previousContent, updateType, timestamp\n- GeneratedContent with text, layout, outputMode, metadata\n- ValidationResult with valid boolean and optional errors array\n- Full JSDoc documentation\n- Unit tests with 80%+ coverage","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-11-26T22:14:49.00851055Z","updated_at":"2026-01-03T21:41:47.645866918Z","dependencies":[{"issue_id":"clack-jxm","depends_on_id":"clack-b5o","type":"parent-child","created_at":"2025-11-26T22:14:57.682543679Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-k6bk","title":"Remove ASCIIArtGenerator and GreetingGenerator","description":"Remove two programmatic content generators (ASCIIArtGenerator and GreetingGenerator) from the Clack Track codebase.\n\n**Goal:** Clean up unused generators from the content system.\n\n**Scope:**\n- Delete generator source files and test files\n- Remove from registry and bootstrap\n- Update imports/exports\n\n**Success Criteria:**\n- Both generators and their tests are deleted\n- No references to either generator remain in the codebase\n- Build and tests pass without these generators","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-05T02:36:28.145396671Z","created_by":"vscode","updated_at":"2026-01-05T03:31:08.409588384Z","closed_at":"2026-01-05T03:31:08.409588384Z","close_reason":"Removed ASCIIArtGenerator and GreetingGenerator from codebase. All quality gates passed (91.52% coverage, 2466 tests passing, zero lint errors)."}
{"id":"clack-k6bk.1","title":"Remove ASCIIArtGenerator from bootstrap","description":"Remove the import and instantiation of ASCIIArtGenerator from src/bootstrap.ts.\n\n**Acceptance Criteria:**\n- ASCIIArtGenerator is no longer imported (line 32)\n- ASCIIArtGenerator is no longer instantiated in createCoreGenerators (line 176)\n- asciiArt property removed from coreGenerators object\n\n**Files:** src/bootstrap.ts\n\n**File Overlap Note:** This issue modifies the same file as clack-k6bk.2. These two issues MUST NOT run in parallel. Execute sequentially.\n\n**Related:** clack-k6bk.2 (GreetingGenerator removal in same file - MUST run sequentially)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T02:36:49.499165209Z","created_by":"vscode","updated_at":"2026-01-05T03:31:17.702639305Z","closed_at":"2026-01-05T03:31:17.702639305Z","close_reason":"Completed as part of epic clack-k6bk","dependencies":[{"issue_id":"clack-k6bk.1","depends_on_id":"clack-k6bk","type":"parent-child","created_at":"2026-01-05T02:36:49.505022584Z","created_by":"vscode"}]}
{"id":"clack-k6bk.2","title":"Remove GreetingGenerator from bootstrap","description":"Remove the import and instantiation of GreetingGenerator from src/bootstrap.ts.\n\n**Acceptance Criteria:**\n- GreetingGenerator is no longer imported (line 31)\n- GreetingGenerator is no longer instantiated in createCoreGenerators (line 172)\n- greeting property removed from coreGenerators object\n\n**Files:** src/bootstrap.ts\n\n**File Overlap Note:** This issue modifies the same file as clack-k6bk.1. These two issues MUST NOT run in parallel. Execute sequentially.\n\n**Related:** clack-k6bk.1 (ASCIIArtGenerator removal in same file - MUST run sequentially)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T02:36:50.491221876Z","created_by":"vscode","updated_at":"2026-01-05T03:31:17.708352013Z","closed_at":"2026-01-05T03:31:17.708352013Z","close_reason":"Completed as part of epic clack-k6bk","dependencies":[{"issue_id":"clack-k6bk.2","depends_on_id":"clack-k6bk","type":"parent-child","created_at":"2026-01-05T02:36:50.496876167Z","created_by":"vscode"},{"issue_id":"clack-k6bk.2","depends_on_id":"clack-k6bk.1","type":"blocks","created_at":"2026-01-05T02:40:07.843146551Z","created_by":"vscode"}]}
{"id":"clack-k6bk.3","title":"Remove generators from register-core.ts","description":"Remove greeting and asciiArt from CoreGenerators interface and registerCoreContent function.\n\n**Acceptance Criteria:**\n- Remove greeting property from CoreGenerators interface (lines 55-56)\n- Remove asciiArt optional property from CoreGenerators interface (lines 63-64)\n- Remove interface JSDoc comments mentioning these generators (lines 26, 38-39)\n- Remove greeting registration block (lines 162-171)\n- Remove asciiArt registration block (lines 207-218)\n\n**Files:** src/content/registry/register-core.ts\n\n**Related:** clack-k6bk.4 (export removal - can run in parallel, no file overlap)\n\n**Parallel Note:** This issue CAN run in parallel with clack-k6bk.4 since they modify different files.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T02:37:03.811379299Z","created_by":"vscode","updated_at":"2026-01-05T03:31:17.711582722Z","closed_at":"2026-01-05T03:31:17.711582722Z","close_reason":"Completed as part of epic clack-k6bk","dependencies":[{"issue_id":"clack-k6bk.3","depends_on_id":"clack-k6bk","type":"parent-child","created_at":"2026-01-05T02:37:03.819415924Z","created_by":"vscode"},{"issue_id":"clack-k6bk.3","depends_on_id":"clack-k6bk.1","type":"blocks","created_at":"2026-01-05T02:37:35.995179966Z","created_by":"vscode"},{"issue_id":"clack-k6bk.3","depends_on_id":"clack-k6bk.2","type":"blocks","created_at":"2026-01-05T02:37:36.012943466Z","created_by":"vscode"}]}
{"id":"clack-k6bk.4","title":"Remove exports from programmatic/index.ts","description":"Remove export statements for GreetingGenerator and ASCIIArtGenerator from the programmatic module index.\n\n**Acceptance Criteria:**\n- Remove: export { GreetingGenerator } from './greeting-generator.js' (line 10)\n- Remove: export { ASCIIArtGenerator } from './ascii-art-generator.js' (line 11)\n- Only PatternGenerator export remains\n\n**Files:** src/content/generators/programmatic/index.ts\n\n**Related:** clack-k6bk.3 (registry removal - can run in parallel, no file overlap)\n\n**Parallel Note:** This issue CAN run in parallel with clack-k6bk.3 since they modify different files.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T02:37:04.718867966Z","created_by":"vscode","updated_at":"2026-01-05T03:31:17.714691888Z","closed_at":"2026-01-05T03:31:17.714691888Z","close_reason":"Completed as part of epic clack-k6bk","dependencies":[{"issue_id":"clack-k6bk.4","depends_on_id":"clack-k6bk","type":"parent-child","created_at":"2026-01-05T02:37:04.723383883Z","created_by":"vscode"},{"issue_id":"clack-k6bk.4","depends_on_id":"clack-k6bk.1","type":"blocks","created_at":"2026-01-05T02:37:37.088192175Z","created_by":"vscode"},{"issue_id":"clack-k6bk.4","depends_on_id":"clack-k6bk.2","type":"blocks","created_at":"2026-01-05T02:37:37.107590675Z","created_by":"vscode"}]}
{"id":"clack-k6bk.5","title":"Delete generator source files","description":"Delete the source files for both ASCIIArtGenerator and GreetingGenerator.\n\n**Acceptance Criteria:**\n- DELETE: src/content/generators/programmatic/ascii-art-generator.ts\n- DELETE: src/content/generators/programmatic/greeting-generator.ts\n- Files no longer exist in the repository\n\n**Files to delete:**\n- src/content/generators/programmatic/ascii-art-generator.ts (135 lines)\n- src/content/generators/programmatic/greeting-generator.ts (97 lines)\n\n**Related:** clack-k6bk.6 (test file deletion - can run in parallel, no file overlap)\n\n**Parallel Note:** This issue CAN run in parallel with clack-k6bk.6 since they delete different files.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T02:37:16.48673593Z","created_by":"vscode","updated_at":"2026-01-05T03:31:17.717649555Z","closed_at":"2026-01-05T03:31:17.717649555Z","close_reason":"Completed as part of epic clack-k6bk","dependencies":[{"issue_id":"clack-k6bk.5","depends_on_id":"clack-k6bk","type":"parent-child","created_at":"2026-01-05T02:37:16.49128493Z","created_by":"vscode"},{"issue_id":"clack-k6bk.5","depends_on_id":"clack-k6bk.3","type":"blocks","created_at":"2026-01-05T02:37:37.979145926Z","created_by":"vscode"},{"issue_id":"clack-k6bk.5","depends_on_id":"clack-k6bk.4","type":"blocks","created_at":"2026-01-05T02:37:37.995667092Z","created_by":"vscode"}]}
{"id":"clack-k6bk.6","title":"Delete generator test files","description":"Delete the test files for both ASCIIArtGenerator and GreetingGenerator.\n\n**Acceptance Criteria:**\n- DELETE: tests/unit/content/generators/programmatic/ascii-art-generator.test.ts\n- DELETE: tests/unit/content/generators/programmatic/greeting-generator.test.ts\n- Test files no longer exist in the repository\n\n**Files to delete:**\n- tests/unit/content/generators/programmatic/ascii-art-generator.test.ts (226 lines)\n- tests/unit/content/generators/programmatic/greeting-generator.test.ts (371 lines)\n\n**Related:** clack-k6bk.5 (source file deletion - can run in parallel, no file overlap)\n\n**Parallel Note:** This issue CAN run in parallel with clack-k6bk.5 since they delete different files.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T02:37:17.35320418Z","created_by":"vscode","updated_at":"2026-01-05T03:31:17.720377305Z","closed_at":"2026-01-05T03:31:17.720377305Z","close_reason":"Completed as part of epic clack-k6bk","dependencies":[{"issue_id":"clack-k6bk.6","depends_on_id":"clack-k6bk","type":"parent-child","created_at":"2026-01-05T02:37:17.360047805Z","created_by":"vscode"},{"issue_id":"clack-k6bk.6","depends_on_id":"clack-k6bk.3","type":"blocks","created_at":"2026-01-05T02:37:39.161242843Z","created_by":"vscode"},{"issue_id":"clack-k6bk.6","depends_on_id":"clack-k6bk.4","type":"blocks","created_at":"2026-01-05T02:37:39.178840593Z","created_by":"vscode"}]}
{"id":"clack-k7e","title":"Add unit tests for failure logging scenarios","description":"Add tests to verify both failure scenarios correctly log data.\n\n**File**: `tests/unit/content/orchestrator.test.ts`\n\n**Test cases**:\n\n1. **Validation failure saves text and metadata**\n   - Mock `generateWithRetry` to return content with 7 lines\n   - Mock `validateGeneratorOutput` to throw ContentValidationError\n   - Verify `saveContent` called with: text (the 7-line content), aiProvider, aiModel, modelTier, status='failed'\n\n2. **Provider failure (no content) saves with empty fields**\n   - Mock `generateWithRetry` to throw RateLimitError\n   - Verify `saveContent` called with: text='', aiProvider='', status='failed'\n\n3. **All metadata fields populated for validation failures**\n   - Set up content with full metadata (aiProvider, aiModel, modelTier, tokensUsed, failedOver)\n   - Verify each field is extracted and saved","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-11-28T07:50:51.277233341Z","updated_at":"2026-01-03T21:41:47.645866918Z","dependencies":[{"issue_id":"clack-k7e","depends_on_id":"clack-rvq","type":"parent-child","created_at":"2025-11-28T07:51:13.004891671Z","created_by":"daemon"},{"issue_id":"clack-k7e","depends_on_id":"clack-5wz","type":"blocks","created_at":"2025-11-28T07:52:52.593658134Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-k7g","title":"Task 1.2: Add ContentPriority and ModelTier enums","description":"Extend src/types/content-generator.ts with ContentPriority enum (NOTIFICATION=0, NORMAL=2, FALLBACK=3) and ModelTier enum (LIGHT, MEDIUM, HEAVY).","acceptance_criteria":"- ContentPriority enum with P0, P2, P3 values\n- ModelTier enum with light/medium/heavy\n- Exported from types/index.ts\n- Unit tests","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-11-26T22:14:49.135336216Z","updated_at":"2026-01-03T21:41:47.645866918Z","dependencies":[{"issue_id":"clack-k7g","depends_on_id":"clack-b5o","type":"parent-child","created_at":"2025-11-26T22:14:57.778717137Z","created_by":"daemon"},{"issue_id":"clack-k7g","depends_on_id":"clack-jxm","type":"blocks","created_at":"2025-11-26T22:14:58.027528929Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-k7s","title":"Task 3.2: Create concrete AI generators (Motivational, News, Weather)","description":"Create src/content/generators/ai/ directory with MotivationalGenerator, NewsSummaryGenerator, WeatherFocusGenerator extending AIPromptGenerator.","acceptance_criteria":"- MotivationalGenerator with motivational.txt prompts\n- NewsSummaryGenerator with news-summary.txt prompts\n- WeatherFocusGenerator with weather-focus.txt prompts\n- Each specifies appropriate model tier\n- Unit tests for each generator","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-11-26T22:15:39.010098211Z","updated_at":"2026-01-03T21:41:47.645866918Z","dependencies":[{"issue_id":"clack-k7s","depends_on_id":"clack-6vv","type":"parent-child","created_at":"2025-11-26T22:15:50.277523592Z","created_by":"daemon"},{"issue_id":"clack-k7s","depends_on_id":"clack-e6l","type":"blocks","created_at":"2025-11-26T22:15:50.983388551Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-ke0","title":"Passkey-only login screen","description":"Implement WebAuthn/passkey authentication login screen with browser compatibility detection. Login-only functionality without registration.","design":"**WebAuthn Implementation:**\n- @simplewebauthn/browser for client\n- @simplewebauthn/server for backend\n- Challenge/response flow\n\n**Backend Endpoints:**\n- POST /api/auth/login/start - Returns challenge\n- POST /api/auth/login/verify - Verifies response, returns session\n\n**UI Components:**\n- LoginScreen - Full-screen centered card\n- PasskeyButton - \"Sign in with Passkey\"\n- Browser support detection with error message\n\n**State Management:**\n- AuthContext (user, token, isAuthenticated)\n- Session token in httpOnly cookie\n- Logout functionality\n\n**Security:**\n- Rate limiting on auth endpoints\n- HTTPS required for WebAuthn\n- Short-lived session tokens","acceptance_criteria":"- [ ] Login screen renders with \"Sign in with Passkey\" button\n- [ ] Browser compatibility check shows error on unsupported browsers\n- [ ] Clicking button triggers WebAuthn passkey ceremony\n- [ ] Successful auth stores session and redirects\n- [ ] Failed auth shows user-friendly error\n- [ ] Cancelled prompt returns to login without error\n- [ ] Backend implements challenge/response flow\n- [ ] Rate limiting on auth endpoints\n- [ ] AuthContext provides isAuthenticated, user, login, logout\n- [ ] All WebAuthn operations mocked in tests\n- [ ] 80%+ test coverage\n- [ ] Mobile responsive (iOS Safari, Android Chrome)\n- [ ] NO password fields or registration visible","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-11-26T05:05:08.487026137Z","updated_at":"2026-01-03T21:41:47.645866918Z","labels":["auth","ui","web"],"dependencies":[{"issue_id":"clack-ke0","depends_on_id":"clack-dor","type":"parent-child","created_at":"2025-11-26T05:05:20.738221628Z","created_by":"daemon"},{"issue_id":"clack-ke0","depends_on_id":"clack-ias","type":"blocks","created_at":"2025-11-26T05:05:30.674863383Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-kein","title":"Remove unused dev:client npm script","description":"The frontend requires the API to function, making dev:client impractical as a standalone command.","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-24T00:06:24.147897667Z","created_by":"Ryan Brodkin","updated_at":"2026-01-24T00:20:24.004372708Z","closed_at":"2026-01-24T00:20:24.004404Z"}
{"id":"clack-kgt","title":"Database Integration with Bootstrap","description":"Initialize database connection in bootstrap and inject into orchestrator.\n\n**Files to modify**:\n- `src/bootstrap.ts` - Add database initialization\n- `src/content/orchestrator.ts` - Accept ContentRepository in config\n\n**Bootstrap changes**:\n```typescript\nconst database = new Database();\nawait database.connect();\nconst contentModel = new ContentModel(database);\nconst contentRepository = new ContentRepository(contentModel);\n\nconst orchestrator = new ContentOrchestrator({\n  // ... existing config\n  contentRepository,\n});\n```","acceptance_criteria":"- Database connects during bootstrap\n- ContentRepository injected into orchestrator\n- Graceful shutdown closes database connection\n- Error handling for database connection failures","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-11-27T21:49:09.578841715Z","updated_at":"2026-01-03T21:41:47.645866918Z","labels":["integration"],"dependencies":[{"issue_id":"clack-kgt","depends_on_id":"clack-cpo","type":"blocks","created_at":"2025-11-27T21:49:31.905905086Z","created_by":"daemon"},{"issue_id":"clack-kgt","depends_on_id":"clack-6pj","type":"blocks","created_at":"2025-11-27T21:49:32.096806628Z","created_by":"daemon"},{"issue_id":"clack-kgt","depends_on_id":"clack-hfu","type":"parent-child","created_at":"2025-11-27T21:49:45.468938509Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-kkr","title":"MySQL Devcontainer Setup","description":"Add MySQL service to devcontainer configuration. User must rebuild container after this task.\n\n**Files to modify**:\n- `.devcontainer/devcontainer.json` - Add MySQL feature or docker-compose service\n- `.devcontainer/docker-compose.yml` - Create if needed for MySQL service\n- `.env.example` - Add MySQL connection variables\n\n**Environment variables**:\n```env\nDATABASE_URL=mysql://root:devpassword@localhost:3306/clack_track\nDATABASE_TYPE=mysql\n```\n\n**REQUIRES USER INTERACTION**: User must rebuild devcontainer after changes.","acceptance_criteria":"- MySQL service running in devcontainer\n- Connection verified with `mysql -u root -p`\n- Environment variables documented in .env.example","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-11-27T21:49:05.959026796Z","updated_at":"2026-01-03T21:41:47.645866918Z","labels":["blocking","infrastructure"],"dependencies":[{"issue_id":"clack-kkr","depends_on_id":"clack-hfu","type":"parent-child","created_at":"2025-11-27T21:49:33.78414067Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-ko4","title":"Implement HTTP Client for Vestaboard Local API","description":"Create HTTP communication layer using fetch API to send messages to Vestaboard device via Local API. Handles authentication, error responses, and connection validation.","design":"## Vestaboard Local API\n- Endpoint: POST http://vestaboard.local:7000/local-api/message\n- Header: X-Vestaboard-Local-Api-Key\n- Body: { \"characters\": [[...], [...], ...] } or [[...], [...], ...]\n- Dimensions: 6 rows × 22 columns\n\n## Error Handling\n- 401/403 → VestaboardAuthenticationError\n- 400 → VestaboardInvalidMessageError\n- Network errors → VestaboardConnectionError\n- Timeout support (configurable)\n\nReferences:\n- https://docs.vestaboard.com/docs/local-api/endpoints/","acceptance_criteria":"- src/api/vestaboard/http-client.ts created\n- VestaboardHTTPClientImpl class implements VestaboardHTTPClient interface\n- sendMessage(characterCodes: number[][]): Promise\u0026lt;VestaboardResponse\u0026gt; method\n- getCurrentMessage(): Promise\u0026lt;VestaboardResponse\u0026gt; method\n- validateConnection(): Promise\u0026lt;boolean\u0026gt; method\n- X-Vestaboard-Local-Api-Key header injection\n- Content-Type: application/json header\n- Proper request body formatting\n- Error handling for 401, 403, 400, timeout, network errors\n- Response parsing and validation\n- Timeout configuration support\n- Exported from src/api/vestaboard/index.ts","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-11-26T05:24:28.254797048Z","updated_at":"2026-01-03T21:41:47.645866918Z","dependencies":[{"issue_id":"clack-ko4","depends_on_id":"clack-7tb","type":"blocks","created_at":"2025-11-26T05:24:28.255530673Z","created_by":"daemon"},{"issue_id":"clack-ko4","depends_on_id":"clack-2jo","type":"parent-child","created_at":"2025-11-26T23:06:04.944084084Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-kos1","title":"Improve vestaboard-prompt skill with content quality principles","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T19:28:39.383845549Z","created_by":"vscode","updated_at":"2026-01-11T19:29:52.7577935Z","closed_at":"2026-01-11T19:29:52.7577935Z","close_reason":"Added content quality principles section with humor guidelines, attention hooks, anti-patterns, absurdist requirements, freshness formula, and commentary principles. Updated Houseboy persona with time-of-day tone variations."}
{"id":"clack-kp4n","title":"[REFACTOR] Separate CLI output format tests from logic tests","description":"**Category:** Test Organization\n**Priority:** Medium\n\n## Problem\nCLI command tests (especially content-test.test.ts, content-list.test.ts) conflate:\n1. **Logic testing** - Does the validator correctly identify invalid content?\n2. **Output testing** - Does the CLI format the output correctly?\n\nThis causes:\n- Brittle tests that break on minor formatting changes\n- Unclear test intent\n- Difficulty maintaining test coverage\n\n## Implementation\n\n### Option A: Split into separate test files\n```\ntests/unit/cli/commands/\n├── content-test.test.ts          # Keep - test command flow\n├── content-test.validation.test.ts  # NEW - test validator logic directly\n├── content-test.output.test.ts      # NEW - test output formatting (can use snapshots)\n```\n\n### Option B: Split within same file using describe blocks\n```typescript\ndescribe('content-test command', () =\u003e {\n  describe('validation logic', () =\u003e {\n    // Test validator directly, not CLI output\n    it('should detect too many lines', () =\u003e {\n      const result = validator.validate('1\\n2\\n3\\n4\\n5\\n6');\n      expect(result.status).toBe('FAILED');\n      expect(result.violations).toContainEqual(\n        expect.objectContaining({ rule: 'maxLines' })\n      );\n    });\n  });\n\n  describe('output formatting', () =\u003e {\n    // Use snapshots for output format stability\n    it('should format validation results', async () =\u003e {\n      const { output } = await captureConsoleOutput(() =\u003e \n        contentTestCommand({ generatorId: 'test' })\n      );\n      expect(output.join('\\n')).toMatchSnapshot();\n    });\n  });\n});\n```\n\n## Files to Refactor\n1. **content-test.test.ts** (lines 402-527) - 4 tests mixing logic and output\n2. **content-list.test.ts** (lines 145-186, 305-324) - Section extraction and table format\n\n## Acceptance Criteria\n- [ ] Validation logic tests use validator directly (no console parsing)\n- [ ] Output format tests either use snapshots or are clearly labeled\n- [ ] Tests for the same behavior are not duplicated\n- [ ] Breaking output format changes only break output tests, not logic tests","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-11-29T05:16:46.979372554Z","updated_at":"2026-01-03T21:41:47.645866918Z","close_reason":"Verified complete by code review","labels":["refactoring","testing"],"dependencies":[{"issue_id":"clack-kp4n","depends_on_id":"clack-s9o","type":"parent-child","created_at":"2025-11-29T05:17:02.967120464Z","created_by":"daemon"},{"issue_id":"clack-kp4n","depends_on_id":"clack-n81p","type":"parent-child","created_at":"2025-11-29T07:00:51.13163018Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-kuwa","title":"Create /deploy skill for Clack Track","description":"Create a /deploy skill for Clack Track that enables Claude Code to deploy the application to production via Docker Swarm.\n\n## Execution Guidance\n- **Parallel Group 1**: clack-kuwa.1 + clack-kuwa.2 (no file overlap, independent creation)\n- **Sequential**: clack-kuwa.3 (testing, blocked by Group 1)\n\n## Strategy\n- Selected: medium_single_branch (low complexity, 2 parallelizable work units)\n- Files: .claude/skills/deploy/ directory (SKILL.md, troubleshooting.md)\n- No file overlap between parallel work units\n\n## Reference\n- Existing skill pattern: .claude/skills/content-generator-designer/\n- DOCKER_HOST: ssh://rbrodkin@10.100.0.91 (from .env.production)","status":"closed","priority":2,"issue_type":"epic","owner":"ryan@spice.cc","created_at":"2026-01-21T22:27:39.562295258Z","created_by":"Ryan Brodkin","updated_at":"2026-01-21T23:13:19.623685304Z","closed_at":"2026-01-21T23:13:19.623685304Z","close_reason":"Merged to develop"}
{"id":"clack-kuwa.1","title":"Create deploy skill SKILL.md","description":"Create the main skill file at .claude/skills/deploy/SKILL.md with complete deployment workflow including branch state detection, user prompt for merge if main behind develop, Docker CLI commands for build/deploy/verify, health check verification, and rollback procedures. All commands via DOCKER_HOST, not direct SSH.\n\n## Files\n- .claude/skills/deploy/SKILL.md (create)\n\n## Acceptance Criteria\n- [ ] SKILL.md follows existing skill pattern (see .claude/skills/content-generator-designer/SKILL.md)\n- [ ] Includes YAML frontmatter with name and description\n- [ ] Documents branch state detection (main vs develop)\n- [ ] Prompts user if main is behind develop before deploy\n- [ ] All Docker commands use DOCKER_HOST pattern (ssh://rbrodkin@10.100.0.91)\n- [ ] Includes build, deploy, verify, and rollback procedures\n- [ ] Health check verification documented\n\n## Cross-References\n- Related: clack-kuwa.2 (troubleshooting doc in same directory, parallelizable)","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-21T22:27:47.333483928Z","created_by":"Ryan Brodkin","updated_at":"2026-01-21T23:13:19.602602304Z","closed_at":"2026-01-21T23:13:19.602602304Z","close_reason":"Merged to develop","dependencies":[{"issue_id":"clack-kuwa.1","depends_on_id":"clack-kuwa","type":"parent-child","created_at":"2026-01-21T22:27:47.334539678Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-kuwa.2","title":"Create troubleshooting reference doc","description":"Create supporting documentation at .claude/skills/deploy/troubleshooting.md with common error patterns and solutions, Docker Swarm service inspection commands, log viewing commands, secret management reference, database connection troubleshooting, and API version mismatch fixes. All commands use DOCKER_HOST pattern.\n\n## Files\n- .claude/skills/deploy/troubleshooting.md (create)\n\n## Acceptance Criteria\n- [ ] Troubleshooting doc follows markdown best practices\n- [ ] Common deployment error patterns documented\n- [ ] Docker Swarm service inspection commands included\n- [ ] Log viewing commands with DOCKER_HOST pattern\n- [ ] Secret management reference documented\n- [ ] Database connection troubleshooting covered\n- [ ] API version mismatch fixes included\n\n## Cross-References\n- Related: clack-kuwa.1 (main skill file in same directory, parallelizable)","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-21T22:27:48.329981846Z","created_by":"Ryan Brodkin","updated_at":"2026-01-21T23:13:19.613208513Z","closed_at":"2026-01-21T23:13:19.613208513Z","close_reason":"Merged to develop","dependencies":[{"issue_id":"clack-kuwa.2","depends_on_id":"clack-kuwa","type":"parent-child","created_at":"2026-01-21T22:27:48.333156804Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-kuwa.3","title":"Test skill invocation and workflow","description":"Manually verify the skill works by invoking /deploy and checking workflow prompts, verifying branch detection logic, ensuring docker commands are properly formatted, and confirming troubleshooting doc is referenced for errors.\n\n## Verification Steps\n1. Invoke /deploy skill from Claude Code\n2. Verify branch detection logic triggers correctly\n3. Check Docker commands use DOCKER_HOST pattern\n4. Simulate error to verify troubleshooting doc reference\n\n## Acceptance Criteria\n- [ ] /deploy skill invocation works\n- [ ] Branch detection prompts user when main behind develop\n- [ ] Docker commands properly formatted with DOCKER_HOST\n- [ ] Troubleshooting doc is referenced in error scenarios\n- [ ] Rollback procedure is accessible and documented\n\n## Dependencies\n- Blocked by: clack-kuwa.1, clack-kuwa.2 (must create files before testing)","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-21T22:27:49.292758471Z","created_by":"Ryan Brodkin","updated_at":"2026-01-21T23:13:19.618496263Z","closed_at":"2026-01-21T23:13:19.618496263Z","close_reason":"Merged to develop","dependencies":[{"issue_id":"clack-kuwa.3","depends_on_id":"clack-kuwa","type":"parent-child","created_at":"2026-01-21T22:27:49.295739638Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-kuwa.3","depends_on_id":"clack-kuwa.1","type":"blocks","created_at":"2026-01-21T22:27:55.180896085Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-kuwa.3","depends_on_id":"clack-kuwa.2","type":"blocks","created_at":"2026-01-21T22:27:55.213094293Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-kvoj","title":"Fix CLI command test isolation","description":"RE-EVALUATE SCOPE: Code review indicates CLI tests already verify behavior (argument parsing, console output, exit codes). Specific action: Review each CLI command test to identify tests that ONLY verify mocks were called with no additional value. Remove or improve weak tests. Tests to review: tests/unit/cli/index.test.ts, tests/unit/cli/commands/*.test.ts. Acceptance: Tests pass with no .env, all remaining tests verify meaningful behavior.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T21:03:38.198684798Z","created_by":"vscode","updated_at":"2026-01-11T22:38:16.691583301Z","closed_at":"2026-01-11T22:38:16.691583301Z","close_reason":"Closed","dependencies":[{"issue_id":"clack-kvoj","depends_on_id":"clack-82ep","type":"parent-child","created_at":"2026-01-11T21:04:05.422014338Z","created_by":"vscode"}]}
{"id":"clack-lg63","title":"Add tone guidelines to vestaboard-prompt skill","description":"Added comprehensive tone \u0026 voice section to the vestaboard-prompt skill documenting the Houseboy persona, humor priorities by content type, acceptable humor styles, emotional register, edge level (R-rated allowed), and anti-patterns to avoid. Also added tone checklist items to the quality checklist.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T03:49:38.591505842Z","created_by":"vscode","updated_at":"2026-01-05T03:58:06.011308341Z","closed_at":"2026-01-05T03:58:06.011308341Z","close_reason":"Closed","labels":["documentation"]}
{"id":"clack-lmzk","title":"content-test.test.ts: 13 tests failing - missing Vestaboard config mock","description":"File: tests/unit/cli/commands/content-test.test.ts\nFailures: 13 tests\nRoot cause: Tests call contentTestCommand() which calls bootstrap(), but Vestaboard configuration is not mocked.\nError: 'Vestaboard configuration is required for operation' thrown at src/bootstrap.ts:224\n\nFailing tests:\n- should list all available generators\n- should show error and list available generators  \n- should generate content and display results\n- should apply frame when --with-frame flag is provided\n- should handle generation errors gracefully\n- should show timing information\n- should validate character count and line count\n- should handle layout output mode\n- should display user prompt when available from AI generator\n- should not display user prompt section when not available\n- should display validation pass status in output\n- should display validation fail status in output\n- should display validation metrics in output","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-03T22:48:14.935934639Z","created_by":"vscode","updated_at":"2026-01-04T00:54:11.771638261Z","closed_at":"2026-01-04T00:54:11.771638261Z","close_reason":"Fixed by adding full bootstrap mock","dependencies":[{"issue_id":"clack-lmzk","depends_on_id":"clack-nltc","type":"parent-child","created_at":"2026-01-03T22:48:46.456444292Z","created_by":"vscode"}]}
{"id":"clack-lwca","title":"Refactor AI generator tests and remove private property access","description":"MERGED from clack-y2kk and clack-o5st to avoid file overlap conflicts.\n\nCombined scope:\n1. Replace generator['modelTier'] with observable behavior tests (test result.metadata.tier instead)\n2. Remove all bracket notation for private TypeScript members\n3. Create shared test utility for common generator patterns\n\nFiles affected (15 AI generator test files):\n- tests/unit/content/generators/ai/motivational-generator.test.ts\n- tests/unit/content/generators/ai/weather-generator.test.ts\n- tests/unit/content/generators/ai/fortune-cookie-generator.test.ts\n- tests/unit/content/generators/ai/haiku-generator.test.ts\n- tests/unit/content/generators/ai/shower-thought-generator.test.ts\n- tests/unit/content/generators/ai/hot-take-generator.test.ts\n- tests/unit/content/generators/ai/novel-insight-generator.test.ts\n- tests/unit/content/generators/ai/compliment-generator.test.ts\n- tests/unit/content/generators/ai/countdown-generator.test.ts\n- tests/unit/content/generators/ai/seasonal-generator.test.ts\n- tests/unit/content/generators/ai/global-news-generator.test.ts\n- tests/unit/content/generators/ai/local-news-generator.test.ts\n- tests/unit/content/generators/ai/tech-news-generator.test.ts\n- tests/unit/content/generators/ai/news-generator.test.ts\n- tests/unit/content/generators/ai/formatting-demo-generator.test.ts\n\nAdditional files with bracket notation:\n- tests/unit/api/vestaboard/http-client.test.ts (defaultClient['baseUrl'], etc.)\n\nNote: The ProtectedXxxGenerator type alias pattern is acceptable as it maintains type safety.\n\nAcceptance: No private property access via bracket notation (except typed patterns), tests verify observable behavior via result.metadata, tests pass without .env.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T21:16:55.948736958Z","created_by":"vscode","updated_at":"2026-01-11T22:38:16.694858592Z","closed_at":"2026-01-11T22:38:16.694858592Z","close_reason":"Closed","dependencies":[{"issue_id":"clack-lwca","depends_on_id":"clack-82ep","type":"parent-child","created_at":"2026-01-11T21:17:13.915434759Z","created_by":"vscode"}]}
{"id":"clack-lx1","title":"Task 2.3: Enhance AI provider factory with model override","description":"Modify src/api/ai/index.ts createAIProvider() to accept optional model parameter for tier-based model selection.","acceptance_criteria":"- createAIProvider(type, apiKey, model?) signature\n- Model override passed to provider constructor\n- Backward compatible (model optional)\n- Updated unit tests","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-11-26T22:15:11.390095546Z","updated_at":"2026-01-03T21:41:47.645866918Z","dependencies":[{"issue_id":"clack-lx1","depends_on_id":"clack-adr","type":"parent-child","created_at":"2025-11-26T22:15:18.815226091Z","created_by":"daemon"},{"issue_id":"clack-lx1","depends_on_id":"clack-xtg","type":"blocks","created_at":"2025-11-26T22:15:19.039594466Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-m280","title":"Fix over-mocking in server tests","description":"web/server.test.ts has 83 lines of mock setup (lines 1-83) before any tests. Tests like 'should set up CORS middleware' (lines 133-143) only verify mocks were called, not actual behavior.\n\nRefactor approach options:\n1. Use supertest against real Express app for integration-style tests\n2. Reduce mocks to only external dependencies\n3. Keep configuration validation tests (they verify correct setup values like CSP directives)\n\nRemove tests that ONLY check 'mock was called' with no argument verification.\nKeep tests that verify specific configuration values (lines 169-177 check CSP directives).\n\nCross-reference: clack-ebji may also modify this file. Coordinate to avoid conflicts.\n\nAcceptance: Tests verify actual behavior, not just mock calls. Tests pass without .env.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T21:03:36.898984505Z","created_by":"vscode","updated_at":"2026-01-11T22:38:16.697893926Z","closed_at":"2026-01-11T22:38:16.697893926Z","close_reason":"Closed","dependencies":[{"issue_id":"clack-m280","depends_on_id":"clack-82ep","type":"parent-child","created_at":"2026-01-11T21:04:05.41915463Z","created_by":"vscode"}]}
{"id":"clack-m66n","title":"New AI Content Generator Concepts","description":"Create five new AI content generators matching the Clack Track project vibe: engaging, cheeky, occasionally gay, never mean-spirited content for Vestaboard split-flap displays. All generators use Pattern A (personality-only) with LIGHT model tier.","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-05T04:11:10.570809885Z","created_by":"vscode","updated_at":"2026-01-05T20:10:56.840623042Z","closed_at":"2026-01-05T20:10:56.840623042Z","close_reason":"All 5 generators implemented"}
{"id":"clack-m66n.1","title":"Shower Thought Generator","description":"Random philosophical musings and 'wait, why IS that?' moments. The AI generates those oddly profound thoughts you have at 2am or in the shower.\n\nSample Output:\nDO FISH KNOW\nTHEY'RE WET\nOR IS THAT JUST LIFE\n\nAcceptance Criteria:\n- User prompt shower-thought.txt created\n- Generator class extends AIPromptGenerator\n- Model tier: LIGHT (simple personality-driven content)\n- Registered with P2 priority, frame enabled\n- Unit tests pass with mocked AI\n\nFiles:\n- prompts/user/shower-thought.txt\n- src/content/generators/ai/shower-thought-generator.ts\n- tests/unit/content/generators/shower-thought-generator.test.ts\n- src/content/registry/register-core.ts (SHARED: add registration call only)\n\nRelated Issues (parallel work, same pattern):\n- clack-m66n.2: Fortune Cookie Generator\n- clack-m66n.3: Countdown Generator\n- clack-m66n.4: Hot Take Generator\n- clack-m66n.5: Compliment Generator\n\nNote: All sibling issues create similar generators. Each owns its own files exclusively. The register-core.ts file is shared - add only your registration call, do not modify other registrations.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T04:11:23.473548501Z","created_by":"vscode","updated_at":"2026-01-05T20:10:56.521517959Z","closed_at":"2026-01-05T20:10:56.521517959Z","close_reason":"Implemented: shower-thought-generator.ts","dependencies":[{"issue_id":"clack-m66n.1","depends_on_id":"clack-m66n","type":"parent-child","created_at":"2026-01-05T04:11:23.479507918Z","created_by":"vscode"}]}
{"id":"clack-m66n.2","title":"Fortune Cookie Generator","description":"Fortune cookie wisdom with a twist - from traditional to absurd. Mix of actual wisdom and delightfully weird predictions.\n\nSample Output:\nYOUR LUCKY NUMBER IS\nPROBABLY NOT 7\nTRY 42 INSTEAD\n\nAcceptance Criteria:\n- User prompt fortune-cookie.txt created\n- Generator class extends AIPromptGenerator\n- Model tier: LIGHT\n- Registered with P2 priority, frame enabled\n- Unit tests pass with mocked AI\n\nFiles:\n- prompts/user/fortune-cookie.txt\n- src/content/generators/ai/fortune-cookie-generator.ts\n- tests/unit/content/generators/fortune-cookie-generator.test.ts\n- src/content/registry/register-core.ts (SHARED: add registration call only)\n\nRelated Issues (parallel work, same pattern):\n- clack-m66n.1: Shower Thought Generator\n- clack-m66n.3: Countdown Generator\n- clack-m66n.4: Hot Take Generator\n- clack-m66n.5: Compliment Generator\n\nNote: All sibling issues create similar generators. Each owns its own files exclusively. The register-core.ts file is shared - add only your registration call, do not modify other registrations.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T04:11:24.477456127Z","created_by":"vscode","updated_at":"2026-01-05T20:10:56.561346084Z","closed_at":"2026-01-05T20:10:56.561346084Z","close_reason":"Implemented: fortune-cookie-generator.ts","dependencies":[{"issue_id":"clack-m66n.2","depends_on_id":"clack-m66n","type":"parent-child","created_at":"2026-01-05T04:11:24.484317752Z","created_by":"vscode"}]}
{"id":"clack-m66n.3","title":"Countdown Generator","description":"Counts down to upcoming events (holidays, weekends, payday, etc.). Uses current date to calculate days remaining with commentary.\n\nSample Output:\nONLY 3 DAYS UNTIL\nFRIDAY\nHOLD ON TIGHT\n\nAcceptance Criteria:\n- User prompt countdown.txt created with {{date}} injection\n- Generator class extends AIPromptGenerator\n- Model tier: LIGHT\n- Registered with P2 priority, frame enabled\n- Handles various countdown targets dynamically\n- Unit tests pass with mocked AI\n\nFiles:\n- prompts/user/countdown.txt\n- src/content/generators/ai/countdown-generator.ts\n- tests/unit/content/generators/countdown-generator.test.ts\n- src/content/registry/register-core.ts (SHARED: add registration call only)\n\nRelated Issues (parallel work, same pattern):\n- clack-m66n.1: Shower Thought Generator\n- clack-m66n.2: Fortune Cookie Generator\n- clack-m66n.4: Hot Take Generator\n- clack-m66n.5: Compliment Generator\n\nNote: All sibling issues create similar generators. Each owns its own files exclusively. The register-core.ts file is shared - add only your registration call, do not modify other registrations.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T04:11:25.341476169Z","created_by":"vscode","updated_at":"2026-01-05T20:10:56.597240917Z","closed_at":"2026-01-05T20:10:56.597240917Z","close_reason":"Implemented: countdown-generator.ts","dependencies":[{"issue_id":"clack-m66n.3","depends_on_id":"clack-m66n","type":"parent-child","created_at":"2026-01-05T04:11:25.347731377Z","created_by":"vscode"}]}
{"id":"clack-m66n.4","title":"Hot Take Generator","description":"Spicy opinions on mundane topics. Strong stances on things like 'best pizza topping' or 'morning vs night showers' - playfully controversial.\n\nSample Output:\nPINEAPPLE ON PIZZA\nIS NOT JUST ACCEPTABLE\nIT'S SUPERIOR\n\nAcceptance Criteria:\n- User prompt hot-take.txt created\n- Generator class extends AIPromptGenerator\n- Model tier: LIGHT\n- Tone is playful, not actually offensive\n- Registered with P2 priority, frame enabled\n- Unit tests pass with mocked AI\n\nFiles:\n- prompts/user/hot-take.txt\n- src/content/generators/ai/hot-take-generator.ts\n- tests/unit/content/generators/hot-take-generator.test.ts\n- src/content/registry/register-core.ts (SHARED: add registration call only)\n\nRelated Issues (parallel work, same pattern):\n- clack-m66n.1: Shower Thought Generator\n- clack-m66n.2: Fortune Cookie Generator\n- clack-m66n.3: Countdown Generator\n- clack-m66n.5: Compliment Generator\n\nNote: All sibling issues create similar generators. Each owns its own files exclusively. The register-core.ts file is shared - add only your registration call, do not modify other registrations.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T04:11:27.509638795Z","created_by":"vscode","updated_at":"2026-01-05T20:10:56.762283709Z","closed_at":"2026-01-05T20:10:56.762283709Z","close_reason":"Implemented: hot-take-generator.ts","dependencies":[{"issue_id":"clack-m66n.4","depends_on_id":"clack-m66n","type":"parent-child","created_at":"2026-01-05T04:11:27.515757878Z","created_by":"vscode"}]}
{"id":"clack-m66n.5","title":"Compliment Generator","description":"Genuine compliments and affirmations directed at the viewer. Wholesome, uplifting, occasionally cheeky but always kind.\n\nSample Output:\nHEY YOU\nYOU'RE DOING GREAT\nKEEP IT UP CHAMP\n\nAcceptance Criteria:\n- User prompt compliment.txt created\n- Generator class extends AIPromptGenerator\n- Model tier: LIGHT\n- Uses second person ('you')\n- Registered with P2 priority, frame enabled\n- Unit tests pass with mocked AI\n\nFiles:\n- prompts/user/compliment.txt\n- src/content/generators/ai/compliment-generator.ts\n- tests/unit/content/generators/compliment-generator.test.ts\n- src/content/registry/register-core.ts (SHARED: add registration call only)\n\nRelated Issues (parallel work, same pattern):\n- clack-m66n.1: Shower Thought Generator\n- clack-m66n.2: Fortune Cookie Generator\n- clack-m66n.3: Countdown Generator\n- clack-m66n.4: Hot Take Generator\n\nNote: All sibling issues create similar generators. Each owns its own files exclusively. The register-core.ts file is shared - add only your registration call, do not modify other registrations.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T04:11:29.877318713Z","created_by":"vscode","updated_at":"2026-01-05T20:10:56.807186375Z","closed_at":"2026-01-05T20:10:56.807186375Z","close_reason":"Implemented: compliment-generator.ts","dependencies":[{"issue_id":"clack-m66n.5","depends_on_id":"clack-m66n","type":"parent-child","created_at":"2026-01-05T04:11:29.884192296Z","created_by":"vscode"}]}
{"id":"clack-m8q0","title":"Refactor Hot Take Generator for Novelty and Diversity","description":"Refactor Hot Take Generator to improve novelty and diversity by replacing HOT_TAKE_DOMAINS (50 specific topics) with HOT_TAKE_SUBJECTS (150+ broad subjects) and HOT_TAKE_ANGLES (12 tone-based angles) with HOT_TAKE_DEVICES (30+ rhetorical devices that force structural variety).\n\nAFFECTED FILES:\n- src/content/generators/ai/hot-take-generator.ts (main implementation)\n- prompts/user/hot-take.txt (prompt template)\n- tests/unit/content/generators/ai/hot-take-generator.test.ts (test suite)\n\nEXECUTION GUIDANCE FOR ORCHESTRATOR:\n\nPhase 1 (PARALLEL): Design work\n- clack-m8q0.1: Design subject taxonomy\n- clack-m8q0.2: Design device taxonomy\nBoth are design documents with no code changes, fully independent.\n\nPhase 2 (PARALLEL with FILE OVERLAP WARNING): Implementation\n- clack-m8q0.3: Implement SUBJECTS array (depends on m8q0.1)\n- clack-m8q0.4: Implement DEVICES array (depends on m8q0.2)\n- clack-m8q0.5: Refactor prompt (depends on m8q0.1 AND m8q0.2)\n\nFILE OVERLAP: m8q0.3 and m8q0.4 both modify hot-take-generator.ts but touch DIFFERENT arrays. Can run parallel if agents use exclusive sections. If sequential preferred, run m8q0.3 first.\n\nPhase 3: Generator update\n- clack-m8q0.6: Update generator class (depends on m8q0.3 AND m8q0.4)\n\nPhase 4: Test update\n- clack-m8q0.7: Update tests (depends on all implementation issues)\n\nCRITICAL PATH: m8q0.1 -\u003e m8q0.3 -\u003e m8q0.6 -\u003e m8q0.7","status":"closed","priority":1,"issue_type":"epic","owner":"ryan@spice.cc","created_at":"2026-01-23T18:28:22.615899714Z","created_by":"Ryan Brodkin","updated_at":"2026-01-23T19:38:16.305550377Z","closed_at":"2026-01-23T19:38:16.305550377Z","close_reason":"Closed"}
{"id":"clack-m8q0.1","title":"Design broad subject taxonomy","description":"Create a comprehensive taxonomy of 150+ broad, open-ended subjects that give the LLM creative freedom to develop unique hot takes. Subjects should be wide enough to allow many possible angles (like 'dogs', 'travel', 'crafting') rather than hyper-specific items.\n\nAcceptance Criteria:\n- 150+ subjects organized into 10+ categories\n- Subjects are broad enough to allow creative interpretation (e.g., 'dogs' not 'chihuahuas barking at mailmen')\n- Mix of: animals, hobbies, life stages, social situations, professions, entertainment, sports, nature, technology concepts, cultural phenomena\n- No subject is itself a recognizable hot take (avoid 'pineapple on pizza' style topics)\n\nEstimated Files: Design document only (no code changes)","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-23T18:28:29.039890758Z","created_by":"Ryan Brodkin","updated_at":"2026-01-23T19:38:08.207209137Z","closed_at":"2026-01-23T19:38:08.207209137Z","close_reason":"Closed","dependencies":[{"issue_id":"clack-m8q0.1","depends_on_id":"clack-m8q0","type":"parent-child","created_at":"2026-01-23T18:28:29.040753258Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-m8q0.2","title":"Design rhetorical device taxonomy","description":"Create a taxonomy of 30+ rhetorical devices that produce structurally different outputs. Focus on forcing different sentence structures, not just tone variations.\n\nAcceptance Criteria:\n- 30+ rhetorical devices with distinct output patterns\n- Each device forces a different structural approach\n- Devices categorized by: statement types, comparison types, temporal framings, logical structures\n- Clear differentiation from current tone-based angles\n\nEstimated Files: Design document only (no code changes)","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-23T18:28:34.148213594Z","created_by":"Ryan Brodkin","updated_at":"2026-01-23T19:38:08.293929512Z","closed_at":"2026-01-23T19:38:08.293929512Z","close_reason":"Closed","dependencies":[{"issue_id":"clack-m8q0.2","depends_on_id":"clack-m8q0","type":"parent-child","created_at":"2026-01-23T18:28:34.149335511Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-m8q0.3","title":"Implement HOT_TAKE_SUBJECTS array","description":"Implement the new HOT_TAKE_SUBJECTS array in the generator, replacing HOT_TAKE_DOMAINS. Export the array for testing.\n\nAcceptance Criteria:\n- HOT_TAKE_SUBJECTS exported const array with 150+ items\n- Items organized by category with comments\n- HOT_TAKE_DOMAINS removed or deprecated\n- TypeScript readonly array type preserved\n\nEstimated Files: src/content/generators/ai/hot-take-generator.ts\n\nFILE OVERLAP NOTE: This issue and clack-m8q0.4 both modify hot-take-generator.ts. They modify DIFFERENT sections (different arrays) so can run in parallel, but orchestrator should be aware of shared file. If run sequentially, this issue should complete first.\n\nRelated Issues: clack-m8q0.4 (same file, different array)","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-23T18:28:40.754545416Z","created_by":"Ryan Brodkin","updated_at":"2026-01-23T19:38:08.361859137Z","closed_at":"2026-01-23T19:38:08.361859137Z","close_reason":"Closed","dependencies":[{"issue_id":"clack-m8q0.3","depends_on_id":"clack-m8q0","type":"parent-child","created_at":"2026-01-23T18:28:40.755523583Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-m8q0.3","depends_on_id":"clack-m8q0.1","type":"blocks","created_at":"2026-01-23T18:28:45.431949543Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-m8q0.4","title":"Implement HOT_TAKE_DEVICES array","description":"Implement the new HOT_TAKE_DEVICES array in the generator, replacing HOT_TAKE_ANGLES. Export the array for testing.\n\nAcceptance Criteria:\n- HOT_TAKE_DEVICES exported const array with 30+ items\n- Items grouped by structural category with comments\n- HOT_TAKE_ANGLES removed or deprecated\n- TypeScript readonly array type preserved\n\nEstimated Files: src/content/generators/ai/hot-take-generator.ts\n\nFILE OVERLAP NOTE: This issue and clack-m8q0.3 both modify hot-take-generator.ts. They modify DIFFERENT sections (different arrays) so can run in parallel, but orchestrator should be aware of shared file. If run sequentially, clack-m8q0.3 should complete first.\n\nRelated Issues: clack-m8q0.3 (same file, different array)","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-23T18:28:50.137633754Z","created_by":"Ryan Brodkin","updated_at":"2026-01-23T19:38:08.431292304Z","closed_at":"2026-01-23T19:38:08.431292304Z","close_reason":"Closed","dependencies":[{"issue_id":"clack-m8q0.4","depends_on_id":"clack-m8q0","type":"parent-child","created_at":"2026-01-23T18:28:50.139122337Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-m8q0.4","depends_on_id":"clack-m8q0.2","type":"blocks","created_at":"2026-01-23T18:28:54.294616798Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-m8q0.5","title":"Refactor prompt for subject-to-take transformation","description":"Rewrite the user prompt to guide the LLM in transforming a broad subject INTO a hot take, rather than recognizing an existing one. Include examples of the transformation process.\n\nAcceptance Criteria:\n- Prompt instructs LLM to CREATE opinion from broad subject\n- Clear guidance on transformation (subject → observation → hot take)\n- Device guidance explains how each device shapes the output structure\n- Remove old domain/angle guidance sections\n- Template variables updated: {{hotTakeSubject}}, {{hotTakeDevice}}\n\nEstimated Files: prompts/user/hot-take.txt","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-23T18:29:01.877747218Z","created_by":"Ryan Brodkin","updated_at":"2026-01-23T19:38:08.506547471Z","closed_at":"2026-01-23T19:38:08.506547471Z","close_reason":"Closed","dependencies":[{"issue_id":"clack-m8q0.5","depends_on_id":"clack-m8q0","type":"parent-child","created_at":"2026-01-23T18:29:01.878881135Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-m8q0.5","depends_on_id":"clack-m8q0.1","type":"blocks","created_at":"2026-01-23T18:29:05.987542512Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-m8q0.5","depends_on_id":"clack-m8q0.2","type":"blocks","created_at":"2026-01-23T18:29:06.054397262Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-m8q0.6","title":"Update generator to use new arrays","description":"Update HotTakeGenerator class to use new array names and template variables. Update metadata tracking accordingly.\n\nAcceptance Criteria:\n- getTemplateVariables() returns hotTakeSubject and hotTakeDevice\n- getCustomMetadata() returns selectedSubject and selectedDevice\n- Instance variables renamed from selectedDomain/selectedAngle\n- JSDoc and comments updated\n\nEstimated Files: src/content/generators/ai/hot-take-generator.ts\n\nDEPENDS ON: Must run AFTER clack-m8q0.3 and clack-m8q0.4 complete, as this issue uses the arrays they create.\n\nRelated Issues: clack-m8q0.3 (creates SUBJECTS array), clack-m8q0.4 (creates DEVICES array)","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-23T18:29:11.748631333Z","created_by":"Ryan Brodkin","updated_at":"2026-01-23T19:38:08.586710554Z","closed_at":"2026-01-23T19:38:08.586710554Z","close_reason":"Closed","dependencies":[{"issue_id":"clack-m8q0.6","depends_on_id":"clack-m8q0","type":"parent-child","created_at":"2026-01-23T18:29:11.749506458Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-m8q0.6","depends_on_id":"clack-m8q0.3","type":"blocks","created_at":"2026-01-23T18:29:17.372935378Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-m8q0.6","depends_on_id":"clack-m8q0.4","type":"blocks","created_at":"2026-01-23T18:29:17.438551128Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-m8q0.7","title":"Update test suite for new structure","description":"Update tests to validate new array sizes, new variable names, and new metadata structure. Add tests for novelty characteristics.\n\nAcceptance Criteria:\n- Tests validate HOT_TAKE_SUBJECTS has 150+ items\n- Tests validate HOT_TAKE_DEVICES has 30+ items\n- Tests check hotTakeSubject and hotTakeDevice template vars\n- Tests check selectedSubject and selectedDevice metadata\n- Tests verify arrays contain no duplicate values\n- Old tests for DOMAINS/ANGLES removed or updated\n\nEstimated Files: tests/unit/content/generators/ai/hot-take-generator.test.ts","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-23T18:29:24.542134381Z","created_by":"Ryan Brodkin","updated_at":"2026-01-23T19:38:08.659392512Z","closed_at":"2026-01-23T19:38:08.659392512Z","close_reason":"Closed","dependencies":[{"issue_id":"clack-m8q0.7","depends_on_id":"clack-m8q0","type":"parent-child","created_at":"2026-01-23T18:29:24.543118631Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-m8q0.7","depends_on_id":"clack-m8q0.3","type":"blocks","created_at":"2026-01-23T18:29:30.893699717Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-m8q0.7","depends_on_id":"clack-m8q0.4","type":"blocks","created_at":"2026-01-23T18:29:30.957197093Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-m8q0.7","depends_on_id":"clack-m8q0.5","type":"blocks","created_at":"2026-01-23T18:29:31.014977093Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-m8q0.7","depends_on_id":"clack-m8q0.6","type":"blocks","created_at":"2026-01-23T18:29:31.084940593Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-mid","title":"[MEDIUM] Fix content-test.test.ts output format assertions","description":"**File:** tests/unit/cli/commands/content-test.test.ts\n**Lines:** 402-527\n**Category:** Doesn't Make Sense\n**Severity:** Medium\n\n## Problem\nMultiple tests (lines 402-433, 435-464, 466-495, 497-527) assert on console output format rather than testing actual validation logic. They check for strings like \"FAILED\" and \"6/5\" rather than testing the validator directly.\n\n## Evidence\n```typescript\nit('should display validation fail status for content with too many lines', async () =\u003e {\n  // ... setup ...\n  expect(output).toMatch(/Status:.*FAILED/);\n  expect(output).toMatch(/Lines:.*6\\/5/);\n  // ← Testing output format, not validation logic!\n});\n```\n\n## Implementation Instructions\n1. **Test validator directly**:\n```typescript\nconst result = validator.validate(content);\nexpect(result.status).toBe('FAILED');\nexpect(result.errors).toContainEqual(\n  expect.objectContaining({ constraint: 'maxLines' })\n);\n```\n2. **Keep one output format test** if needed, but separate from logic tests\n\n## Acceptance Criteria\n- [ ] Validation logic tested directly on validator object\n- [ ] Output format tests separate from logic tests\n- [ ] Tests don't break on minor formatting changes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-29T05:08:31.842604422Z","updated_at":"2026-01-03T22:03:39.578763011Z","closed_at":"2026-01-03T22:03:39.578763011Z","close_reason":"Verified complete - tests refactored with direct assertions and loose matching","labels":["medium","testing"],"dependencies":[{"issue_id":"clack-mid","depends_on_id":"clack-n81p","type":"parent-child","created_at":"2025-11-29T07:01:02.966930547Z","created_by":"daemon"}]}
{"id":"clack-n75i","title":"[MEDIUM] Fix http-client.test.ts constructor default value assertions","description":"**File:** tests/unit/api/vestaboard/http-client.test.ts\n**Lines:** 36-49\n**Category:** Too Brittle\n**Severity:** Medium\n\n## Problem\nThree constructor tests only check `.toBeDefined()` without verifying actual default values. If defaults change silently, tests won't catch it.\n\n## Evidence\n```typescript\nit('should use default baseUrl if not provided', () =\u003e {\n  const defaultClient = new VestaboardHttpClient({ apiKey: 'test' });\n  expect(defaultClient).toBeDefined();  // ← Doesn't verify the actual default URL!\n});\n```\n\n## Implementation Instructions\n1. **Verify actual default values**:\n```typescript\nexpect(defaultClient['baseUrl']).toBe('http://vestaboard.local:7000');\nexpect(defaultClient['timeoutMs']).toBe(5000);\nexpect(defaultClient['maxRetries']).toBe(3);\n```\n2. **Or document why only existence check is needed** if defaults are implementation details\n\n## Acceptance Criteria\n- [ ] Tests verify actual default values, not just existence\n- [ ] Default values match implementation constants\n- [ ] Tests catch unintended default changes","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-11-29T05:08:36.853459966Z","updated_at":"2026-01-03T21:41:47.645866918Z","close_reason":"Verified complete by code review","labels":["medium","testing"],"dependencies":[{"issue_id":"clack-n75i","depends_on_id":"clack-ini3","type":"parent-child","created_at":"2025-11-29T07:01:30.56831992Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-n81p","title":"CLI Test Quality Improvements","description":"Fix CLI test brittleness and missing coverage. Separate concerns between format tests and logic tests.\n\nIncludes:\n- Missing bootstrap mock causing failures\n- Separate output format tests from logic tests\n- Brittle regex section extraction\n- Output format assertions\n- ANSI code assertions cleanup\n- CLI index missing assertions\n- Locale-dependent number formatting","notes":"Created in 2025 - stale issue cleanup","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-11-29T07:00:20.871717055Z","updated_at":"2026-01-23T22:36:28.949985962Z","closed_at":"2026-01-23T22:36:28.949988129Z","dependencies":[{"issue_id":"clack-n81p","depends_on_id":"clack-d719","type":"blocks","created_at":"2025-11-29T07:06:00.232336795Z","created_by":"daemon"}]}
{"id":"clack-n94","title":"Configuration and Type Definitions","description":"Add environment configuration and TypeScript type definitions for Home Assistant integration.","status":"tombstone","priority":0,"issue_type":"epic","created_at":"2025-11-24T00:14:50.550244334Z","updated_at":"2026-01-03T21:41:47.645866918Z","deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"clack-n99z","title":"Novel Insight Generator - AI content on 100+ random intellectual topics","description":"Create an AI prompt generator that produces deeply novel, thought-provoking content on one of 100+ randomly selected topics spanning science, philosophy, culture, and society.\n\n**Scope:**\n- New user prompt file with topic list and style guidance\n- New NovelInsightGenerator class extending AIPromptGenerator\n- Registration in content registry\n- Unit tests\n\n**Constraints:**\n- Full nerd level - can reference specific theories, figures, concepts\n- Three output styles: mind-blown facts, provocative questions, novel connections\n- Exclusions: religion/spirituality, heavy topics (death/doom), current events\n\n**Success Criteria:**\nGenerator produces varied, intellectually stimulating content that fits Vestaboard constraints.","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-05T19:47:00.174513794Z","created_by":"vscode","updated_at":"2026-01-05T21:44:47.205612468Z","closed_at":"2026-01-05T21:44:47.205612468Z","close_reason":"Closed"}
{"id":"clack-n99z.1","title":"Create novel-insight user prompt with 100+ topics","description":"Write prompts/user/novel-insight.txt containing:\n- Instructions for generating novel insights (facts, questions, or connections)\n- Full topic list organized by category (100+ topics across 16 sub-categories)\n- Style guidance matching 'full nerd' level\n- Exclusion rules (no religion, heavy topics, current events)\n\n**Acceptance Criteria:**\n- Prompt file exists at prompts/user/novel-insight.txt\n- Contains 100+ distinct topics across 16 sub-categories\n- Three output styles documented (fact, question, connection)\n- Tone aligns with Houseboy persona (cheeky, never mean)\n\n**Files:** prompts/user/novel-insight.txt\n\n**Parallel Group:** A (can run with Unit 2)\n\n**Related:**\n- clack-n99z.2 (generator class that uses this prompt)\n- clack-n99z.4 (tests reference this prompt file path)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T19:47:13.447091758Z","created_by":"vscode","updated_at":"2026-01-05T21:44:47.119851009Z","closed_at":"2026-01-05T21:44:47.119851009Z","close_reason":"Closed","dependencies":[{"issue_id":"clack-n99z.1","depends_on_id":"clack-n99z","type":"parent-child","created_at":"2026-01-05T19:47:13.453778008Z","created_by":"vscode"}]}
{"id":"clack-n99z.2","title":"Implement NovelInsightGenerator class","description":"Create generator class following existing patterns (e.g., ShowerThoughtGenerator).\n\n**Implementation:**\n- Class extends AIPromptGenerator\n- Uses MEDIUM tier (more complex reasoning than shower thoughts)\n- Returns correct prompt file paths (major-update-base.txt, novel-insight.txt)\n\n**Acceptance Criteria:**\n- Class exists at src/content/generators/ai/novel-insight-generator.ts\n- Extends AIPromptGenerator correctly\n- Uses ModelTier.MEDIUM\n- Exports from generators index\n\n**Files:** src/content/generators/ai/novel-insight-generator.ts\n\n**Parallel Group:** A (can run with Unit 1)\n**Related:** clack-n99z.1 (prompt file this generator uses)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T19:47:20.946596512Z","created_by":"vscode","updated_at":"2026-01-05T21:44:47.146569884Z","closed_at":"2026-01-05T21:44:47.146569884Z","close_reason":"Closed","dependencies":[{"issue_id":"clack-n99z.2","depends_on_id":"clack-n99z","type":"parent-child","created_at":"2026-01-05T19:47:20.953792304Z","created_by":"vscode"}]}
{"id":"clack-n99z.3","title":"Register generator and export from index","description":"Add generator to content registry and ensure proper exports.\n\n**Implementation:**\n- Register in register-core.ts with P2 (NORMAL) priority\n- Export from src/content/generators/ai/index.ts\n- Verify appears in content:list command output\n\n**Acceptance Criteria:**\n- Generator registered in register-core.ts with P2 priority\n- Exported from src/content/generators/ai/index.ts\n- Appears in 'npm run content:list' output\n\n**Files:**\n- src/content/registry/register-core.ts\n- src/content/generators/ai/index.ts\n\n**Blocked By:** clack-n99z.1, clack-n99z.2 (needs both prompt and class to exist)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T19:47:27.282540167Z","created_by":"vscode","updated_at":"2026-01-05T21:44:47.167493509Z","closed_at":"2026-01-05T21:44:47.167493509Z","close_reason":"Closed","dependencies":[{"issue_id":"clack-n99z.3","depends_on_id":"clack-n99z","type":"parent-child","created_at":"2026-01-05T19:47:27.289746126Z","created_by":"vscode"},{"issue_id":"clack-n99z.3","depends_on_id":"clack-n99z.1","type":"blocks","created_at":"2026-01-05T19:47:41.057719507Z","created_by":"vscode"},{"issue_id":"clack-n99z.3","depends_on_id":"clack-n99z.2","type":"blocks","created_at":"2026-01-05T19:47:41.075345507Z","created_by":"vscode"}]}
{"id":"clack-n99z.4","title":"Write unit tests for NovelInsightGenerator","description":"Unit tests following existing patterns (e.g., shower-thought-generator.test.ts).\n\n**Test Coverage:**\n- Tests generator instantiation\n- Tests getSystemPromptFile() returns 'major-update-base.txt'\n- Tests getUserPromptFile() returns 'novel-insight.txt'\n- Tests model tier is MEDIUM\n- Integration with mocked AI provider\n\n**Acceptance Criteria:**\n- Test file exists at tests/unit/content/generators/novel-insight-generator.test.ts\n- All tests pass\n- 80%+ coverage on new code\n\n**Files:** tests/unit/content/generators/novel-insight-generator.test.ts\n\n**Blocked By:** clack-n99z.2 (needs generator class to test)\n**Related:** clack-n99z.1 (prompt file referenced in tests)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T19:47:35.207954213Z","created_by":"vscode","updated_at":"2026-01-05T21:44:47.185849009Z","closed_at":"2026-01-05T21:44:47.185849009Z","close_reason":"Closed","dependencies":[{"issue_id":"clack-n99z.4","depends_on_id":"clack-n99z","type":"parent-child","created_at":"2026-01-05T19:47:35.213405005Z","created_by":"vscode"},{"issue_id":"clack-n99z.4","depends_on_id":"clack-n99z.2","type":"blocks","created_at":"2026-01-05T19:47:41.100679966Z","created_by":"vscode"}]}
{"id":"clack-nggs","title":"[LOW] Remove tautological assertion in vestaboard-live.test.ts","description":"**File:** tests/integration/api/vestaboard-live.test.ts\n**Lines:** 45-51\n**Category:** Does Nothing\n**Severity:** Low\n\n## Problem\nTest \"should send text message to Vestaboard\" has tautological assertion `expect(true).toBe(true)` that always passes regardless of actual behavior.\n\n## Evidence\n```typescript\nit('should send text message to Vestaboard', async () =\u003e {\n  await client.sendText('LIVE TEST\\nFROM JEST');\n  expect(true).toBe(true);  // ← Always passes!\n  console.log('Text message sent successfully');\n});\n```\n\n## Implementation Instructions\n1. **Remove the expect()** entirely - test passes if no error thrown\n2. **Or assert on response** if API returns status info\n3. **Or use expect().resolves.not.toThrow()** for clarity\n\n## Acceptance Criteria\n- [ ] No tautological assertions\n- [ ] Test documents intent clearly (pass if no error)\n- [ ] Or meaningful assertion on API response","status":"tombstone","priority":3,"issue_type":"task","created_at":"2025-11-29T05:09:25.270252377Z","updated_at":"2026-01-03T21:41:47.645866918Z","close_reason":"Verified complete by code review","labels":["low","testing"],"dependencies":[{"issue_id":"clack-nggs","depends_on_id":"clack-ini3","type":"parent-child","created_at":"2025-11-29T07:01:40.743347134Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-nlf","title":"[HIGH] Fix info-bar.test.ts timezone-dependent assertions","description":"**File:** tests/unit/content/frame/info-bar.test.ts\n**Lines:** 194-226\n**Category:** Too Brittle\n**Severity:** High\n\n## Problem\nTests hardcode expectations for Pacific timezone conversion (17:05 UTC → 09:05). If tests run on a machine in a different timezone or if timezone handling changes, tests will fail.\n\n## Evidence\n```typescript\nit('should return 24-hour format with leading zeros', () =\u003e {\n  const data: InfoBarData = {\n    dateTime: new Date('2024-11-26T17:05:00Z'),  // UTC\n  };\n  const result = formatInfoBar(data);\n  const timePortion = codesToString(result.slice(10, 15));\n  expect(timePortion).toBe('09:05');  // ← Assumes Pacific timezone!\n});\n```\n\n## Implementation Instructions\n1. **Mock the timezone utility** to return predictable results\n2. OR **Use relative timezone assertions** instead of hardcoded times\n3. OR **Set timezone in test environment** explicitly\n\n## Acceptance Criteria\n- [ ] Tests pass regardless of machine timezone\n- [ ] Timezone conversion is either mocked or explicitly set\n- [ ] No hardcoded timezone-specific expected values","status":"tombstone","priority":1,"issue_type":"bug","created_at":"2025-11-29T05:07:08.249627092Z","updated_at":"2026-01-03T21:41:47.645866918Z","close_reason":"Verified complete by code review","labels":["high","testing"],"dependencies":[{"issue_id":"clack-nlf","depends_on_id":"clack-s9o","type":"parent-child","created_at":"2025-11-29T05:09:59.741742963Z","created_by":"daemon"},{"issue_id":"clack-nlf","depends_on_id":"clack-rokx","type":"parent-child","created_at":"2025-11-29T07:01:04.063526547Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"bug"}
{"id":"clack-nltc","title":"Fix Failing Unit and Integration Tests","description":"Multiple test files are failing because they call bootstrap() which requires Vestaboard configuration that isn't properly mocked. 25 tests failing across 3 test files.","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-03T22:47:50.568013169Z","created_by":"vscode","updated_at":"2026-01-04T00:54:11.817823386Z","closed_at":"2026-01-04T00:54:11.817823386Z","close_reason":"All 25 tests fixed and merged to main"}
{"id":"clack-nsx","title":"Create Factory Function and Public API","description":"Implement factory function to create configured Vestaboard clients, following the existing AI provider pattern. Creates index.ts as the public API entry point.","design":"## Factory Pattern (Consistent with AI Providers)\nReference: src/api/ai/index.ts\n\nFactory creates:\n1. HTTP client from config\n2. Character converter (default implementation)\n3. Vestaboard client with injected dependencies\n\n## Public API Exports\n- createVestaboardClient() factory\n- All interfaces (VestaboardSender, etc.)\n- All error types\n- Helper functions if needed","acceptance_criteria":"- src/api/vestaboard/index.ts created\n- createVestaboardClient(config: VestaboardConfig): VestaboardClient factory function\n- Factory instantiates HTTP client from config\n- Factory creates default character converter\n- Factory injects both into VestaboardClient\n- Config validation in factory\n- Re-exports all public interfaces and types\n- Re-exports all error classes\n- Re-exports character converter functions for testing\n- Pattern matches src/api/ai/index.ts structure","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-11-26T05:24:49.130064294Z","updated_at":"2026-01-03T21:41:47.645866918Z","close_reason":"Verified complete by code review","dependencies":[{"issue_id":"clack-nsx","depends_on_id":"clack-745","type":"blocks","created_at":"2025-11-26T05:24:49.131215627Z","created_by":"daemon"},{"issue_id":"clack-nsx","depends_on_id":"clack-z37n","type":"parent-child","created_at":"2025-11-29T07:01:17.108897595Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-nux","title":"Task 4.1: Create ContentRegistry singleton class","description":"Create src/content/registry/content-registry.ts with singleton pattern for registering and managing content generators.","acceptance_criteria":"- Singleton getInstance() pattern\n- register(registration, generator) method\n- unregister(id) method\n- getAll(), getById(), getByPriority(), getByEventPattern() methods\n- Map-based storage\n- Unit tests with 80%+ coverage","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-11-26T22:16:05.935569335Z","updated_at":"2026-01-03T21:41:47.645866918Z","dependencies":[{"issue_id":"clack-nux","depends_on_id":"clack-4lg","type":"parent-child","created_at":"2025-11-26T22:16:15.123065714Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-nzc","title":"[CRITICAL] Fix ai-prompt-generator.test.ts provider failover test","description":"**File:** tests/unit/content/generators/ai-prompt-generator.test.ts\n**Lines:** 388-407\n**Category:** Doesn't make sense\n**Severity:** Critical\n\n## Problem\nTest \"should throw error when all providers fail\" (lines 388-407) doesn't actually test provider failover. It mocks getAlternate to return null, then expects an error, but the error is from the provider factory not being implemented (line 139-143). This tests the broken test implementation, not actual failover behavior.\n\n## Evidence\n```typescript\nit('should throw error when all providers fail', async () =\u003e {\n  // Mock getAlternate to return null\n  jest.spyOn(generator, 'getAlternate').mockReturnValue(null);\n  \n  // Expects error - but it's from \"Provider factory not implemented\"\n  await expect(generator.generate(mockContext)).rejects.toThrow();\n});\n```\n\n## Implementation Instructions\n1. **Create proper failover test** - Mock primary provider to throw a retriable error (RateLimitError)\n2. **Mock alternate provider** - Either return a working alternate OR null to test exhaustion\n3. **Verify error message** - Assert the error contains information about both providers failing\n4. **Test the failover path** - Verify getAlternate was called after primary failed\n\n## Acceptance Criteria\n- [ ] Primary provider mock throws RateLimitError or AuthenticationError\n- [ ] Test verifies getAlternate() was called\n- [ ] When alternate is null, error message indicates all providers exhausted\n- [ ] When alternate also fails, error contains both failure reasons\n- [ ] Test does NOT rely on \"Provider factory not implemented\" error","status":"tombstone","priority":1,"issue_type":"bug","created_at":"2025-11-29T05:05:57.856178753Z","updated_at":"2026-01-03T21:41:47.645866918Z","labels":["critical","testing"],"dependencies":[{"issue_id":"clack-nzc","depends_on_id":"clack-s9o","type":"parent-child","created_at":"2025-11-29T05:09:49.392894597Z","created_by":"daemon"},{"issue_id":"clack-nzc","depends_on_id":"clack-10tc","type":"parent-child","created_at":"2025-11-29T07:00:35.753057173Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"bug"}
{"id":"clack-o57s","title":"Add Beads reference requirement to commitlint","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-22T21:50:58.592873339Z","created_by":"Ryan Brodkin","updated_at":"2026-01-22T21:52:07.401650427Z","closed_at":"2026-01-22T21:52:07.401650427Z","close_reason":"Implemented custom commitlint plugin requiring clack-* refs"}
{"id":"clack-o5st","title":"Replace private property access patterns","description":"Multiple test files use object['privateProp'] to access private/protected TypeScript members. This is brittle - tests break when internal implementation changes. Refactor to test through public interfaces only. If internal state must be verified, consider adding test-only getters or redesigning. Acceptance: No bracket notation for private access.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T21:03:41.794316966Z","created_by":"vscode","updated_at":"2026-01-11T21:17:15.691549593Z","closed_at":"2026-01-11T21:17:15.691549593Z","close_reason":"Merged into clack-lwca to avoid file overlap conflicts","dependencies":[{"issue_id":"clack-o5st","depends_on_id":"clack-82ep","type":"parent-child","created_at":"2026-01-11T21:04:05.427008963Z","created_by":"vscode"}]}
{"id":"clack-o8l","title":"Add SQLiteDatabase.resetSharedInstance() call in test teardown","description":"The SQLiteDatabase singleton should be reset between test suites to prevent potential memory leaks in long test runs.\n\n**Location:** `tests/setup/jest.setup.ts`\n\n**Implementation:**\nAdd an `afterAll` hook that calls `SQLiteDatabase.resetSharedInstance()` to properly clean up the shared in-memory database after all tests complete.","status":"tombstone","priority":3,"issue_type":"chore","created_at":"2025-11-28T08:52:31.093042804Z","updated_at":"2026-01-03T21:41:47.645866918Z","deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"chore"}
{"id":"clack-od7z","title":"[INFRA] Update Jest config - ignore ./trees and add thresholds","description":"**Category:** Testing Infrastructure\n**Priority:** High\n\n## Problem\n1. **Worktree test pollution**: When running `npm test` from project root, Jest may discover and run tests inside `./trees/` worktrees, causing duplicate test execution and potential conflicts.\n\n2. **No per-directory coverage thresholds**: Critical paths like generators have same threshold as utility code.\n\n3. **No slow test warnings**: No visibility into tests that take too long.\n\n## Implementation\n\nUpdate `jest.config.cjs`:\n```javascript\nmodule.exports = {\n  // ... existing config ...\n\n  // CRITICAL: Ignore worktree directories to prevent duplicate test runs\n  testPathIgnorePatterns: [\n    '/node_modules/',\n    '/dist/',\n    '/trees/',           // ← ADD: Ignore all worktrees\n    '/.beads/',          // ← ADD: Ignore beads database\n  ],\n\n  // Also ignore worktrees for coverage collection\n  coveragePathIgnorePatterns: [\n    '/node_modules/',\n    '/dist/',\n    '/trees/',           // ← ADD\n    '/__mocks__/',       // ← ADD: Don't count mocks toward coverage\n    '/__fixtures__/',    // ← ADD: Don't count fixtures\n  ],\n\n  // Warn on slow tests\n  slowTestThreshold: 5,  // ← ADD: Warn if test takes \u003e 5 seconds\n\n  // Per-directory coverage thresholds\n  coverageThreshold: {\n    global: {\n      branches: 80,\n      functions: 80,\n      lines: 80,\n      statements: 80,\n    },\n    // Higher threshold for critical paths\n    './src/content/generators/': {\n      branches: 85,\n      functions: 85,\n      lines: 85,\n    },\n    // Lower threshold for type definitions (mostly interfaces)\n    './src/types/': {\n      branches: 50,\n      functions: 50,\n    },\n  },\n};\n```\n\n## Verification\n```bash\n# Verify ./trees is ignored\nnpm test -- --listTests | grep -c \"trees/\"\n# Should output: 0\n\n# Verify worktree tests not executed\ncd trees/some-worktree \u0026\u0026 npm test  # Still works within worktree\ncd ../.. \u0026\u0026 npm test                 # Ignores trees/ directory\n```\n\n## Acceptance Criteria\n- [ ] `./trees/` added to testPathIgnorePatterns\n- [ ] `./trees/` added to coveragePathIgnorePatterns\n- [ ] slowTestThreshold configured\n- [ ] Per-directory coverage thresholds added\n- [ ] Verified tests in ./trees/ not executed from root","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-11-29T05:16:43.544285428Z","updated_at":"2026-01-03T21:41:47.645866918Z","labels":["configuration","infrastructure","testing"],"dependencies":[{"issue_id":"clack-od7z","depends_on_id":"clack-s9o","type":"parent-child","created_at":"2025-11-29T05:17:02.541477214Z","created_by":"daemon"},{"issue_id":"clack-od7z","depends_on_id":"clack-d719","type":"parent-child","created_at":"2025-11-29T07:00:34.930738089Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-odi","title":"Update TextLayoutFormatter to Use Character Converter","description":"Integrate character converter into TextLayoutFormatter to populate characterCodes field in VestaboardLayout. Updates existing formatter stub with real implementation.","design":"## Integration Points\nCurrent: src/content/formatters/text-layout.ts (stub)\n\nChanges needed:\n1. Inject character converter via constructor\n2. Use converter in format() method\n3. Populate layout.characterCodes field\n4. Keep text wrapping and centering logic\n\n## Dependency Injection\nConstructor receives CharacterConverter (or use default from factory)","acceptance_criteria":"- src/content/formatters/text-layout.ts updated\n- Constructor accepts CharacterConverter parameter (optional, defaults to factory-created)\n- format() method uses converter.layoutToCharacterCodes()\n- VestaboardLayout.characterCodes field populated\n- Text wrapping logic implemented (22 chars max per row)\n- Text centering logic works with centerText() helper\n- 6-row limit enforced\n- All existing tests updated to use character converter\n- New tests added for characterCodes population\n- Integration with ContentGenerator works\n- 80%+ test coverage maintained","notes":"3-char identifier cleanup","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-26T05:26:10.097983471Z","updated_at":"2026-01-23T22:36:20.299197792Z","closed_at":"2026-01-23T22:36:20.299210042Z","dependencies":[{"issue_id":"clack-odi","depends_on_id":"clack-u7h","type":"blocks","created_at":"2025-11-26T05:26:10.099746846Z","created_by":"daemon"},{"issue_id":"clack-odi","depends_on_id":"clack-nsx","type":"blocks","created_at":"2025-11-26T05:26:10.100602596Z","created_by":"daemon"},{"issue_id":"clack-odi","depends_on_id":"clack-z37n","type":"parent-child","created_at":"2025-11-29T07:01:17.678082887Z","created_by":"daemon"}]}
{"id":"clack-ofzp","title":"Server and Web Test Quality","description":"Fix server and web-related test quality issues.\n\nIncludes:\n- server.test.ts brittle middleware order assertions (HIGH)\n- push.test.ts non-functional VAPID key test (HIGH)\n- pushService.test.ts mock return value tests (LOW)\n- web route tests inconsistent function signatures (LOW)","notes":"Created in 2025 - stale issue cleanup","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-11-29T07:00:21.594573264Z","updated_at":"2026-01-23T22:36:28.942123004Z","closed_at":"2026-01-23T22:36:28.942125712Z","dependencies":[{"issue_id":"clack-ofzp","depends_on_id":"clack-d719","type":"blocks","created_at":"2025-11-29T07:06:00.68563842Z","created_by":"daemon"}]}
{"id":"clack-ok2i","title":"Pad single-digit dates to two digits in info bar","description":"## Summary\nThe bottom line of the Vestaboard display shows dates without left-padding single digits. For example, November 5th displays as \"5NOV\" instead of \"05NOV\".\n\n## Root Cause\nThe `reformatDateMonth()` function in `src/content/frame/info-bar.ts` returns `${day}${month}` without padding the day to 2 digits.\n\n## Solution\nAdd `padStart(2, '0')` to the day portion in the return statement.\n\n## Files\n- `src/content/frame/info-bar.ts` (line 75)\n- `tests/unit/content/frame/info-bar.test.ts` (line 179 - update test expectation)\n\n## Acceptance Criteria\n- [ ] Single-digit dates display as \"01NOV\" through \"09NOV\"\n- [ ] Double-digit dates unchanged (\"10NOV\" through \"31NOV\")\n- [ ] Test updated to expect \"01NOV \" instead of \"1NOV \"\n- [ ] All existing info-bar tests pass","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-04T07:00:59.235998544Z","created_by":"vscode","updated_at":"2026-01-04T08:38:38.602127298Z","closed_at":"2026-01-04T08:38:38.602127298Z","close_reason":"Fixed in commit 9ca2df8. Single-digit dates now display with leading zeros (05NOV instead of 5NOV)."}
{"id":"clack-op6k","title":"VestaboardPreview dual model support","description":"Update VestaboardPreview component to support both black and white Vestaboard models. Black model: off-black board, near-black flaps, white text. White model: off-white board, near-white flaps, dark text. Model determined by VESTABOARD_MODEL env var exposed via new API endpoint.\n\n## Execution Order for Orchestrator\n\n**Parallel Group 1** (no dependencies - start immediately):\n- clack-op6k.1: Create backend config API endpoint\n- clack-op6k.2: Add model prop and dual-color styling to VestaboardPreview\n\n**Parallel Group 2** (after Group 1 partial completion):\n- clack-op6k.3: Add apiClient method (after .1 completes)\n- clack-op6k.5: Update VestaboardPreview tests (after .2 completes)\n\n**Group 3** (after Group 2 + .2 complete):\n- clack-op6k.4: Update Welcome and History pages (requires both .2 and .3)\n\n## Critical Path\nclack-op6k.1 → clack-op6k.3 → clack-op6k.4 (API pipeline)","status":"closed","priority":2,"issue_type":"epic","owner":"ryan@spice.cc","created_at":"2026-01-22T21:47:47.784233418Z","created_by":"Ryan Brodkin","updated_at":"2026-01-22T23:35:19.078902542Z","closed_at":"2026-01-22T23:35:19.078902542Z","close_reason":"Merged to main: VestaboardPreview dual model support + legacy interface cleanup"}
{"id":"clack-op6k.1","title":"Create backend config API endpoint","description":"Create new /api/config/vestaboard endpoint that returns the current board model from config.\n\nAcceptance Criteria:\n- New route handler at src/web/routes/config.ts\n- GET /api/config/vestaboard returns { model: 'black' | 'white' }\n- Route registered in server setup\n- Unit test for endpoint\n\nFiles: src/web/routes/config.ts (new), src/web/server.ts, tests/unit/web/routes/config.test.ts (new)","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-22T21:47:56.386963922Z","created_by":"Ryan Brodkin","updated_at":"2026-01-22T23:35:19.039819042Z","closed_at":"2026-01-22T23:35:19.039819042Z","close_reason":"Merged to main: VestaboardPreview dual model support + legacy interface cleanup","dependencies":[{"issue_id":"clack-op6k.1","depends_on_id":"clack-op6k","type":"parent-child","created_at":"2026-01-22T21:47:56.38782363Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-op6k.2","title":"Add model prop and dual-color styling to VestaboardPreview","description":"Update VestaboardPreview component to accept model prop and apply appropriate color scheme.\n\nAcceptance Criteria:\n- Add model?: 'black' | 'white' prop (defaults to 'black')\n- Black model: off-black board background (#0a0a0a), near-black flaps (#1a1a1a), white text (#ffffff)\n- White model: off-white board background (#f5f5f5), near-white flaps (#e8e8e8), dark text (#1a1a1a)\n- Use cn() helper for conditional class application\n- Flaps must have visible contrast against board background\n\nFiles: src/web/frontend/components/VestaboardPreview.tsx","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-22T21:47:57.909856464Z","created_by":"Ryan Brodkin","updated_at":"2026-01-22T23:35:19.053557334Z","closed_at":"2026-01-22T23:35:19.053557334Z","close_reason":"Merged to main: VestaboardPreview dual model support + legacy interface cleanup","dependencies":[{"issue_id":"clack-op6k.2","depends_on_id":"clack-op6k","type":"parent-child","created_at":"2026-01-22T21:47:57.914287006Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-op6k.3","title":"Add apiClient method to fetch board config","description":"Add method to apiClient to fetch Vestaboard model configuration.\n\nAcceptance Criteria:\n- New getVestaboardConfig() method returns { model: 'black' | 'white' }\n- Proper TypeScript typing\n- Error handling follows existing patterns\n\nFiles: src/web/frontend/services/apiClient.ts","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-22T21:48:06.181150176Z","created_by":"Ryan Brodkin","updated_at":"2026-01-22T23:35:19.060802917Z","closed_at":"2026-01-22T23:35:19.060802917Z","close_reason":"Merged to main: VestaboardPreview dual model support + legacy interface cleanup","dependencies":[{"issue_id":"clack-op6k.3","depends_on_id":"clack-op6k","type":"parent-child","created_at":"2026-01-22T21:48:06.186580551Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-op6k.3","depends_on_id":"clack-op6k.1","type":"blocks","created_at":"2026-01-22T21:48:17.356713876Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-op6k.4","title":"Update Welcome and History pages to use model config","description":"Fetch board config on page load and pass model to VestaboardPreview.\n\nAcceptance Criteria:\n- Welcome.tsx fetches config and passes model prop\n- History.tsx fetches config and passes model prop\n- Loading state handled gracefully (default to 'black' while loading)\n- Config cached or shared via context if needed\n\nFiles: src/web/frontend/pages/Welcome.tsx, src/web/frontend/pages/History.tsx","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-22T21:48:07.649542594Z","created_by":"Ryan Brodkin","updated_at":"2026-01-22T23:35:19.065701584Z","closed_at":"2026-01-22T23:35:19.065701584Z","close_reason":"Merged to main: VestaboardPreview dual model support + legacy interface cleanup","dependencies":[{"issue_id":"clack-op6k.4","depends_on_id":"clack-op6k","type":"parent-child","created_at":"2026-01-22T21:48:07.660762469Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-op6k.4","depends_on_id":"clack-op6k.2","type":"blocks","created_at":"2026-01-22T21:48:18.840545168Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-op6k.4","depends_on_id":"clack-op6k.3","type":"blocks","created_at":"2026-01-22T21:48:19.64382296Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-op6k.5","title":"Update VestaboardPreview tests for dual model support","description":"Update test file to cover both black and white model rendering.\n\nAcceptance Criteria:\n- Test default (black) model styling\n- Test explicit black model prop\n- Test white model prop with correct colors\n- Remove hardcoded bg-black expectations, use model-aware assertions\n\nFiles: tests/web/components/VestaboardPreview.test.tsx","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-22T21:48:09.588515678Z","created_by":"Ryan Brodkin","updated_at":"2026-01-22T23:35:19.074385334Z","closed_at":"2026-01-22T23:35:19.074385334Z","close_reason":"Merged to main: VestaboardPreview dual model support + legacy interface cleanup","dependencies":[{"issue_id":"clack-op6k.5","depends_on_id":"clack-op6k","type":"parent-child","created_at":"2026-01-22T21:48:09.591634053Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-op6k.5","depends_on_id":"clack-op6k.2","type":"blocks","created_at":"2026-01-22T21:48:21.038298044Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-p160","title":"Refactor circuit-breaker-repo.test.ts to use beforeAll/afterAll pattern","description":"Fix flaky test by refactoring database connection lifecycle from beforeEach/afterEach to beforeAll/afterAll pattern per project standards.\n\n**Location:** tests/unit/storage/repositories/circuit-breaker-repo.test.ts\n\n**Problem:** Test uses beforeEach to reset and recreate database connections for every test (~34 tests), causing timeout failures under load due to connection pool exhaustion.\n\n**Acceptance Criteria:**\n- [ ] Connection setup (resetKnexInstance, getKnexInstance) moved to beforeAll\n- [ ] Table creation logic moved to beforeAll\n- [ ] beforeEach only contains data cleanup and repository instantiation\n- [ ] afterEach for connection close moved to afterAll\n- [ ] All tests pass without timeout errors\n\n**Reference:** tests/unit/storage/models/content.test.ts","status":"closed","priority":2,"issue_type":"bug","owner":"ryan@spice.cc","created_at":"2026-01-22T03:28:05.821115918Z","created_by":"Ryan Brodkin","updated_at":"2026-01-22T05:00:02.234631971Z","closed_at":"2026-01-22T05:00:02.234631971Z","close_reason":"Refactored circuit-breaker-repo.test.ts to use beforeAll/afterAll pattern per project standards. All 34 tests pass, 100% coverage on target file."}
{"id":"clack-p2al","title":"Fix db-migrate.test.ts test expectations","status":"closed","priority":2,"issue_type":"bug","owner":"ryan@spice.cc","created_at":"2026-01-22T21:18:53.941459129Z","created_by":"Ryan Brodkin","updated_at":"2026-01-22T21:20:08.362560803Z","closed_at":"2026-01-22T21:20:08.362560803Z","close_reason":"Fixed test expectations to match implementation"}
{"id":"clack-p30","title":"Add Error Handling and Logging","description":"Define error types, add comprehensive logging for connection/events/errors, handle auth and network failures gracefully.","acceptance_criteria":"- Error types defined (AuthenticationError, ConnectionError, etc.)\n- Comprehensive logging (connection, events, errors)\n- Authentication failure handling\n- Network error handling\n- Debug logging option\n- Error scenarios documented","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-11-24T00:18:48.722613166Z","updated_at":"2026-01-03T21:41:47.645866918Z","dependencies":[{"issue_id":"clack-p30","depends_on_id":"clack-ar9","type":"blocks","created_at":"2025-11-24T00:19:59.323888546Z","created_by":"daemon"},{"issue_id":"clack-p30","depends_on_id":"clack-iwr","type":"blocks","created_at":"2025-11-24T00:20:00.37478313Z","created_by":"daemon"},{"issue_id":"clack-p30","depends_on_id":"clack-2w5","type":"blocks","created_at":"2025-11-24T00:20:01.486984381Z","created_by":"daemon"},{"issue_id":"clack-p30","depends_on_id":"clack-0nr","type":"parent-child","created_at":"2025-11-24T04:19:17.240498424Z","created_by":"vscode"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-p3ud","title":"circuit.test.ts has 4 failing timer-based tests blocking pre-commit","description":"Four tests in tests/unit/cli/commands/circuit.test.ts are timing out:\n\n1. 'respects interval option' (line 469)\n2. 'multiple refresh cycles work correctly' (line 529)\n3. 'detects and highlights state changes' (line 565)\n4. 'uses default interval of 2000ms when not specified' (line 594)\n\nAll failures are in the circuitWatchCommand describe block and timeout after 5 seconds.\n\nError: 'Exceeded timeout of 5000 ms for a test'\n\nImpact: Blocks git pre-commit hooks, preventing commits even for unrelated changes.\n\nReproduction:\nnpm test -- tests/unit/cli/commands/circuit.test.ts\n\nExpected: 25/25 tests pass\nActual: 21 pass, 4 fail with timeout errors\n\nRoot Cause: Likely improper jest.advanceTimersByTimeAsync() usage in async timer tests.\n\nFiles: tests/unit/cli/commands/circuit.test.ts","status":"open","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-26T07:21:25.768190679Z","created_by":"Ryan Brodkin","updated_at":"2026-01-26T07:21:39.038978713Z"}
{"id":"clack-pcq","title":"Configure frameless PWA with push notification support","description":"Transform the React app into a Progressive Web App with standalone/frameless display mode, offline capability, and push notification support for content updates.","design":"**Web App Manifest (manifest.json):**\n- display: \"standalone\" (frameless, no browser chrome)\n- orientation: \"portrait\"\n- theme_color and background_color matching app theme\n- App icons (192x192, 512x512, maskable)\n- shortcuts for quick actions\n- start_url: \"/\"\n\n**Service Worker:**\n- Use Vite PWA plugin (vite-plugin-pwa)\n- Workbox for caching strategies\n- Cache static assets (offline-first)\n- Network-first for API calls\n- Background sync for failed votes\n\n**Push Notifications:**\n- Web Push API with VAPID keys\n- Backend: POST /api/notifications/subscribe\n- Backend: POST /api/notifications/send (admin)\n- Notification types: new content, vote reminders\n- Permission request flow (non-intrusive)\n- Notification click handlers (open app to relevant page)\n\n**iOS Support:**\n- apple-mobile-web-app-capable meta tag\n- apple-mobile-web-app-status-bar-style: \"black-translucent\"\n- apple-touch-icon links\n- splash screen images\n\n**Android Support:**\n- Maskable icons for adaptive icon support\n- Install prompt handling (beforeinstallprompt)\n- Custom install UI\n\n**Backend Endpoints:**\n- POST /api/push/subscribe - Store push subscription\n- POST /api/push/unsubscribe - Remove subscription\n- POST /api/push/send - Send notification (admin)\n- Store subscriptions in database (new PushSubscription model)","acceptance_criteria":"- [ ] manifest.json configured with standalone display mode\n- [ ] App icons generated (192x192, 512x512, maskable)\n- [ ] Service worker registers and caches static assets\n- [ ] App works offline (cached pages load)\n- [ ] iOS meta tags for frameless display\n- [ ] Android install prompt handled gracefully\n- [ ] Push notification permission request UI\n- [ ] Backend stores push subscriptions\n- [ ] Push notifications received on mobile devices\n- [ ] Notification click opens app to correct page\n- [ ] \"Add to Home Screen\" works on iOS and Android\n- [ ] App launches without browser chrome (frameless)\n- [ ] Lighthouse PWA audit passes\n- [ ] Unit tests for service worker registration\n- [ ] 80%+ test coverage for new code","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-11-26T05:08:25.820341339Z","updated_at":"2026-01-03T21:41:47.645866918Z","labels":["pwa","ui","web"],"dependencies":[{"issue_id":"clack-pcq","depends_on_id":"clack-dor","type":"parent-child","created_at":"2025-11-26T05:08:32.295512384Z","created_by":"daemon"},{"issue_id":"clack-pcq","depends_on_id":"clack-ias","type":"blocks","created_at":"2025-11-26T05:08:32.397612634Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-pds","title":"Expose prompts in GeneratedContent metadata","description":"Add systemPrompt and userPrompt fields to GeneratedContent metadata so the content:test CLI can display what was sent to the LLM.","design":"1. Update src/types/content-generator.ts - add to GenerationMetadata:\n   - systemPrompt?: string\n   - userPrompt?: string\n\n2. Update src/content/generators/ai-prompt-generator.ts - in generate() return:\n   - Include systemPrompt and formatted userPrompt in metadata","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2025-11-27T20:03:11.97062255Z","updated_at":"2026-01-03T21:41:47.645866918Z","dependencies":[{"issue_id":"clack-pds","depends_on_id":"clack-foo","type":"parent-child","created_at":"2025-11-27T20:03:23.26776418Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature"}
{"id":"clack-phm2","title":"Sleep mode output spacing refinement","description":"Limit sleep mode greeting to exactly 2 lines and insert blank row between text lines to create negative space for starfield background visibility.","status":"closed","priority":2,"issue_type":"epic","owner":"dev@container.local","created_at":"2026-01-19T21:36:33.450065302Z","created_by":"Dev Container","updated_at":"2026-01-19T22:32:42.344555541Z","closed_at":"2026-01-19T22:32:42.344555541Z","close_reason":"Merged to main: sleep mode now uses exactly 2 lines with blank row spacing between them"}
{"id":"clack-phm2.1","title":"Update sleep greeting prompt to enforce 2 lines","description":"Change sleep-greeting.txt prompt constraints from '2-3 lines' to 'exactly 2 lines'. Update examples to show only 2-line outputs.\n\nAcceptance Criteria:\n- Prompt specifies 'exactly 2 lines' instead of '2-3 lines'\n- Examples updated to show 2-line formats only\n- Instructions emphasize brevity and negative space concept\n\nFiles: prompts/user/sleep-greeting.txt","status":"closed","priority":2,"issue_type":"task","owner":"dev@container.local","created_at":"2026-01-19T21:36:40.36919093Z","created_by":"Dev Container","updated_at":"2026-01-19T22:32:42.32435525Z","closed_at":"2026-01-19T22:32:42.32435525Z","close_reason":"Merged to main: sleep mode now uses exactly 2 lines with blank row spacing between them","dependencies":[{"issue_id":"clack-phm2.1","depends_on_id":"clack-phm2","type":"parent-child","created_at":"2026-01-19T21:36:40.370384638Z","created_by":"Dev Container"}]}
{"id":"clack-phm2.2","title":"Modify text overlay for blank line spacing","description":"Update overlayText() in SleepModeGenerator to insert a blank row between each text line. For 2 lines of text on a 6-row display, lines should occupy rows 1 and 3 (or 2 and 4) rather than consecutive rows.\n\nAcceptance Criteria:\n- overlayText() calculates row positions with gap between lines\n- For 2 lines: effective vertical span is 3 rows (line + gap + line)\n- Text remains vertically centered with new spacing formula\n- Blank rows between text preserve art pattern (natural behavior)\n\nFiles: src/content/generators/programmatic/sleep-mode-generator.ts","status":"closed","priority":2,"issue_type":"task","owner":"dev@container.local","created_at":"2026-01-19T21:36:40.562217263Z","created_by":"Dev Container","updated_at":"2026-01-19T22:32:42.335633583Z","closed_at":"2026-01-19T22:32:42.335633583Z","close_reason":"Merged to main: sleep mode now uses exactly 2 lines with blank row spacing between them","dependencies":[{"issue_id":"clack-phm2.2","depends_on_id":"clack-phm2","type":"parent-child","created_at":"2026-01-19T21:36:40.562924847Z","created_by":"Dev Container"}]}
{"id":"clack-phm2.3","title":"Update unit tests for new spacing behavior","description":"Update sleep-mode-generator tests to verify the new 2-line limit and blank row spacing between lines.\n\nAcceptance Criteria:\n- Test verifies 2-line greeting is placed with blank row between\n- Test verifies vertical centering accounts for spacing\n- Existing tests updated to match new behavior\n\nFiles: tests/unit/content/generators/sleep-mode-generator.test.ts, tests/unit/content/generators/ai/sleep-greeting-generator.test.ts","status":"closed","priority":2,"issue_type":"task","owner":"dev@container.local","created_at":"2026-01-19T21:36:45.203970876Z","created_by":"Dev Container","updated_at":"2026-01-19T22:32:42.34035475Z","closed_at":"2026-01-19T22:32:42.34035475Z","close_reason":"Merged to main: sleep mode now uses exactly 2 lines with blank row spacing between them","dependencies":[{"issue_id":"clack-phm2.3","depends_on_id":"clack-phm2","type":"parent-child","created_at":"2026-01-19T21:36:45.205060668Z","created_by":"Dev Container"},{"issue_id":"clack-phm2.3","depends_on_id":"clack-phm2.1","type":"blocks","created_at":"2026-01-19T21:36:49.149627378Z","created_by":"Dev Container"},{"issue_id":"clack-phm2.3","depends_on_id":"clack-phm2.2","type":"blocks","created_at":"2026-01-19T21:36:49.196811878Z","created_by":"Dev Container"}]}
{"id":"clack-pll2","title":"Standardize DATABASE_* environment variables across all environments","description":"Standardize on DATABASE_* prefix for all database environment variables. Currently knex.ts and knexfile.ts use DB_* while env.ts, stack.yml, and deployment use DATABASE_*. This causes prod to fall back to SQLite instead of MySQL.","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-04T23:19:36.164638176Z","created_by":"vscode","updated_at":"2026-01-05T01:00:06.158409509Z","closed_at":"2026-01-05T01:00:06.158409509Z","close_reason":"Merged to develop. Production verified working with MySQL."}
{"id":"clack-pll2.1","title":"Create complete index of DB_* usage locations","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-04T23:19:51.740884628Z","created_by":"vscode","updated_at":"2026-01-04T23:21:03.492326717Z","deleted_at":"2026-01-04T23:21:03.492326717Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-pll2.2","title":"Create complete index of DB_* usage locations","description":"Document every file:line where DB_TYPE, DB_HOST, DB_PORT, DB_USER, DB_PASSWORD, DB_NAME appear. Create before/after mapping table.\n\nFiles to check:\n- src/storage/knex.ts (lines 41, 45-49)\n- knexfile.ts (lines 54, 56, 58-62, 67)\n- tests/unit/storage/knex.test.ts (lines 174-201)\n- .env.example (lines 33, 35-41)\n\n---\n[Verification additions]\nACCEPTANCE CRITERIA:\n- [ ] Complete inventory of all DB_* variable locations documented\n- [ ] Before/after mapping table showing DB_* -\u003e DATABASE_* changes\n- [ ] Output saved to issue comment or temporary file\n\nCROSS-REFERENCES:\n- Related: clack-pll2.3 (modifies knex.ts based on this index)\n- Related: clack-pll2.4 (modifies knexfile.ts based on this index)\n- Related: clack-pll2.5 (modifies tests based on this index)\n- Related: clack-pll2.6 (modifies .env.example based on this index)\n\nPARALLEL: Can run independently. Output informs other issues but does not block their implementation (they have explicit line numbers already).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T23:20:00.50140284Z","created_by":"vscode","updated_at":"2026-01-05T20:02:37.199548547Z","closed_at":"2026-01-05T20:02:37.199548547Z","close_reason":"Work completed as part of epic","dependencies":[{"issue_id":"clack-pll2.2","depends_on_id":"clack-pll2","type":"parent-child","created_at":"2026-01-04T23:20:00.507629882Z","created_by":"vscode"}]}
{"id":"clack-pll2.3","title":"Update src/storage/knex.ts to use DATABASE_* prefix","description":"Replace DB_* with DATABASE_* in src/storage/knex.ts production config:\n- process.env.DB_TYPE → process.env.DATABASE_TYPE\n- process.env.DB_HOST → process.env.DATABASE_HOST\n- process.env.DB_PORT → process.env.DATABASE_PORT\n- process.env.DB_USER → process.env.DATABASE_USER\n- process.env.DB_PASSWORD → process.env.DATABASE_PASSWORD (use getSecretOrEnv pattern)\n- process.env.DB_NAME → process.env.DATABASE_NAME\n\n---\n[Verification additions]\nFILES: src/storage/knex.ts (lines 41, 45-49)\n\nACCEPTANCE CRITERIA:\n- [ ] All DB_* references in knex.ts replaced with DATABASE_*\n- [ ] Code compiles without TypeScript errors\n- [ ] Production config still functions with MySQL when DATABASE_TYPE=mysql\n\nCROSS-REFERENCES:\n- Related: clack-pll2.4 (parallel work on knexfile.ts with same pattern)\n- Related: clack-pll2.5 (tests for this code must also be updated)\n\nPARALLEL: Can run in parallel with .4, .5, .6, .7. No file overlap with other issues.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T23:20:00.52686384Z","created_by":"vscode","updated_at":"2026-01-05T20:02:37.264938714Z","closed_at":"2026-01-05T20:02:37.264938714Z","close_reason":"Work completed as part of epic","dependencies":[{"issue_id":"clack-pll2.3","depends_on_id":"clack-pll2","type":"parent-child","created_at":"2026-01-04T23:20:00.527537215Z","created_by":"vscode"}]}
{"id":"clack-pll2.4","title":"Update knexfile.ts to use DATABASE_* prefix","description":"Replace DB_* with DATABASE_* in knexfile.ts production config (lines 54-67):\n- process.env.DB_TYPE → process.env.DATABASE_TYPE (lines 54, 56, 67)\n- process.env.DB_HOST → process.env.DATABASE_HOST (line 58)\n- process.env.DB_PORT → process.env.DATABASE_PORT (line 59)\n- process.env.DB_USER → process.env.DATABASE_USER (line 60)\n- process.env.DB_PASSWORD → process.env.DATABASE_PASSWORD (line 61)\n- process.env.DB_NAME → process.env.DATABASE_NAME (line 62)\n\n---\n[Verification additions]\nFILES: knexfile.ts (lines 54-67)\n\nACCEPTANCE CRITERIA:\n- [ ] All DB_* references in knexfile.ts replaced with DATABASE_*\n- [ ] Code compiles without TypeScript errors\n- [ ] knex migrate:status works in both dev and production configs\n\nCROSS-REFERENCES:\n- Related: clack-pll2.3 (parallel work on knex.ts with same pattern)\n\nPARALLEL: Can run in parallel with .3, .5, .6, .7. No file overlap with other issues.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T23:20:00.54663184Z","created_by":"vscode","updated_at":"2026-01-05T20:02:37.344071214Z","closed_at":"2026-01-05T20:02:37.344071214Z","close_reason":"Work completed as part of epic","dependencies":[{"issue_id":"clack-pll2.4","depends_on_id":"clack-pll2","type":"parent-child","created_at":"2026-01-04T23:20:00.547200674Z","created_by":"vscode"}]}
{"id":"clack-pll2.5","title":"Update tests/unit/storage/knex.test.ts for DATABASE_* vars","description":"Update test environment variable setup/teardown in knex.test.ts to use DATABASE_* prefix instead of DB_*.\n\nSpecific changes in \"Environment-specific configuration loading\" describe block (lines 172-202):\n- process.env.DB_TYPE → process.env.DATABASE_TYPE\n- process.env.DB_HOST → process.env.DATABASE_HOST\n- process.env.DB_PORT → process.env.DATABASE_PORT\n- process.env.DB_USER → process.env.DATABASE_USER\n- process.env.DB_PASSWORD → process.env.DATABASE_PASSWORD\n- process.env.DB_NAME → process.env.DATABASE_NAME\n\nAlso update originalDb* variable names to originalDatabase* for consistency.\n\n---\n[Verification additions]\nFILES: tests/unit/storage/knex.test.ts (lines 172-202)\n\nACCEPTANCE CRITERIA:\n- [ ] All DB_* references in test file replaced with DATABASE_*\n- [ ] Variable names updated for consistency (originalDb* → originalDatabase*)\n- [ ] Test file compiles without TypeScript errors\n- [ ] npm test runs this test file successfully\n\nCROSS-REFERENCES:\n- Related: clack-pll2.3 (these tests validate the knex.ts changes)\n\nPARALLEL: Can run in parallel with .3, .4, .6, .7. No file overlap with other issues.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T23:20:00.565379632Z","created_by":"vscode","updated_at":"2026-01-05T20:02:37.439932297Z","closed_at":"2026-01-05T20:02:37.439932297Z","close_reason":"Work completed as part of epic","dependencies":[{"issue_id":"clack-pll2.5","depends_on_id":"clack-pll2","type":"parent-child","created_at":"2026-01-04T23:20:00.565938965Z","created_by":"vscode"}]}
{"id":"clack-pll2.6","title":"Update .env.example documentation","description":"Update .env.example to standardize on DATABASE_* naming:\n\nChanges required:\n1. Remove or comment out the DB_* section (lines 32-41):\n   - DB_TYPE=sqlite\n   - DB_HOST, DB_PORT, DB_USER, DB_PASSWORD, DB_NAME\n\n2. Keep DATABASE_URL and DATABASE_TYPE but update comments:\n   - Remove \"Legacy\" label from DATABASE_* variables\n   - Mark these as the primary database configuration method\n\n3. Add clear documentation showing DATABASE_* as the standard pattern\n\n---\n[Verification additions]\nFILES: .env.example (lines 31-46)\n\nACCEPTANCE CRITERIA:\n- [ ] DB_* variables removed or clearly marked as deprecated\n- [ ] DATABASE_* variables are the documented standard\n- [ ] Comments clearly explain the configuration pattern\n- [ ] No duplicate or conflicting documentation\n\nCROSS-REFERENCES:\n- Related: clack-pll2.3, clack-pll2.4 (code expects DATABASE_* based on these changes)\n\nPARALLEL: Can run in parallel with .3, .4, .5, .7. No file overlap with other issues.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T23:20:00.58570909Z","created_by":"vscode","updated_at":"2026-01-05T20:02:37.533388631Z","closed_at":"2026-01-05T20:02:37.533388631Z","close_reason":"Work completed as part of epic","dependencies":[{"issue_id":"clack-pll2.6","depends_on_id":"clack-pll2","type":"parent-child","created_at":"2026-01-04T23:20:00.586333799Z","created_by":"vscode"}]}
{"id":"clack-pll2.7","title":"Update CLAUDE.md if database env vars referenced","description":"Check CLAUDE.md for any references to database env vars and update if needed.\n\nANALYSIS COMPLETE: grep of CLAUDE.md shows NO references to DB_* or DATABASE_* variables.\nThe Quick Reference table points to .env.example for environment vars.\nNo changes required to CLAUDE.md.\n\n---\n[Verification additions]\nFILES: CLAUDE.md (no changes expected)\n\nACCEPTANCE CRITERIA:\n- [ ] Verify no DB_* or DATABASE_* references exist in CLAUDE.md\n- [ ] If references exist, update to DATABASE_* pattern\n- [ ] If no references exist, close as N/A with verification note\n\nCROSS-REFERENCES:\n- Related: clack-pll2.6 (.env.example is the source of truth for env vars)\n\nNOTE: This issue may be immediately closeable with verification that no updates needed.\n\nPARALLEL: Can run in parallel with .3, .4, .5, .6. No file overlap with other issues.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T23:20:00.604947757Z","created_by":"vscode","updated_at":"2026-01-05T20:02:37.600588047Z","closed_at":"2026-01-05T20:02:37.600588047Z","close_reason":"Work completed as part of epic","dependencies":[{"issue_id":"clack-pll2.7","depends_on_id":"clack-pll2","type":"parent-child","created_at":"2026-01-04T23:20:00.605503299Z","created_by":"vscode"}]}
{"id":"clack-pll2.8","title":"Run local tests to verify changes","description":"Run npm test locally to verify all changes work. All tests must pass with coverage maintained.\n\nThis is a validation gate that runs AFTER all code changes are complete.\n\n---\n[Verification additions]\nACCEPTANCE CRITERIA:\n- [ ] npm test completes successfully (exit code 0)\n- [ ] All unit tests pass\n- [ ] Coverage thresholds maintained (80%+ branches, functions, lines, statements)\n- [ ] No TypeScript compilation errors\n- [ ] Knex production MySQL config test passes with DATABASE_* variables\n\nDEPENDENCIES:\n- Blocked by: clack-pll2.2, .3, .4, .5, .6, .7 (all code changes must complete first)\n- Blocks: clack-pll2.9 (prod testing requires local validation first)\n\nEXECUTION: This is a quality gate - run after parallel issues .2-.7 complete.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T23:20:00.623681424Z","created_by":"vscode","updated_at":"2026-01-05T20:02:37.664552422Z","closed_at":"2026-01-05T20:02:37.664552422Z","close_reason":"Work completed as part of epic","dependencies":[{"issue_id":"clack-pll2.8","depends_on_id":"clack-pll2","type":"parent-child","created_at":"2026-01-04T23:20:00.624240965Z","created_by":"vscode"},{"issue_id":"clack-pll2.8","depends_on_id":"clack-pll2.2","type":"blocks","created_at":"2026-01-04T23:20:28.467994339Z","created_by":"vscode"},{"issue_id":"clack-pll2.8","depends_on_id":"clack-pll2.3","type":"blocks","created_at":"2026-01-04T23:20:28.483889964Z","created_by":"vscode"},{"issue_id":"clack-pll2.8","depends_on_id":"clack-pll2.4","type":"blocks","created_at":"2026-01-04T23:20:28.500633131Z","created_by":"vscode"},{"issue_id":"clack-pll2.8","depends_on_id":"clack-pll2.5","type":"blocks","created_at":"2026-01-04T23:20:28.515997423Z","created_by":"vscode"},{"issue_id":"clack-pll2.8","depends_on_id":"clack-pll2.6","type":"blocks","created_at":"2026-01-04T23:20:28.533059631Z","created_by":"vscode"},{"issue_id":"clack-pll2.8","depends_on_id":"clack-pll2.7","type":"blocks","created_at":"2026-01-04T23:20:28.549473048Z","created_by":"vscode"}]}
{"id":"clack-pll2.9","title":"Test npm run generate in prod via DOCKER_HOST","description":"SSH to prod container and verify npm run generate connects to MySQL successfully.\n\nCommand: DOCKER_HOST=ssh://rbrodkin@10.100.0.91 DOCKER_API_VERSION=1.43 docker exec \u003ccontainer\u003e npm run generate\n\nThis validates that the DATABASE_* environment variables work correctly in the production Docker Swarm deployment.\n\n---\n[Verification additions]\nACCEPTANCE CRITERIA:\n- [ ] npm run generate executes without \"Cannot find module sqlite3\" error\n- [ ] Command connects to MySQL database successfully\n- [ ] Content generation completes (may succeed or fail on AI, but DB connection works)\n- [ ] No environment variable resolution errors\n\nDEPENDENCIES:\n- Blocked by: clack-pll2.8 (local tests must pass before prod deployment)\n- Requires: Changes deployed to prod via existing CI/CD pipeline\n\nEXECUTION: Final validation step. Run after local tests pass and changes are deployed.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T23:20:00.643297174Z","created_by":"vscode","updated_at":"2026-01-05T20:02:37.728393297Z","closed_at":"2026-01-05T20:02:37.728393297Z","close_reason":"Work completed as part of epic","dependencies":[{"issue_id":"clack-pll2.9","depends_on_id":"clack-pll2","type":"parent-child","created_at":"2026-01-04T23:20:00.643925507Z","created_by":"vscode"},{"issue_id":"clack-pll2.9","depends_on_id":"clack-pll2.8","type":"blocks","created_at":"2026-01-04T23:20:28.565540589Z","created_by":"vscode"}]}
{"id":"clack-pm8d","title":"ISS Observer Generator","description":"Create a content generator that provides wacky mission-control-style commentary on what the ISS is currently seeing. Fetches real-time position data, reverse-geocodes location, and combines with astronaut crew info for deadpan cosmic observations.\n\n## Execution Order (for orchestration)\n\n**Parallel Group A** (no dependencies, can run simultaneously):\n- clack-pm8d.1: Create ISS API client\n- clack-pm8d.2: Create observation dictionaries  \n- clack-pm8d.3: Create user prompt file\n\n**Sequential** (requires Group A complete):\n- clack-pm8d.4: Implement ISSObserverGenerator\n\n**Parallel Group B** (requires issue 4 complete):\n- clack-pm8d.5: Register generator\n- clack-pm8d.6: Write unit tests","status":"closed","priority":1,"issue_type":"epic","owner":"ryan@spice.cc","created_at":"2026-01-23T19:58:32.906205968Z","created_by":"Ryan Brodkin","updated_at":"2026-01-23T21:19:57.585920921Z","closed_at":"2026-01-23T21:19:57.585920921Z","close_reason":"Closed"}
{"id":"clack-pm8d.1","title":"Create ISS API client","description":"Create src/api/data-sources/iss-client.ts with methods to fetch ISS position, reverse geocode coordinates, and get astronaut crew list.\n\n## Acceptance Criteria\n- [ ] getPosition() returns lat, lon, altitude, velocity, visibility from WhereTheISS.at API\n- [ ] reverseGeocode(lat, lon) returns country_code, timezone_id, region\n- [ ] getSpaceCrew() returns astronaut names and craft assignments from Open Notify API\n- [ ] getFullStatus() convenience method combines all three calls\n- [ ] Ocean detection logic for when geocoding returns null (Pacific, Atlantic, Indian, Arctic, Southern)\n- [ ] Graceful error handling with appropriate fallbacks\n- [ ] 10 second timeout on all requests\n- [ ] Export from src/api/data-sources/index.ts\n\n## API Endpoints\n- Position: https://api.wheretheiss.at/v1/satellites/25544\n- Geocode: https://api.wheretheiss.at/v1/coordinates/{lat},{lon}\n- Astronauts: http://api.open-notify.org/astros.json\n\n## Files\n- src/api/data-sources/iss-client.ts\n- src/api/data-sources/index.ts (export)","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-23T19:58:41.26411218Z","created_by":"Ryan Brodkin","updated_at":"2026-01-23T21:19:57.149196546Z","closed_at":"2026-01-23T21:19:57.149196546Z","close_reason":"Closed","dependencies":[{"issue_id":"clack-pm8d.1","depends_on_id":"clack-pm8d","type":"parent-child","created_at":"2026-01-23T19:58:41.265909388Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-pm8d.2","title":"Create observation dictionaries","description":"Create dictionaries for observation angles and location flavors to ensure high content variability.\n\n## Acceptance Criteria\n- [ ] 20+ observation angles (ALTITUDE_PERSPECTIVE, VELOCITY_COMPARISON, ASTRONAUT_THOUGHT, GEOGRAPHIC_TRIVIA, MUNDANE_CONTRAST, PRETEND_SURVEILLANCE, PHILOSOPHICAL_DISTANCE, ORBITAL_MECHANICS, CREW_ACTIVITY, BORDER_OBSERVATION, TIME_ZONE_ABSURDITY, WEATHER_COMPARISON, GRAVITY_HUMOR, EARTH_APPRECIATION, ROUTINE_CONTRAST, SCIENTIFIC_DEADPAN, HISTORICAL_REFERENCE, NIGHT_SIDE_MYSTERY, SUNRISE_SUNSET, etc.)\n- [ ] 50+ location flavors organized by region type:\n  - Ocean regions: PACIFIC_OCEAN, ATLANTIC_OCEAN, INDIAN_OCEAN, ARCTIC_OCEAN, SOUTHERN_OCEAN\n  - Major countries: UNITED_STATES, AUSTRALIA, RUSSIA, CHINA, BRAZIL, CANADA, etc.\n  - Generic fallbacks: GENERIC_LAND, GENERIC_OCEAN\n- [ ] selectRandomItem\u003cT\u003e(array: T[]): T utility function\n- [ ] getFlavorKey(location: ISSLocation): string mapping function\n\n## Files\n- src/content/generators/ai/iss-observer-dictionaries.ts","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-23T19:58:50.99430417Z","created_by":"Ryan Brodkin","updated_at":"2026-01-23T21:19:57.240728838Z","closed_at":"2026-01-23T21:19:57.240728838Z","close_reason":"Closed","dependencies":[{"issue_id":"clack-pm8d.2","depends_on_id":"clack-pm8d","type":"parent-child","created_at":"2026-01-23T19:58:50.99563492Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-pm8d.3","title":"Create user prompt file","description":"Create the user prompt with clear context establishment rules and approved opening patterns.\n\n## Acceptance Criteria\n- [ ] CRITICAL: First line MUST establish ISS context - readers have zero context\n- [ ] Approved opening patterns documented:\n  - ISS NOW OVER [LOCATION]\n  - SPACE STATION CROSSING [LOCATION]\n  - ISS CREW LOOKING DOWN AT [LOCATION]\n  - ISS ORBITING ABOVE [LOCATION]\n  - INTERNATIONAL SPACE STATION NOW ABOVE [LOCATION]\n- [ ] Forbidden patterns documented (too vague):\n  - OVER [LOCATION] NOW\n  - CROSSING [LOCATION]\n  - [ASTRONAUT] SEES [LOCATION]\n- [ ] Template variables: {{location}}, {{latitude}}, {{longitude}}, {{altitude}}, {{velocity}}, {{velocityMph}}, {{visibility}}, {{astronaut}}, {{crewCount}}, {{observationAngle}}, {{locationFlavor}}\n- [ ] Voice requirements: deadpan mission control, third-person only, no 'you', statistical precision + philosophical whimsy\n- [ ] Good and bad examples included in prompt\n\n## Files\n- prompts/user/iss-observer.txt","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-23T19:58:59.109980549Z","created_by":"Ryan Brodkin","updated_at":"2026-01-23T21:19:57.314738838Z","closed_at":"2026-01-23T21:19:57.314738838Z","close_reason":"Closed","dependencies":[{"issue_id":"clack-pm8d.3","depends_on_id":"clack-pm8d","type":"parent-child","created_at":"2026-01-23T19:58:59.111450258Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-pm8d.4","title":"Implement ISSObserverGenerator","description":"Create the generator class extending AIPromptGenerator with data injection hooks.\n\n## Acceptance Criteria\n- [ ] Extends AIPromptGenerator with LIGHT model tier\n- [ ] Constructor accepts optional ISSClient for dependency injection (testing)\n- [ ] getSystemPromptFile() returns 'major-update-base.txt'\n- [ ] getUserPromptFile() returns 'iss-observer.txt'\n- [ ] getTemplateVariables() implementation:\n  - Fetches ISS position, location, and crew via ISSClient\n  - Selects random astronaut from ISS crew only (filter out Tiangong)\n  - Selects random observation angle from dictionary\n  - Selects location-appropriate flavor based on region\n  - Returns all template variables for prompt injection\n- [ ] getCustomMetadata() tracks:\n  - issDataFetched: boolean\n  - position: ISSPosition | null\n  - location: ISSLocation | null\n  - crewCount: number\n  - selectedAstronaut: string\n  - observationAngle: string\n  - locationFlavor: string\n- [ ] Graceful fallback values when API fails\n- [ ] Export from src/content/generators/ai/index.ts\n\n## Dependencies\n- Requires: ISS API client (clack-pm8d.1)\n- Requires: Observation dictionaries (clack-pm8d.2)\n- Requires: User prompt file (clack-pm8d.3)\n\n## Files\n- src/content/generators/ai/iss-observer-generator.ts\n- src/content/generators/ai/index.ts (export)","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-23T19:59:09.271214637Z","created_by":"Ryan Brodkin","updated_at":"2026-01-23T21:19:57.394518463Z","closed_at":"2026-01-23T21:19:57.394518463Z","close_reason":"Closed","dependencies":[{"issue_id":"clack-pm8d.4","depends_on_id":"clack-pm8d","type":"parent-child","created_at":"2026-01-23T19:59:09.272099971Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-pm8d.4","depends_on_id":"clack-pm8d.1","type":"blocks","created_at":"2026-01-23T19:59:34.157000468Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-pm8d.4","depends_on_id":"clack-pm8d.2","type":"blocks","created_at":"2026-01-23T19:59:34.22153301Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-pm8d.4","depends_on_id":"clack-pm8d.3","type":"blocks","created_at":"2026-01-23T19:59:34.276437677Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-pm8d.5","title":"Register generator","description":"Add generator to CoreGenerators interface and register with ContentRegistry.\n\n## Acceptance Criteria\n- [ ] Add issObserver: ContentGenerator to CoreGenerators interface\n- [ ] Create instance in createCoreGenerators() with dependencies:\n  - promptLoader\n  - modelTierSelector\n  - apiKeys\n  - new ISSClient()\n- [ ] Register with ContentRegistry:\n  - id: 'iss-observer'\n  - name: 'ISS Observer'\n  - priority: ContentPriority.NORMAL (P2)\n  - modelTier: ModelTier.LIGHT\n  - applyFrame: true\n\n## Dependencies\n- Requires: Generator implementation (clack-pm8d.4)\n\n## Files\n- src/content/registry/register-core.ts","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-23T19:59:17.338575627Z","created_by":"Ryan Brodkin","updated_at":"2026-01-23T21:19:57.457398754Z","closed_at":"2026-01-23T21:19:57.457398754Z","close_reason":"Closed","dependencies":[{"issue_id":"clack-pm8d.5","depends_on_id":"clack-pm8d","type":"parent-child","created_at":"2026-01-23T19:59:17.339617294Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-pm8d.5","depends_on_id":"clack-pm8d.4","type":"blocks","created_at":"2026-01-23T19:59:39.674630804Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-pm8d.6","title":"Write unit tests","description":"Comprehensive unit tests for ISSClient and ISSObserverGenerator.\n\n## Acceptance Criteria\n- [ ] ISSClient tests (tests/unit/api/data-sources/iss-client.test.ts):\n  - getPosition() returns correct structure\n  - reverseGeocode() handles land locations\n  - reverseGeocode() handles ocean locations (null country_code)\n  - getSpaceCrew() returns astronauts filtered by craft\n  - getFullStatus() combines all data\n  - Timeout handling (10 second limit)\n  - Error handling with graceful fallbacks\n  - Mock all HTTP requests (no real API calls)\n- [ ] ISSObserverGenerator tests (tests/unit/content/generators/ai/iss-observer-generator.test.ts):\n  - Constructor creates instance with LIGHT tier\n  - getSystemPromptFile() returns 'major-update-base.txt'\n  - getUserPromptFile() returns 'iss-observer.txt'\n  - getTemplateVariables() injects ISS data correctly\n  - Random astronaut selected from ISS crew only\n  - Random observation angle selected\n  - Location-appropriate flavor selected\n  - getCustomMetadata() tracks all selections\n  - Fallback values used on API failure\n  - Mock ISSClient for isolation\n- [ ] 80%+ code coverage on new files\n\n## Dependencies\n- Requires: Generator implementation (clack-pm8d.4)\n\n## Files\n- tests/unit/api/data-sources/iss-client.test.ts\n- tests/unit/content/generators/ai/iss-observer-generator.test.ts","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-23T19:59:27.54675659Z","created_by":"Ryan Brodkin","updated_at":"2026-01-23T21:19:57.518089713Z","closed_at":"2026-01-23T21:19:57.518089713Z","close_reason":"Closed","dependencies":[{"issue_id":"clack-pm8d.6","depends_on_id":"clack-pm8d","type":"parent-child","created_at":"2026-01-23T19:59:27.547844173Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-pm8d.6","depends_on_id":"clack-pm8d.4","type":"blocks","created_at":"2026-01-23T19:59:39.740767721Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-ppg5","title":"Fix Test Suite Performance \u0026 Establish Testing Standards","description":"Tests are taking ~130 seconds to run due to real timer delays and inefficient database setup patterns. This epic covers fixing the performance issues and documenting testing standards to prevent regression.\n\n**Root Cause**: http-client.test.ts takes 101.8 seconds (95% of unit test time) due to testing exponential backoff with real timers.\n\n**Target**: Reduce test suite time from ~130s to ~40s.\n\n**Success Criteria**:\n- Unit tests complete in \u003c 30 seconds total\n- All test files complete in \u003c 5 seconds individually\n- Testing standards documented in CLAUDE.md","status":"closed","priority":1,"issue_type":"epic","owner":"ryan@spice.cc","created_at":"2026-01-21T21:13:48.323957596Z","created_by":"Ryan Brodkin","updated_at":"2026-01-21T22:08:24.393195918Z","closed_at":"2026-01-21T22:08:24.393195918Z","close_reason":"Implemented in feature/clack-ppg5-test-performance, merged to develop"}
{"id":"clack-ppg5.1","title":"Add fake timers to http-client retry tests","description":"Refactor tests/unit/api/vestaboard/http-client.test.ts to use Jest fake timers for all exponential backoff and retry tests. Currently tests real elapsed time which wastes ~90 seconds.\n\n**Problem**: The test validates exponential backoff using real timers:\n```typescript\nconst startTime = Date.now();\nawait expect(client.post(mockLayout)).rejects.toThrow();\nconst elapsed = Date.now() - startTime;\nexpect(elapsed).toBeGreaterThanOrEqual(2500); // Waits REAL time\n```\n\n**Solution**: Use Jest fake timers:\n```typescript\nbeforeEach(() =\u003e jest.useFakeTimers());\nafterEach(() =\u003e jest.useRealTimers());\n\nit('should use exponential backoff', async () =\u003e {\n  const promise = client.post(mockLayout);\n  await jest.advanceTimersByTimeAsync(1000); // First retry\n  await jest.advanceTimersByTimeAsync(2000); // Second retry\n  await expect(promise).rejects.toThrow();\n});\n```\n\n**Acceptance Criteria**:\n- [ ] All retry/backoff tests use jest.useFakeTimers() and jest.useRealTimers()\n- [ ] Tests use jest.advanceTimersByTimeAsync() to simulate delays\n- [ ] Remove real time assertions (Date.now() elapsed checks)\n- [ ] Tests still verify correct number of retries and backoff behavior\n- [ ] File execution time \u003c 5 seconds\n\n**Files**: tests/unit/api/vestaboard/http-client.test.ts\n\n**Reference**: See cron.test.ts for correct fake timer patterns","status":"closed","priority":1,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-21T21:14:11.789082468Z","created_by":"Ryan Brodkin","updated_at":"2026-01-21T22:08:24.363120584Z","closed_at":"2026-01-21T22:08:24.363120584Z","close_reason":"Implemented in feature/clack-ppg5-test-performance, merged to develop","dependencies":[{"issue_id":"clack-ppg5.1","depends_on_id":"clack-ppg5","type":"parent-child","created_at":"2026-01-21T21:14:11.790369052Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-ppg5.2","title":"Optimize database test setup patterns","description":"Refactor database repository tests to use beforeAll/afterAll for connection setup instead of beforeEach/afterEach. Remove the 1-second real delay in content-repo.test.ts.\n\n**Current Pattern (inefficient)**:\n```typescript\nbeforeEach(async () =\u003e {\n  resetKnexInstance();\n  knex = getKnexInstance();\n  await knex.schema.createTable('content', ...);\n});\nafterEach(async () =\u003e {\n  await closeKnexInstance();\n});\n```\n\n**Target Pattern (efficient)**:\n```typescript\nbeforeAll(async () =\u003e {\n  resetKnexInstance();\n  knex = getKnexInstance();\n  await knex.schema.createTable('content', ...);\n});\nbeforeEach(async () =\u003e {\n  await knex('content').del(); // Just clean data\n});\nafterAll(async () =\u003e {\n  await closeKnexInstance();\n});\n```\n\n**Acceptance Criteria**:\n- [ ] Database connection created once per test file, not per test\n- [ ] Tables created in beforeAll, cleaned (not dropped) in beforeEach\n- [ ] Connection closed in afterAll\n- [ ] Remove 1-second delay in content-repo.test.ts (use timestamp manipulation or fake timers)\n- [ ] All database tests still pass with isolation maintained\n\n**Files**:\n- tests/unit/storage/repositories/content-repo.test.ts\n- tests/unit/storage/repositories/vote.test.ts\n- tests/unit/storage/repositories/log.test.ts\n- tests/unit/storage/models/content.test.ts\n- tests/unit/storage/models/validation-attempts.test.ts","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-21T21:14:13.054018844Z","created_by":"Ryan Brodkin","updated_at":"2026-01-21T22:08:24.373145668Z","closed_at":"2026-01-21T22:08:24.373145668Z","close_reason":"Implemented in feature/clack-ppg5-test-performance, merged to develop","dependencies":[{"issue_id":"clack-ppg5.2","depends_on_id":"clack-ppg5","type":"parent-child","created_at":"2026-01-21T21:14:13.059466761Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-ppg5.3","title":"Add fake timers to HA integration tests","description":"Replace real 150ms delays in Home Assistant integration tests with Jest fake timers.\n\n**Problem**: The reconnection tests use real setTimeout delays:\n```typescript\nawait new Promise(resolve =\u003e setTimeout(resolve, 150));\n```\n\n**Acceptance Criteria**:\n- [ ] All reconnection tests use fake timers\n- [ ] No real setTimeout delays \u003e 50ms in test execution\n- [ ] Reconnection behavior still properly tested\n\n**Files**: tests/integration/home-assistant-integration.test.ts\n\n**Reference**: See trigger-matcher.test.ts for correct fake timer patterns in integration tests","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-21T21:14:14.127638969Z","created_by":"Ryan Brodkin","updated_at":"2026-01-21T22:08:24.378388001Z","closed_at":"2026-01-21T22:08:24.378388001Z","close_reason":"Implemented in feature/clack-ppg5-test-performance, merged to develop","dependencies":[{"issue_id":"clack-ppg5.3","depends_on_id":"clack-ppg5","type":"parent-child","created_at":"2026-01-21T21:14:14.130923594Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-ppg5.4","title":"Reduce global test timeout","description":"Reduce default Jest timeout from 30 seconds to 10 seconds to catch slow tests earlier. Ensure any legitimately slow tests have explicit timeouts.\n\n**Current**: jest.setTimeout(30000) in tests/setup/jest.setup.ts\n\n**Target**: jest.setTimeout(10000)\n\n**Acceptance Criteria**:\n- [ ] Global timeout changed to 10000ms in jest.setup.ts\n- [ ] E2E tests retain 60000ms timeout (already configured in jest.config.cjs)\n- [ ] Any tests that need \u003e 10s have explicit timeout parameter\n- [ ] All tests pass with new timeout\n\n**Files**: tests/setup/jest.setup.ts\n\n**Note**: This change should be made AFTER the other performance fixes to avoid false failures","status":"closed","priority":3,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-21T21:14:15.027585845Z","created_by":"Ryan Brodkin","updated_at":"2026-01-21T22:08:24.383074126Z","closed_at":"2026-01-21T22:08:24.383074126Z","close_reason":"Implemented in feature/clack-ppg5-test-performance, merged to develop","dependencies":[{"issue_id":"clack-ppg5.4","depends_on_id":"clack-ppg5","type":"parent-child","created_at":"2026-01-21T21:14:15.028310011Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-ppg5.4","depends_on_id":"clack-ppg5.1","type":"blocks","created_at":"2026-01-21T21:15:26.311274503Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-ppg5.4","depends_on_id":"clack-ppg5.2","type":"blocks","created_at":"2026-01-21T21:15:27.55481117Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-ppg5.4","depends_on_id":"clack-ppg5.3","type":"blocks","created_at":"2026-01-21T21:15:28.718657629Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-ppg5.5","title":"Document testing standards in CLAUDE.md","description":"Add comprehensive testing standards section to CLAUDE.md covering timer mocking, database setup patterns, performance expectations, and anti-patterns to avoid.\n\n**Section to Add**: New 'Testing Standards' section after 'Testing Requirements'\n\n**Content Requirements**:\n1. **Timer Mocking Pattern** - When and how to use jest.useFakeTimers()\n2. **Database Test Setup Pattern** - beforeAll/afterAll for connections\n3. **Performance Expectations** - Unit tests \u003c 5s per file, total suite \u003c 60s\n4. **Anti-Patterns to Avoid**:\n   - Real timers for delays (use fake timers)\n   - Per-test database connections (use per-suite)\n   - Long global timeouts that mask slow tests\n5. **Reference Examples** - Point to good implementations in codebase\n\n**Acceptance Criteria**:\n- [ ] New 'Testing Standards' section in CLAUDE.md\n- [ ] Timer mocking patterns documented with examples\n- [ ] Database test setup patterns documented\n- [ ] Performance expectations stated (unit tests \u003c 5s per file)\n- [ ] Anti-patterns listed with explanations\n- [ ] References to existing good examples in codebase\n\n**Files**: CLAUDE.md","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-21T21:14:16.685919471Z","created_by":"Ryan Brodkin","updated_at":"2026-01-21T22:08:24.388194626Z","closed_at":"2026-01-21T22:08:24.388194626Z","close_reason":"Implemented in feature/clack-ppg5-test-performance, merged to develop","dependencies":[{"issue_id":"clack-ppg5.5","depends_on_id":"clack-ppg5","type":"parent-child","created_at":"2026-01-21T21:14:16.698077929Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-ppg5.5","depends_on_id":"clack-ppg5.1","type":"blocks","created_at":"2026-01-21T21:14:22.729030501Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-ppg5.5","depends_on_id":"clack-ppg5.2","type":"blocks","created_at":"2026-01-21T21:14:22.770019293Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-ppg5.5","depends_on_id":"clack-ppg5.3","type":"blocks","created_at":"2026-01-21T21:14:22.814167709Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-ppg5.5","depends_on_id":"clack-ppg5.4","type":"blocks","created_at":"2026-01-21T21:14:22.863381584Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-ptb","title":"Add Usage Examples","description":"Create code examples for event subscription, state queries, service calls, and troubleshooting guide.","acceptance_criteria":"- Event subscription code examples\n- State query code examples\n- Service call code examples\n- Reconnection behavior documented\n- Troubleshooting guide\n- Common error scenarios documented","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-11-24T00:19:01.557195798Z","updated_at":"2026-01-03T21:41:47.645866918Z","dependencies":[{"issue_id":"clack-ptb","depends_on_id":"clack-t51","type":"blocks","created_at":"2025-11-24T00:20:23.586792919Z","created_by":"daemon"},{"issue_id":"clack-ptb","depends_on_id":"clack-3my","type":"parent-child","created_at":"2025-11-24T04:21:05.807710794Z","created_by":"vscode"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-pvu","title":"[MEDIUM] Remove typeof checks in local-news-generator.test.ts","description":"**File:** tests/unit/content/generators/ai/local-news-generator.test.ts\n**Lines:** 184-249\n**Category:** Doesn't Make Sense\n**Severity:** Medium\n\n## Problem\nMultiple tests (lines 184-195, 197-210, 213-249) only do typeof checks or access protected properties with bracket notation. These don't verify real behavior.\n\n## Evidence\n```typescript\nit('should inherit generate method from BaseNewsGenerator', () =\u003e {\n  expect(typeof generator.generate).toBe('function');\n  // Comment: \"The actual implementation is tested in base-news-generator.test.ts\"\n});\n```\n\n## Implementation Instructions\n1. **Delete lines 184-195 and 213-248** - typeof checks and protected property access\n2. **Keep lines 197-210** if they test meaningful configuration, but simplify\n3. **Add actual behavior tests** if needed for local news-specific functionality\n\n## Acceptance Criteria\n- [ ] No typeof checks testing method existence\n- [ ] No bracket notation access to protected properties\n- [ ] Tests verify local news-specific behavior or are removed","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-11-29T05:07:10.878074051Z","updated_at":"2026-01-03T21:41:47.645866918Z","labels":["medium","testing"],"dependencies":[{"issue_id":"clack-pvu","depends_on_id":"clack-anr5","type":"parent-child","created_at":"2025-11-29T07:00:49.80380018Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-q1dy","title":"Refactor Tool-Based Generation (Template Method + DRY)","description":"Refactor the feature/clack-cooj-tool-calling branch to eliminate DRY violations and simplify architecture. Key changes: (1) Template Method pattern in AIPromptGenerator base class, (2) Remove duplicate promptsOnly handling from 12 generators, (3) Remove dual-mode useToolBasedGeneration flag since tool-based is standard.","status":"closed","priority":1,"issue_type":"epic","owner":"ryan@spice.cc","created_at":"2026-01-20T05:50:42.895235927Z","created_by":"Ryan Brodkin","updated_at":"2026-01-20T09:55:23.612693263Z","closed_at":"2026-01-20T09:55:23.612693263Z","close_reason":"Epic completed: Template Method pattern implemented, generators migrated, tests updated, merged to main."}
{"id":"clack-q1dy.1","title":"Refactor AIPromptGenerator to Template Method pattern","description":"Restructure the base class to centralize promptsOnly handling and provide clean extension hooks for subclasses.\n\nAcceptance Criteria:\n- Base generate() method handles promptsOnly check in ONE place\n- New protected hook: getTemplateVariables(context): Promise\u003cRecord\u003cstring, string\u003e\u003e\n- New protected hook: getCustomMetadata(): Record\u003cstring, unknown\u003e\n- New protected hook: postProcessContent(content: GeneratedContent): GeneratedContent\n- Subclasses ONLY override hooks, never the full generate() method\n- All existing tests pass\n\nFiles:\n- src/content/generators/ai-prompt-generator.ts\n- src/types/content-generator.ts\n\nParallel Work:\n- Runs in parallel with clack-q1dy.2 (no file overlap)\n- Both must complete before clack-q1dy.3","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-20T05:50:55.339144502Z","created_by":"Ryan Brodkin","updated_at":"2026-01-20T09:55:18.470891719Z","closed_at":"2026-01-20T09:55:18.470891719Z","close_reason":"All tasks completed. Tool-based generation merged to main with Template Method pattern.","dependencies":[{"issue_id":"clack-q1dy.1","depends_on_id":"clack-q1dy","type":"parent-child","created_at":"2026-01-20T05:50:55.34008421Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-q1dy.2","title":"Migrate generators to use new Template Method hooks","description":"Update all 12 generators that override generate() to use the new Template Method hooks instead.\n\nAcceptance Criteria:\n- No generator overrides generate() method\n- Generators override getTemplateVariables() for custom prompt data (weather, news, etc.)\n- Generators override getCustomMetadata() for custom metadata fields\n- Generators override postProcessContent() for content modification (e.g., FortuneCookieGenerator title)\n- ~200 lines of duplicate code eliminated\n- All existing generator tests pass\n\nFiles (12 generators):\n- src/content/generators/ai/base-news-generator.ts\n- src/content/generators/ai/haiku-generator.ts\n- src/content/generators/ai/weather-generator.ts\n- src/content/generators/ai/daily-roast-generator.ts\n- src/content/generators/ai/compliment-generator.ts\n- src/content/generators/ai/fortune-cookie-generator.ts\n- src/content/generators/ai/language-lesson-generator.ts\n- src/content/generators/ai/novel-insight-generator.ts\n- src/content/generators/ai/paradox-engine-generator.ts\n- src/content/generators/ai/story-fragment-generator.ts\n- src/content/generators/ai/time-perspective-generator.ts\n- src/content/generators/ai/word-of-the-day-generator.ts\n\nParallel Work:\n- Runs in parallel with clack-q1dy.1 (no file overlap)\n- Both must complete before clack-q1dy.3","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-20T05:50:55.567046335Z","created_by":"Ryan Brodkin","updated_at":"2026-01-20T09:55:18.477773719Z","closed_at":"2026-01-20T09:55:18.477773719Z","close_reason":"All tasks completed. Tool-based generation merged to main with Template Method pattern.","dependencies":[{"issue_id":"clack-q1dy.2","depends_on_id":"clack-q1dy","type":"parent-child","created_at":"2026-01-20T05:50:55.56785571Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-q1dy.3","title":"Simplify orchestrator (remove dual-mode flag)","description":"Remove useToolBasedGeneration context flag since tool-based is the standard. Always use ToolBasedGenerator wrapper for AI generators.\n\nAcceptance Criteria:\n- Remove useToolBasedGeneration from GenerationContext interface\n- Remove conditional wrapping logic in orchestrator\n- ToolBasedGenerator always wraps AI generators (no opt-out)\n- CLI commands simplified (no --use-tools flag needed)\n- All orchestrator tests pass\n\nFiles:\n- src/content/orchestrator.ts\n- src/types/content-generator.ts\n- src/cli/commands/content-test.ts\n\nDependencies:\n- Blocked by clack-q1dy.1 (Template Method pattern must exist first)\n- Blocked by clack-q1dy.2 (All generators must be migrated first)\n- These can run in parallel before this unit starts","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-20T05:50:55.825416252Z","created_by":"Ryan Brodkin","updated_at":"2026-01-20T09:55:18.482947469Z","closed_at":"2026-01-20T09:55:18.482947469Z","close_reason":"All tasks completed. Tool-based generation merged to main with Template Method pattern.","dependencies":[{"issue_id":"clack-q1dy.3","depends_on_id":"clack-q1dy","type":"parent-child","created_at":"2026-01-20T05:50:55.82616296Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-q1dy.3","depends_on_id":"clack-q1dy.1","type":"blocks","created_at":"2026-01-20T05:51:01.56329238Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-q1dy.3","depends_on_id":"clack-q1dy.2","type":"blocks","created_at":"2026-01-20T05:51:01.612575921Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-q1dy.4","title":"Update and consolidate tests","description":"Update test suites to reflect the simplified architecture. Remove tests for dual-mode behavior, ensure Template Method pattern is well-tested.\n\nAcceptance Criteria:\n- Template Method hooks have dedicated tests\n- Removed tests for deprecated dual-mode behavior\n- Coverage remains ≥80%\n- All integration tests pass\n\nFiles:\n- tests/unit/content/generators/ai-prompt-generator.test.ts\n- tests/unit/content/generators/tool-based-generator.test.ts\n- tests/unit/content/orchestrator.test.ts\n- tests/integration/content/orchestrator-validation.test.ts","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-20T05:50:56.08007821Z","created_by":"Ryan Brodkin","updated_at":"2026-01-20T09:55:18.487191011Z","closed_at":"2026-01-20T09:55:18.487191011Z","close_reason":"All tasks completed. Tool-based generation merged to main with Template Method pattern.","dependencies":[{"issue_id":"clack-q1dy.4","depends_on_id":"clack-q1dy","type":"parent-child","created_at":"2026-01-20T05:50:56.080760919Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-q1dy.4","depends_on_id":"clack-q1dy.3","type":"blocks","created_at":"2026-01-20T05:51:01.64876288Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-q1dy.5","title":"Merge refactored branch to main","description":"Final integration - merge the refactored feature branch to main.\n\nAcceptance Criteria:\n- All tests pass in CI\n- No merge conflicts\n- CLAUDE.md updated with new architecture documentation\n- Old beads issues (clack-cooj.*) closed\n\nFiles:\n- CLAUDE.md\n- .beads/ (issue closures)","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-20T05:50:56.365069335Z","created_by":"Ryan Brodkin","updated_at":"2026-01-20T09:55:18.492270844Z","closed_at":"2026-01-20T09:55:18.492270844Z","close_reason":"All tasks completed. Tool-based generation merged to main with Template Method pattern.","dependencies":[{"issue_id":"clack-q1dy.5","depends_on_id":"clack-q1dy","type":"parent-child","created_at":"2026-01-20T05:50:56.366672794Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-q1dy.5","depends_on_id":"clack-q1dy.4","type":"blocks","created_at":"2026-01-20T05:51:01.692584921Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-q4k","title":"Write Unit Tests for Character Converter","description":"Create comprehensive unit tests for pure character conversion functions. Target: 100% coverage (branches, functions, lines, statements). No mocks needed.","design":"## Test Coverage Areas\nPure function testing (no mocks):\n\n1. Letter conversion (A=1, Z=26)\n2. Number conversion (0=36, 1-9=27-35)\n3. Symbol conversion (!, @, #, etc.)\n4. Space and blank (0)\n5. Color codes (63-71)\n6. Uppercase normalization\n7. Invalid character handling\n8. Row conversion (string → number[])\n9. Layout conversion (VestaboardLayout → number[][])\n10. Edge cases (empty, long strings, null/undefined)","acceptance_criteria":"- tests/unit/api/vestaboard/character-converter.test.ts created\n- Test textToCharacterCode() with letters (A-Z → 1-26)\n- Test numbers (0 → 36, 1-9 → 27-35)\n- Test symbols (!, @, #, $, etc.)\n- Test space character (→ 0)\n- Test color codes (63-71)\n- Test uppercase normalization (a → A → 1)\n- Test invalid character error throwing\n- Test rowToCharacterCodes() with mixed content\n- Test layoutToCharacterCodes() with full 6×22 layout\n- Test edge cases (empty string, undefined, null)\n- 100% coverage achieved (branches, functions, lines, statements)\n- All tests pass\n- No mocks used (pure function testing)","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-11-26T05:25:18.545606502Z","updated_at":"2026-01-03T21:41:47.645866918Z","dependencies":[{"issue_id":"clack-q4k","depends_on_id":"clack-u7h","type":"blocks","created_at":"2025-11-26T05:25:18.546767211Z","created_by":"daemon"},{"issue_id":"clack-q4k","depends_on_id":"clack-jc1","type":"blocks","created_at":"2025-11-26T05:25:18.547691544Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-q5q9","title":"Modernize Devcontainer Setup","description":"Transition existing devcontainer from custom Dockerfile + 4 volumes to modern setup with standard image + single user volume. Goals: lower complexity, better maintainability, native Claude installer, simplified Beads install, auto-daemon.\n\n---\n**Execution Plan for reaper:takeoff:**\n\n**Parallel Group 1 (no blockers):**\n- clack-q5q9.1: Volume simplification (docker-compose.yml volumes)\n- clack-q5q9.2: Claude native installer (post-create.sh)\n- clack-q5q9.3: Beads npm install (post-create.sh, devcontainer.json containerEnv)\n\n**Sequential (blocked by Group 1):**\n- clack-q5q9.4: Script split (depends on q5q9.1, q5q9.2, q5q9.3)\n\n**Parallel Group 2 (blocked by q5q9.4):**\n- clack-q5q9.5: postStartCommand (depends on q5q9.3, q5q9.4)\n- clack-q5q9.6: Dockerfile removal (depends on q5q9.4)\n\n**Sequential (blocked by Group 2):**\n- clack-q5q9.7: devcontainer.json cleanup (depends on q5q9.1, q5q9.5, q5q9.6)\n- clack-q5q9.8: Final testing (depends on q5q9.7)\n\n**Strategy:** medium_single_branch - all work on same branch, exclusive file ownership per issue.","status":"closed","priority":1,"issue_type":"epic","owner":"ryan@spice.cc","created_at":"2026-01-23T00:37:44.930510387Z","created_by":"Ryan Brodkin","updated_at":"2026-01-23T03:11:04.390841213Z","closed_at":"2026-01-23T03:11:04.390841213Z","close_reason":"done"}
{"id":"clack-q5q9.1","title":"Simplify volume mounts to single user directory","description":"Replace 4 separate Claude-related volumes with single user home directory mount.\n\n**Current volumes in docker-compose.yml (REMOVE):**\n```yaml\nvolumes:\n  - claude-home-clack-track:/home/vscode/.claude\n  - command-history-clack-track:/home/vscode/history\n  - claude-config-clack-track:/home/vscode/.config/claude-code\n```\n\n**New simplified volumes:**\n```yaml\nvolumes:\n  - ..:/workspace:cached\n  - clack-track-userdata:/home/vscode        # Single user volume\n  - beads-db-clack-track:/workspace/.beads   # Separate for ext4\n\n# Named volumes at bottom:\nvolumes:\n  clack-track-userdata:\n  beads-db-clack-track:\n  mysql-data:\n```\n\n**Acceptance Criteria:**\n- [ ] Single userdata volume replaces 3 Claude-related volumes\n- [ ] Beads volume remains separate for filesystem compatibility\n- [ ] MySQL volume unchanged\n- [ ] All Claude settings, history, and config persist across rebuilds\n\n**Files:** docker-compose.yml\n\n---\n**Cross-References:** Also modifies docker-compose.yml: clack-q5q9.6 (image change). This issue handles volumes only; clack-q5q9.6 handles service definition.","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-23T00:38:00.702585881Z","created_by":"Ryan Brodkin","updated_at":"2026-01-23T03:10:59.683742627Z","closed_at":"2026-01-23T03:10:59.683742627Z","close_reason":"done","dependencies":[{"issue_id":"clack-q5q9.1","depends_on_id":"clack-q5q9","type":"parent-child","created_at":"2026-01-23T00:38:00.703675339Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-q5q9.2","title":"Replace Claude Code npm install with native installer","description":"Switch from deprecated npm global install to official native installer.\n\n**Current (REMOVE):**\n```bash\nnpm install -g @anthropic-ai/claude-code\nclaude update || echo \"Claude Code is up to date\"\n```\n\n**New (ADD):**\n```bash\necho \"=== Installing Claude Code (native) ===\"\ncurl -fsSL https://claude.ai/install.sh | bash\n```\n\n**Acceptance Criteria:**\n- [ ] Native installer used instead of npm\n- [ ] Claude command available after installation\n- [ ] No npm global prefix configuration needed for Claude\n\n**Files:** post-create.sh\n\n---\n**Cross-References:**\n- post-create.sh: clack-q5q9.3 (Beads install), clack-q5q9.4 (script split)\n- This issue handles Claude Code installation method only","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-23T00:38:01.981286548Z","created_by":"Ryan Brodkin","updated_at":"2026-01-23T03:10:59.689230961Z","closed_at":"2026-01-23T03:10:59.689230961Z","close_reason":"done","dependencies":[{"issue_id":"clack-q5q9.2","depends_on_id":"clack-q5q9","type":"parent-child","created_at":"2026-01-23T00:38:01.988307131Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-q5q9.3","title":"Simplify Beads CLI installation","description":"Replace 50-line fallback installation chain with simple npm install.\n\n**Current (REMOVE):** Lines 181-234 with curl -\u003e brew -\u003e go install fallback chain\n\n**New (ADD) in post-create.sh:**\n```bash\necho \"=== Installing Beads CLI ===\"\nsudo npm install -g @beads/bd\n```\n\n**Also add containerEnv in devcontainer.json:**\n```json\n\"containerEnv\": {\n  \"BEADS_SYNC_BRANCH\": \"beads-sync\"\n}\n```\n\n**Acceptance Criteria:**\n- [ ] Beads installed via npm global package\n- [ ] BEADS_SYNC_BRANCH environment variable set\n- [ ] Go toolchain no longer required for beads\n\n**Files:** post-create.sh, devcontainer.json\n\n---\n**Cross-References:**\n- post-create.sh: clack-q5q9.2 (Claude install), clack-q5q9.4 (script split)\n- devcontainer.json: clack-q5q9.5 (postStartCommand), clack-q5q9.6 (features), clack-q5q9.7 (final cleanup)\n- This issue handles: Beads npm install, BEADS_SYNC_BRANCH env var","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-23T00:38:03.881382007Z","created_by":"Ryan Brodkin","updated_at":"2026-01-23T03:10:59.694617586Z","closed_at":"2026-01-23T03:10:59.694617586Z","close_reason":"done","dependencies":[{"issue_id":"clack-q5q9.3","depends_on_id":"clack-q5q9","type":"parent-child","created_at":"2026-01-23T00:38:03.885959757Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-q5q9.4","title":"Split post-create.sh into system vs user-space scripts","description":"Separate concerns into two scripts following modern devcontainer pattern.\n\n**post-create.sh** (system-level, runs once on creation):\n```bash\n#\\!/bin/bash\nset -e\n\necho \"=== Installing Playwright dependencies ===\"\nsudo apt-get update\nsudo apt-get install -y libnss3 libnspr4 libatk1.0-0 libatk-bridge2.0-0 \\\n    libcups2 libdrm2 libdbus-1-3 libxkbcommon0 libxcomposite1 libxdamage1 \\\n    libxfixes3 libxrandr2 libgbm1 libasound2 libatspi2.0-0 libxshmfence1 \\\n    default-mysql-client\n\necho \"=== Installing Claude Code (native) ===\"\ncurl -fsSL https://claude.ai/install.sh | bash\n\necho \"=== Installing Beads CLI ===\"\nsudo npm install -g @beads/bd\n\necho \"=== Fixing Beads volume permissions ===\"\nsudo chown -R vscode:vscode /workspace/.beads\n\necho \"=== System Setup Complete ===\"\n```\n\n**update-content.sh** (user-space, runs on cache updates):\n```bash\n#\\!/bin/bash\nset -e\n\necho \"=== Installing project dependencies ===\"\nif [ -f package.json ]; then\n  npm install\nfi\n\necho \"=== Setting up Git hooks ===\"\nnpm run prepare || echo \"Husky setup skipped\"\n\n# Combined beads + husky hooks setup\n# [move existing hook setup logic from current post-create.sh lines 44-101]\n\necho \"=== Configuring Beads ===\"\nif command -v bd \u0026\u003e /dev/null; then\n  cd /workspace\n  if \\! bd info \u0026\u003e /dev/null 2\u003e\u00261; then\n    echo \"Initializing Beads with sync branch: $BEADS_SYNC_BRANCH\"\n    bd init --branch \"${BEADS_SYNC_BRANCH:-beads-sync}\"\n    bd hooks install --force\n  fi\nfi\n\necho \"=== Verifying Installations ===\"\necho \"Node: $(node --version)\"\necho \"npm: $(npm --version)\"\ncommand -v claude \u0026\u003e /dev/null \u0026\u0026 echo \"Claude Code: $(claude --version 2\u003e/dev/null)\"\ncommand -v bd \u0026\u003e /dev/null \u0026\u0026 echo \"Beads: $(bd --version 2\u003e/dev/null)\"\n\necho \"=== Update Complete ===\"\n```\n\n**Acceptance Criteria:**\n- [ ] post-create.sh contains only system-level setup (apt, sudo operations)\n- [ ] update-content.sh contains user-space setup (npm, git hooks, configs)\n- [ ] Both scripts are executable\n- [ ] devcontainer.json references both via postCreateCommand and updateContentCommand\n\n**Files:** post-create.sh, update-content.sh (new)\n\n---\n**Cross-References:**\n- Incorporates installation methods from: clack-q5q9.2 (Claude), clack-q5q9.3 (Beads)\n- This issue consolidates and restructures the scripts after individual installation methods are finalized","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-23T00:38:30.02586388Z","created_by":"Ryan Brodkin","updated_at":"2026-01-23T03:10:59.700592836Z","closed_at":"2026-01-23T03:10:59.700592836Z","close_reason":"done","dependencies":[{"issue_id":"clack-q5q9.4","depends_on_id":"clack-q5q9","type":"parent-child","created_at":"2026-01-23T00:38:30.032403672Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-q5q9.4","depends_on_id":"clack-q5q9.1","type":"blocks","created_at":"2026-01-23T00:38:58.117289088Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-q5q9.4","depends_on_id":"clack-q5q9.2","type":"blocks","created_at":"2026-01-23T00:38:58.155551504Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-q5q9.4","depends_on_id":"clack-q5q9.3","type":"blocks","created_at":"2026-01-23T00:38:58.187902713Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-q5q9.5","title":"Add postStartCommand for beads daemon","description":"Auto-start beads daemon when container starts.\n\n**Add to devcontainer.json:**\n```json\n\"postStartCommand\": \"bd daemon start --auto-commit --auto-push --interval 5m 2\u003e/dev/null || true\"\n```\n\n**Acceptance Criteria:**\n- [ ] Beads daemon starts automatically on container start\n- [ ] Daemon runs with auto-commit and auto-push enabled\n- [ ] Silent failure if beads not initialized (|| true)\n\n**Files:** devcontainer.json\n\n---\n**Cross-References:**\n- devcontainer.json: clack-q5q9.3 (containerEnv), clack-q5q9.6 (features), clack-q5q9.7 (final cleanup)\n- This issue handles postStartCommand only","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-23T00:38:31.960566673Z","created_by":"Ryan Brodkin","updated_at":"2026-01-23T03:10:59.705824877Z","closed_at":"2026-01-23T03:10:59.705824877Z","close_reason":"done","dependencies":[{"issue_id":"clack-q5q9.5","depends_on_id":"clack-q5q9","type":"parent-child","created_at":"2026-01-23T00:38:31.964689381Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-q5q9.5","depends_on_id":"clack-q5q9.3","type":"blocks","created_at":"2026-01-23T00:39:00.507857964Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-q5q9.5","depends_on_id":"clack-q5q9.4","type":"blocks","created_at":"2026-01-23T00:39:00.566036422Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-q5q9.6","title":"Remove custom Dockerfile, simplify docker-compose","description":"Eliminate custom Dockerfile by using standard devcontainer image in docker-compose.\n\n**New docker-compose.yml node-dev service:**\n```yaml\nnode-dev:\n  image: mcr.microsoft.com/devcontainers/typescript-node:20-bookworm\n  volumes:\n    - ..:/workspace:cached\n    - clack-track-userdata:/home/vscode\n    - beads-db-clack-track:/workspace/.beads\n  command: [\"sleep\", \"infinity\"]\n  environment:\n    - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}\n    - CLAUDE_CODE_API_KEY=${CLAUDE_CODE_API_KEY:-${ANTHROPIC_API_KEY}}\n    - ANTHROPIC_MODEL=${ANTHROPIC_MODEL}\n    - NODE_ENV=development\n  ports:\n    - \"3000:3000\"\n  working_dir: /workspace\n  depends_on:\n    - mysql\n  networks:\n    - clack-network\n```\n\n**Add features to devcontainer.json:**\n```json\n\"features\": {\n  \"ghcr.io/devcontainers/features/common-utils:2\": {},\n  \"ghcr.io/devcontainers/features/python:1\": {\n    \"version\": \"3.12\"\n  },\n  \"ghcr.io/devcontainers/features/docker-outside-of-docker:1\": {}\n}\n```\n\n**Move to post-create.sh:** Playwright deps, MySQL client (apt-get)\n**MySQL service:** Unchanged (already clean)\n\n**Acceptance Criteria:**\n- [ ] Dockerfile deleted from .devcontainer/\n- [ ] docker-compose.yml uses standard image for node-dev\n- [ ] Features added to devcontainer.json for Python and Docker CLI\n- [ ] MySQL service unchanged and functional\n- [ ] Volumes simplified (3 total: workspace, userdata, beads)\n\n**Files:** Dockerfile (delete), devcontainer.json, docker-compose.yml\n\n---\n**Cross-References:**\n- docker-compose.yml volumes: clack-q5q9.1 (handles volume simplification)\n- devcontainer.json: clack-q5q9.3 (containerEnv), clack-q5q9.5 (postStartCommand), clack-q5q9.7 (final cleanup)\n- This issue handles: image change, Dockerfile deletion, features addition","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-23T00:38:32.09529959Z","created_by":"Ryan Brodkin","updated_at":"2026-01-23T03:10:59.711494294Z","closed_at":"2026-01-23T03:10:59.711494294Z","close_reason":"done","dependencies":[{"issue_id":"clack-q5q9.6","depends_on_id":"clack-q5q9","type":"parent-child","created_at":"2026-01-23T00:38:32.096243423Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-q5q9.6","depends_on_id":"clack-q5q9.4","type":"blocks","created_at":"2026-01-23T00:39:02.073522923Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-q5q9.7","title":"Clean up devcontainer.json configuration","description":"Finalize devcontainer.json with all changes and remove cruft.\n\n**Changes:**\n- Add updateContentCommand: \"bash .devcontainer/update-content.sh\"\n- Add postStartCommand for beads daemon\n- Add containerEnv for BEADS_SYNC_BRANCH\n- Remove build.args (no custom Dockerfile)\n- Clean up PATH settings (no more npm-global prefix needed)\n- Ensure features are properly configured\n\n**Final structure should include:**\n```json\n{\n  \"name\": \"Clack Track Dev\",\n  \"dockerComposeFile\": \"docker-compose.yml\",\n  \"service\": \"node-dev\",\n  \"workspaceFolder\": \"/workspace\",\n  \"remoteUser\": \"vscode\",\n  \"containerEnv\": {\n    \"NODE_OPTIONS\": \"--max-old-space-size=6144\",\n    \"BEADS_SYNC_BRANCH\": \"beads-sync\"\n  },\n  \"features\": { ... },\n  \"postCreateCommand\": \"bash .devcontainer/post-create.sh\",\n  \"updateContentCommand\": \"bash .devcontainer/update-content.sh\",\n  \"postStartCommand\": \"bd daemon start --auto-commit --auto-push --interval 5m 2\u003e/dev/null || true\",\n  \"forwardPorts\": [...],\n  \"customizations\": { ... }\n}\n```\n\n**Acceptance Criteria:**\n- [ ] devcontainer.json uses simplified configuration\n- [ ] All three commands present: postCreateCommand, updateContentCommand, postStartCommand\n- [ ] containerEnv includes BEADS_SYNC_BRANCH\n- [ ] No references to removed Dockerfile (no build.args)\n- [ ] Features properly configured\n\n**Files:** devcontainer.json\n\n---\n**Cross-References:**\n- devcontainer.json prior changes: clack-q5q9.3 (containerEnv), clack-q5q9.5 (postStartCommand), clack-q5q9.6 (features)\n- This issue consolidates all devcontainer.json changes and removes deprecated config\n- Note: Earlier issues add components; this issue validates final state","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-23T00:38:47.04803318Z","created_by":"Ryan Brodkin","updated_at":"2026-01-23T03:10:59.716827044Z","closed_at":"2026-01-23T03:10:59.716827044Z","close_reason":"done","dependencies":[{"issue_id":"clack-q5q9.7","depends_on_id":"clack-q5q9","type":"parent-child","created_at":"2026-01-23T00:38:47.051586888Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-q5q9.7","depends_on_id":"clack-q5q9.1","type":"blocks","created_at":"2026-01-23T00:39:02.978616173Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-q5q9.7","depends_on_id":"clack-q5q9.5","type":"blocks","created_at":"2026-01-23T00:39:03.01649234Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-q5q9.7","depends_on_id":"clack-q5q9.6","type":"blocks","created_at":"2026-01-23T00:39:03.05384684Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-q5q9.8","title":"Remove example files and test full rebuild","description":"Delete the example directory and verify the new setup works.\n\n**Actions:**\n1. Remove /workspace/devcontainer-example/ directory\n2. Rebuild devcontainer from scratch\n3. Verify all tools available: claude, bd, npm, python, docker\n4. Verify beads daemon starts automatically\n5. Verify volumes persist across rebuilds\n\n**Acceptance Criteria:**\n- [ ] Example directory removed\n- [ ] Full devcontainer rebuild succeeds\n- [ ] All CLI tools functional (claude, bd, npm, python, docker)\n- [ ] Beads daemon running after start\n- [ ] MySQL connection works\n- [ ] User data persists after rebuild\n\n**Files:** devcontainer-example/ (delete)","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-23T00:38:48.494158625Z","created_by":"Ryan Brodkin","updated_at":"2026-01-23T03:10:59.721693794Z","closed_at":"2026-01-23T03:10:59.721693794Z","close_reason":"done","dependencies":[{"issue_id":"clack-q5q9.8","depends_on_id":"clack-q5q9","type":"parent-child","created_at":"2026-01-23T00:38:48.498741708Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-q5q9.8","depends_on_id":"clack-q5q9.7","type":"blocks","created_at":"2026-01-23T00:39:03.952971049Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-qk0w","title":"Route-Based Code Splitting","description":"Reduce initial bundle from 558 kB to ~200 kB by implementing route-based code splitting with lazy loading.\n\n**Success Criteria:**\n- Initial bundle is 300 kB or less\n- Each route loads its own chunk\n- Vendor code in separate cacheable chunk\n- No functional regressions\n- Build completes without chunk size warning\n\n**Execution Plan:**\n\n**Phase 1 - PARALLEL:**\n- clack-qk0w.1: Add Suspense loading component (RouteLoading.tsx)\n- clack-qk0w.3: Configure Vite manual chunks (vite.config.ts)\n  (These have NO shared files and can run simultaneously)\n\n**Phase 2 - SEQUENTIAL after Phase 1:**\n- clack-qk0w.2: Convert pages to lazy imports (App.tsx + page exports)\n  (Depends on clack-qk0w.1 for RouteLoading component)\n\n**Phase 3 - FINAL:**\n- clack-qk0w.4: Verify bundle sizes and test routes\n  (Depends on ALL previous tasks)","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-05T21:53:53.989229138Z","created_by":"vscode","updated_at":"2026-01-05T23:45:14.852058674Z","closed_at":"2026-01-05T23:45:14.852058674Z","close_reason":"Closed"}
{"id":"clack-qk0w.1","title":"Add Suspense loading component","description":"Create a minimal loading spinner/skeleton for route transitions.\n\n**Files:**\n- src/web/frontend/components/RouteLoading.tsx (new)\n\n**Acceptance Criteria:**\n- Component renders centered loading indicator\n- Matches app styling (dark theme)\n- Exports as named export\n\n**Related Issues:**\n- clack-qk0w.2 depends on this component for Suspense fallback\n- clack-qk0w.3 can run in PARALLEL with this task (no dependency)\n- clack-qk0w.4 will verify this component works in route transitions","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T21:54:04.92536342Z","created_by":"vscode","updated_at":"2026-01-05T23:45:14.749036257Z","closed_at":"2026-01-05T23:45:14.749036257Z","close_reason":"Closed","dependencies":[{"issue_id":"clack-qk0w.1","depends_on_id":"clack-qk0w","type":"parent-child","created_at":"2026-01-05T21:54:04.948631087Z","created_by":"vscode"}]}
{"id":"clack-qk0w.2","title":"Convert pages to lazy imports in App.tsx","description":"Replace static imports with React.lazy() for all 4 page components.\n\n**Files:**\n- src/web/frontend/App.tsx (modify)\n- src/web/frontend/pages/Welcome.tsx (add default export)\n- src/web/frontend/pages/History.tsx (add default export)\n- src/web/frontend/pages/Account.tsx (add default export)\n- src/web/frontend/pages/Login.tsx (add default export)\n\n**Note:** Pages currently use named exports. React.lazy() requires default exports. Either:\n1. Add `export default Welcome` etc. to each page file, OR\n2. Use dynamic import wrapper: `lazy(() =\u003e import(\"./pages/Welcome\").then(m =\u003e ({ default: m.Welcome })))`\n\n**Acceptance Criteria:**\n- Welcome, History, Account, Login use lazy()\n- Routes wrapped in \u003cSuspense fallback={\u003cRouteLoading /\u003e}\u003e\n- All pages load correctly with code splitting\n\n**Related Issues:**\n- Depends on clack-qk0w.1 for RouteLoading component\n- clack-qk0w.3 can run in PARALLEL (no shared files)\n- clack-qk0w.4 will verify lazy loading works","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T21:54:06.377441463Z","created_by":"vscode","updated_at":"2026-01-05T23:45:14.779650257Z","closed_at":"2026-01-05T23:45:14.779650257Z","close_reason":"Closed","dependencies":[{"issue_id":"clack-qk0w.2","depends_on_id":"clack-qk0w","type":"parent-child","created_at":"2026-01-05T21:54:06.390105546Z","created_by":"vscode"},{"issue_id":"clack-qk0w.2","depends_on_id":"clack-qk0w.1","type":"blocks","created_at":"2026-01-05T21:54:17.774747676Z","created_by":"vscode"}]}
{"id":"clack-qk0w.3","title":"Configure Vite manual chunks","description":"Separate vendor libraries into stable, cacheable chunks.\n\n**Files:**\n- vite.config.ts (modify build.rollupOptions.output.manualChunks)\n\n**Acceptance Criteria:**\n- react, react-dom, react-router-dom in vendor chunk\n- @radix-ui/*, lucide-react in ui chunk\n- App code remains in dynamic per-route chunks\n\n**Related Issues:**\n- clack-qk0w.1 can run in PARALLEL with this task (no shared files)\n- clack-qk0w.2 can run in PARALLEL with this task (no shared files)\n- clack-qk0w.4 will verify chunk configuration","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T21:54:08.181351838Z","created_by":"vscode","updated_at":"2026-01-05T23:45:14.80612034Z","closed_at":"2026-01-05T23:45:14.80612034Z","close_reason":"Closed","dependencies":[{"issue_id":"clack-qk0w.3","depends_on_id":"clack-qk0w","type":"parent-child","created_at":"2026-01-05T21:54:08.205027297Z","created_by":"vscode"}]}
{"id":"clack-qk0w.4","title":"Verify bundle sizes and test routes","description":"Confirm optimization success and no regressions.\n\n**Verification Commands:**\n- npm run build:client (check for chunk size warnings)\n- Inspect dist/public/assets/ for chunk files\n\n**Files to Verify:**\n- dist/public/assets/*.js (examine chunk sizes)\n- No source files modified by this task\n\n**Acceptance Criteria:**\n- npm run build:client shows no chunk size warning\n- Initial bundle (index-*.js) is 300 kB or less\n- Separate vendor chunk exists (vendor-*.js)\n- Separate ui chunk exists (ui-*.js or similar)\n- All 4 routes load correctly in browser (/, /flipside, /account, /login)\n- Route transitions show loading state briefly\n- PWA service worker still precaches correctly\n\n**Related Issues:**\n- Blocked by clack-qk0w.1 (loading component)\n- Blocked by clack-qk0w.2 (lazy imports)\n- Blocked by clack-qk0w.3 (Vite config)\n- This is the final verification task","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T21:54:10.839649423Z","created_by":"vscode","updated_at":"2026-01-05T23:45:14.83035359Z","closed_at":"2026-01-05T23:45:14.83035359Z","close_reason":"Closed","dependencies":[{"issue_id":"clack-qk0w.4","depends_on_id":"clack-qk0w","type":"parent-child","created_at":"2026-01-05T21:54:10.846903006Z","created_by":"vscode"},{"issue_id":"clack-qk0w.4","depends_on_id":"clack-qk0w.1","type":"blocks","created_at":"2026-01-05T21:54:19.517836219Z","created_by":"vscode"},{"issue_id":"clack-qk0w.4","depends_on_id":"clack-qk0w.2","type":"blocks","created_at":"2026-01-05T21:54:19.837217677Z","created_by":"vscode"},{"issue_id":"clack-qk0w.4","depends_on_id":"clack-qk0w.3","type":"blocks","created_at":"2026-01-05T21:54:20.162932344Z","created_by":"vscode"}]}
{"id":"clack-r0g","title":"Task 5.2: Create FrameDecorator service","description":"Create src/content/frame/frame-decorator.ts wrapping existing frame generator for post-generation decoration with time/weather.","acceptance_criteria":"- Constructor accepts optional HomeAssistantClient and AIProvider\n- decorate(text, dateTime?) method\n- Wraps existing generateFrame() function\n- Returns FrameResult with layout and warnings\n- Graceful degradation if HA/AI unavailable\n- Unit tests","status":"tombstone","priority":1,"issue_type":"task","assignee":"claude","created_at":"2025-11-26T22:16:29.910541346Z","updated_at":"2026-01-03T21:41:47.645866918Z","dependencies":[{"issue_id":"clack-r0g","depends_on_id":"clack-zoc","type":"parent-child","created_at":"2025-11-26T22:16:37.891673253Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-r793","title":"Remove motivational generator entirely","description":"Remove the motivational content generator entirely from the codebase.\n\nGoal: Delete all files, references, and registrations related to motivational-quote / MotivationalGenerator\n\nSuccess criteria:\n- Build passes\n- All tests pass with 80%+ coverage\n- No references to motivational generator remain\n- content:list shows no motivational generator\n\n---\n[Execution Order - Added by verification]\n\nCRITICAL: Import dependencies require specific execution order:\n\nPhase 1 (Parallel):\n- clack-r793.2: Remove imports from bootstrap.ts and register-core.ts (MUST run first)\n- clack-r793.4: Documentation cleanup (independent, can run in parallel)\n\nPhase 2 (After Phase 1):\n- clack-r793.1: Delete source files (blocked by clack-r793.2 - imports removed first)\n- clack-r793.3: Delete test files and fixtures (can run parallel with clack-r793.1)\n\nPhase 3 (After Phase 2):\n- clack-r793.5: Final validation (blocked by all above)\n\nParallel Groups:\n- Group 1: [clack-r793.2, clack-r793.4]\n- Group 2: [clack-r793.1, clack-r793.3]\n- Group 3: [clack-r793.5]\n\nWARNING: If clack-r793.1 executes before clack-r793.2, build will FAIL due to broken imports in bootstrap.ts","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-12T06:28:57.565539261Z","created_by":"vscode","updated_at":"2026-01-12T17:56:05.108242051Z","closed_at":"2026-01-12T17:56:05.108242051Z","close_reason":"Motivational generator removed"}
{"id":"clack-r793.1","title":"Remove motivational generator source files","description":"Delete source files and clean up exports.\n\nFiles to delete:\n- src/content/generators/ai/motivational-generator.ts\n- prompts/user/motivational.txt\n\nFiles to modify:\n- src/content/generators/ai/index.ts - Remove MotivationalGenerator export\n\nAcceptance criteria:\n- Files deleted\n- No import errors in remaining code\n\n---\n[Auto-added by verification]\nEXECUTION NOTE: This issue MUST be coordinated with clack-r793.2\n- clack-r793.2 MUST run FIRST or CONCURRENTLY to remove imports from bootstrap.ts and register-core.ts\n- If this issue runs alone first, build will FAIL due to broken imports\n- Recommended: Merge scope with clack-r793.2 into single atomic work unit OR establish hard blocker\n\nRelated issues:\n- clack-r793.2: Modifies bootstrap.ts which imports from motivational-generator.ts (CRITICAL coordination required)\n- clack-r793.3: Test file imports from motivational-generator.ts (cleanup after this issue)","notes":"Parent epic closed - motivational generator removed","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T06:29:11.183359711Z","created_by":"vscode","updated_at":"2026-01-23T22:36:42.067089969Z","closed_at":"2026-01-23T22:36:42.067095802Z","dependencies":[{"issue_id":"clack-r793.1","depends_on_id":"clack-r793","type":"parent-child","created_at":"2026-01-12T06:29:11.185049836Z","created_by":"vscode"},{"issue_id":"clack-r793.1","depends_on_id":"clack-r793.2","type":"blocks","created_at":"2026-01-12T06:31:36.769217209Z","created_by":"vscode"}]}
{"id":"clack-r793.2","title":"Remove motivational generator registration","description":"Remove from registry and bootstrap.\n\nFiles to modify:\n- src/content/registry/register-core.ts - Remove motivational from CoreGenerators interface and registerCoreContent()\n- src/bootstrap.ts - Remove MotivationalGenerator import and instantiation from createCoreGenerators()\n\nAcceptance criteria:\n- CoreGenerators interface no longer has motivational property\n- registerCoreContent() no longer registers motivational-quote\n- createCoreGenerators() no longer creates MotivationalGenerator instance\n\n---\n[Auto-added by verification]\nEXECUTION NOTE: This issue has import dependencies on clack-r793.1 files\n- bootstrap.ts imports directly from src/content/generators/ai/motivational-generator.ts\n- This issue SHOULD run BEFORE or CONCURRENTLY with clack-r793.1\n- If clack-r793.1 deletes source first, this file will have broken imports\n- Recommended: Execute this issue FIRST, then clack-r793.1 can safely delete files\n\nRelated issues:\n- clack-r793.1: Deletes the source file this issue imports from (CRITICAL coordination required)\n- clack-r793.3: Also has import dependency on same source file","notes":"Parent epic closed - motivational generator removed","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T06:29:13.209516921Z","created_by":"vscode","updated_at":"2026-01-23T22:36:42.070183052Z","closed_at":"2026-01-23T22:36:42.070187552Z","dependencies":[{"issue_id":"clack-r793.2","depends_on_id":"clack-r793","type":"parent-child","created_at":"2026-01-12T06:29:13.213451462Z","created_by":"vscode"}]}
{"id":"clack-r793.3","title":"Clean up motivational generator tests and fixtures","description":"Remove test files and fixture data.\n\nFiles to delete:\n- tests/unit/content/generators/ai/motivational-generator.test.ts\n\nFiles to modify:\n- tests/fixtures/openai-responses.json - Remove motivational fixture\n- tests/fixtures/anthropic-responses.json - Remove motivational fixture\n\nAcceptance criteria:\n- All tests pass\n- No test files reference motivational generator\n\n---\n[Auto-added by verification]\nEXECUTION NOTE: Test file has import dependency\n- Test file imports from src/content/generators/ai/motivational-generator.ts\n- This issue can run in parallel with clack-r793.1 and clack-r793.2 (all deletions happen together)\n- OR this issue should run AFTER clack-r793.1 (source already deleted, test deletion is cleanup)\n\nRelated issues:\n- clack-r793.1: Deletes source file that test imports from (coordinate execution)\n- clack-r793.4: Documentation cleanup (no dependency, truly parallel)","notes":"Parent epic closed - motivational generator removed","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T06:29:16.104560714Z","created_by":"vscode","updated_at":"2026-01-23T22:36:42.072362344Z","closed_at":"2026-01-23T22:36:42.072365885Z","dependencies":[{"issue_id":"clack-r793.3","depends_on_id":"clack-r793","type":"parent-child","created_at":"2026-01-12T06:29:16.112188047Z","created_by":"vscode"}]}
{"id":"clack-r793.4","title":"Update documentation for motivational removal","description":"Remove motivational references from docs.\n\nFiles to modify:\n- CLAUDE.md - Remove motivational references from generator documentation\n- prompts/README.md - Remove motivational references if present\n- docs/ai-providers.md - Remove motivational references if present\n\nAcceptance criteria:\n- No documentation references motivational generator\n\n---\n[Auto-added by verification]\nEXECUTION NOTE: This issue has NO code dependencies on other issues\n- Documentation changes are independent of source code changes\n- Can execute fully in parallel with clack-r793.1, clack-r793.2, clack-r793.3\n\nRelated issues:\n- clack-r793.1, clack-r793.2, clack-r793.3: Source/test changes (no dependency, can run parallel)","notes":"Parent epic closed - motivational generator removed","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T06:29:19.34419059Z","created_by":"vscode","updated_at":"2026-01-23T22:36:42.074576385Z","closed_at":"2026-01-23T22:36:42.074579219Z","dependencies":[{"issue_id":"clack-r793.4","depends_on_id":"clack-r793","type":"parent-child","created_at":"2026-01-12T06:29:19.36772984Z","created_by":"vscode"}]}
{"id":"clack-r793.5","title":"Validate build and tests after motivational removal","description":"Final validation that removal is complete.\n\nSteps:\n- Run npm run build\n- Run npm test\n- Verify 80%+ coverage maintained\n- Run npm run content:list to verify generator is removed\n\nAcceptance criteria:\n- Build succeeds with no TypeScript errors\n- All tests pass\n- Coverage \u003e= 80%\n- content:list shows no motivational generator","notes":"Parent epic closed - motivational generator removed","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T06:29:21.327890299Z","created_by":"vscode","updated_at":"2026-01-23T22:36:42.077282969Z","closed_at":"2026-01-23T22:36:42.077286427Z","dependencies":[{"issue_id":"clack-r793.5","depends_on_id":"clack-r793","type":"parent-child","created_at":"2026-01-12T06:29:21.341339508Z","created_by":"vscode"},{"issue_id":"clack-r793.5","depends_on_id":"clack-r793.1","type":"blocks","created_at":"2026-01-12T06:29:27.721056636Z","created_by":"vscode"},{"issue_id":"clack-r793.5","depends_on_id":"clack-r793.2","type":"blocks","created_at":"2026-01-12T06:29:27.756766469Z","created_by":"vscode"},{"issue_id":"clack-r793.5","depends_on_id":"clack-r793.3","type":"blocks","created_at":"2026-01-12T06:29:27.788157094Z","created_by":"vscode"},{"issue_id":"clack-r793.5","depends_on_id":"clack-r793.4","type":"blocks","created_at":"2026-01-12T06:29:27.816435844Z","created_by":"vscode"}]}
{"id":"clack-rcgx","title":"Navigation Redesign: iOS 26 Floating Tab Bar","description":"## Overview\nReplace the current top header navigation with a modern iOS 26-style floating bottom tab bar featuring playful animations, confetti on votes, split-flap character reveals, and haptic feedback.\n\n## Design Decisions\n| Aspect | Choice |\n|--------|--------|\n| Nav style | Floating pill-shaped bottom tab bar with glass blur effect |\n| Tabs | 3 items: Home, History, Account |\n| Hidden features | Admin → inside Account page, Login → contextual redirect |\n| Animations | Confetti, split-flap flip, haptics, tab bounce |\n\n## User Requirements (from interview)\n- **Primary use**: Mix of viewing, voting, debugging\n- **Users**: Household (2-5 people)\n- **Device**: Mobile-first\n- **Style**: Playful \u0026 bold\n- **Auth**: Required for voting (track who voted)\n- **Quick actions**: Vote up/down prominent\n- **Nav items**: Home, History, Account (3 visible)\n- **Delight level**: Maximum! Confetti, split-flap animations, haptics\n\n## Files to Create\n1. src/web/frontend/components/BottomTabBar.tsx\n2. src/web/frontend/components/Confetti.tsx\n3. src/web/frontend/lib/animations.ts\n\n## Files to Modify\n1. src/web/frontend/components/PageLayout.tsx\n2. src/web/frontend/components/Navigation.tsx\n3. src/web/frontend/components/VestaboardPreview.tsx\n4. src/web/frontend/components/VotingButtons.tsx\n5. src/web/frontend/pages/Account.tsx\n6. src/web/frontend/index.css\n\n## Success Criteria\n- Bottom tab bar visible and floating on mobile\n- Top nav visible on desktop (md+)\n- Confetti bursts on thumbs-up vote\n- Split-flap animation on content load\n- Haptic feedback on votes/tab switches\n- Admin section accessible from Account page\n- All existing tests pass","status":"closed","priority":2,"issue_type":"epic","owner":"ryan@spice.cc","created_at":"2026-01-24T04:00:51.683119299Z","created_by":"Ryan Brodkin","updated_at":"2026-01-26T04:24:50.598825419Z","closed_at":"2026-01-26T04:24:50.598828586Z"}
{"id":"clack-rcgx.1","title":"Create animation utilities (animations.ts)","description":"## Objective\nCreate animation utility functions for haptics, confetti, and split-flap effects.\n\n## File\nsrc/web/frontend/lib/animations.ts\n\n## Implementation\n- `triggerHaptic(type: 'light' | 'medium' | 'heavy')` - Vibration API wrapper\n- `triggerSuccessHaptic()` - Double-tap pattern for positive actions\n- `createConfettiAnimation(canvas, config)` - Canvas-based confetti particles\n- `getSplitFlapDelay(row, col)` - Staggered delay calculator\n- `getRandomFlipChar()` - Random character for spinning effect\n- `CONFETTI_COLORS` - Amber/gold/orange theme colors\n\n## Acceptance Criteria\n- [ ] Haptic feedback degrades gracefully on unsupported devices\n- [ ] Confetti animation uses requestAnimationFrame\n- [ ] Returns cleanup function for proper React integration\n- [ ] TypeScript interfaces exported for config options","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-24T04:01:05.89066875Z","created_by":"Ryan Brodkin","updated_at":"2026-01-26T04:24:50.661590877Z","closed_at":"2026-01-26T04:24:50.661595002Z","dependencies":[{"issue_id":"clack-rcgx.1","depends_on_id":"clack-rcgx","type":"parent-child","created_at":"2026-01-24T04:01:05.893224Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-rcgx.2","title":"Create Confetti component","description":"## Objective\nCreate a React component that renders canvas-based confetti animation.\n\n## File\nsrc/web/frontend/components/Confetti.tsx\n\n## Implementation\n- Canvas-based particle animation\n- Triggered by `active` prop\n- Colors: amber (#FFB800), orange (#FF8C00), gold (#FFD700)\n- Auto-cleanup after animation completes\n- Full-screen overlay with pointer-events-none\n- `onComplete` callback for parent notification\n\n## Dependencies\n- Requires: clack-rcgx.1 (animations.ts)\n\n## Acceptance Criteria\n- [ ] Particles burst upward then fall with gravity\n- [ ] Animation duration ~2.5 seconds\n- [ ] Canvas resizes on window resize\n- [ ] Proper cleanup on unmount\n- [ ] aria-hidden for accessibility","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-24T04:01:27.126773968Z","created_by":"Ryan Brodkin","updated_at":"2026-01-26T04:24:50.719541169Z","closed_at":"2026-01-26T04:24:50.719543336Z","dependencies":[{"issue_id":"clack-rcgx.2","depends_on_id":"clack-rcgx","type":"parent-child","created_at":"2026-01-24T04:01:27.131194635Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-rcgx.2","depends_on_id":"clack-rcgx.1","type":"blocks","created_at":"2026-01-24T04:02:59.718313219Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-rcgx.3","title":"Create BottomTabBar component","description":"## Objective\nCreate iOS 26-style floating bottom tab bar with glass effect.\n\n## File\nsrc/web/frontend/components/BottomTabBar.tsx\n\n## Implementation\n- Floating pill shape with backdrop-blur-xl\n- 3 tabs: Home, History, Account (using Lucide icons)\n- Active state: filled icon, visible label, scale-105\n- Inactive state: outline icon, hidden label\n- Safe area padding for notched devices\n- Hidden on desktop (md:hidden)\n- Haptic feedback on tab switch\n\n## Styling\n- Background: bg-white/80 dark:bg-gray-900/80\n- Border: border-gray-200/50 dark:border-gray-700/50\n- Shadow: shadow-lg shadow-black/10\n- Active color: amber-600 / amber-400\n\n## Dependencies\n- Requires: clack-rcgx.1 (animations.ts for haptics)\n\n## Acceptance Criteria\n- [ ] Tabs navigate to correct routes\n- [ ] Active tab visually distinguished\n- [ ] Smooth transitions on state changes\n- [ ] Touch targets minimum 44px\n- [ ] Focus visible states for accessibility","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-24T04:01:29.861454886Z","created_by":"Ryan Brodkin","updated_at":"2026-01-26T04:24:50.776798628Z","closed_at":"2026-01-26T04:24:50.776802919Z","dependencies":[{"issue_id":"clack-rcgx.3","depends_on_id":"clack-rcgx","type":"parent-child","created_at":"2026-01-24T04:01:29.863879845Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-rcgx.3","depends_on_id":"clack-rcgx.1","type":"blocks","created_at":"2026-01-24T04:03:00.202924636Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-rcgx.4","title":"Add CSS animations to index.css","description":"## Objective\nAdd keyframe animations for split-flap effect and other UI animations.\n\n## File\nsrc/web/frontend/index.css\n\n## Implementation\nAdd keyframes:\n- @keyframes flip-in: 3D flip for split-flap character reveal\n- @keyframes bounce-in: Subtle bounce for tab selection\n- Utility classes for animation delays (staggered effects)\n\n## Acceptance Criteria\n- [ ] Animations use GPU-accelerated properties (transform, opacity)\n- [ ] Keyframes follow existing CSS variable patterns\n- [ ] Compatible with tailwindcss-animate plugin","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-24T04:01:32.149770929Z","created_by":"Ryan Brodkin","updated_at":"2026-01-26T04:24:50.831618919Z","closed_at":"2026-01-26T04:24:50.831621503Z","dependencies":[{"issue_id":"clack-rcgx.4","depends_on_id":"clack-rcgx","type":"parent-child","created_at":"2026-01-24T04:01:32.164523346Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-rcgx.5","title":"Update VestaboardPreview with split-flap animation","description":"## Objective\nAdd character-by-character flip animation when content changes.\n\n## File\nsrc/web/frontend/components/VestaboardPreview.tsx\n\n## Implementation\n- Detect content changes via useEffect\n- Stagger animation per character (left-to-right, top-to-bottom)\n- Use CSS 3D transform for realistic flip effect\n- Base delay ~20ms between characters\n- Optional: Add flip sound effect\n\n## Dependencies\n- Requires: clack-rcgx.1 (getSplitFlapDelay)\n- Requires: clack-rcgx.4 (flip-in keyframe)\n\n## Acceptance Criteria\n- [ ] Animation triggers on content prop change\n- [ ] Characters flip in wave pattern\n- [ ] Animation is GPU-accelerated\n- [ ] Can be disabled for performance if needed\n- [ ] Doesn't block initial render","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-24T04:02:04.09231893Z","created_by":"Ryan Brodkin","updated_at":"2026-01-26T04:24:50.887216294Z","closed_at":"2026-01-26T04:24:50.887218711Z","dependencies":[{"issue_id":"clack-rcgx.5","depends_on_id":"clack-rcgx","type":"parent-child","created_at":"2026-01-24T04:02:04.09716043Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-rcgx.5","depends_on_id":"clack-rcgx.1","type":"blocks","created_at":"2026-01-24T04:03:00.853597095Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-rcgx.5","depends_on_id":"clack-rcgx.4","type":"blocks","created_at":"2026-01-24T04:03:01.215696679Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-rcgx.6","title":"Update VotingButtons with confetti and haptics","description":"## Objective\nEnhance voting experience with confetti on thumbs-up and haptic feedback.\n\n## File\nsrc/web/frontend/components/VotingButtons.tsx\n\n## Implementation\n- Trigger confetti burst on successful thumbs-up vote\n- Trigger haptic feedback on any vote\n- Add scale animation on button press (active:scale-95)\n- Position confetti origin at button location\n\n## Dependencies\n- Requires: clack-rcgx.1 (triggerHaptic, triggerSuccessHaptic)\n- Requires: clack-rcgx.2 (Confetti component)\n\n## Acceptance Criteria\n- [ ] Confetti only on thumbs-up (not thumbs-down)\n- [ ] Haptic on both vote types\n- [ ] Button press animation feels responsive\n- [ ] Confetti doesn't interfere with voting function\n- [ ] Works correctly when voting on History page items","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-24T04:02:07.342590084Z","created_by":"Ryan Brodkin","updated_at":"2026-01-26T04:24:50.995076461Z","closed_at":"2026-01-26T04:24:50.995080503Z","dependencies":[{"issue_id":"clack-rcgx.6","depends_on_id":"clack-rcgx","type":"parent-child","created_at":"2026-01-24T04:02:07.366257292Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-rcgx.6","depends_on_id":"clack-rcgx.1","type":"blocks","created_at":"2026-01-24T04:03:01.486072845Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-rcgx.6","depends_on_id":"clack-rcgx.2","type":"blocks","created_at":"2026-01-24T04:03:01.910568387Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-rcgx.7","title":"Update PageLayout with BottomTabBar","description":"## Objective\nIntegrate BottomTabBar into page layout with proper spacing.\n\n## File\nsrc/web/frontend/components/PageLayout.tsx\n\n## Implementation\n- Add BottomTabBar component (mobile only)\n- Hide top Navigation on mobile (keep for desktop)\n- Add bottom padding to content area for tab bar clearance (~80px)\n- Ensure content scrolls correctly under tab bar\n\n## Dependencies\n- Requires: clack-rcgx.3 (BottomTabBar component)\n\n## Acceptance Criteria\n- [ ] Tab bar visible on mobile\n- [ ] Tab bar hidden on desktop (md+)\n- [ ] Content doesn't get cut off by tab bar\n- [ ] Page scrolling works correctly\n- [ ] Glass effect shows content scrolling underneath","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-24T04:02:12.614122961Z","created_by":"Ryan Brodkin","updated_at":"2026-01-26T04:24:51.056356919Z","closed_at":"2026-01-26T04:24:51.056359419Z","dependencies":[{"issue_id":"clack-rcgx.7","depends_on_id":"clack-rcgx","type":"parent-child","created_at":"2026-01-24T04:02:12.626719295Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-rcgx.7","depends_on_id":"clack-rcgx.3","type":"blocks","created_at":"2026-01-24T04:03:02.314019929Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-rcgx.8","title":"Simplify Navigation for desktop only","description":"## Objective\nSimplify top navigation for desktop-only display.\n\n## File\nsrc/web/frontend/components/Navigation.tsx\n\n## Implementation\n- Remove hamburger menu (Sheet component)\n- Simplify to logo + 3 horizontal links: Home, History, Account\n- Hide on mobile (hidden md:block)\n- Clean up unused imports\n\n## Acceptance Criteria\n- [ ] No hamburger menu\n- [ ] Hidden on mobile viewports\n- [ ] Visible on desktop (768px+)\n- [ ] Links work correctly\n- [ ] Removed Sheet/Menu imports if unused","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-24T04:02:17.967399297Z","created_by":"Ryan Brodkin","updated_at":"2026-01-26T04:24:51.113006003Z","closed_at":"2026-01-26T04:24:51.113008628Z","dependencies":[{"issue_id":"clack-rcgx.8","depends_on_id":"clack-rcgx","type":"parent-child","created_at":"2026-01-24T04:02:17.979338131Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-rcgx.9","title":"Restructure Account page with Admin section","description":"## Objective\nAdd tabbed interface to Account page, integrating Admin controls.\n\n## File\nsrc/web/frontend/pages/Account.tsx\n\n## Implementation\n- Add tab navigation within Account page\n- Tabs: Profile, Passkeys, Admin (if authorized)\n- Move circuit breaker controls from Admin page into Admin tab\n- Dev-only: Style Guide link at bottom\n- Preserve existing Profile and Passkeys UI\n\n## Dependencies\n- May reference: src/web/frontend/pages/Admin.tsx (for circuit breaker UI)\n\n## Acceptance Criteria\n- [ ] Tab navigation works correctly\n- [ ] Admin tab only visible to authorized users\n- [ ] Circuit breaker controls functional in new location\n- [ ] Profile and Passkeys tabs unchanged\n- [ ] Style Guide visible in dev mode only\n- [ ] Responsive on mobile and desktop","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-24T04:02:23.390672341Z","created_by":"Ryan Brodkin","updated_at":"2026-01-26T04:24:51.169632294Z","closed_at":"2026-01-26T04:24:51.169634628Z","dependencies":[{"issue_id":"clack-rcgx.9","depends_on_id":"clack-rcgx","type":"parent-child","created_at":"2026-01-24T04:02:23.396700425Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-ri63","title":"Remove countdown generator entirely","description":"Remove the countdown content generator entirely from the codebase.\n\nGoal: Delete all files, references, and registrations related to countdown / CountdownGenerator\n\nSuccess criteria:\n- Build passes\n- All tests pass with 80%+ coverage\n- No references to countdown generator remain\n- content:list shows no countdown generator\n\nExecution Order:\n- Phase 1: clack-ri63.2 (remove registration), clack-ri63.3 (remove tests) - parallel\n- Phase 2: clack-ri63.1 (delete source files) - after Phase 1\n- Phase 3: clack-ri63.4 (validation) - after all","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-12T09:05:27.669116301Z","created_by":"vscode","updated_at":"2026-01-12T17:56:05.129254134Z","closed_at":"2026-01-12T17:56:05.129254134Z","close_reason":"Countdown generator removed"}
{"id":"clack-ri63.1","title":"Remove countdown generator source files","description":"Delete source files and clean up exports.\n\nFiles to delete:\n- src/content/generators/ai/countdown-generator.ts\n- prompts/user/countdown.txt\n\nFiles to modify:\n- src/content/generators/ai/index.ts - Remove CountdownGenerator export\n\nAcceptance criteria:\n- Files deleted\n- No import errors in remaining code\n- TypeScript compilation succeeds\n\nExecution note: Can proceed after clack-ri63.2 (registration removal) completes, as imports must be removed from registry first.","notes":"Parent epic closed - countdown generator removed","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T09:05:41.878659627Z","created_by":"vscode","updated_at":"2026-01-23T22:36:40.77116701Z","closed_at":"2026-01-23T22:36:40.771172718Z","dependencies":[{"issue_id":"clack-ri63.1","depends_on_id":"clack-ri63","type":"parent-child","created_at":"2026-01-12T09:05:41.879547668Z","created_by":"vscode"},{"issue_id":"clack-ri63.1","depends_on_id":"clack-ri63.2","type":"blocks","created_at":"2026-01-12T09:05:51.894437756Z","created_by":"vscode"}]}
{"id":"clack-ri63.2","title":"Remove countdown generator registration","description":"Remove from registry and bootstrap.\n\nFiles to modify:\n- src/content/registry/register-core.ts - Remove countdown from CoreGenerators interface and registerCoreContent()\n- src/bootstrap.ts - Remove CountdownGenerator import and instantiation from createCoreGenerators()\n\nAcceptance criteria:\n- CoreGenerators interface no longer has countdown property\n- registerCoreContent() no longer registers countdown\n- createCoreGenerators() no longer creates CountdownGenerator instance\n\nExecution note: Part of Phase 1 (parallel with clack-ri63.3). Both must complete before clack-ri63.1 (file deletion).","notes":"Parent epic closed - countdown generator removed","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T09:05:43.00619446Z","created_by":"vscode","updated_at":"2026-01-23T22:36:40.773749885Z","closed_at":"2026-01-23T22:36:40.773751926Z","dependencies":[{"issue_id":"clack-ri63.2","depends_on_id":"clack-ri63","type":"parent-child","created_at":"2026-01-12T09:05:43.009093169Z","created_by":"vscode"}]}
{"id":"clack-ri63.3","title":"Clean up countdown generator tests","description":"Remove test files.\n\nFiles to delete:\n- tests/unit/content/generators/ai/countdown-generator.test.ts\n- Remove countdown references from tests/unit/content/registry/register-core.test.ts\n\nNote: No fixture references found for countdown generator.\n\nAcceptance criteria:\n- All tests pass\n- No test files reference countdown generator\n- 80%+ coverage maintained after removal\n\nExecution note: Part of Phase 1 (parallel with clack-ri63.2). Both must complete before clack-ri63.1 (file deletion).","notes":"Parent epic closed - countdown generator removed","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T09:05:44.018917878Z","created_by":"vscode","updated_at":"2026-01-23T22:36:40.775893843Z","closed_at":"2026-01-23T22:36:40.775897843Z","dependencies":[{"issue_id":"clack-ri63.3","depends_on_id":"clack-ri63","type":"parent-child","created_at":"2026-01-12T09:05:44.025447419Z","created_by":"vscode"}]}
{"id":"clack-ri63.4","title":"Validate build and tests after countdown removal","description":"Final validation that removal is complete.\n\nSteps:\n- Run npm run build\n- Run npm test\n- Verify 80%+ coverage maintained\n- Run npm run content:list to verify generator is removed\n\nAcceptance criteria:\n- Build succeeds with no TypeScript errors\n- All tests pass with 80%+ coverage\n- content:list shows no countdown generator\n- No countdown references remain in codebase\n\nExecution note: Runs after clack-ri63.1, clack-ri63.2, and clack-ri63.3 all complete.","notes":"Parent epic closed - countdown generator removed","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T09:05:44.898461295Z","created_by":"vscode","updated_at":"2026-01-23T22:36:40.777900843Z","closed_at":"2026-01-23T22:36:40.77790276Z","dependencies":[{"issue_id":"clack-ri63.4","depends_on_id":"clack-ri63","type":"parent-child","created_at":"2026-01-12T09:05:44.903123961Z","created_by":"vscode"},{"issue_id":"clack-ri63.4","depends_on_id":"clack-ri63.1","type":"blocks","created_at":"2026-01-12T09:05:51.915392506Z","created_by":"vscode"},{"issue_id":"clack-ri63.4","depends_on_id":"clack-ri63.2","type":"blocks","created_at":"2026-01-12T09:05:51.935398965Z","created_by":"vscode"},{"issue_id":"clack-ri63.4","depends_on_id":"clack-ri63.3","type":"blocks","created_at":"2026-01-12T09:05:51.956537923Z","created_by":"vscode"}]}
{"id":"clack-riby","title":"Fix Minor Update Startup Failure","description":"Production Docker deployment crashes on fresh installs when minor updates run before any major update has populated the cache.\n\n**Error:**\n```\nFailed to run minor update: Error: No cached content available for minor update. A major update must be performed first.\n```\n\n**Root Cause:** CronScheduler throws an unhandled error when MinorUpdateGenerator has no cached content.\n\n**Solution:**\n1. CronScheduler gracefully skips minor updates when cache is empty\n2. Clear logging indicates system is waiting for first major update\n3. No retry loops - relies on HA events or manual CLI trigger\n\n**Success Criteria:**\n- Minor updates skip gracefully when no cached content available (no crash)\n- Clear logs explain how to trigger first major update manually\n- After first major update succeeds, minor updates resume normally","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-04T02:46:22.658541043Z","created_by":"vscode","updated_at":"2026-01-04T03:52:44.568131887Z","closed_at":"2026-01-04T03:52:44.568131887Z","close_reason":"Closed"}
{"id":"clack-riby.1","title":"Add graceful cache miss handling to CronScheduler","description":"Modify `CronScheduler.runMinorUpdate()` to gracefully skip when no cached content is available, instead of crashing.\n\n**Changes Required:**\n- Catch \"No cached content\" error specifically in `runMinorUpdate()`\n- Log user-friendly message: \"Minor update skipped - waiting for first major update\"\n- Continue running scheduler (don't crash)\n- After a major update succeeds (via HA event or CLI), minor updates resume normally\n\n**Files:** `src/scheduler/cron.ts`\n\n**Acceptance Criteria:**\n- [ ] `runMinorUpdate()` catches cache miss error\n- [ ] Logs clear message about waiting for first major update\n- [ ] Scheduler continues running after cache miss\n- [ ] Minor updates work after cache is populated\n\n**Parallel Work:** Can run concurrently with clack-riby child #2 (no file overlap)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-04T02:46:37.103002425Z","created_by":"vscode","updated_at":"2026-01-04T03:52:44.503791428Z","closed_at":"2026-01-04T03:52:44.503791428Z","close_reason":"Closed","dependencies":[{"issue_id":"clack-riby.1","depends_on_id":"clack-riby","type":"parent-child","created_at":"2026-01-04T02:46:37.110803342Z","created_by":"vscode"}]}
{"id":"clack-riby.2","title":"Simplify initial major update to single attempt","description":"Keep the existing single-attempt logic in `src/index.ts` but improve logging to make failure state clear. No retry loop - if it fails, the system relies on HA events or manual `npm run generate` to populate the cache.\n\n**Changes Required:**\n- Improve failure logging to explain next steps\n- Log message should mention: \"Run 'npm run generate' or wait for Home Assistant event\"\n- No retry loop, no exponential backoff, no API spam risk\n\n**Files:** `src/index.ts`\n\n**Acceptance Criteria:**\n- [ ] Single initial major update attempt (already exists)\n- [ ] On failure: log clear message explaining manual trigger options\n- [ ] Scheduler starts regardless of initial update success/failure\n- [ ] No retry loop added\n\n**Parallel Work:** Can run concurrently with clack-riby.1 (no file overlap)\n\n**Note:** Tests for this logging change are NOT in scope for clack-riby.3 (which focuses on CronScheduler). Logging improvements can be verified manually or via e2e testing.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T02:46:38.414267134Z","created_by":"vscode","updated_at":"2026-01-04T03:52:44.528877762Z","closed_at":"2026-01-04T03:52:44.528877762Z","close_reason":"Closed","dependencies":[{"issue_id":"clack-riby.2","depends_on_id":"clack-riby","type":"parent-child","created_at":"2026-01-04T02:46:38.423403134Z","created_by":"vscode"}]}
{"id":"clack-riby.3","title":"Add tests for cache miss scenarios","description":"Write unit tests verifying the graceful degradation behavior for the scheduler cache miss handling.\n\n**Changes Required:**\n- Add tests for CronScheduler cache miss behavior\n- Verify scheduler continues running after cache miss\n- Verify minor updates work after cache is populated\n\n**Files:** `tests/unit/scheduler/cron.test.ts`\n\n**Acceptance Criteria:**\n- [ ] Test: `CronScheduler` skips minor update when no cache available\n- [ ] Test: `CronScheduler` continues running after cache miss\n- [ ] Test: Minor updates work after cache is populated\n\n**Related Issues:** clack-riby.1, clack-riby.2","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T02:46:47.575551263Z","created_by":"vscode","updated_at":"2026-01-04T03:52:44.54778047Z","closed_at":"2026-01-04T03:52:44.54778047Z","close_reason":"Closed","dependencies":[{"issue_id":"clack-riby.3","depends_on_id":"clack-riby","type":"parent-child","created_at":"2026-01-04T02:46:47.58227568Z","created_by":"vscode"},{"issue_id":"clack-riby.3","depends_on_id":"clack-riby.1","type":"blocks","created_at":"2026-01-04T02:46:52.514425585Z","created_by":"vscode"}]}
{"id":"clack-rjyb","title":"AI Generators - News \u0026 Learning","description":"## Overview\nMove second batch of AI generator tests (news, learning, serial story) to integration with real PromptLoader.\n\n## Risk Level\nHIGH - Different generator types (RSS-based, database-dependent). If news mocking breaks, it is isolated to this batch.\n\n## Dependencies\nRequires Epic 1 (Testing Foundations) to establish patterns.\n\n## Files Affected\n8 test files from tests/unit/content/generators/ai/ -\u003e tests/integration/content/generators/ai/\n\n## Success Criteria\n- [ ] All 8 generator test files moved to integration directory\n- [ ] Use real PromptLoader (load actual prompt files)\n- [ ] Mock only AI provider responses at boundary\n- [ ] Replace fixed count assertions with flexible assertions\n- [ ] All tests pass in integration environment\n\n## Parallel Execution Context\nThis epic runs IN PARALLEL with these sibling epics (no file overlap):\n- clack-b8xx: CLI Command Test Migration\n- clack-7yso: Storage Layer Test Migration\n- clack-uotb: AI Generators - Hot Take \u0026 Personality\n- clack-te4l: AI Generators - Philosophical \u0026 Misc\n- clack-5tjn: Core Orchestration Tests\n\nEach domain is isolated - failures in this epic do NOT affect sibling epics.","status":"open","priority":1,"issue_type":"epic","owner":"ryan@spice.cc","created_at":"2026-01-27T22:21:16.874145134Z","created_by":"Ryan Brodkin","updated_at":"2026-01-27T22:36:20.05753201Z","dependencies":[{"issue_id":"clack-rjyb","depends_on_id":"clack-3n0y","type":"blocks","created_at":"2026-01-27T22:28:40.996818047Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-rjyb.1","title":"Move AI generator tests batch 2","description":"## Objective\nMove second batch (news, learning content) from unit to integration with same refactoring approach as batch 1.\n\n## TDD Approach\n1. RED: Move test files, update imports (tests may fail due to heavy mocking removal)\n2. GREEN: Replace internal mocks with real PromptLoader/ModelTierSelector, mock only AI provider at boundary\n3. BLUE: Replace fixed counts with flexible assertions, remove existence checks\n\n## Acceptance Criteria\n- [ ] Move 8 generator test files to integration directory\n- [ ] Use real PromptLoader (load actual prompt files)\n- [ ] Use real ModelTierSelector\n- [ ] Mock only AI provider responses at boundary (use createMockAIProvider helper)\n- [ ] Replace fixed count assertions with flexible assertions\n- [ ] Remove arbitrary existence checks\n- [ ] Test public API only\n- [ ] All tests pass in integration environment\n\n## Scope\nFiles: language-lesson, serial-story, wakeup-greeting, word-of-the-day, local-news, base-news, novel-insight, haiku (8 test files)","status":"open","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-27T22:26:25.966883721Z","created_by":"Ryan Brodkin","updated_at":"2026-01-27T22:26:25.966883721Z","dependencies":[{"issue_id":"clack-rjyb.1","depends_on_id":"clack-rjyb","type":"parent-child","created_at":"2026-01-27T22:26:25.969626888Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-rmk","title":"[MEDIUM] Remove tautological compile-time tests in programmatic-generator.test.ts","description":"**File:** tests/unit/content/generators/programmatic-generator.test.ts\n**Lines:** 56-70\n**Category:** Tests That Do Nothing\n**Severity:** Medium\n\n## Problem\nTwo tests have tautological assertions or test implementation details:\n- Line 56-62: `expect(true).toBe(true)` - always passes\n- Line 64-70: Only verifies `generate` is a function, not actual behavior\n\n## Evidence\n```typescript\nit('should not be directly instantiable at compile time', () =\u003e {\n  const compileTimeCheck = true;\n  expect(compileTimeCheck).toBe(true);  // ← Tautological\n});\n```\n\n## Implementation Instructions\n1. **Remove lines 56-62** entirely - TypeScript handles abstract class enforcement\n2. **Replace lines 64-70** with actual behavior test:\n```typescript\nit('should call generate implementation in subclass', async () =\u003e {\n  const result = await generator.generate(mockContext);\n  expect(result).toBeDefined();\n  expect(result.text).toBe('expected value');\n});\n```\n\n## Acceptance Criteria\n- [ ] No tautological `expect(true).toBe(true)` assertions\n- [ ] Tests verify actual generation behavior\n- [ ] Compile-time checks removed (TypeScript handles these)","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-11-29T05:07:09.289101301Z","updated_at":"2026-01-03T21:41:47.645866918Z","labels":["medium","testing"],"dependencies":[{"issue_id":"clack-rmk","depends_on_id":"clack-anr5","type":"parent-child","created_at":"2025-11-29T07:00:50.317610222Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-rnx","title":"Implement validateGeneratorOutput() function","description":"Create comprehensive validation in src/utils/validators.ts that validates generator output against Vestaboard constraints. Returns detailed ValidationResult for CLI display AND throws ContentValidationError on failure for orchestrator integration.","design":"File: src/utils/validators.ts\n\nKey functions:\n- validateGeneratorOutput(content) - main entry point\n- validateTextContent(text) - for outputMode='text' (5 lines × 21 chars)\n- validateLayoutContent(layout) - for outputMode='layout' (6 rows × 22 cols, codes 0-69)\n- findInvalidCharacters(text) - check against VESTABOARD.SUPPORTED_CHARS\n\nValidationResult interface:\n- valid: boolean\n- lineCount: number\n- maxLineLength: number\n- invalidChars: string[]\n- errors: string[]\n\nAlso add FRAMED_MAX_ROWS=5 and FRAMED_MAX_COLS=21 to src/config/constants.ts","acceptance_criteria":"- Validates text mode: max 5 lines, max 21 chars/line, valid characters\n- Validates layout mode: 6×22 dimensions, codes 0-69\n- Returns detailed result for CLI display\n- Throws ContentValidationError on failure","status":"tombstone","priority":1,"issue_type":"feature","created_at":"2025-11-27T20:03:10.115877174Z","updated_at":"2026-01-03T21:41:47.645866918Z","dependencies":[{"issue_id":"clack-rnx","depends_on_id":"clack-foo","type":"parent-child","created_at":"2025-11-27T20:03:23.062846347Z","created_by":"daemon"},{"issue_id":"clack-rnx","depends_on_id":"clack-gpc","type":"blocks","created_at":"2025-11-27T20:03:30.046544919Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature"}
{"id":"clack-rokx","title":"Timing and Flaky Test Stabilization","description":"Fix tests with timing dependencies, timezone issues, and randomness that cause flaky behavior in CI.\n\nIncludes:\n- info-bar.test.ts timezone-dependent assertions (HIGH)\n- color-bar.test.ts season/holiday detection (HIGH)\n- static-fallback-generator.test.ts probabilistic randomness\n- dimensions.test.ts flaky randomness\n- home-assistant.test.ts exponential backoff\n- generate.test.ts timing-dependent timestamp","status":"tombstone","priority":2,"issue_type":"epic","created_at":"2025-11-29T07:00:21.088294347Z","updated_at":"2026-01-03T21:41:47.645866918Z","close_reason":"All 6 child tasks completed","dependencies":[{"issue_id":"clack-rokx","depends_on_id":"clack-d719","type":"blocks","created_at":"2025-11-29T07:06:00.41800267Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"clack-rvq","title":"Complete Failure Logging for Content Generation","description":"Validation failures (like ContentValidationError) lose critical debugging information. When the AI generates content that fails validation, the text, aiProvider, aiModel, modelTier, and tokensUsed are not saved to the database.\n\n**Root Cause**: In orchestrator.ts, `content` is scoped inside the try block but validation throws in the same block. The catch handler only receives the error, losing all content metadata.\n\n**Impact**: Cannot correlate failures with specific providers/models. Cannot see what text actually failed validation.","acceptance_criteria":"- [ ] Validation failures log the failed text\n- [ ] Validation failures log aiProvider, aiModel, modelTier, tokensUsed\n- [ ] Provider failures continue to work (no regression)\n- [ ] Unit tests cover both failure scenarios\n- [ ] 80%+ test coverage maintained","status":"tombstone","priority":1,"issue_type":"epic","created_at":"2025-11-28T07:50:16.400617172Z","updated_at":"2026-01-03T21:41:47.645866918Z","deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"clack-s2a","title":"[HIGH] Fix color-bar.test.ts season/holiday detection tests that do nothing","description":"**File:** tests/unit/content/frame/color-bar.test.ts\n**Lines:** 171-239\n**Category:** Tests That Do Nothing\n**Severity:** High\n\n## Problem\n11 tests in the \"Season detection\" and \"Holiday detection\" blocks (lines 171-239) are testing the wrong thing. They set the system time, call `getColors()`, then assert `mockProvider.mockResponse.toBeTruthy()`. The `mockResponse` is initialized in `beforeEach` and never changes during the test, so this assertion always passes regardless of whether season detection actually works.\n\n## Evidence\n```typescript\n// Lines 171-196 (Example from season detection)\nit('should detect spring (March-May)', async () =\u003e {\n  jest.setSystemTime(new Date('2024-03-15'));\n  await service.getColors();\n  // Verify season is used in prompt by checking the AI was called\n  expect(mockProvider.mockResponse).toBeTruthy();  // ← Always true!\n});\n```\n\n## Implementation Instructions\n1. **Spy on mockProvider.generate()** instead of checking mockResponse\n2. **Assert the prompt contains season keywords**:\n   ```typescript\n   it('should detect spring (March-May)', async () =\u003e {\n     jest.setSystemTime(new Date('2024-03-15'));\n     const generateSpy = jest.spyOn(mockProvider, 'generate');\n     await service.getColors();\n     expect(generateSpy).toHaveBeenCalledWith(\n       expect.objectContaining({\n         userPrompt: expect.stringContaining('spring')\n       })\n     );\n   });\n   ```\n3. **Apply same fix to all 11 tests** in both season and holiday detection blocks\n4. **Alternative:** Remove these tests if season detection is tested elsewhere\n\n## Acceptance Criteria\n- [ ] All season detection tests verify prompt contains season name\n- [ ] All holiday detection tests verify prompt contains holiday name\n- [ ] No tests use the tautological `mockResponse.toBeTruthy()` pattern\n- [ ] Tests actually fail when season/holiday detection is broken","status":"tombstone","priority":1,"issue_type":"bug","created_at":"2025-11-29T05:06:01.842509464Z","updated_at":"2026-01-03T21:41:47.645866918Z","close_reason":"Verified complete by code review","labels":["high","testing"],"dependencies":[{"issue_id":"clack-s2a","depends_on_id":"clack-s9o","type":"parent-child","created_at":"2025-11-29T05:09:49.805197875Z","created_by":"daemon"},{"issue_id":"clack-s2a","depends_on_id":"clack-rokx","type":"parent-child","created_at":"2025-11-29T07:01:04.350520756Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"bug"}
{"id":"clack-s9o","title":"Test Suite Quality Refactoring","description":"Comprehensive refactoring of Jest test suite to address quality issues discovered during audit.\n\n## Summary\n- **Total test files reviewed:** 80\n- **Files with issues:** ~35\n- **Total issues identified:** ~95\n\n## Issues by Category\n| Category | Count |\n|----------|-------|\n| Tests That Do Nothing | 18 |\n| Tests That Are Too Brittle | 35 |\n| Tests That Don't Make Sense | 42 |\n| API Contact Violations | 0 ✓ |\n\n## Issues by Severity\n| Severity | Count |\n|----------|-------|\n| Critical | 4 |\n| High | 10 |\n| Medium | ~60 |\n| Low | ~21 |\n\n## Key Problem Patterns\n1. **Incomplete test setup** - Tests expecting failures due to missing mocks (ai-prompt-generator.test.ts)\n2. **Tautological assertions** - expect(true).toBe(true), typeof checks\n3. **Testing implementation details** - ANSI codes, middleware order, exact string formats\n4. **Testing mocks not code** - Verifying mock return values instead of actual behavior\n5. **Timing-dependent tests** - Tests relying on real time rather than mocked timers\n6. **Duplicate/redundant tests** - Same assertions repeated in different contexts\n\n## Acceptance Criteria\n- [ ] All critical severity issues resolved\n- [ ] All high severity issues resolved\n- [ ] Medium severity issues addressed or documented as acceptable\n- [ ] Test suite passes with 80%+ coverage maintained\n- [ ] No new quality issues introduced","status":"tombstone","priority":1,"issue_type":"epic","created_at":"2025-11-29T05:04:42.635819219Z","updated_at":"2026-01-03T21:41:47.645866918Z","labels":["quality","refactoring","testing"],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"clack-suz","title":"Create Mock Utilities for Testing","description":"Create mock factory functions for character converter, HTTP client, and Vestaboard client to enable comprehensive unit testing without real HTTP calls.","design":"## Mock Factory Pattern\nReference: tests/__mocks__/ai-providers.ts\n\nThree mock levels:\n1. Character converter mock (for testing orchestrator)\n2. HTTP client mock (for testing client)\n3. High-level client mock (for testing usage sites)\n\nEach mock supports:\n- Success scenarios\n- Failure scenarios\n- Custom behavior configuration\n- Message capture for assertions","acceptance_criteria":"- tests/__mocks__/vestaboard.ts created\n- MockCharacterConverterOptions interface defined\n- createMockCharacterConverter() factory function\n- MockVestaboardHTTPClientOptions interface defined\n- createMockVestaboardHTTPClient() factory function\n- MockVestaboardClientOptions interface defined\n- createMockVestaboardClient() factory function\n- Success/failure mode support in all mocks\n- Message capture capability in HTTP and client mocks\n- getSentMessages() helper methods\n- Pattern matches tests/__mocks__/ai-providers.ts structure\n- Comprehensive JSDoc documentation","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-11-26T05:24:58.203969257Z","updated_at":"2026-01-03T21:41:47.645866918Z","dependencies":[{"issue_id":"clack-suz","depends_on_id":"clack-7tb","type":"blocks","created_at":"2025-11-26T05:24:58.204972715Z","created_by":"daemon"},{"issue_id":"clack-suz","depends_on_id":"clack-2jo","type":"parent-child","created_at":"2025-11-26T23:06:05.290281168Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-t51","title":"Update Project Documentation","description":"Update CLAUDE.md with HA client API documentation, architecture diagram, key methods, and usage patterns.","acceptance_criteria":"- CLAUDE.md API Layer section updated\n- HA client in architecture diagram\n- Key methods documented\n- Error types documented\n- Example usage patterns\n- Environment configuration section updated","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-11-24T00:19:00.208203547Z","updated_at":"2026-01-03T21:41:47.645866918Z","dependencies":[{"issue_id":"clack-t51","depends_on_id":"clack-ar9","type":"blocks","created_at":"2025-11-24T00:20:15.948416596Z","created_by":"daemon"},{"issue_id":"clack-t51","depends_on_id":"clack-iwr","type":"blocks","created_at":"2025-11-24T00:20:17.315702638Z","created_by":"daemon"},{"issue_id":"clack-t51","depends_on_id":"clack-2w5","type":"blocks","created_at":"2025-11-24T00:20:18.581072833Z","created_by":"daemon"},{"issue_id":"clack-t51","depends_on_id":"clack-y4k","type":"blocks","created_at":"2025-11-24T00:20:19.886745167Z","created_by":"daemon"},{"issue_id":"clack-t51","depends_on_id":"clack-1wi","type":"blocks","created_at":"2025-11-24T00:20:21.165765876Z","created_by":"daemon"},{"issue_id":"clack-t51","depends_on_id":"clack-p30","type":"blocks","created_at":"2025-11-24T00:20:22.403151126Z","created_by":"daemon"},{"issue_id":"clack-t51","depends_on_id":"clack-3my","type":"parent-child","created_at":"2025-11-24T04:21:00.6916945Z","created_by":"vscode"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-t73","title":"[MEDIUM] Remove typeof checks in news-generator.test.ts","description":"**File:** tests/unit/content/generators/ai/news-generator.test.ts\n**Lines:** 116-160\n**Category:** Doesn't Make Sense\n**Severity:** Medium\n\n## Problem\nSame pattern as motivational-generator.test.ts:\n- Lines 116-128: Named \"generate()\" but only calls getters\n- Lines 130-139: Only checks typeof\n- Lines 142-160: Only typeof checks\n\n## Implementation Instructions\n1. **Remove lines 130-139 and 142-160**\n2. **Fix or remove lines 116-128**\n\n## Acceptance Criteria\n- [ ] No typeof checks\n- [ ] Tests that claim to test generate() actually call it\n- [ ] Redundant tests removed","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-11-29T05:07:15.02780047Z","updated_at":"2026-01-03T21:41:47.645866918Z","labels":["medium","testing"],"dependencies":[{"issue_id":"clack-t73","depends_on_id":"clack-anr5","type":"parent-child","created_at":"2025-11-29T07:00:49.207980888Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-t9j","title":"Persist Major Updates to Database","description":"Save successful major update content to database after sending to Vestaboard. Also persist failures.\n\n**Files to modify**:\n- `src/content/orchestrator.ts` - Add persistence after successful send\n- `src/content/orchestrator.ts` - Add failure persistence on generation errors\n\n**Implementation**:\n- After successful send: save with status='success', all metadata\n- On failure: save with status='failed', errorType, errorMessage\n- Use fire-and-forget pattern (don't block content delivery)","acceptance_criteria":"- Successful major updates saved to database\n- Failed generations saved with error details\n- Database errors don't block content delivery\n- All metadata fields populated correctly","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-11-27T21:49:10.605108424Z","updated_at":"2026-01-03T21:41:47.645866918Z","labels":["feature"],"dependencies":[{"issue_id":"clack-t9j","depends_on_id":"clack-kgt","type":"blocks","created_at":"2025-11-27T21:49:32.412572211Z","created_by":"daemon"},{"issue_id":"clack-t9j","depends_on_id":"clack-hfu","type":"parent-child","created_at":"2025-11-27T21:49:45.571119176Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-te4l","title":"AI Generators - Philosophical \u0026 Misc","description":"## Overview\nMove third batch of AI generator tests (philosophical, observational content) to integration with real PromptLoader.\n\n## Risk Level\nHIGH - Different generator types (ISS API, fortune cookies). If external API mocking breaks, it is isolated to this batch.\n\n## Dependencies\nRequires Epic 1 (Testing Foundations) to establish patterns.\n\n## Files Affected\n9 test files from tests/unit/content/generators/ai/ -\u003e tests/integration/content/generators/ai/\n\n## Success Criteria\n- [ ] All 9 generator test files moved to integration directory\n- [ ] Use real PromptLoader (load actual prompt files)\n- [ ] Mock only AI provider responses and external APIs at boundary\n- [ ] Replace fixed count assertions with flexible assertions\n- [ ] All tests pass in integration environment\n\n## Parallel Execution Context\nThis epic runs IN PARALLEL with these sibling epics (no file overlap):\n- clack-b8xx: CLI Command Test Migration\n- clack-7yso: Storage Layer Test Migration\n- clack-uotb: AI Generators - Hot Take \u0026 Personality\n- clack-rjyb: AI Generators - News \u0026 Learning\n- clack-5tjn: Core Orchestration Tests\n\nEach domain is isolated - failures in this epic do NOT affect sibling epics.","status":"open","priority":1,"issue_type":"epic","owner":"ryan@spice.cc","created_at":"2026-01-27T22:26:59.0837725Z","created_by":"Ryan Brodkin","updated_at":"2026-01-27T22:36:21.317966719Z","dependencies":[{"issue_id":"clack-te4l","depends_on_id":"clack-3n0y","type":"blocks","created_at":"2026-01-27T22:28:41.050101839Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-te4l.1","title":"Move AI generator tests batch 3","description":"## Objective\nMove final batch (philosophical, misc) from unit to integration with same refactoring approach as batches 1-2.\n\n## TDD Approach\n1. RED: Move test files, update imports (tests may fail due to heavy mocking removal)\n2. GREEN: Replace internal mocks with real PromptLoader/ModelTierSelector, mock only AI provider at boundary\n3. BLUE: Replace fixed counts with flexible assertions, remove existence checks\n\n## Acceptance Criteria\n- [ ] Move 9 generator test files to integration directory\n- [ ] Use real PromptLoader (load actual prompt files)\n- [ ] Use real ModelTierSelector\n- [ ] Mock only AI provider responses at boundary (use createMockAIProvider helper)\n- [ ] Replace fixed count assertions with flexible assertions\n- [ ] Remove arbitrary existence checks\n- [ ] Test public API only\n- [ ] All tests pass in integration environment\n\n## Scope\nFiles: shower-thought, paradox-engine, news, time-perspective, iss-observer, sleep-greeting, global-news, fortune-cookie, tech-news (9 test files)","status":"open","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-27T22:27:26.897409305Z","created_by":"Ryan Brodkin","updated_at":"2026-01-27T22:27:26.897409305Z","dependencies":[{"issue_id":"clack-te4l.1","depends_on_id":"clack-te4l","type":"parent-child","created_at":"2026-01-27T22:27:26.898194305Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-tuh1","title":"Fix Docker deployment for production daemon and connectivity","description":"Production Docker deployment is semi-functional: container runs but scheduler never starts (no minor updates), AI calls fail with wrong model name, and mDNS resolution doesn't work for Home Assistant.\n\n**Root Causes:**\n1. src/index.ts starts web server but never calls bootstrap() or scheduler.start()\n2. Default ANTHROPIC_MODEL is 'claude-sonnet-4' but API requires dated version\n3. Container cannot resolve homeassistant.local via mDNS\n\n**Success Criteria:**\n- Minor updates run every minute in production logs\n- AI calls succeed without 404 errors\n- Home Assistant connects via IP (10.100.0.10) or hostname (ha.lkw.rybro.io)","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-04T01:08:10.285352219Z","created_by":"vscode","updated_at":"2026-01-05T20:04:57.763238918Z","closed_at":"2026-01-05T20:04:57.763238918Z","close_reason":"All subtasks complete - Docker deployment fixed"}
{"id":"clack-tuh1.1","title":"Fix daemon mode - start scheduler and HA in production","description":"The current src/index.ts only starts the web server but never calls bootstrap() to initialize the scheduler and Home Assistant event handler. This means minor updates never run in the Docker container.\n\n**Changes Required:**\n- Web server mode must call bootstrap() to initialize all components\n- Call scheduler.start() after web server starts\n- Call eventHandler.initialize() if Home Assistant is configured\n- Add proper shutdown handling (SIGTERM/SIGINT) for graceful cleanup\n\n**Files:** src/index.ts\n\n**Acceptance Criteria:**\n- docker logs shows 'Cron scheduler started' message\n- Minor updates appear in logs every minute\n- Scheduler stops gracefully on container shutdown\n\n**Parallel Work:** Can run concurrently with clack-tuh1.2 and clack-tuh1.3 (no file overlap)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-04T01:08:46.297024847Z","created_by":"vscode","updated_at":"2026-01-05T20:04:57.684952959Z","closed_at":"2026-01-05T20:04:57.684952959Z","close_reason":"Code implemented - bootstrap() and scheduler.start() in src/index.ts","dependencies":[{"issue_id":"clack-tuh1.1","depends_on_id":"clack-tuh1","type":"parent-child","created_at":"2026-01-04T01:08:46.302081847Z","created_by":"vscode"}]}
{"id":"clack-tuh1.2","title":"Fix Anthropic default model name in config","description":"The default model in src/config/env.ts line 144 is 'claude-sonnet-4' but the Anthropic API requires dated version identifiers like 'claude-sonnet-4-5-20250929' (as defined in src/config/model-tiers.ts).\n\nThis causes 404 errors when ColorBarService tries to use the LIGHT tier model for color generation.\n\n**Changes Required:**\n- Update default ANTHROPIC_MODEL to match model-tiers.ts format\n- Consider using the LIGHT tier model as default (claude-haiku-4-5-20251001) since it is most commonly used\n\n**Files:** src/config/env.ts\n\n**Acceptance Criteria:**\n- AI calls succeed without 404 'model not found' errors\n- ColorBarService generates colors successfully\n\n**Parallel Work:** Can run concurrently with clack-tuh1.1 and clack-tuh1.3 (no file overlap)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T01:08:48.023088875Z","created_by":"vscode","updated_at":"2026-01-05T20:04:57.706883084Z","closed_at":"2026-01-05T20:04:57.706883084Z","close_reason":"Fixed - default model is claude-sonnet-4-5-20250929","dependencies":[{"issue_id":"clack-tuh1.2","depends_on_id":"clack-tuh1","type":"parent-child","created_at":"2026-01-04T01:08:48.028296375Z","created_by":"vscode"}]}
{"id":"clack-tuh1.3","title":"Configure Home Assistant connectivity with IP address","description":"Docker containers cannot resolve mDNS hostnames like 'homeassistant.local'. The production deployment needs to use either:\n- IP address: 10.100.0.10 (no SSL but that is acceptable)\n- Hostname: ha.lkw.rybro.io (SSL via load balancer, but may not support port 8123)\n\nSince WebSocket uses port 8123 and the load balancer may not forward it, recommend using the IP address with HTTP.\n\n**Changes Required:**\n- Update stack.yml or documentation to specify IP-based configuration\n- Document mDNS limitation in DEPLOY.md\n- Ensure secrets/env use http://10.100.0.10:8123 format\n\n**Files:** stack.yml, DEPLOY.md\n\n**Acceptance Criteria:**\n- Home Assistant WebSocket connection succeeds from container\n- Connection failure logs show meaningful error (not DNS resolution failure)\n- Documentation explains mDNS limitation and IP recommendation\n\n**Parallel Work:** Can run concurrently with clack-tuh1.1 and clack-tuh1.2 (no file overlap)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T01:08:49.261833042Z","created_by":"vscode","updated_at":"2026-01-05T20:04:57.725065043Z","closed_at":"2026-01-05T20:04:57.725065043Z","close_reason":"Configured in production","dependencies":[{"issue_id":"clack-tuh1.3","depends_on_id":"clack-tuh1","type":"parent-child","created_at":"2026-01-04T01:08:49.269514417Z","created_by":"vscode"}]}
{"id":"clack-tuh1.4","title":"Verify deployment fixes on production VM","description":"After code fixes are complete, rebuild and redeploy to the production VM to verify everything works.\n\n**Steps:**\n1. Rebuild Docker image with fixes\n2. Update secrets if needed (HOME_ASSISTANT_URL to use IP)\n3. Redeploy stack: docker stack deploy -c stack.yml clack-track\n4. Check logs: docker service logs clack-track_app -f\n\n**Verification Checklist:**\n- [ ] 'Cron scheduler started' appears in logs\n- [ ] Minor updates logged every minute\n- [ ] No 404 errors for AI model calls\n- [ ] Home Assistant connects (or gracefully degrades with warning)\n- [ ] Web interface accessible at http://host:3030\n\n**Assignee:** user (requires SSH access to production Docker host)","status":"closed","priority":2,"issue_type":"task","assignee":"user","created_at":"2026-01-04T01:08:50.413926626Z","created_by":"vscode","updated_at":"2026-01-05T20:04:57.743603168Z","closed_at":"2026-01-05T20:04:57.743603168Z","close_reason":"Verified by user","dependencies":[{"issue_id":"clack-tuh1.4","depends_on_id":"clack-tuh1","type":"parent-child","created_at":"2026-01-04T01:08:50.420088876Z","created_by":"vscode"},{"issue_id":"clack-tuh1.4","depends_on_id":"clack-tuh1.1","type":"blocks","created_at":"2026-01-04T01:08:58.075184338Z","created_by":"vscode"},{"issue_id":"clack-tuh1.4","depends_on_id":"clack-tuh1.2","type":"blocks","created_at":"2026-01-04T01:08:58.106963213Z","created_by":"vscode"},{"issue_id":"clack-tuh1.4","depends_on_id":"clack-tuh1.3","type":"blocks","created_at":"2026-01-04T01:08:58.127406171Z","created_by":"vscode"}]}
{"id":"clack-tya","title":"Account management page with passkey management","description":"Authenticated account page showing profile details, passkey management (add/remove), and logout functionality with mobile-friendly settings layout.","design":"**Account Display:**\n- Profile section (username, email, created date)\n- Passkey list with metadata (device name, last used, created)\n\n**Passkey Management:**\n- \"Add New Passkey\" triggers WebAuthn registration\n- \"Remove Passkey\" with confirmation dialog\n- Rename passkeys\n- Cannot remove last passkey (prevent lockout)\n\n**Backend Endpoints:**\n- GET /api/account/profile\n- POST /api/account/passkey/register/start\n- POST /api/account/passkey/register/verify\n- DELETE /api/account/passkey/:id\n- PATCH /api/account/passkey/:id\n\n**Authorization:**\n- requireAuth middleware on all endpoints\n- Session validation\n- 401 redirect to login","acceptance_criteria":"- [ ] Route protected (redirects if not authenticated)\n- [ ] Profile displays username, email, creation date\n- [ ] Passkey list shows all credentials with metadata\n- [ ] \"Add New Passkey\" triggers WebAuthn registration\n- [ ] User can name new passkeys\n- [ ] \"Remove Passkey\" shows confirmation dialog\n- [ ] Cannot remove last passkey (UI + backend validation)\n- [ ] User can rename passkeys\n- [ ] Logout clears session and redirects\n- [ ] requireAuth middleware validates session\n- [ ] Invalid session returns 401\n- [ ] Rate limiting on account endpoints\n- [ ] Mobile responsive with collapsible sections\n- [ ] 80%+ test coverage","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-11-26T05:05:08.915925429Z","updated_at":"2026-01-03T21:41:47.645866918Z","labels":["auth","ui","web"],"dependencies":[{"issue_id":"clack-tya","depends_on_id":"clack-dor","type":"parent-child","created_at":"2025-11-26T05:05:21.332468504Z","created_by":"daemon"},{"issue_id":"clack-tya","depends_on_id":"clack-ias","type":"blocks","created_at":"2025-11-26T05:05:30.833980258Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-u7h","title":"Implement Character Code Converter (Pure Functions)","description":"Create character conversion module with lookup table and pure functions to convert text to Vestaboard character codes. No dependencies, 100% unit testable.","design":"## Character Code Mapping (Vestaboard API)\n- Letters A-Z: codes 1-26\n- Numbers 0-9: 0=36, 1-9=27-35\n- Symbols: ! (37), @ (38), # (39), $ (40), etc.\n- Space/Blank: 0\n- Color codes: Red (63), Orange (64), Yellow (65), Green (66), Blue (67), Violet (68), White (69)\n\n## Pure Function Design\nAll functions stateless, deterministic, no side effects.\n\nReferences:\n- https://docs.vestaboard.com/docs/charactercodes/","acceptance_criteria":"- src/api/vestaboard/character-converter.ts created\n- CHARACTER_CODE_MAP constant with complete lookup table\n- textToCharacterCode(char: string): number function\n- rowToCharacterCodes(text: string): number[] function\n- layoutToCharacterCodes(layout: VestaboardLayout): number[][] function\n- isValidCharacter(char: string): boolean function\n- getSupportedCharacters(): Set\u0026lt;string\u0026gt; function\n- Uppercase normalization implemented\n- Unsupported characters throw VestaboardUnsupportedCharacterError\n- No external dependencies (pure module)\n- Exported from src/api/vestaboard/index.ts","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-11-26T05:24:18.212594627Z","updated_at":"2026-01-03T21:41:47.645866918Z","dependencies":[{"issue_id":"clack-u7h","depends_on_id":"clack-7tb","type":"blocks","created_at":"2025-11-26T05:24:18.213449294Z","created_by":"daemon"},{"issue_id":"clack-u7h","depends_on_id":"clack-2jo","type":"parent-child","created_at":"2025-11-26T23:06:05.063756709Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-udlb","title":"Add getTemplateVariables hook with random lucky numbers","description":"Override getTemplateVariables() in FortuneCookieGenerator to generate 6 random 1-2 digit numbers (10-99) and return them as template variable.\n\n**Acceptance Criteria:**\n- Generates 6 random integers between 10-99\n- Returns as space-separated string (e.g., '14 67 23 91 45 82')\n- Uses {{luckyNumbers}} as template variable name\n- Stores generated numbers in instance property for metadata tracking\n- Updates getCustomMetadata() to include generatedLuckyNumbers\n\n**Files:** src/content/generators/ai/fortune-cookie-generator.ts\n\n**Related Issues:**\n- clack-eyob: Updates the prompt to use {{luckyNumbers}} variable (parallel work, no file overlap)\n\n**Parallel Execution:** Can run simultaneously with clack-eyob (different files, no dependencies)","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-21T19:33:51.018381459Z","created_by":"Ryan Brodkin","updated_at":"2026-01-21T20:33:26.798491378Z","closed_at":"2026-01-21T20:33:26.798491378Z","close_reason":"Implemented and merged to main"}
{"id":"clack-uftx","title":"pushService.test.ts fails - cannot locate @/web/frontend/services/pushService.js module","description":"## Test Failure\n\n**File:** `tests/web/services/pushService.test.ts`\n**Error:** Configuration error - Could not locate module `@/web/frontend/services/pushService.js`\n\n```\nFAIL tests/web/services/pushService.test.ts\n  ● Test suite failed to run\n\n    Configuration error:\n\n    Could not locate module @/web/frontend/services/pushService.js mapped as:\n    /workspace/src/$1.\n\n      at createNoMappedModuleFoundError (node_modules/jest-resolve/build/index.js:1117:17)\n      at Object.\u003canonymous\u003e (tests/web/services/pushService.test.ts:8:1)\n```\n\n## Root Cause\nThe test imports from `@/web/frontend/services/pushService.js` at line 8, but this module doesn't exist. Either:\n1. The module was never created (incomplete feature)\n2. The module was moved/renamed\n3. The test was written for a planned but unimplemented feature\n\n## Investigation Needed\n- Check if `src/web/frontend/services/pushService.ts` exists\n- If not, determine if push notification service is planned or abandoned\n- Either create the module or remove the test\n\n## Impact\nThis test suite cannot run, causing 1 test failure in CI.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-11-29T07:29:40.1886113Z","updated_at":"2026-01-03T22:15:57.029909172Z","closed_at":"2026-01-03T22:15:57.029909172Z","close_reason":"Fixed module resolution and test failures: Added moduleNameMapper for .js extension stripping, DOM lib types, BufferSource type fix, Notification undefined check, test mock fixes. All 10 tests pass.","labels":["blocking","bug","testing"],"dependencies":[{"issue_id":"clack-uftx","depends_on_id":"clack-ofzp","type":"parent-child","created_at":"2025-11-29T08:29:10.8175633Z","created_by":"daemon"}]}
{"id":"clack-ujik","title":"Fix integration tests requiring real API credentials","description":"Three integration tests in `tests/integration/cli/content-commands.test.ts` fail when run without real API credentials.\n\n**Failing Tests:**\n1. should successfully test pattern-art generator\n2. should generate valid 6x22 pattern layout\n3. should produce valid color codes\n\n**Root Cause:**\nTests execute real npm CLI commands via `execSync` that bypass Jest mocks and attempt external API calls (OpenAI, Vestaboard) with test credentials.\n\n**Secondary Issue:**\nIntegration test environment lacks required database tables (circuit_breaker_state, content).\n\n**Recommended Fix:**\n- Mock `execSync` calls to bypass real CLI execution, OR\n- Mark these as 'live' tests requiring explicit flag (LIVE_INTEGRATION_TEST=true), OR\n- Add database initialization to integration test setup\n\n**Discovered During:**\nclack-q1dy refactoring epic - these failures pre-existed the refactoring.\n\nFiles:\n- tests/integration/cli/content-commands.test.ts","status":"closed","priority":3,"issue_type":"bug","owner":"ryan@spice.cc","created_at":"2026-01-20T09:51:49.270269761Z","created_by":"Ryan Brodkin","updated_at":"2026-01-24T00:08:06.354775214Z","closed_at":"2026-01-24T00:08:06.354775214Z","close_reason":"Closed"}
{"id":"clack-ujl","title":"[MEDIUM] Fix content-list.test.ts brittle regex section extraction","description":"**File:** tests/unit/cli/commands/content-list.test.ts\n**Lines:** 145-186, 305-324\n**Category:** Too Brittle\n**Severity:** Medium\n\n## Problem\nTests use complex regex patterns to extract output sections: `/P0.*?(?=P2|P3|Total:|$)/s`. This is extremely brittle - if output format or spacing changes, regex breaks.\n\n## Evidence\n```typescript\n// Lines 145-154 - Fragile regex extraction\nconst p0Section = output.match(/P0.*?(?=P2|P3|Total:|$)/s);\nconst p2Section = output.match(/P2.*?(?=P3|Total:|$)/s);\n\n// Lines 305-324 - Loose table character check\nexpect(output).toMatch(/[│|─-]/);  // ← Too loose, anything with pipes matches\n```\n\n## Implementation Instructions\n1. **Parse output into structured data** using split by section headers\n2. **Test each section separately** without complex regex\n3. **Or use snapshot testing** for exact output verification\n4. **Table format test** should verify actual structure, not just character presence\n\n## Acceptance Criteria\n- [ ] No complex regex for section extraction\n- [ ] Output parsing is straightforward and maintainable\n- [ ] Table tests verify structure, not just character presence","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-29T05:08:32.277596131Z","updated_at":"2026-01-03T22:03:39.574206386Z","closed_at":"2026-01-03T22:03:39.574206386Z","close_reason":"Verified complete - tests refactored with direct assertions and loose matching","labels":["medium","testing"],"dependencies":[{"issue_id":"clack-ujl","depends_on_id":"clack-n81p","type":"parent-child","created_at":"2025-11-29T07:01:02.748472671Z","created_by":"daemon"}]}
{"id":"clack-ulq","title":"Fix metadata field name mismatch between generators and orchestrator","description":"**Pre-existing bug discovered during workspace-rvq implementation.**\n\nGenerators populate metadata with:\n- `provider` (e.g., ai-prompt-generator.ts:192)\n- `model` (e.g., ai-prompt-generator.ts:190)\n- `tier` (e.g., ai-prompt-generator.ts:191)\n\nOrchestrator extracts:\n- `aiProvider` (orchestrator.ts:239, 277)\n- `aiModel` (orchestrator.ts:240, 278)\n- `modelTier` (orchestrator.ts:241, 279)\n\n**Impact**: All metadata extraction silently fails and defaults to empty strings, losing provider/model correlation in database.\n\n**Fix**: Update orchestrator to use correct field names: `provider`, `model`, `tier`\n\n**Related**: Discovered during workspace-rvq epic implementation","status":"tombstone","priority":1,"issue_type":"bug","created_at":"2025-11-28T08:26:58.285801011Z","updated_at":"2026-01-03T21:41:47.645866918Z","deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"bug"}
{"id":"clack-uotb","title":"AI Generators - Hot Take \u0026 Personality","description":"## Overview\nMove first batch of AI generator tests (hot-take, personality-based, seasonal content) to integration with real PromptLoader.\n\n## Risk Level\nHIGH - First generator batch establishes mocking patterns. If PromptLoader integration breaks, it is isolated to this batch.\n\n## Dependencies\nRequires Epic 1 (Testing Foundations) to establish patterns.\n\n## Files Affected\n8 test files from tests/unit/content/generators/ai/ -\u003e tests/integration/content/generators/ai/\n\n## Success Criteria\n- [ ] All 8 generator test files moved to integration directory\n- [ ] Use real PromptLoader (load actual prompt files)\n- [ ] Mock only AI provider responses at boundary\n- [ ] Replace fixed count assertions with flexible assertions\n- [ ] Remove arbitrary existence checks\n- [ ] Test public API only (no protected method access)\n- [ ] All tests pass in integration environment\n\n## Parallel Execution Context\nThis epic runs IN PARALLEL with these sibling epics (no file overlap):\n- clack-b8xx: CLI Command Test Migration\n- clack-7yso: Storage Layer Test Migration\n- clack-rjyb: AI Generators - News \u0026 Learning\n- clack-te4l: AI Generators - Philosophical \u0026 Misc\n- clack-5tjn: Core Orchestration Tests\n\nEach domain is isolated - failures in this epic do NOT affect sibling epics.","status":"open","priority":1,"issue_type":"epic","owner":"ryan@spice.cc","created_at":"2026-01-27T22:15:33.306612419Z","created_by":"Ryan Brodkin","updated_at":"2026-01-27T22:36:18.560448718Z","dependencies":[{"issue_id":"clack-uotb","depends_on_id":"clack-3n0y","type":"blocks","created_at":"2026-01-27T22:28:40.943829214Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-uotb.1","title":"Move AI generator tests batch 1","description":"## Objective\nMove first batch (hot-take, personality-based) from tests/unit/content/generators/ai/ to tests/integration/ with real PromptLoader.\n\n## TDD Approach\n1. RED: Move test files, update imports (tests may fail due to heavy mocking removal)\n2. GREEN: Replace internal mocks with real PromptLoader/ModelTierSelector, mock only AI provider at boundary\n3. BLUE: Replace fixed counts with flexible assertions, remove existence checks\n\n## Acceptance Criteria\n- [ ] Move 8 generator test files to integration directory\n- [ ] Use real PromptLoader (load actual prompt files)\n- [ ] Use real ModelTierSelector\n- [ ] Mock only AI provider responses at boundary (use createMockAIProvider helper)\n- [ ] Replace fixed count assertions (toHaveLength(5)) with flexible assertions (toBeGreaterThan(0))\n- [ ] Remove arbitrary existence checks (expect(generator).toBeDefined())\n- [ ] Test public API only (no protected method access via type casting)\n- [ ] All tests pass in integration environment\n\n## Scope\nFiles: hot-take, houseboy-vent, happy-to-see-me, seasonal, yo-momma, weather, alien-field-report, daily-roast (8 test files)","status":"open","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-27T22:20:07.957370838Z","created_by":"Ryan Brodkin","updated_at":"2026-01-27T22:20:07.957370838Z","dependencies":[{"issue_id":"clack-uotb.1","depends_on_id":"clack-uotb","type":"parent-child","created_at":"2026-01-27T22:20:07.958487379Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-vbqy","title":"Fix Production Prompt Failures","description":"Reduce Vestaboard content generation failures from 23.5% to \u003c5% by fixing dimension substitution bug and improving prompt documentation. Root cause: BaseNewsGenerator and NovelInsightGenerator override generate() without calling applyDimensionSubstitution(), sending literal {{maxChars}}/{{maxLines}} to AI.","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-11T19:39:18.058597887Z","created_by":"vscode","updated_at":"2026-01-11T20:25:52.300527972Z","closed_at":"2026-01-11T20:25:52.300527972Z","close_reason":"All child tasks completed and merged to develop"}
{"id":"clack-vbqy.1","title":"Fix dimension substitution in BaseNewsGenerator","description":"BaseNewsGenerator.generate() overrides base class but fails to call applyDimensionSubstitution(), causing {{maxChars}} and {{maxLines}} to be sent literally to AI instead of '21' and '5'. This causes 67-83% failure rates for tech-news, local-news, global-news generators.\n\nACCEPTANCE CRITERIA:\n- Import DimensionSubstitutor in base-news-generator.ts\n- Instantiate and apply dimension substitution to system prompt\n- Add 'date' to template variables passed to system prompt\n- Existing tests pass\n- Add test case verifying dimension substitution is applied\n\nFILES:\n- src/content/generators/ai/base-news-generator.ts\n- tests/unit/content/generators/ai/base-news-generator.test.ts\n\nRELATED ISSUES:\n- clack-vbqy.2: Same fix pattern (DimensionSubstitutor import/apply) in NovelInsightGenerator. Ensure consistent implementation approach.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-11T19:39:33.310850505Z","created_by":"vscode","updated_at":"2026-01-11T20:25:47.545832719Z","closed_at":"2026-01-11T20:25:47.545832719Z","close_reason":"Merged to develop in commit 587115f","dependencies":[{"issue_id":"clack-vbqy.1","depends_on_id":"clack-vbqy","type":"parent-child","created_at":"2026-01-11T19:39:33.311678088Z","created_by":"vscode"}]}
{"id":"clack-vbqy.2","title":"Fix dimension substitution in NovelInsightGenerator","description":"NovelInsightGenerator.generate() overrides base class but fails to call applyDimensionSubstitution(), causing {{maxChars}} and {{maxLines}} to be sent literally to AI. This causes 100% failure rate for novel-insight generator.\n\nACCEPTANCE CRITERIA:\n- Import DimensionSubstitutor in novel-insight-generator.ts\n- Instantiate and apply dimension substitution to system prompt\n- Add 'date' to template variables passed to system prompt\n- Existing tests pass\n- Add test case verifying dimension substitution is applied\n\nFILES:\n- src/content/generators/ai/novel-insight-generator.ts\n- tests/unit/content/generators/ai/novel-insight-generator.test.ts\n\nRELATED ISSUES:\n- clack-vbqy.1: Same fix pattern (DimensionSubstitutor import/apply) in BaseNewsGenerator. Ensure consistent implementation approach.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-11T19:39:34.077174422Z","created_by":"vscode","updated_at":"2026-01-11T20:25:47.552762511Z","closed_at":"2026-01-11T20:25:47.552762511Z","close_reason":"Merged to develop in commit 587115f","dependencies":[{"issue_id":"clack-vbqy.2","depends_on_id":"clack-vbqy","type":"parent-child","created_at":"2026-01-11T19:39:34.080753672Z","created_by":"vscode"}]}
{"id":"clack-vbqy.3","title":"Update system prompt character list","description":"System prompt punctuation list is unclear and doesn't explicitly state forbidden characters. Update to match actual SUPPORTED_CHARS constant and add explicit exclusions. 2 failures were caused by '\u003e' character which AI didn't know was forbidden.\n\nACCEPTANCE CRITERIA:\n- Update punctuation list in major-update-base.txt to match constants.ts format\n- Add 'NOT ALLOWED' section with explicit exclusions: \u003c \u003e [ ] { } \\ | ^ ~ ` _\n- Add negative examples showing rejected character usage\n- No test changes needed (prompt file only)\n\nFILES:\n- prompts/system/major-update-base.txt","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T19:39:35.130173422Z","created_by":"vscode","updated_at":"2026-01-11T20:25:47.555968969Z","closed_at":"2026-01-11T20:25:47.555968969Z","close_reason":"Merged to develop in commit 587115f","dependencies":[{"issue_id":"clack-vbqy.3","depends_on_id":"clack-vbqy","type":"parent-child","created_at":"2026-01-11T19:39:35.133891005Z","created_by":"vscode"}]}
{"id":"clack-vbqy.4","title":"Remove conflicting constraints from novel-insight.txt","description":"novel-insight.txt user prompt contains a 'VESTABOARD CONSTRAINTS' section that conflicts with system prompt (says 6 rows when only 5 available with frame). Remove to maintain single source of truth in system prompt.\n\nACCEPTANCE CRITERIA:\n- Remove lines 19-25 (VESTABOARD CONSTRAINTS section) from novel-insight.txt\n- Verify no other user prompts contain constraint definitions\n- No test changes needed (prompt file only)\n\nFILES:\n- prompts/user/novel-insight.txt","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T19:39:36.109308256Z","created_by":"vscode","updated_at":"2026-01-11T20:25:47.559222303Z","closed_at":"2026-01-11T20:25:47.559222303Z","close_reason":"Merged to develop in commit 587115f","dependencies":[{"issue_id":"clack-vbqy.4","depends_on_id":"clack-vbqy","type":"parent-child","created_at":"2026-01-11T19:39:36.113200423Z","created_by":"vscode"}]}
{"id":"clack-vbqy.5","title":"Update vestaboard-prompt skill with constraint rules","description":"Add documentation to vestaboard-prompt skill clarifying that user prompts must NEVER define display constraints, character limits, or line limits. These belong exclusively in the system prompt to avoid conflicts.\n\nACCEPTANCE CRITERIA:\n- Add 'Constraint Rules' section to SKILL.md explaining single source of truth principle\n- State that only system prompts define constraints\n- List what user prompts should NOT include (character limits, line limits, character sets)\n- Add to Quality Checklist: 'No constraint definitions' check for user prompts\n\nFILES:\n- .claude/skills/vestaboard-prompt/SKILL.md","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T19:39:37.429001798Z","created_by":"vscode","updated_at":"2026-01-11T20:25:47.562078928Z","closed_at":"2026-01-11T20:25:47.562078928Z","close_reason":"Merged to develop in commit 587115f","dependencies":[{"issue_id":"clack-vbqy.5","depends_on_id":"clack-vbqy","type":"parent-child","created_at":"2026-01-11T19:39:37.429689923Z","created_by":"vscode"}]}
{"id":"clack-viu","title":"Make AI Generators Functional with Real Data","description":"Three AI generators exist but only MotivationalGenerator works. NewsGenerator and WeatherGenerator claim to use external data (RSS feeds, weather) but no data is ever fetched or injected.\n\n**Approach:**\n- Hybrid pattern: DataProvider for weather, self-fetching for news\n- Multiple news generators (Global, Tech, Local) for equal selection chance\n- ContentDataProvider service for centralized weather/color fetching\n\n**Deliverables:**\n- Working RSSClient with real RSS parsing\n- 3 news generators with category-specific feeds\n- ContentDataProvider service for weather data\n- Updated WeatherGenerator using context data\n- All generators registered and functional","status":"tombstone","priority":1,"issue_type":"epic","assignee":"claude","created_at":"2025-11-27T09:20:19.481308878Z","updated_at":"2026-01-03T21:41:47.645866918Z","labels":["ai","content","infrastructure"],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"clack-vmec","title":"Fix db:migrate CLI and unify deployment workflow","description":"Fix the broken db:migrate CLI command and remove redundant deploy.sh script.\n\n**Existing Work:** Implementation in progress on branch `feature/clack-1bte-migrations` (worktree at `./trees/clack-1bte-migrations`).\n\n**Root Cause:** The `db:migrate` command is missing from the CLI command whitelist in `src/index.ts`. When running `node dist/cli/index.js db:migrate`, the main function doesn't recognize it as a CLI command, so `runCLI()` is never called and migrations silently don't run.\n\n**Scope:**\n1. Add `db:migrate` to command whitelist (1-line fix in src/index.ts)\n2. Add unit test for CLI routing\n3. Remove deprecated deploy.sh (unified approach: /deploy skill is comprehensive)\n4. Verify in production Docker environment\n\n**Acceptance Criteria:**\n- `node dist/cli/index.js db:migrate` outputs migration status to stdout\n- Migrations execute when pending\n- Works in Docker container without TTY\n- Exit code 1 on failure, 0 on success\n- /deploy skill Step 2 works as documented","status":"closed","priority":1,"issue_type":"epic","owner":"ryan@spice.cc","created_at":"2026-01-22T02:09:40.25326484Z","created_by":"Ryan Brodkin","updated_at":"2026-01-22T03:45:48.349796423Z","closed_at":"2026-01-22T03:45:48.349796423Z","close_reason":"Epic complete: db:migrate CLI fix implemented, tested, and verified in production Docker"}
{"id":"clack-vmec.1","title":"Add db:migrate to CLI command whitelist","description":"Add `'db:migrate'` to the command whitelist array in `src/index.ts` (lines 24-38).\n\n**Root Cause:** The db:migrate command is not in the whitelist, so `runCLI()` is never called.\n\n**Fix Location:** `src/index.ts` line ~32 (after `'db:reset'`)\n\n```typescript\n// Add after 'db:reset',\n'db:migrate',\n```\n\n**Branch:** `feature/clack-1bte-migrations`\n\n**Acceptance Criteria:**\n- [ ] `db:migrate` added to command whitelist array\n- [ ] `node dist/cli/index.js db:migrate` calls `runCLI()` and executes migrations\n- [ ] Output shows migration status (batch number, files run)\n\n**Files:** src/index.ts (1 line addition)","status":"closed","priority":1,"issue_type":"bug","owner":"ryan@spice.cc","created_at":"2026-01-22T02:09:48.360168469Z","created_by":"Ryan Brodkin","updated_at":"2026-01-22T03:45:43.245819129Z","closed_at":"2026-01-22T03:45:43.245819129Z","close_reason":"All tasks completed and merged to develop","dependencies":[{"issue_id":"clack-vmec.1","depends_on_id":"clack-vmec","type":"parent-child","created_at":"2026-01-22T02:09:48.36179501Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-vmec.2","title":"Add unit test for db:migrate CLI routing","description":"Add unit test to verify `db:migrate` command is correctly routed through `main()` to `dbMigrateCommand()`.\n\n**Branch:** `feature/clack-1bte-migrations`\n\n**Test should verify:**\n1. When `process.argv` contains `db:migrate`, `runCLI()` is called\n2. The `dbMigrateCommand` function is invoked\n\n**Acceptance Criteria:**\n- [ ] Test file created or updated: `tests/unit/cli/index.test.ts`\n- [ ] Test passes with the whitelist fix applied\n- [ ] Coverage maintained at 80%+\n\n**Files:** tests/unit/cli/index.test.ts (new or update)","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-22T02:09:56.05031575Z","created_by":"Ryan Brodkin","updated_at":"2026-01-22T03:45:43.260363296Z","closed_at":"2026-01-22T03:45:43.260363296Z","close_reason":"All tasks completed and merged to develop","dependencies":[{"issue_id":"clack-vmec.2","depends_on_id":"clack-vmec","type":"parent-child","created_at":"2026-01-22T02:09:56.052149583Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-vmec.2","depends_on_id":"clack-vmec.1","type":"blocks","created_at":"2026-01-22T02:12:16.867164135Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-vmec.3","title":"Remove deprecated deploy.sh script","description":"Remove `deploy.sh` in favor of the `/deploy` skill which provides comprehensive deployment with migrations.\n\n**Rationale:**\n- `/deploy` skill has migrations, validation, health checks, rollback guidance\n- `deploy.sh` is outdated (no migrations, uses different compose file)\n- Having two deployment methods causes confusion\n\n**Branch:** `feature/clack-1bte-migrations`\n\n**Acceptance Criteria:**\n- [ ] `deploy.sh` deleted from repository\n- [ ] Any README.md references updated to point to `/deploy` skill\n- [ ] Commit message explains deprecation rationale\n\n**Files:** deploy.sh (delete), README.md (update if needed)","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-22T02:10:02.741721378Z","created_by":"Ryan Brodkin","updated_at":"2026-01-22T03:45:43.268761963Z","closed_at":"2026-01-22T03:45:43.268761963Z","close_reason":"All tasks completed and merged to develop","dependencies":[{"issue_id":"clack-vmec.3","depends_on_id":"clack-vmec","type":"parent-child","created_at":"2026-01-22T02:10:02.743144586Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-vmec.3","depends_on_id":"clack-vmec.1","type":"blocks","created_at":"2026-01-22T02:10:19.950375053Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-vmec.4","title":"E2E: Verify migrations work in production Docker","description":"Manual verification that migrations work in production Docker environment.\n\n**Requires:** Production environment access\n\n**Setup:**\n```bash\n# Copy production env from project root (contains DOCKER_HOST, DATABASE_URL, etc.)\ncp .env.production ./trees/clack-1bte-migrations/\ncd ./trees/clack-1bte-migrations\n\n# Load production environment\nset -a; source .env.production; set +a\n```\n\n**Test Steps:**\n1. Build Docker image with fix applied:\n   ```bash\n   docker build -t clack-track:latest .\n   ```\n\n2. Run migration command:\n   ```bash\n   docker run --rm \\\n     --network clack-track_clack-network \\\n     -e DATABASE_URL=\"$DATABASE_URL\" \\\n     -e DATABASE_TYPE=\"$DATABASE_TYPE\" \\\n     clack-track:latest \\\n     node dist/cli/index.js db:migrate\n   ```\n\n3. Verify output shows migration status\n4. Verify exit code is 0 on success\n\n**Acceptance Criteria:**\n- [ ] Migration command produces output (not silent)\n- [ ] Shows 'Database is already up to date' or lists migrations run\n- [ ] Exit code 0 on success, 1 on failure\n- [ ] /deploy skill Step 2 works as documented\n\n**Files:** None (manual verification)","status":"closed","priority":2,"issue_type":"task","assignee":"user","owner":"ryan@spice.cc","created_at":"2026-01-22T02:10:11.918217799Z","created_by":"Ryan Brodkin","updated_at":"2026-01-22T03:45:43.276803838Z","closed_at":"2026-01-22T03:45:43.276803838Z","close_reason":"All tasks completed and merged to develop","dependencies":[{"issue_id":"clack-vmec.4","depends_on_id":"clack-vmec","type":"parent-child","created_at":"2026-01-22T02:10:11.920430882Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-vmec.4","depends_on_id":"clack-vmec.1","type":"blocks","created_at":"2026-01-22T02:10:19.993520095Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-vt08","title":"Fix pre-existing web UI test failures (4 tests)","description":"## Overview\n4 pre-existing test failures in web frontend components discovered during clack-3n0y refactoring work. Tests have assertion mismatches with actual component implementations.\n\n## Affected Tests\n\n### 1. font-loading.test.ts (2 failures)\n- **Expected**: `rel=\"dns-prefetch\"` for fonts.gstatic.com\n- **Actual**: `rel=\"preconnect\"` for fonts.gstatic.com\n- **Issue**: Tests check for specific HTML attributes that don't match current implementation\n\n### 2. FloatingLogo.test.tsx (2 failures)\n- **Expected**: `py-X` class (unified vertical padding)\n- **Actual**: `pt-6 pb-12 px-4` classes (explicit top/bottom padding)\n- **Issue**: Tests validate implementation details instead of visual behavior\n\n## Root Cause\nTest assertions are out of sync with component implementation. These are not code defects - the components work correctly. The tests need to be updated to match current implementation or refactored to test behavior instead of implementation details.\n\n## Impact\n- Test pass rate: 4436/4447 (99.75%)\n- Does NOT affect application functionality\n- Does NOT block other test refactoring work\n\n## Files Affected\n- tests/web/frontend/font-loading.test.ts\n- tests/web/components/FloatingLogo.test.tsx\n\n## Acceptance Criteria\n- [ ] Update font-loading.test.ts assertions to match current HTML (preconnect)\n- [ ] Update FloatingLogo.test.tsx assertions to match current classes (pt-6 pb-12)\n- [ ] OR refactor tests to validate visual behavior instead of implementation details\n- [ ] All web UI tests passing\n- [ ] No regressions in component functionality","status":"open","priority":2,"issue_type":"bug","owner":"ryan@spice.cc","created_at":"2026-01-28T02:33:08.829136551Z","created_by":"Ryan Brodkin","updated_at":"2026-01-28T02:33:08.829136551Z"}
{"id":"clack-vy5o","title":"server.test.ts fails - cannot locate @/web/routes/push.js module","description":"## Test Failure\n\n**File:** `tests/unit/web/server.test.ts`\n**Error:** Configuration error - Could not locate module `@/web/routes/push.js`\n\n```\nFAIL tests/unit/web/server.test.ts\n  ● Test suite failed to run\n\n    Configuration error:\n\n    Could not locate module @/web/routes/push.js mapped as:\n    /workspace/src/$1.\n\n      at createNoMappedModuleFoundError (node_modules/jest-resolve/build/index.js:1117:17)\n      at Object.\u003canonymous\u003e (tests/unit/web/server.test.ts:71:6)\n```\n\n## Root Cause\nThe test file mocks `@/web/routes/push.js` at line 71, but this module doesn't exist. Either:\n1. The module was never created (incomplete feature)\n2. The module was moved/renamed\n3. The test was written for a planned but unimplemented feature\n\n## Investigation Needed\n- Check if `src/web/routes/push.ts` exists\n- If not, determine if push notification feature is planned or abandoned\n- Either create the module or remove the mock\n\n## Impact\nThis test suite cannot run, causing 1 test failure in CI.","status":"tombstone","priority":1,"issue_type":"bug","created_at":"2025-11-29T07:29:40.01730705Z","updated_at":"2026-01-03T21:41:47.645866918Z","close_reason":"Verified complete by code review","labels":["blocking","bug","testing"],"dependencies":[{"issue_id":"clack-vy5o","depends_on_id":"clack-ofzp","type":"parent-child","created_at":"2025-11-29T08:29:10.6836498Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"bug"}
{"id":"clack-w8p","title":"Register new generators and update prompts","description":"Final integration: register all new generators in ContentRegistry and finalize prompts.\n\n**Files:**\n- `src/content/registry/register-core.ts`\n- `prompts/user/news-global.txt` (verify)\n- `prompts/user/news-tech.txt` (verify)\n- `prompts/user/news-local.txt` (verify)\n- `prompts/user/weather-focus.txt` (verify)\n\n**Requirements:**\n- Register GlobalNewsGenerator, TechNewsGenerator, LocalNewsGenerator at P2\n- Remove old NewsGenerator registration\n- Each news generator gets equal selection probability\n- Verify all prompts reference their injected data sections\n- Update .env.example with new env vars","status":"tombstone","priority":3,"issue_type":"task","assignee":"claude","created_at":"2025-11-27T09:21:12.218113083Z","updated_at":"2026-01-03T21:41:47.645866918Z","labels":["content","integration"],"dependencies":[{"issue_id":"clack-w8p","depends_on_id":"clack-viu","type":"parent-child","created_at":"2025-11-27T09:21:53.199653922Z","created_by":"daemon"},{"issue_id":"clack-w8p","depends_on_id":"clack-2n6","type":"blocks","created_at":"2025-11-27T09:22:16.79344371Z","created_by":"daemon"},{"issue_id":"clack-w8p","depends_on_id":"clack-69j","type":"blocks","created_at":"2025-11-27T09:22:18.615464128Z","created_by":"daemon"},{"issue_id":"clack-w8p","depends_on_id":"clack-aqq","type":"blocks","created_at":"2025-11-27T09:22:20.389553337Z","created_by":"daemon"},{"issue_id":"clack-w8p","depends_on_id":"clack-2wk","type":"blocks","created_at":"2025-11-27T09:22:22.968365588Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-w9e7","title":"Add Claude Code Settings to Devcontainer","description":"Configure Claude Code settings in devcontainer using jq deep merge pattern from devcontainer-example.\n\n**Goal:** Enable bypassPermissions mode and disable attribution co-author lines automatically when devcontainer is created/updated.\n\n**Settings to configure:**\n- permissions.defaultMode: bypassPermissions (auto-approve tool calls)\n- attribution.commit: '' (no co-author line in commits)\n- attribution.pr: '' (no co-author line in PRs)\n\n**Race condition prevention:** Lifecycle hooks guarantee ordering - Claude Code installed in postCreate before settings configured in updateContent.\n\n**Files:** .devcontainer/update-content.sh\n\n**Acceptance Criteria:**\n- Claude Code settings automatically configured when devcontainer starts\n- bypassPermissions mode enabled by default\n- Co-author attribution lines disabled\n- Existing user settings preserved via deep merge","status":"closed","priority":1,"issue_type":"epic","owner":"ryan@spice.cc","created_at":"2026-01-23T03:29:35.16634188Z","created_by":"Ryan Brodkin","updated_at":"2026-01-23T09:00:27.335857262Z","closed_at":"2026-01-23T09:00:27.335857262Z","close_reason":"Closed"}
{"id":"clack-w9e7.1","title":"Add Claude Code settings configuration to update-content.sh","description":"Add a new section to .devcontainer/update-content.sh that configures Claude Code settings using jq deep merge pattern.\n\n**Implementation:**\n1. Create ~/.claude directory if it doesn't exist\n2. Define settings JSON with bypassPermissions mode and empty attribution strings\n3. If settings file exists, deep merge new settings (preserving user customizations)\n4. If settings file doesn't exist, create it with pretty-printed JSON\n5. Use atomic write pattern (.tmp + mv) to prevent corruption\n\n**Acceptance Criteria:**\n- Settings section added after 'Installing project dependencies' and before 'Setting up Git hooks'\n- Uses jq -s '.[0] * .[1]' for deep merge\n- Uses atomic write pattern (.tmp file + mv)\n- Handles both create and update scenarios\n- Sets permissions.defaultMode to bypassPermissions\n- Sets attribution.commit and attribution.pr to empty strings\n- Prints confirmation message on success\n\n**Files:** .devcontainer/update-content.sh","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-23T03:29:42.31953905Z","created_by":"Ryan Brodkin","updated_at":"2026-01-23T09:00:27.261244554Z","closed_at":"2026-01-23T09:00:27.261244554Z","close_reason":"Closed","dependencies":[{"issue_id":"clack-w9e7.1","depends_on_id":"clack-w9e7","type":"parent-child","created_at":"2026-01-23T03:29:42.320275216Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-wk6","title":"Write Unit Tests for Factory Function","description":"Create unit tests for createVestaboardClient() factory function. Verify proper instantiation, configuration, and dependency injection.","design":"## Test Coverage\nReference: tests/unit/api/ai/factory.test.ts\n\n1. Factory creates client with valid config\n2. Factory validates config (missing apiKey, apiUrl)\n3. Factory applies default values (timeout)\n4. Created client is instance of VestaboardClient\n5. Created client has working methods\n\nSimple tests, minimal mocking needed.","acceptance_criteria":"- tests/unit/api/vestaboard/factory.test.ts created\n- Test createVestaboardClient() with valid config\n- Test factory throws error on missing apiKey\n- Test factory throws error on missing apiUrl\n- Test factory applies default timeout if not provided\n- Test created client is instance of VestaboardClient\n- Test created client implements VestaboardSender interface\n- Test created client has sendLayout method\n- Test created client has sendText method\n- Test created client has validateConnection method\n- 80%+ coverage achieved\n- All tests pass","notes":"3-char identifier cleanup","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-26T05:25:47.920420002Z","updated_at":"2026-01-23T22:36:20.307997Z","closed_at":"2026-01-23T22:36:20.308000208Z","dependencies":[{"issue_id":"clack-wk6","depends_on_id":"clack-nsx","type":"blocks","created_at":"2025-11-26T05:25:47.921243002Z","created_by":"daemon"},{"issue_id":"clack-wk6","depends_on_id":"clack-jc1","type":"blocks","created_at":"2025-11-26T05:25:47.922063585Z","created_by":"daemon"},{"issue_id":"clack-wk6","depends_on_id":"clack-z37n","type":"parent-child","created_at":"2025-11-29T07:01:18.030294012Z","created_by":"daemon"}]}
{"id":"clack-wm7","title":"Add Environment Variables","description":"Add HOME_ASSISTANT_URL, HOME_ASSISTANT_TOKEN, and optional reconnection settings to .env.example with documentation.","acceptance_criteria":"- HOME_ASSISTANT_URL in .env.example\n- HOME_ASSISTANT_TOKEN in .env.example\n- HOME_ASSISTANT_RECONNECT_ATTEMPTS (optional)\n- HOME_ASSISTANT_RECONNECT_DELAY (optional)\n- Token creation documentation in comments\n- Security notes about token storage","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-11-24T00:18:50.675824584Z","updated_at":"2026-01-03T21:41:47.645866918Z","dependencies":[{"issue_id":"clack-wm7","depends_on_id":"clack-n94","type":"parent-child","created_at":"2025-11-24T04:19:45.586129882Z","created_by":"vscode"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-wnqz","title":"Yo Momma Generator","description":"Add a 'Yo momma so [insult/compliment] that she [action]' generator in the same humor and generation style as the HappyToSeeMe generator. Jokes can be either sick burns or compliments.","status":"closed","priority":2,"issue_type":"epic","owner":"ryan@spice.cc","created_at":"2026-01-22T05:47:19.261784589Z","created_by":"Ryan Brodkin","updated_at":"2026-01-22T07:11:52.995746507Z","closed_at":"2026-01-22T07:11:52.995746507Z","close_reason":"Implemented and merged to develop"}
{"id":"clack-wnqz.1","title":"Create YoMommaGenerator class","description":"Create yo-momma-generator.ts following HappyToSeeMeGenerator pattern with three vibe dictionaries (QUALITY_VIBES, ACTION_VIBES, TONE_VIBES).\n\nRelated Issues: clack-wnqz.2 (user prompt), clack-wnqz.3 (test suite), clack-wnqz.4 (registry integration)\n\nAcceptance Criteria:\n- Class extends AIPromptGenerator\n- Uses ModelTier.LIGHT for cost efficiency\n- Has QUALITY_VIBES dictionary (20+ entries) - adjectives describing momma\n- Has ACTION_VIBES dictionary (20+ entries) - absurd actions she does\n- Has TONE_VIBES dictionary (entries like 'sick burn', 'backhanded compliment', 'genuine hype')\n- getSystemPromptFile() returns 'major-update-base.txt'\n- getUserPromptFile() returns 'yo-momma.txt'\n- getTemplateVariables() injects qualityVibe, actionVibe, toneVibe\n- getCustomMetadata() tracks selected vibes\n- Static readonly exports for testing\n- Full JSDoc documentation\n\nFiles: src/content/generators/ai/yo-momma-generator.ts","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-22T05:47:31.568395928Z","created_by":"Ryan Brodkin","updated_at":"2026-01-22T07:11:52.973791923Z","closed_at":"2026-01-22T07:11:52.973791923Z","close_reason":"Implemented and merged to develop","dependencies":[{"issue_id":"clack-wnqz.1","depends_on_id":"clack-wnqz","type":"parent-child","created_at":"2026-01-22T05:47:31.569162595Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-wnqz.2","title":"Create yo-momma.txt user prompt","description":"Create prompt file that guides AI to generate cohesive 'Yo momma' jokes.\n\nRelated Issues: clack-wnqz.1 (generator class using this prompt), clack-wnqz.4 (registry integration)\n\nAcceptance Criteria:\n- Uses {{qualityVibe}}, {{actionVibe}}, {{toneVibe}} template variables\n- Explains the dual burn/compliment nature\n- Provides good/bad examples showing cohesive vs random humor\n- Specifies 5 lines max, 21 chars per line, ALL CAPS\n- Emphasizes internal logic and absurd specificity (matching HappyToSeeMe style)\n- Specifies playful tone - clever wordplay, not crude\n\nFiles: prompts/user/yo-momma.txt","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-22T05:47:33.116419929Z","created_by":"Ryan Brodkin","updated_at":"2026-01-22T07:11:52.981215132Z","closed_at":"2026-01-22T07:11:52.981215132Z","close_reason":"Implemented and merged to develop","dependencies":[{"issue_id":"clack-wnqz.2","depends_on_id":"clack-wnqz","type":"parent-child","created_at":"2026-01-22T05:47:33.119211346Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-wnqz.3","title":"Write comprehensive test suite for YoMommaGenerator","description":"Create test file mirroring HappyToSeeMe test structure.\n\nRelated Issues: clack-wnqz.1 (tests this generator), clack-wnqz.4 (registry integration)\n\nAcceptance Criteria:\n- Constructor tests (with/without API keys, LIGHT tier verification)\n- getSystemPromptFile() and getUserPromptFile() tests\n- validate() tests (valid and invalid scenarios)\n- Vibe selection tests for all three dictionaries\n- 100-output variability tests for randomness verification\n- Metadata tracking tests\n- Static constant exports tests (20+ entries per dictionary)\n- Design philosophy test (vibes as inspiration)\n\nFiles: tests/unit/content/generators/ai/yo-momma-generator.test.ts","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-22T05:47:34.599220471Z","created_by":"Ryan Brodkin","updated_at":"2026-01-22T07:11:52.985761548Z","closed_at":"2026-01-22T07:11:52.985761548Z","close_reason":"Implemented and merged to develop","dependencies":[{"issue_id":"clack-wnqz.3","depends_on_id":"clack-wnqz","type":"parent-child","created_at":"2026-01-22T05:47:34.602284888Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-wnqz.4","title":"Integrate YoMommaGenerator into registry and bootstrap","description":"Wire up the generator into the application.\n\nRelated Issues: clack-wnqz.1 (generator class), clack-wnqz.2 (prompt file), clack-wnqz.3 (test suite)\n\nAcceptance Criteria:\n- Add export to src/content/generators/ai/index.ts\n- Add yoMomma: ContentGenerator to CoreGenerators interface\n- Add instantiation in createCoreGenerators() function\n- Add registration in registerCoreContent() with id 'yo-momma', P2 priority, LIGHT tier, applyFrame: true\n- Add import statement in bootstrap.ts\n- Verify npm run content:list shows the new generator\n\nFiles: src/content/generators/ai/index.ts, src/content/registry/register-core.ts, src/bootstrap.ts","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-22T05:47:35.947791847Z","created_by":"Ryan Brodkin","updated_at":"2026-01-22T07:11:52.99060159Z","closed_at":"2026-01-22T07:11:52.99060159Z","close_reason":"Implemented and merged to develop","dependencies":[{"issue_id":"clack-wnqz.4","depends_on_id":"clack-wnqz","type":"parent-child","created_at":"2026-01-22T05:47:35.95142543Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-wnqz.4","depends_on_id":"clack-wnqz.1","type":"blocks","created_at":"2026-01-22T05:47:41.989788169Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-wnqz.4","depends_on_id":"clack-wnqz.2","type":"blocks","created_at":"2026-01-22T05:47:42.027080835Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-wq6j","title":"Fix storage model timing tests","description":"Replace arbitrary setTimeout waits with Jest fake timers. Corrected locations: vote.test.ts:282 (10ms wait), log.test.ts:134 (10ms wait), content.test.ts:225 (1-second wait for MySQL DATETIME precision - may need timestamp manipulation instead of fake timers). Use jest.useFakeTimers() and jest.advanceTimersByTime() for vote/log tests. For content.test.ts, consider manipulating generatedAt timestamps directly rather than waiting. Acceptance: Tests pass with no .env file, no arbitrary setTimeout waits remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T21:03:30.660197877Z","created_by":"vscode","updated_at":"2026-01-11T22:38:16.701371342Z","closed_at":"2026-01-11T22:38:16.701371342Z","close_reason":"Closed","dependencies":[{"issue_id":"clack-wq6j","depends_on_id":"clack-82ep","type":"parent-child","created_at":"2026-01-11T21:04:05.408823338Z","created_by":"vscode"}]}
{"id":"clack-ws2v","title":"Complete Authentication System Implementation","description":"## Overview\nImplement production-ready authentication system with magic link registration, WebAuthn passkey authentication, and comprehensive route/element protection.\n\n## Goals\n- Database-backed users, sessions, credentials, and magic links\n- Real WebAuthn cryptographic verification (replace mock)\n- Magic link registration flow (CLI + Admin UI)\n- Protected routes and auth-aware UI components\n- Development auth bypass for Playwright testing\n\n## Success Criteria\n- No open user registrations - invite-only via magic links\n- All protected routes use consistent ProtectedRoute pattern\n- Session persistence survives server restarts\n- 80%+ test coverage on auth code\n\n## Scope\n22 work units across database, backend, and frontend layers\n\n---\n\n## Execution Guidance (for reaper:takeoff)\n\n### Parallel Group 1: Database Schema (can run in parallel)\n- clack-ws2v.1: users + sessions tables\n- clack-ws2v.2: credentials table\n- clack-ws2v.3: magic_links table\n\n### Parallel Group 2: Model Layer (after Group 1)\nRun after their respective schema issue:\n- clack-ws2v.4: UserModel (after .1)\n- clack-ws2v.5: SessionModel (after .1)\n- clack-ws2v.6: CredentialModel (after .2)\n- clack-ws2v.7: MagicLinkModel (after .3)\n\n### Parallel Group 3: Backend Services (after Group 2)\n- clack-ws2v.8: WebAuthn verification (after .5, .6) - modifies auth.ts (verification functions)\n- clack-ws2v.9: Session middleware (after .5) - modifies auth.ts (session storage) - CAN PARALLEL with .8\n- clack-ws2v.10: Magic link service (after .4, .7)\n\n### Parallel Group 4: CLI + Admin UI (after Group 3)\n- clack-ws2v.11: CLI invite command (after .10)\n- clack-ws2v.12: Admin UI invite form (after .10)\n\n### Sequential: Registration Flow\n- clack-ws2v.13: Registration flow (after .8, .10) - modifies auth.ts + App.tsx\n\n### Parallel Group 5: Frontend Protection Components (no backend deps)\nCan start after Group 2 (need types only):\n- clack-ws2v.14: ProtectedRoute component\n- clack-ws2v.15: useRequireAuth hook\n- clack-ws2v.16: AuthGuard component\n\n### Parallel Group 6: Apply Protection Patterns (after Group 5)\n- clack-ws2v.17: Dev auth bypass (after .9)\n- clack-ws2v.18: Update Account page (after .14, .15) - modifies App.tsx\n- clack-ws2v.19: Update Admin page (after .14, .15) - modifies App.tsx - CAN PARALLEL with .18\n- clack-ws2v.20: Navigation auth-aware (after .16)\n\n### Final: Integration Tests (after all implementation)\n- clack-ws2v.21: Backend auth tests (after .8, .9, .10, .13)\n- clack-ws2v.22: Frontend auth tests (after .14, .15, .16, .18, .19, .20)\n\n### File Overlap Warnings\n- src/web/routes/auth.ts: Issues 8, 9, 13 (coordination notes in each issue)\n- src/web/frontend/App.tsx: Issues 13, 18, 19 (coordination notes in each issue)\n- Both overlaps have been analyzed and issues can run in parallel per guidance above","status":"closed","priority":1,"issue_type":"epic","owner":"ryan@spice.cc","created_at":"2026-01-24T03:20:52.835078135Z","created_by":"Ryan Brodkin","updated_at":"2026-01-26T01:41:40.425211597Z","closed_at":"2026-01-26T01:41:40.425211597Z","close_reason":"Epic completed - authentication system fully implemented"}
{"id":"clack-ws2v.1","title":"Create users and sessions database schema","description":"## Objective\nCreate database migrations for users and sessions tables to enable persistent authentication.\n\n## TDD Approach\n1. RED: Write tests for migration up/down, table constraints, indexes\n2. GREEN: Implement migrations to pass tests\n3. BLUE: Refactor if needed while keeping tests green\n\n## Acceptance Criteria\n- [ ] Migration 007 creates `users` table (id, email, name, created_at, updated_at)\n- [ ] Migration 008 creates `sessions` table (id, user_id, token, expires_at, created_at, data)\n- [ ] Foreign key from sessions.user_id to users.id (nullable for anonymous)\n- [ ] Unique index on users.email\n- [ ] Index on sessions.token for fast lookup\n- [ ] Migrations are reversible (down function works)\n- [ ] Tests verify table creation and constraints\n\n## Scope\nFiles: migrations/007_create_users_table.cjs, migrations/008_create_sessions_table.cjs","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-24T03:21:10.329497962Z","created_by":"Ryan Brodkin","updated_at":"2026-01-26T01:41:40.43567143Z","closed_at":"2026-01-26T01:41:40.43567143Z","close_reason":"Epic completed - authentication system fully implemented","dependencies":[{"issue_id":"clack-ws2v.1","depends_on_id":"clack-ws2v","type":"parent-child","created_at":"2026-01-24T03:21:10.331455795Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-ws2v.10","title":"Implement magic link generation and validation","description":"## Objective\nCreate service for generating and validating magic link tokens for registration invites.\n\n## TDD Approach\n1. RED: Write tests for token generation, validation, expiration, single-use\n2. GREEN: Implement MagicLinkService to pass tests\n3. BLUE: Refactor while keeping tests green\n\n## Acceptance Criteria\n- [ ] MagicLinkService.generate(email, createdBy) creates secure token\n- [ ] MagicLinkService.validate(token) returns email if valid, throws if invalid/expired/used\n- [ ] Tokens are single-use (marked used after successful validation)\n- [ ] Configurable expiration via MAGIC_LINK_EXPIRY_HOURS (default: 24)\n- [ ] Secure random token generation using crypto.randomBytes (32 bytes, base64url)\n- [ ] Unit tests with 80%+ coverage\n\n## Scope\nFiles: src/auth/magic-link-service.ts, tests/unit/auth/magic-link-service.test.ts","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-24T03:21:59.786451596Z","created_by":"Ryan Brodkin","updated_at":"2026-01-26T01:41:40.479238097Z","closed_at":"2026-01-26T01:41:40.479238097Z","close_reason":"Epic completed - authentication system fully implemented","dependencies":[{"issue_id":"clack-ws2v.10","depends_on_id":"clack-ws2v","type":"parent-child","created_at":"2026-01-24T03:21:59.799644013Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-ws2v.10","depends_on_id":"clack-ws2v.4","type":"blocks","created_at":"2026-01-24T03:23:50.342202634Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-ws2v.10","depends_on_id":"clack-ws2v.7","type":"blocks","created_at":"2026-01-24T03:23:50.484694592Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-ws2v.11","title":"Create CLI command for magic link generation","description":"## Objective\nAdd CLI command to generate magic link for user registration invites.\n\n## TDD Approach\n1. RED: Write tests for CLI argument parsing, link generation, output format\n2. GREEN: Implement CLI command to pass tests\n3. BLUE: Refactor while keeping tests green\n\n## Acceptance Criteria\n- [ ] npm run auth:invite -- --email user@example.com generates link\n- [ ] Outputs full registration URL to console (e.g., https://example.com/register?token=xxx)\n- [ ] Validates email format before generating\n- [ ] Records 'cli' as created_by in database\n- [ ] Uses bootstrap() pattern like other CLI commands\n- [ ] Integration test verifies end-to-end flow\n\n## Scope\nFiles: src/cli/commands/auth.ts, tests/integration/cli/auth-commands.test.ts","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-24T03:22:16.81915734Z","created_by":"Ryan Brodkin","updated_at":"2026-01-26T01:41:40.483008055Z","closed_at":"2026-01-26T01:41:40.483008055Z","close_reason":"Epic completed - authentication system fully implemented","dependencies":[{"issue_id":"clack-ws2v.11","depends_on_id":"clack-ws2v","type":"parent-child","created_at":"2026-01-24T03:22:16.82206334Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-ws2v.11","depends_on_id":"clack-ws2v.10","type":"blocks","created_at":"2026-01-24T03:23:52.522565635Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-ws2v.12","title":"Create admin UI for magic link generation","description":"## Objective\nAdd magic link generation form to Admin page for creating registration invites.\n\n## TDD Approach\n1. RED: Write tests for form rendering, validation, API call, link display\n2. GREEN: Implement InviteForm component and API endpoint to pass tests\n3. BLUE: Refactor while keeping tests green\n\n## Acceptance Criteria\n- [ ] Email input field with client-side validation\n- [ ] Generate Invite button calls POST /api/admin/invite\n- [ ] Shows generated link in copyable format after success\n- [ ] API endpoint protected by requireAuth middleware\n- [ ] Records authenticated user_id as created_by in database\n- [ ] Error handling for invalid emails and API failures\n- [ ] Component tests verify UI behavior\n\n## Scope\nFiles: src/web/frontend/pages/Admin.tsx, src/web/frontend/components/InviteForm.tsx, src/web/routes/admin.ts (NEW), src/web/server.ts, tests/web/components/InviteForm.test.tsx\n\nNote: src/web/routes/admin.ts is a NEW file. Must also update src/web/server.ts to register the admin router.","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-24T03:22:19.509624467Z","created_by":"Ryan Brodkin","updated_at":"2026-01-26T01:41:40.486739639Z","closed_at":"2026-01-26T01:41:40.486739639Z","close_reason":"Epic completed - authentication system fully implemented","dependencies":[{"issue_id":"clack-ws2v.12","depends_on_id":"clack-ws2v","type":"parent-child","created_at":"2026-01-24T03:22:19.515168717Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-ws2v.12","depends_on_id":"clack-ws2v.10","type":"blocks","created_at":"2026-01-24T03:23:52.656416551Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-ws2v.13","title":"Implement user registration flow via magic link","description":"## Objective\nCreate complete registration flow: user clicks magic link, sets up passkey, account created.\n\n## TDD Approach\n1. RED: Write tests for token validation, registration UI, account creation, passkey setup\n2. GREEN: Implement registration page and API to pass tests\n3. BLUE: Refactor while keeping tests green\n\n## Acceptance Criteria\n- [ ] GET /register?token=xxx validates token and shows registration UI\n- [ ] Registration page collects name, displays email from token\n- [ ] Passkey setup initiated after name entry\n- [ ] POST /api/auth/register creates user and first credential\n- [ ] Token marked as used after successful registration\n- [ ] Session created automatically after registration (user logged in)\n- [ ] Invalid/expired tokens show appropriate error with no registration form\n- [ ] Add /register route to frontend App.tsx\n- [ ] Integration tests verify full registration flow\n\n## File Overlap Notes\n- src/web/routes/auth.ts is also modified by clack-ws2v.8 and clack-ws2v.9\n- This issue adds new /register endpoint; clack-ws2v.8 must complete first (already blocked)\n- src/web/frontend/App.tsx is also modified by clack-ws2v.18 and clack-ws2v.19\n- These App.tsx changes are independent (different routes) but coordinate during review\n\n## Scope\nFiles: src/web/frontend/pages/Register.tsx (NEW), src/web/routes/auth.ts, src/web/frontend/App.tsx, tests/web/pages/Register.test.tsx, tests/integration/web/routes/auth-register.test.ts","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-24T03:22:29.719975888Z","created_by":"Ryan Brodkin","updated_at":"2026-01-26T01:41:40.491018972Z","closed_at":"2026-01-26T01:41:40.491018972Z","close_reason":"Epic completed - authentication system fully implemented","dependencies":[{"issue_id":"clack-ws2v.13","depends_on_id":"clack-ws2v","type":"parent-child","created_at":"2026-01-24T03:22:29.723266055Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-ws2v.13","depends_on_id":"clack-ws2v.8","type":"blocks","created_at":"2026-01-24T03:23:54.14013751Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-ws2v.13","depends_on_id":"clack-ws2v.10","type":"blocks","created_at":"2026-01-24T03:23:54.30370326Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-ws2v.14","title":"Create ProtectedRoute component","description":"## Objective\nCreate reusable route wrapper that checks authentication before rendering children.\n\n## TDD Approach\n1. RED: Write tests for loading, redirect, and authenticated render states\n2. GREEN: Implement ProtectedRoute to pass tests\n3. BLUE: Refactor while keeping tests green\n\n## Acceptance Criteria\n- [ ] \u003cProtectedRoute\u003e wraps route element in App.tsx\n- [ ] Shows loading spinner while checking auth (isLoading state)\n- [ ] Redirects to /login with return URL param if not authenticated\n- [ ] Renders children only when authenticated\n- [ ] Uses AuthContext for auth state\n- [ ] Component tests verify all three states (loading, redirect, render)\n\n## Scope\nFiles: src/web/frontend/components/ProtectedRoute.tsx, tests/web/components/ProtectedRoute.test.tsx","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-24T03:22:51.278586342Z","created_by":"Ryan Brodkin","updated_at":"2026-01-26T01:41:40.49484793Z","closed_at":"2026-01-26T01:41:40.49484793Z","close_reason":"Epic completed - authentication system fully implemented","dependencies":[{"issue_id":"clack-ws2v.14","depends_on_id":"clack-ws2v","type":"parent-child","created_at":"2026-01-24T03:22:51.280661384Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-ws2v.15","title":"Create useRequireAuth hook","description":"## Objective\nCreate reusable hook for page-level auth requirements with redirect handling.\n\n## TDD Approach\n1. RED: Write tests for auth state, redirect behavior, return URL preservation\n2. GREEN: Implement hook to pass tests\n3. BLUE: Refactor while keeping tests green\n\n## Acceptance Criteria\n- [ ] useRequireAuth() returns { isLoading, isAuthenticated, user }\n- [ ] Automatically redirects to /login if not authenticated (after loading complete)\n- [ ] Preserves intended destination in returnUrl query param\n- [ ] Works with or without ProtectedRoute wrapper\n- [ ] Can be used in pages that need auth state without full protection\n- [ ] Unit tests verify hook behavior with React Testing Library\n\n## Scope\nFiles: src/web/frontend/hooks/useRequireAuth.ts, tests/web/hooks/useRequireAuth.test.ts","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-24T03:22:52.600894718Z","created_by":"Ryan Brodkin","updated_at":"2026-01-26T01:41:40.498296055Z","closed_at":"2026-01-26T01:41:40.498296055Z","close_reason":"Epic completed - authentication system fully implemented","dependencies":[{"issue_id":"clack-ws2v.15","depends_on_id":"clack-ws2v","type":"parent-child","created_at":"2026-01-24T03:22:52.601602301Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-ws2v.16","title":"Create AuthGuard component for element-level protection","description":"## Objective\nCreate component for conditionally rendering UI elements based on auth state.\n\n## TDD Approach\n1. RED: Write tests for conditional rendering, fallback, no layout shift\n2. GREEN: Implement AuthGuard to pass tests\n3. BLUE: Refactor while keeping tests green\n\n## Acceptance Criteria\n- [ ] \u003cAuthGuard\u003e{children}\u003c/AuthGuard\u003e renders children only if authenticated\n- [ ] \u003cAuthGuard fallback={\u003cLoginButton/\u003e}\u003e shows fallback when not authenticated\n- [ ] \u003cAuthGuard require='admin'\u003e supports role-based visibility (stub for future)\n- [ ] No layout shift when auth state changes (consistent container sizing)\n- [ ] Uses AuthContext for auth state\n- [ ] Component tests verify conditional rendering in all states\n\n## Scope\nFiles: src/web/frontend/components/AuthGuard.tsx, tests/web/components/AuthGuard.test.tsx","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-24T03:22:53.761019552Z","created_by":"Ryan Brodkin","updated_at":"2026-01-26T01:41:40.502301014Z","closed_at":"2026-01-26T01:41:40.502301014Z","close_reason":"Epic completed - authentication system fully implemented","dependencies":[{"issue_id":"clack-ws2v.16","depends_on_id":"clack-ws2v","type":"parent-child","created_at":"2026-01-24T03:22:53.761775052Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-ws2v.17","title":"Implement development auth bypass for Playwright","description":"## Objective\nAdd environment-based auth bypass for automated testing with Playwright.\n\n## TDD Approach\n1. RED: Write tests for bypass enabling, header recognition, session creation\n2. GREEN: Implement bypass middleware to pass tests\n3. BLUE: Refactor while keeping tests green\n\n## Acceptance Criteria\n- [ ] AUTH_BYPASS_ENABLED=true enables bypass (default: false)\n- [ ] X-Auth-Bypass: \u003cuser-id\u003e header auto-authenticates request\n- [ ] Only works when NODE_ENV !== 'production' (hard block)\n- [ ] Bypass creates valid session for the request (works with requireAuth)\n- [ ] If user-id doesn't exist, creates test user automatically\n- [ ] Add to CLAUDE.md: Playwright usage documentation\n- [ ] Integration tests verify bypass works AND is disabled in production mode\n\n## Scope\nFiles: src/web/middleware/auth-bypass.ts, src/web/server.ts, tests/integration/web/middleware/auth-bypass.test.ts, CLAUDE.md","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-24T03:22:55.135333886Z","created_by":"Ryan Brodkin","updated_at":"2026-01-26T01:41:40.505981139Z","closed_at":"2026-01-26T01:41:40.505981139Z","close_reason":"Epic completed - authentication system fully implemented","dependencies":[{"issue_id":"clack-ws2v.17","depends_on_id":"clack-ws2v","type":"parent-child","created_at":"2026-01-24T03:22:55.136165469Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-ws2v.17","depends_on_id":"clack-ws2v.9","type":"blocks","created_at":"2026-01-24T03:23:55.883736928Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-ws2v.18","title":"Update Account page to use new auth patterns","description":"## Objective\nRefactor Account.tsx to use ProtectedRoute and useRequireAuth instead of manual useEffect redirect.\n\n## TDD Approach\n1. RED: Verify existing tests still define expected behavior\n2. GREEN: Refactor to use new patterns while keeping tests passing\n3. BLUE: Clean up any redundant code\n\n## Acceptance Criteria\n- [ ] Remove useEffect auth check from Account.tsx\n- [ ] Wrap /account route with ProtectedRoute in App.tsx\n- [ ] Use useRequireAuth if additional auth state access needed\n- [ ] All existing Account.test.tsx tests pass\n- [ ] No visible behavior change to users\n- [ ] Cleaner, more maintainable code\n\n## File Overlap Notes\n- src/web/frontend/App.tsx is also modified by clack-ws2v.13 and clack-ws2v.19\n- clack-ws2v.13 adds /register route (independent, can run parallel)\n- clack-ws2v.19 wraps /admin route (same pattern, can run PARALLEL with this issue)\n- Coordinate during merge: All three add route wrappers to App.tsx\n\n## Scope\nFiles: src/web/frontend/pages/Account.tsx, src/web/frontend/App.tsx","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-24T03:23:11.710878671Z","created_by":"Ryan Brodkin","updated_at":"2026-01-26T01:41:40.509476472Z","closed_at":"2026-01-26T01:41:40.509476472Z","close_reason":"Epic completed - authentication system fully implemented","dependencies":[{"issue_id":"clack-ws2v.18","depends_on_id":"clack-ws2v","type":"parent-child","created_at":"2026-01-24T03:23:11.712724796Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-ws2v.18","depends_on_id":"clack-ws2v.14","type":"blocks","created_at":"2026-01-24T03:23:57.263194345Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-ws2v.18","depends_on_id":"clack-ws2v.15","type":"blocks","created_at":"2026-01-24T03:23:57.37279747Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-ws2v.19","title":"Update Admin page to use new auth patterns","description":"## Objective\nRefactor Admin.tsx to use ProtectedRoute instead of API-level 401 handling for initial auth.\n\n## TDD Approach\n1. RED: Verify existing tests still define expected behavior\n2. GREEN: Refactor to use new patterns while keeping tests passing\n3. BLUE: Clean up redundant unauthorized state handling\n\n## Acceptance Criteria\n- [ ] Wrap /admin route with ProtectedRoute in App.tsx\n- [ ] Remove isUnauthorized state and related UI from Admin.tsx\n- [ ] Keep API error handling for non-auth errors (500, network, etc.)\n- [ ] All existing Admin.test.tsx tests pass (update if needed for new pattern)\n- [ ] No visible behavior change to users\n\n## File Overlap Notes\n- src/web/frontend/App.tsx is also modified by clack-ws2v.13 and clack-ws2v.18\n- clack-ws2v.13 adds /register route (independent, can run parallel)\n- clack-ws2v.18 wraps /account route (same pattern, can run PARALLEL with this issue)\n- Coordinate during merge: All three add route wrappers to App.tsx\n\n## Scope\nFiles: src/web/frontend/pages/Admin.tsx, src/web/frontend/App.tsx","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-24T03:23:12.919940047Z","created_by":"Ryan Brodkin","updated_at":"2026-01-26T01:41:40.512854847Z","closed_at":"2026-01-26T01:41:40.512854847Z","close_reason":"Epic completed - authentication system fully implemented","dependencies":[{"issue_id":"clack-ws2v.19","depends_on_id":"clack-ws2v","type":"parent-child","created_at":"2026-01-24T03:23:12.920932005Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-ws2v.19","depends_on_id":"clack-ws2v.14","type":"blocks","created_at":"2026-01-24T03:23:57.466081595Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-ws2v.19","depends_on_id":"clack-ws2v.15","type":"blocks","created_at":"2026-01-24T03:23:57.536380179Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-ws2v.2","title":"Create passkeys/credentials database schema","description":"## Objective\nCreate database migration for credentials table storing WebAuthn public keys.\n\n## TDD Approach\n1. RED: Write tests for credential storage, unique constraints, indexes\n2. GREEN: Implement migration to pass tests\n3. BLUE: Refactor if needed while keeping tests green\n\n## Acceptance Criteria\n- [ ] Migration 009 creates `credentials` table\n- [ ] Columns: id, user_id, credential_id (base64), public_key (base64), counter, device_type, name, created_at, last_used_at\n- [ ] Foreign key from credentials.user_id to users.id\n- [ ] Unique index on credential_id for authentication lookup\n- [ ] Tests verify constraints and indexes\n\n## Scope\nFiles: migrations/009_create_credentials_table.cjs","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-24T03:21:11.425325254Z","created_by":"Ryan Brodkin","updated_at":"2026-01-26T01:41:40.441137097Z","closed_at":"2026-01-26T01:41:40.441137097Z","close_reason":"Epic completed - authentication system fully implemented","dependencies":[{"issue_id":"clack-ws2v.2","depends_on_id":"clack-ws2v","type":"parent-child","created_at":"2026-01-24T03:21:11.426247629Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-ws2v.20","title":"Update Navigation with auth-aware link visibility","description":"## Objective\nUpdate Navigation component to show/hide links based on authentication state.\n\n## TDD Approach\n1. RED: Write tests for conditional link visibility based on auth state\n2. GREEN: Implement auth-aware navigation to pass tests\n3. BLUE: Refactor while keeping tests green\n\n## Acceptance Criteria\n- [ ] Use AuthGuard or useAuth to check auth state\n- [ ] Hide /admin and /account links when not authenticated\n- [ ] Show /login link when not authenticated\n- [ ] Hide /login and show logout action when authenticated\n- [ ] Works in both mobile (Sheet) and desktop navigation\n- [ ] Navigation tests verify conditional rendering\n- [ ] No layout shift when auth state changes\n\n## Scope\nFiles: src/web/frontend/components/Navigation.tsx, tests/web/navigation.test.tsx","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-24T03:23:14.729808048Z","created_by":"Ryan Brodkin","updated_at":"2026-01-26T01:41:40.516128972Z","closed_at":"2026-01-26T01:41:40.516128972Z","close_reason":"Epic completed - authentication system fully implemented","dependencies":[{"issue_id":"clack-ws2v.20","depends_on_id":"clack-ws2v","type":"parent-child","created_at":"2026-01-24T03:23:14.730877798Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-ws2v.20","depends_on_id":"clack-ws2v.16","type":"blocks","created_at":"2026-01-24T03:23:57.616237262Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-ws2v.21","title":"Backend auth integration tests","description":"## Objective\nComprehensive integration tests for complete authentication flows.\n\n## TDD Approach\nThese are the final verification tests ensuring all backend auth components work together.\n\n## Acceptance Criteria\n- [ ] Test full WebAuthn login flow with real credential verification\n- [ ] Test magic link generation → registration → login flow\n- [ ] Test session creation, validation, expiration, cleanup\n- [ ] Test auth bypass in development mode works\n- [ ] Test auth bypass is disabled in production mode\n- [ ] All tests use fake timers for expiration testing (no real delays)\n- [ ] 80%+ coverage on auth-related backend code\n- [ ] Tests run in \u003c 60 seconds\n\n## Scope\nFiles: tests/integration/web/auth-flows.test.ts","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-24T03:23:28.337742387Z","created_by":"Ryan Brodkin","updated_at":"2026-01-26T01:41:40.519741722Z","closed_at":"2026-01-26T01:41:40.519741722Z","close_reason":"Epic completed - authentication system fully implemented","dependencies":[{"issue_id":"clack-ws2v.21","depends_on_id":"clack-ws2v","type":"parent-child","created_at":"2026-01-24T03:23:28.340176387Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-ws2v.21","depends_on_id":"clack-ws2v.8","type":"blocks","created_at":"2026-01-24T03:23:59.294251304Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-ws2v.21","depends_on_id":"clack-ws2v.9","type":"blocks","created_at":"2026-01-24T03:23:59.390547346Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-ws2v.21","depends_on_id":"clack-ws2v.10","type":"blocks","created_at":"2026-01-24T03:23:59.50502493Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-ws2v.21","depends_on_id":"clack-ws2v.13","type":"blocks","created_at":"2026-01-24T03:24:16.637647465Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-ws2v.22","title":"Frontend auth component tests","description":"## Objective\nComprehensive tests for all new frontend auth components and updated pages.\n\n## TDD Approach\nThese are the final verification tests ensuring all frontend auth components work correctly.\n\n## Acceptance Criteria\n- [ ] ProtectedRoute tests: loading state, redirect behavior, authenticated render\n- [ ] useRequireAuth tests: hook returns correct state, handles redirects\n- [ ] AuthGuard tests: conditional rendering, fallback prop, no layout shift\n- [ ] Updated Account page tests pass with new ProtectedRoute pattern\n- [ ] Updated Admin page tests pass with new ProtectedRoute pattern\n- [ ] Navigation tests verify auth-aware link visibility\n- [ ] 80%+ coverage on frontend auth components\n- [ ] Tests use jsdom environment with React Testing Library\n\n## Scope\nFiles: tests/web/auth-components.test.tsx","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-24T03:23:29.692212638Z","created_by":"Ryan Brodkin","updated_at":"2026-01-26T01:41:40.522930722Z","closed_at":"2026-01-26T01:41:40.522930722Z","close_reason":"Epic completed - authentication system fully implemented","dependencies":[{"issue_id":"clack-ws2v.22","depends_on_id":"clack-ws2v","type":"parent-child","created_at":"2026-01-24T03:23:29.693207888Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-ws2v.22","depends_on_id":"clack-ws2v.14","type":"blocks","created_at":"2026-01-24T03:24:01.218522889Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-ws2v.22","depends_on_id":"clack-ws2v.15","type":"blocks","created_at":"2026-01-24T03:24:01.312795597Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-ws2v.22","depends_on_id":"clack-ws2v.16","type":"blocks","created_at":"2026-01-24T03:24:01.477501791Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-ws2v.22","depends_on_id":"clack-ws2v.18","type":"blocks","created_at":"2026-01-24T03:24:01.596263708Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-ws2v.22","depends_on_id":"clack-ws2v.19","type":"blocks","created_at":"2026-01-24T03:24:01.717486166Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-ws2v.22","depends_on_id":"clack-ws2v.20","type":"blocks","created_at":"2026-01-24T03:24:01.829270166Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-ws2v.3","title":"Create magic link tokens database schema","description":"## Objective\nCreate database migration for magic_links table to store registration invite tokens.\n\n## TDD Approach\n1. RED: Write tests for token storage, expiration, usage tracking\n2. GREEN: Implement migration to pass tests\n3. BLUE: Refactor if needed while keeping tests green\n\n## Acceptance Criteria\n- [ ] Migration 010 creates `magic_links` table\n- [ ] Columns: id, token (unique), email, expires_at, used_at, created_by, created_at\n- [ ] Unique index on token for fast lookup\n- [ ] Index on email + used_at for validation queries\n- [ ] Tests verify table structure\n\n## Scope\nFiles: migrations/010_create_magic_links_table.cjs","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-24T03:21:12.820845005Z","created_by":"Ryan Brodkin","updated_at":"2026-01-26T01:41:40.445942514Z","closed_at":"2026-01-26T01:41:40.445942514Z","close_reason":"Epic completed - authentication system fully implemented","dependencies":[{"issue_id":"clack-ws2v.3","depends_on_id":"clack-ws2v","type":"parent-child","created_at":"2026-01-24T03:21:12.821628755Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-ws2v.4","title":"Implement UserModel and UserRepository","description":"## Objective\nCreate data access layer for users following existing model/repository patterns.\n\n## TDD Approach\n1. RED: Write tests for CRUD operations, email uniqueness, error handling\n2. GREEN: Implement model and repository to pass tests\n3. BLUE: Refactor while keeping tests green\n\n## Acceptance Criteria\n- [ ] UserModel with create, findById, findByEmail, update, delete methods\n- [ ] UserRepository with graceful error handling (fire-and-forget writes, empty returns on read errors)\n- [ ] Email uniqueness enforced at model level\n- [ ] TypeScript types exported from src/types/\n- [ ] Unit tests with 80%+ coverage\n\n## Scope\nFiles: src/storage/models/user.ts, src/storage/repositories/user-repo.ts, tests/unit/storage/models/user.test.ts, tests/unit/storage/repositories/user-repo.test.ts","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-24T03:21:34.064674917Z","created_by":"Ryan Brodkin","updated_at":"2026-01-26T01:41:40.450852722Z","closed_at":"2026-01-26T01:41:40.450852722Z","close_reason":"Epic completed - authentication system fully implemented","dependencies":[{"issue_id":"clack-ws2v.4","depends_on_id":"clack-ws2v","type":"parent-child","created_at":"2026-01-24T03:21:34.066256876Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-ws2v.4","depends_on_id":"clack-ws2v.1","type":"blocks","created_at":"2026-01-24T03:24:21.096386259Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-ws2v.5","title":"Implement SessionModel and SessionRepository","description":"## Objective\nCreate data access layer for sessions with expiration handling.\n\n## TDD Approach\n1. RED: Write tests for session lifecycle, expiration, cleanup\n2. GREEN: Implement model and repository to pass tests\n3. BLUE: Refactor while keeping tests green\n\n## Acceptance Criteria\n- [ ] SessionModel with create, findByToken, findByUserId, update, delete, deleteExpired methods\n- [ ] SessionRepository with cleanup methods and graceful error handling\n- [ ] JSON data field serialization/deserialization\n- [ ] touch() method to update last accessed timestamp\n- [ ] Unit tests with 80%+ coverage\n\n## Scope\nFiles: src/storage/models/session.ts, src/storage/repositories/session-repo.ts, tests/unit/storage/models/session.test.ts, tests/unit/storage/repositories/session-repo.test.ts","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-24T03:21:34.98419996Z","created_by":"Ryan Brodkin","updated_at":"2026-01-26T01:41:40.455934472Z","closed_at":"2026-01-26T01:41:40.455934472Z","close_reason":"Epic completed - authentication system fully implemented","dependencies":[{"issue_id":"clack-ws2v.5","depends_on_id":"clack-ws2v","type":"parent-child","created_at":"2026-01-24T03:21:34.98507271Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-ws2v.5","depends_on_id":"clack-ws2v.1","type":"blocks","created_at":"2026-01-24T03:24:11.849734921Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-ws2v.6","title":"Implement CredentialModel and CredentialRepository","description":"## Objective\nCreate data access layer for WebAuthn credentials with counter tracking.\n\n## TDD Approach\n1. RED: Write tests for credential storage, counter updates, lookup\n2. GREEN: Implement model and repository to pass tests\n3. BLUE: Refactor while keeping tests green\n\n## Acceptance Criteria\n- [ ] CredentialModel with create, findByCredentialId, findByUserId, updateCounter, updateLastUsed, delete methods\n- [ ] CredentialRepository matching existing patterns with graceful error handling\n- [ ] Base64 encoding/decoding helpers for credential_id and public_key\n- [ ] Counter increment for replay attack prevention\n- [ ] Unit tests with 80%+ coverage\n\n## Scope\nFiles: src/storage/models/credential.ts, src/storage/repositories/credential-repo.ts, tests/unit/storage/models/credential.test.ts, tests/unit/storage/repositories/credential-repo.test.ts","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-24T03:21:35.958680918Z","created_by":"Ryan Brodkin","updated_at":"2026-01-26T01:41:40.460325847Z","closed_at":"2026-01-26T01:41:40.460325847Z","close_reason":"Epic completed - authentication system fully implemented","dependencies":[{"issue_id":"clack-ws2v.6","depends_on_id":"clack-ws2v","type":"parent-child","created_at":"2026-01-24T03:21:35.959506418Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-ws2v.6","depends_on_id":"clack-ws2v.2","type":"blocks","created_at":"2026-01-24T03:24:13.061126547Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-ws2v.7","title":"Implement MagicLinkModel and MagicLinkRepository","description":"## Objective\nCreate data access layer for magic link tokens with secure generation.\n\n## TDD Approach\n1. RED: Write tests for token generation, validation, expiration, single-use\n2. GREEN: Implement model and repository to pass tests\n3. BLUE: Refactor while keeping tests green\n\n## Acceptance Criteria\n- [ ] MagicLinkModel with create, findByToken, markUsed, deleteExpired, findByEmail methods\n- [ ] MagicLinkRepository with token generation helper using crypto.randomBytes\n- [ ] Expiration checking built into findByToken\n- [ ] Single-use enforcement via used_at timestamp\n- [ ] Unit tests with 80%+ coverage\n\n## Scope\nFiles: src/storage/models/magic-link.ts, src/storage/repositories/magic-link-repo.ts, tests/unit/storage/models/magic-link.test.ts, tests/unit/storage/repositories/magic-link-repo.test.ts","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-24T03:21:36.745803377Z","created_by":"Ryan Brodkin","updated_at":"2026-01-26T01:41:40.46531843Z","closed_at":"2026-01-26T01:41:40.46531843Z","close_reason":"Epic completed - authentication system fully implemented","dependencies":[{"issue_id":"clack-ws2v.7","depends_on_id":"clack-ws2v","type":"parent-child","created_at":"2026-01-24T03:21:36.74648996Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-ws2v.7","depends_on_id":"clack-ws2v.3","type":"blocks","created_at":"2026-01-24T03:24:15.020871631Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-ws2v.8","title":"Implement real WebAuthn verification in auth routes","description":"## Objective\nReplace mock WebAuthn verification with real cryptographic validation using stored credentials.\n\n## TDD Approach\n1. RED: Write tests for credential lookup, signature verification, counter validation\n2. GREEN: Implement real verification to pass tests\n3. BLUE: Refactor while keeping tests green\n\n## Acceptance Criteria\n- [ ] verifyAuthenticationResponse uses stored public key from CredentialRepository\n- [ ] Counter validation prevents replay attacks (reject if counter \u003c= stored)\n- [ ] verifyRegistrationResponse stores new credentials via CredentialRepository\n- [ ] Remove all mock bypass code (try/catch that ignores errors)\n- [ ] Update last_used_at on successful authentication\n- [ ] Integration tests verify full WebAuthn flow\n\n## File Overlap Notes\n- src/web/routes/auth.ts is also modified by clack-ws2v.9 (session middleware) and clack-ws2v.13 (registration)\n- This issue focuses on credential verification functions only (verifyLogin, verifyAuthenticationResponse)\n- clack-ws2v.9 handles session storage replacement (getSessionId, sessions object)\n- Coordinate: Complete this issue BEFORE clack-ws2v.13 (already blocked)\n\n## Scope\nFiles: src/web/routes/auth.ts, src/web/routes/account.ts, tests/integration/web/routes/auth.test.ts","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-24T03:21:55.675702011Z","created_by":"Ryan Brodkin","updated_at":"2026-01-26T01:41:40.469625014Z","closed_at":"2026-01-26T01:41:40.469625014Z","close_reason":"Epic completed - authentication system fully implemented","dependencies":[{"issue_id":"clack-ws2v.8","depends_on_id":"clack-ws2v","type":"parent-child","created_at":"2026-01-24T03:21:55.677033886Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-ws2v.8","depends_on_id":"clack-ws2v.5","type":"blocks","created_at":"2026-01-24T03:23:50.076968717Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-ws2v.8","depends_on_id":"clack-ws2v.6","type":"blocks","created_at":"2026-01-24T03:23:50.160420008Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-ws2v.9","title":"Implement database-backed session middleware","description":"## Objective\nReplace in-memory session store with database-backed sessions for persistence.\n\n## TDD Approach\n1. RED: Write tests for session creation, validation, expiration, cleanup\n2. GREEN: Implement database session middleware to pass tests\n3. BLUE: Refactor while keeping tests green\n\n## Acceptance Criteria\n- [ ] Session created in database on successful login\n- [ ] requireAuth middleware validates session token from database\n- [ ] Expired sessions rejected and cleaned up automatically\n- [ ] Session token stored in secure HTTP-only cookie (not x-session-id header)\n- [ ] Configurable session duration via SESSION_DURATION_DAYS (default: 30)\n- [ ] Integration tests verify session lifecycle\n\n## File Overlap Notes\n- src/web/routes/auth.ts is also modified by clack-ws2v.8 (WebAuthn) and clack-ws2v.13 (registration)\n- This issue focuses on session storage replacement (getSessionId, sessions object, requireAuth)\n- clack-ws2v.8 handles credential verification (verifyLogin, verifyAuthenticationResponse)\n- Can run in PARALLEL with clack-ws2v.8 (different concerns in same file)\n\n## Scope\nFiles: src/web/middleware/session.ts, src/web/routes/auth.ts, tests/integration/web/middleware/session.test.ts","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-24T03:21:57.352947262Z","created_by":"Ryan Brodkin","updated_at":"2026-01-26T01:41:40.474329597Z","closed_at":"2026-01-26T01:41:40.474329597Z","close_reason":"Epic completed - authentication system fully implemented","dependencies":[{"issue_id":"clack-ws2v.9","depends_on_id":"clack-ws2v","type":"parent-child","created_at":"2026-01-24T03:21:57.354167887Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-ws2v.9","depends_on_id":"clack-ws2v.5","type":"blocks","created_at":"2026-01-24T03:23:50.246039675Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-wxg","title":"Create Mocks and Fixtures","description":"Create tests/__mocks__/home-assistant.ts mock factory and tests/fixtures/home-assistant-responses.json with example data.","acceptance_criteria":"- Mock factory in tests/__mocks__/home-assistant.ts\n- Mock connection object\n- Mock subscription functions\n- Fixtures file created\n- Auth success/failure message fixtures\n- Entity state example fixtures\n- Event payload fixtures (automation_triggered, custom)\n- Service call response fixtures\n- Error response fixtures","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-11-24T00:18:56.039819462Z","updated_at":"2026-01-03T21:41:47.645866918Z","dependencies":[{"issue_id":"clack-wxg","depends_on_id":"clack-926","type":"parent-child","created_at":"2025-11-24T04:20:22.91119201Z","created_by":"vscode"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-x4p8","title":"Content Quality Overhaul: System Prompt \u0026 Skill","description":"Overhaul both the system prompt (universal AI instructions) and the skill (prompt creation guidance) to incorporate lessons from user interview about what makes content succeed or fail.\n\n## Success Criteria\n1. System prompt contains all universal content quality principles\n2. Skill teaches how to leverage system prompt personality for dynamic content\n3. Variability is a documented requirement, not a suggestion\n4. Named anti-patterns (Countdown, Shower Thought) are documented\n5. Completeness and standalone requirements are explicit\n\n## Scope\n- Included: System prompt enhancements, skill document rewrites, supporting files\n- Excluded: Generator code changes, new generators, test changes\n\n## Execution Guidance for Orchestrator\n\n### File Groups\n- **System Prompt** (prompts/system/major-update-base.txt): clack-x4p8.1, clack-x4p8.2\n- **SKILL.md** (.claude/skills/vestaboard-prompt/SKILL.md): clack-x4p8.3, .4, .5, .6, .7, .8\n- **templates.md** (.claude/skills/vestaboard-prompt/templates.md): clack-x4p8.9\n\n### Parallel Groups\n- **Group A (parallel)**: clack-x4p8.1, clack-x4p8.2 - Both add NEW sections to system prompt, can merge\n- **Group B (parallel)**: clack-x4p8.3, .4, .5, .6, .7 - Each adds DISTINCT section to SKILL.md\n- **Group C (after Group B)**: clack-x4p8.8 - References sections from Group B\n- **Group D (after .4)**: clack-x4p8.9 - References variability patterns from .4\n\n### Critical Path\nGroup A (independent) | Group B (parallel) -\u003e Group C -\u003e Done\n                      |-\u003e clack-x4p8.4 -\u003e Group D -\u003e Done\n\n### Merge Strategy\nFor SKILL.md parallel work: Each issue adds a distinct section. Agents should add sections at end of file to minimize conflicts. Order within file is not critical.","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-11T20:30:38.431985965Z","created_by":"vscode","updated_at":"2026-01-11T21:13:47.525014802Z","closed_at":"2026-01-11T21:13:47.525014802Z","close_reason":"Closed"}
{"id":"clack-x4p8.1","title":"Add content quality principles to system prompt","description":"Add principles to prompts/system/major-update-base.txt that teach the AI what makes content succeed vs fail.\n\n## What to Add\n- CONTENT QUALITY section\n- Guidance on avoiding generic/saccharine content\n- The 'would someone stop to read this?' test\n- Emotional resolution guidance\n- Anti-AI-slop principles\n\n## Acceptance Criteria\n- [ ] System prompt has a CONTENT QUALITY section\n- [ ] Includes guidance on avoiding generic/saccharine content\n- [ ] Includes the 'stop and read' test\n\n## Files\n- prompts/system/major-update-base.txt\n\n## Related Issues\n- clack-x4p8.2 also modifies this file (standalone test section)\n- Coordinate additions to avoid conflicts; both add NEW sections","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T20:30:51.464885638Z","created_by":"vscode","updated_at":"2026-01-11T21:13:47.479079885Z","closed_at":"2026-01-11T21:13:47.479079885Z","close_reason":"Closed","dependencies":[{"issue_id":"clack-x4p8.1","depends_on_id":"clack-x4p8","type":"parent-child","created_at":"2026-01-11T20:30:51.465621805Z","created_by":"vscode"}]}
{"id":"clack-x4p8.2","title":"Add standalone test requirements to system prompt","description":"Add the 'content must stand alone' principle to the system prompt. The AI needs to know that users never see the prompt—only output.\n\n## What to Add\n- Explanation that viewers only see output\n- 'Niche with context' principle\n- Example of good vs bad niche content\n\n## Acceptance Criteria\n- [ ] System prompt explains that viewers only see output\n- [ ] 'Niche with context' principle documented\n- [ ] Example of good vs bad niche content\n\n## Files\n- prompts/system/major-update-base.txt\n\n## Related Issues\n- clack-x4p8.1 also modifies this file (content quality section)\n- Coordinate additions to avoid conflicts; both add NEW sections","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T20:30:52.367399263Z","created_by":"vscode","updated_at":"2026-01-11T21:13:47.49149876Z","closed_at":"2026-01-11T21:13:47.49149876Z","close_reason":"Closed","dependencies":[{"issue_id":"clack-x4p8.2","depends_on_id":"clack-x4p8","type":"parent-child","created_at":"2026-01-11T20:30:52.370145097Z","created_by":"vscode"}]}
{"id":"clack-x4p8.3","title":"Add skill section: Leveraging Personality Dimensions","description":"Create a new skill section teaching prompt designers how to creatively leverage the personality dimensions (mood, energy, humor style, obsession) that are automatically injected into every system prompt.\n\n## What to Add\n- Section explaining what personality dimensions exist\n- How to reference them in user prompts\n- Examples of prompts that use {{obsession}} creatively\n- When to constrain vs amplify personality\n\n## Acceptance Criteria\n- [ ] Section explains what personality dimensions exist\n- [ ] Shows how to reference them in user prompts\n- [ ] Gives examples of prompts that use {{obsession}} creatively\n- [ ] Explains when to constrain vs amplify personality\n\n## Files\n- .claude/skills/vestaboard-prompt/SKILL.md\n\n## Section Ownership\nThis issue adds the \"Leveraging Personality Dimensions\" section.\nOther issues adding sections to SKILL.md:\n- clack-x4p8.4: Variability Requirements section\n- clack-x4p8.5: Standalone Test section\n- clack-x4p8.6: Format-Critical Content Types section\n- clack-x4p8.7: Named Anti-Patterns section\n- clack-x4p8.8: Quality Checklist enhancements (depends on .3-.7)\n\nThese issues add DISTINCT sections and can run in parallel if agents coordinate insertion points.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T20:30:53.34041918Z","created_by":"vscode","updated_at":"2026-01-11T21:13:47.495731427Z","closed_at":"2026-01-11T21:13:47.495731427Z","close_reason":"Closed","dependencies":[{"issue_id":"clack-x4p8.3","depends_on_id":"clack-x4p8","type":"parent-child","created_at":"2026-01-11T20:30:53.34514643Z","created_by":"vscode"}]}
{"id":"clack-x4p8.4","title":"Add skill section: Variability Requirements","description":"Elevate variability from a 'tip' to a documented requirement. Include the anti-patterns (Countdown, Shower Thought) as named failures.\n\n## What to Add\n- Section titled 'Variability Requirements (Mandatory)'\n- List of acceptable variability sources (external data, style dictionaries, theme dictionaries)\n- The '100-output test'\n- Named anti-patterns:\n  - Countdown: 'relying on predictive model to not be predictive'\n  - Shower Thought: same reason\n- Why News and Novel Insight work (RSS, output styles)\n\n## Acceptance Criteria\n- [ ] Section titled 'Variability Requirements (Mandatory)'\n- [ ] Lists acceptable variability sources\n- [ ] Documents the '100-output test'\n- [ ] Names Countdown and Shower Thought as anti-patterns with explanations\n- [ ] Explains why News and Novel Insight work\n\n## Files\n- .claude/skills/vestaboard-prompt/SKILL.md\n\n## Section Ownership\nThis issue adds the \"Variability Requirements\" section.\nOther issues adding sections to SKILL.md:\n- clack-x4p8.3: Leveraging Personality Dimensions section\n- clack-x4p8.5: Standalone Test section\n- clack-x4p8.6: Format-Critical Content Types section\n- clack-x4p8.7: Named Anti-Patterns section\n- clack-x4p8.8: Quality Checklist enhancements (depends on .3-.7)\n\nThese issues add DISTINCT sections and can run in parallel if agents coordinate insertion points.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T20:30:54.938083584Z","created_by":"vscode","updated_at":"2026-01-11T21:13:47.499675177Z","closed_at":"2026-01-11T21:13:47.499675177Z","close_reason":"Closed","dependencies":[{"issue_id":"clack-x4p8.4","depends_on_id":"clack-x4p8","type":"parent-child","created_at":"2026-01-11T20:30:54.944439292Z","created_by":"vscode"}]}
{"id":"clack-x4p8.5","title":"Add skill section: Standalone Test","description":"Add explicit section on the standalone test principle with examples.\n\n## What to Add\n- Section titled 'The Standalone Test'\n- Explanation that user never sees prompt\n- 'Niche with context' examples (Klingon phrase vs full Klingon)\n- Clear pass/fail criteria\n\n## Acceptance Criteria\n- [ ] Section titled 'The Standalone Test'\n- [ ] Explains user never sees prompt\n- [ ] 'Niche with context' examples\n- [ ] Clear pass/fail criteria\n\n## Files\n- .claude/skills/vestaboard-prompt/SKILL.md\n\n## Section Ownership\nThis issue adds the \"Standalone Test\" section.\nOther issues adding sections to SKILL.md:\n- clack-x4p8.3: Leveraging Personality Dimensions section\n- clack-x4p8.4: Variability Requirements section\n- clack-x4p8.6: Format-Critical Content Types section\n- clack-x4p8.7: Named Anti-Patterns section\n- clack-x4p8.8: Quality Checklist enhancements (depends on .3-.7)\n\nThese issues add DISTINCT sections and can run in parallel if agents coordinate insertion points.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T20:31:09.445448924Z","created_by":"vscode","updated_at":"2026-01-11T21:13:47.502962469Z","closed_at":"2026-01-11T21:13:47.502962469Z","close_reason":"Closed","dependencies":[{"issue_id":"clack-x4p8.5","depends_on_id":"clack-x4p8","type":"parent-child","created_at":"2026-01-11T20:31:09.446316299Z","created_by":"vscode"}]}
{"id":"clack-x4p8.6","title":"Add skill section: Format-Critical Content Types","description":"Document which content types REQUIRE specific formatting to work.\n\n## What to Add\n- Table of format-critical types (Fortune Cookie, Haiku, Countdown)\n- Fortune Cookie requirements: centered, lucky numbers on line 6\n- Whitespace as meaningful principle\n- Distinction between 'format required' vs 'format optional'\n\n## Acceptance Criteria\n- [ ] Table of format-critical types\n- [ ] Fortune Cookie formatting requirements documented\n- [ ] Whitespace as meaningful principle\n- [ ] Clear distinction between required vs optional formatting\n\n## Files\n- .claude/skills/vestaboard-prompt/SKILL.md\n\n## Section Ownership\nThis issue adds the \"Format-Critical Content Types\" section.\nOther issues adding sections to SKILL.md:\n- clack-x4p8.3: Leveraging Personality Dimensions section\n- clack-x4p8.4: Variability Requirements section\n- clack-x4p8.5: Standalone Test section\n- clack-x4p8.7: Named Anti-Patterns section\n- clack-x4p8.8: Quality Checklist enhancements (depends on .3-.7)\n\nThese issues add DISTINCT sections and can run in parallel if agents coordinate insertion points.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T20:31:10.425216133Z","created_by":"vscode","updated_at":"2026-01-11T21:13:47.508679302Z","closed_at":"2026-01-11T21:13:47.508679302Z","close_reason":"Closed","dependencies":[{"issue_id":"clack-x4p8.6","depends_on_id":"clack-x4p8","type":"parent-child","created_at":"2026-01-11T20:31:10.428570174Z","created_by":"vscode"}]}
{"id":"clack-x4p8.7","title":"Add skill section: Named Anti-Patterns","description":"Create a section documenting specific generators that exemplify failure patterns, with explanations.\n\n## What to Add\n- Countdown Generator anti-pattern: cannot generate novel content daily\n- Shower Thought anti-pattern: relies on predictive model to not be predictive\n- Generic Motivational anti-pattern: saccharine, preachy, context-blind\n- Each pattern includes: why it fails, what principle it violates, how to fix\n\n## Acceptance Criteria\n- [ ] Countdown Generator anti-pattern documented\n- [ ] Shower Thought anti-pattern documented\n- [ ] Generic Motivational anti-pattern documented\n- [ ] Each has: why it fails, what principle it violates, how to fix\n\n## Files\n- .claude/skills/vestaboard-prompt/SKILL.md\n\n## Section Ownership\nThis issue adds the \"Named Anti-Patterns\" section.\nOther issues adding sections to SKILL.md:\n- clack-x4p8.3: Leveraging Personality Dimensions section\n- clack-x4p8.4: Variability Requirements section\n- clack-x4p8.5: Standalone Test section\n- clack-x4p8.6: Format-Critical Content Types section\n- clack-x4p8.8: Quality Checklist enhancements (depends on .3-.7)\n\nThese issues add DISTINCT sections and can run in parallel if agents coordinate insertion points.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T20:31:11.464384383Z","created_by":"vscode","updated_at":"2026-01-11T21:13:47.51290201Z","closed_at":"2026-01-11T21:13:47.51290201Z","close_reason":"Closed","dependencies":[{"issue_id":"clack-x4p8.7","depends_on_id":"clack-x4p8","type":"parent-child","created_at":"2026-01-11T20:31:11.46973705Z","created_by":"vscode"}]}
{"id":"clack-x4p8.8","title":"Enhance Quality Checklist with new criteria","description":"Add new checklist items based on interview insights.\n\n## What to Add\n- 'Content Completeness' section with 4 criteria:\n  - Self-contained meaning\n  - Proper ending\n  - Emotional resolution\n  - Visual completion\n- 'Repeatability' section with variability source check\n- 'Accessibility' section with standalone test\n- '100-output test' as pre-flight question\n\n## Acceptance Criteria\n- [ ] 'Content Completeness' section with 4 criteria\n- [ ] 'Repeatability' section with variability source check\n- [ ] 'Accessibility' section with standalone test\n- [ ] '100-output test' as pre-flight question\n\n## Files\n- .claude/skills/vestaboard-prompt/SKILL.md\n\n## Related Issues\nThis issue enhances the Quality Checklist by referencing content from:\n- clack-x4p8.3: Personality Dimensions (for variability)\n- clack-x4p8.4: Variability Requirements (for repeatability section)\n- clack-x4p8.5: Standalone Test (for accessibility section)\n- clack-x4p8.6: Format-Critical Types (for completeness)\n- clack-x4p8.7: Named Anti-Patterns (for examples)\n\nMUST RUN AFTER .3-.7 to reference their content correctly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T20:31:12.830021092Z","created_by":"vscode","updated_at":"2026-01-11T21:13:47.516781552Z","closed_at":"2026-01-11T21:13:47.516781552Z","close_reason":"Closed","dependencies":[{"issue_id":"clack-x4p8.8","depends_on_id":"clack-x4p8","type":"parent-child","created_at":"2026-01-11T20:31:12.834717009Z","created_by":"vscode"},{"issue_id":"clack-x4p8.8","depends_on_id":"clack-x4p8.3","type":"blocks","created_at":"2026-01-11T20:31:21.643690846Z","created_by":"vscode"},{"issue_id":"clack-x4p8.8","depends_on_id":"clack-x4p8.4","type":"blocks","created_at":"2026-01-11T20:31:21.661864096Z","created_by":"vscode"},{"issue_id":"clack-x4p8.8","depends_on_id":"clack-x4p8.5","type":"blocks","created_at":"2026-01-11T20:31:21.678757763Z","created_by":"vscode"},{"issue_id":"clack-x4p8.8","depends_on_id":"clack-x4p8.6","type":"blocks","created_at":"2026-01-11T20:31:21.698319013Z","created_by":"vscode"},{"issue_id":"clack-x4p8.8","depends_on_id":"clack-x4p8.7","type":"blocks","created_at":"2026-01-11T20:31:21.717045096Z","created_by":"vscode"}]}
{"id":"clack-x4p8.9","title":"Update templates.md with variability examples","description":"Update the templates file to show how to build variability into prompts.\n\n## What to Add\n- New 'Pattern D: Variability-Driven Prompts' section\n- Examples of style dictionaries\n- Examples of theme dictionaries\n- How to combine with personality dimensions\n\n## Acceptance Criteria\n- [ ] New 'Pattern D: Variability-Driven Prompts' section\n- [ ] Examples of style dictionaries\n- [ ] Examples of theme dictionaries\n- [ ] Shows how to combine with personality dimensions\n\n## Files\n- .claude/skills/vestaboard-prompt/templates.md\n\n## Related Issues\n- Depends on: clack-x4p8.4","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T20:31:14.071359801Z","created_by":"vscode","updated_at":"2026-01-11T21:13:47.521505885Z","closed_at":"2026-01-11T21:13:47.521505885Z","close_reason":"Closed","dependencies":[{"issue_id":"clack-x4p8.9","depends_on_id":"clack-x4p8","type":"parent-child","created_at":"2026-01-11T20:31:14.075338968Z","created_by":"vscode"},{"issue_id":"clack-x4p8.9","depends_on_id":"clack-x4p8.4","type":"blocks","created_at":"2026-01-11T20:31:22.471309763Z","created_by":"vscode"}]}
{"id":"clack-xcz","title":"Fix TypeScript errors in API route tests after database model type changes","description":"API route tests (voting.test.ts, content.test.ts, logs.test.ts) use string IDs in mock data, but database models changed to expect number IDs (auto-increment). This causes TypeScript compilation errors preventing tests from running.\n\nRoot Cause: Commit 0e6e002 changed VoteRecord.id, ContentRecord.id, LogRecord.id from string to number (database auto-increment), but test mock data was not updated to match.\n\nImpact: 0 tests run (compilation failure blocks all 23 tests)\n\nTypeScript Errors:\n- voting.test.ts:47,77 - Type 'string' not assignable to type 'number' (id: 'vote-123')\n- content.test.ts:47,113 - Type 'string' not assignable to type 'number' (id: 'content-123')  \n- logs.test.ts:47,53,83,180 - Type 'string' not assignable to type 'number' (id: 'log-1')\n\nFiles Affected:\n- tests/web/api-routes/voting.test.ts (2 string IDs)\n- tests/web/api-routes/content.test.ts (2 string IDs)\n- tests/web/api-routes/logs.test.ts (4 string IDs)","design":"Solution: Update test mock data to use numeric IDs matching database model types.\n\nChanges Required:\n- voting.test.ts: 'vote-123' → 123, 'vote-789' → 789\n- content.test.ts: 'content-123' → 123, 'content-1' → 1\n- logs.test.ts: 'log-1' → 1, 'log-2' → 2\n\nEstimated LOC: ~8 lines across 3 test files\nEstimated Time: \u003c15 minutes","acceptance_criteria":"- All TypeScript compilation errors resolved\n- All 23 API route tests run and pass\n- Test coverage maintained at 80%+\n- Linting passes\n- No regression in test functionality","status":"tombstone","priority":1,"issue_type":"bug","created_at":"2025-11-26T00:28:08.25387847Z","updated_at":"2026-01-03T21:41:47.645866918Z","labels":["bug","testing","typescript"],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"bug"}
{"id":"clack-xtcg","title":"bootstrap-cleanup.test.ts: 1 test failing - missing Vestaboard config mock","description":"File: tests/integration/bootstrap-cleanup.test.ts\nFailures: 1 test\nRoot cause: Test calls bootstrap() directly, but Vestaboard configuration is not mocked.\nError: 'Vestaboard configuration is required for operation' thrown at src/bootstrap.ts:224\n\nFailing test:\n- should run retention cleanup on startup","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-03T22:48:25.443729129Z","created_by":"vscode","updated_at":"2026-01-04T00:54:11.795177594Z","closed_at":"2026-01-04T00:54:11.795177594Z","close_reason":"Fixed by adding Vestaboard env vars","dependencies":[{"issue_id":"clack-xtcg","depends_on_id":"clack-nltc","type":"parent-child","created_at":"2026-01-03T22:48:46.479514583Z","created_by":"vscode"}]}
{"id":"clack-xtg","title":"Task 2.2: Create ModelTierSelector class","description":"Create src/api/ai/model-tier-selector.ts with select() method for tier-based model selection and getAlternate() for cross-provider fallback.","acceptance_criteria":"- ModelTierSelector class with constructor accepting preferred and available providers\n- select(tier) returns provider/model pair\n- getAlternate(current) returns fallback provider/model or null\n- Unit tests with all provider combinations\n- 80%+ coverage","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-11-26T22:15:11.267591713Z","updated_at":"2026-01-03T21:41:47.645866918Z","dependencies":[{"issue_id":"clack-xtg","depends_on_id":"clack-adr","type":"parent-child","created_at":"2025-11-26T22:15:18.711013466Z","created_by":"daemon"},{"issue_id":"clack-xtg","depends_on_id":"clack-068","type":"blocks","created_at":"2025-11-26T22:15:18.910753008Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-xu0","title":"Integrate ContentDataProvider into Orchestrator","description":"Wire ContentDataProvider into the content generation pipeline.\n\n**Files:**\n- `src/content/orchestrator.ts`\n- `src/bootstrap.ts`\n- `src/types/content-generator.ts`\n\n**Requirements:**\n- Add `dataProvider` to ContentOrchestratorConfig\n- Call `dataProvider.fetchData()` before generation in `generateAndSend()`\n- Extend `GenerationContext` with `data?: ContentData`\n- Pass pre-fetched data to FrameDecorator (avoid duplicate weather fetch)\n- Update bootstrap to create and wire ContentDataProvider","status":"tombstone","priority":2,"issue_type":"task","assignee":"claude","created_at":"2025-11-27T09:20:42.544779417Z","updated_at":"2026-01-03T21:41:47.645866918Z","labels":["infrastructure","orchestrator"],"dependencies":[{"issue_id":"clack-xu0","depends_on_id":"clack-viu","type":"parent-child","created_at":"2025-11-27T09:21:47.279762919Z","created_by":"daemon"},{"issue_id":"clack-xu0","depends_on_id":"clack-yib","type":"blocks","created_at":"2025-11-27T09:22:14.088771792Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-xx4s","title":"Hot Take Generator Diversity Enhancement","description":"Add variety dimensions to HotTakeGenerator following established patterns. Currently generates repetitive content due to static prompt with fixed examples. Solution: Add HOT_TAKE_DOMAINS (50 items) and HOT_TAKE_ANGLES (12 items) arrays with getTemplateVariables() hook for 600 unique combinations.","status":"closed","priority":2,"issue_type":"epic","owner":"ryan@spice.cc","created_at":"2026-01-21T20:29:09.790571551Z","created_by":"Ryan Brodkin","updated_at":"2026-01-21T21:39:31.671940797Z","closed_at":"2026-01-21T21:39:31.671940797Z","close_reason":"Implemented hot-take diversity with 50 domains and 12 angles. Merged to develop."}
{"id":"clack-xx4s.1","title":"Add variety arrays and hook overrides to HotTakeGenerator","description":"Add two variety dimensions with arrays and implement getTemplateVariables() + getCustomMetadata() hooks.\n\nAcceptance Criteria:\n- Add HOT_TAKE_DOMAINS array (50 items) for topic categories\n- Add HOT_TAKE_ANGLES array (12 items) for opinion styles  \n- Implement getTemplateVariables() returning { hotTakeDomain, hotTakeAngle }\n- Implement getCustomMetadata() returning selection tracking\n- Add private selectRandom\u003cT\u003e() helper method\n- Store selections in private instance variables\n\nFiles: src/content/generators/ai/hot-take-generator.ts\n\n---\n[Orchestration Notes]\nParallel Group: Can execute in parallel with clack-xx4s.2 (no file overlap)\nRelated: clack-xx4s.2 (parallel work on prompt file)","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-21T20:29:22.011498251Z","created_by":"Ryan Brodkin","updated_at":"2026-01-21T21:39:31.652454588Z","closed_at":"2026-01-21T21:39:31.652454588Z","close_reason":"Implemented hot-take diversity with 50 domains and 12 angles. Merged to develop.","dependencies":[{"issue_id":"clack-xx4s.1","depends_on_id":"clack-xx4s","type":"parent-child","created_at":"2026-01-21T20:29:22.012237376Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-xx4s.2","title":"Update hot-take.txt prompt with template variables","description":"Restructure prompt to use {{hotTakeDomain}} and {{hotTakeAngle}} placeholders with guidance sections.\n\nAcceptance Criteria:\n- Add {{hotTakeDomain}} placeholder with domain-specific guidance\n- Add {{hotTakeAngle}} placeholder with angle-specific guidance\n- Remove static example list (now dynamically injected)\n- Add DOMAIN GUIDANCE section (like word-of-the-day.txt)\n- Add ANGLE GUIDANCE section explaining each style\n- Keep core requirements (playful, not mean, avoid divisive topics)\n\nFiles: prompts/user/hot-take.txt\n\n---\n[Orchestration Notes]\nParallel Group: Can execute in parallel with clack-xx4s.1 (no file overlap)\nRelated: clack-xx4s.1 (parallel work on generator code)","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-21T20:29:23.067516876Z","created_by":"Ryan Brodkin","updated_at":"2026-01-21T21:39:31.661798672Z","closed_at":"2026-01-21T21:39:31.661798672Z","close_reason":"Implemented hot-take diversity with 50 domains and 12 angles. Merged to develop.","dependencies":[{"issue_id":"clack-xx4s.2","depends_on_id":"clack-xx4s","type":"parent-child","created_at":"2026-01-21T20:29:23.070577918Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-xx4s.3","title":"Update unit tests for new variety mechanism","description":"Add tests for new hooks and variety selection, update existing tests for new behavior.\n\nAcceptance Criteria:\n- Test getTemplateVariables() returns domain and angle\n- Test getCustomMetadata() tracks selections\n- Test random selection produces valid array items\n- Verify template variables flow through to prompts\n- Update existing generate() test for new metadata shape\n\nFiles: tests/unit/content/generators/ai/hot-take-generator.test.ts\n\n---\n[Orchestration Notes]\nExecution Order: Must wait for clack-xx4s.1 AND clack-xx4s.2 to complete (tests both code and prompt changes)\nCannot Parallelize: Depends on both parallel work units","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-21T20:29:30.713172755Z","created_by":"Ryan Brodkin","updated_at":"2026-01-21T21:39:31.667185672Z","closed_at":"2026-01-21T21:39:31.667185672Z","close_reason":"Implemented hot-take diversity with 50 domains and 12 angles. Merged to develop.","dependencies":[{"issue_id":"clack-xx4s.3","depends_on_id":"clack-xx4s","type":"parent-child","created_at":"2026-01-21T20:29:30.718658005Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-xx4s.3","depends_on_id":"clack-xx4s.1","type":"blocks","created_at":"2026-01-21T20:29:36.566664133Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-xx4s.3","depends_on_id":"clack-xx4s.2","type":"blocks","created_at":"2026-01-21T20:29:36.603176091Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-y25l","title":"Unify Sleep Mode Semantics to User-Facing Standard","description":"Refactor the sleep mode system to use ONE consistent semantic language throughout the codebase. Remove all 'inverted semantics' language and use user-facing terminology: 'Sleep mode ON' = active (blocking), 'Sleep mode OFF' = inactive (normal). This is a documentation/naming cleanup - no logic changes needed.","status":"closed","priority":2,"issue_type":"epic","owner":"ryan@spice.cc","created_at":"2026-01-20T04:37:18.445666638Z","created_by":"Ryan Brodkin","updated_at":"2026-01-20T05:43:52.326095334Z","closed_at":"2026-01-20T05:43:52.326095334Z","close_reason":"Merged to main in commit 282d8cf"}
{"id":"clack-y25l.1","title":"Update CLI circuit.ts comments","description":"Remove 'inverted semantics' from comments in src/cli/commands/circuit.ts, replace with user-facing descriptions.\n\n**Lines to update:**\n- Line 181: Change to describe user action, not inversion\n- Line 211: Remove '(inverted semantics)' from docstring  \n- Line 298: Change to describe user action, not inversion\n- Line 328: Remove '(inverted semantics)' from docstring\n\n**Acceptance Criteria:**\n- No grep matches for 'invert' in this file\n- Comments describe user intent (ON = enter sleep, OFF = wake up)","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-20T04:37:34.123499048Z","created_by":"Ryan Brodkin","updated_at":"2026-01-20T05:43:52.115904042Z","closed_at":"2026-01-20T05:43:52.115904042Z","close_reason":"Merged to main in commit 282d8cf","dependencies":[{"issue_id":"clack-y25l.1","depends_on_id":"clack-y25l","type":"parent-child","created_at":"2026-01-20T04:37:34.125001673Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-y25l.2","title":"Update EventHandler comments","description":"Remove 'inverted from circuit breaker convention' language from src/scheduler/event-handler.ts, use user-intent descriptions.\n\n**Lines to update:**\n- Lines 236-238: Rewrite docstring to explain user actions\n- Lines 249-251: Rewrite comment to explain user actions\n\n**Acceptance Criteria:**\n- No grep matches for 'invert' in this file\n- Comments describe: action='on' = ENTER sleep, action='off' = EXIT sleep","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-20T04:37:34.321666465Z","created_by":"Ryan Brodkin","updated_at":"2026-01-20T05:43:52.300608792Z","closed_at":"2026-01-20T05:43:52.300608792Z","close_reason":"Merged to main in commit 282d8cf","dependencies":[{"issue_id":"clack-y25l.2","depends_on_id":"clack-y25l","type":"parent-child","created_at":"2026-01-20T04:37:34.322564048Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-y25l.3","title":"Fix integration test describe blocks","description":"Rename describe blocks in tests/integration/sleep-mode-flow.test.ts to use user-facing action language instead of internal state.\n\n**Changes:**\n- Line 87: 'SLEEP_MODE circuit OFF (entering sleep)' → 'Activating sleep mode (action=\"on\")'\n- Line 166: 'SLEEP_MODE circuit ON (waking up)' → 'Deactivating sleep mode (action=\"off\")'\n\n**Acceptance Criteria:**\n- Describe blocks use action= language matching test payloads\n- All tests still pass","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-20T04:37:34.547639298Z","created_by":"Ryan Brodkin","updated_at":"2026-01-20T05:43:52.306480084Z","closed_at":"2026-01-20T05:43:52.306480084Z","close_reason":"Merged to main in commit 282d8cf","dependencies":[{"issue_id":"clack-y25l.3","depends_on_id":"clack-y25l","type":"parent-child","created_at":"2026-01-20T04:37:34.548421673Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-y25l.4","title":"Fix unit test names and comments","description":"Rename tests in tests/unit/scheduler/event-handler.test.ts from 'inverted semantics' to user-action descriptions.\n\n**Changes:**\n- Line 513: Test name → 'should exit sleep mode when action=\"off\" (unblock updates)'\n- Line 524: Comment → 'action='off' = user wants to wake up → unblock updates internally'\n- Line 528: Test name → 'should enter sleep mode when action=\"on\" (block updates)'\n- Line 539: Comment → 'action='on' = user wants to sleep → block updates internally'\n\n**Acceptance Criteria:**\n- No grep matches for 'invert' in this file\n- All tests still pass","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-20T04:37:34.753830007Z","created_by":"Ryan Brodkin","updated_at":"2026-01-20T05:43:52.311139667Z","closed_at":"2026-01-20T05:43:52.311139667Z","close_reason":"Merged to main in commit 282d8cf","dependencies":[{"issue_id":"clack-y25l.4","depends_on_id":"clack-y25l","type":"parent-child","created_at":"2026-01-20T04:37:34.754555048Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-y25l.5","title":"Rewrite CLAUDE.md sleep mode docs","description":"Rewrite Sleep Mode System section in CLAUDE.md with user-first perspective.\n\n**Changes:**\n- Remove 'Inverted' from convention breaks table\n- Replace 'Circuit Breaker Semantics' with user-first explanation\n- Remove 'Why the internal inversion?' paragraph\n- Lead with user commands, make internal state an implementation note\n\n**Acceptance Criteria:**\n- No grep matches for 'invert' in sleep mode section\n- Documentation explains from user perspective first","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-20T04:37:34.970437549Z","created_by":"Ryan Brodkin","updated_at":"2026-01-20T05:43:52.315665625Z","closed_at":"2026-01-20T05:43:52.315665625Z","close_reason":"Merged to main in commit 282d8cf","dependencies":[{"issue_id":"clack-y25l.5","depends_on_id":"clack-y25l","type":"parent-child","created_at":"2026-01-20T04:37:34.971192965Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-y25l.6","title":"Verify grep for 'invert' returns 0","description":"Final validation that no 'invert' language remains in sleep-related code.\n\n**Verification:**\n- Run: grep -ri 'invert' src/ tests/ CLAUDE.md | grep -i sleep\n- Should return 0 results\n- Run full test suite to confirm all tests pass\n\n**Acceptance Criteria:**\n- Zero matches for 'invert' in sleep-related files\n- All tests pass","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-20T04:37:35.193003507Z","created_by":"Ryan Brodkin","updated_at":"2026-01-20T05:43:52.321088167Z","closed_at":"2026-01-20T05:43:52.321088167Z","close_reason":"Merged to main in commit 282d8cf","dependencies":[{"issue_id":"clack-y25l.6","depends_on_id":"clack-y25l","type":"parent-child","created_at":"2026-01-20T04:37:35.193954049Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-y25l.6","depends_on_id":"clack-y25l.1","type":"blocks","created_at":"2026-01-20T04:37:40.689512135Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-y25l.6","depends_on_id":"clack-y25l.2","type":"blocks","created_at":"2026-01-20T04:37:40.724758135Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-y25l.6","depends_on_id":"clack-y25l.3","type":"blocks","created_at":"2026-01-20T04:37:40.760632801Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-y25l.6","depends_on_id":"clack-y25l.4","type":"blocks","created_at":"2026-01-20T04:37:40.798216426Z","created_by":"Ryan Brodkin"},{"issue_id":"clack-y25l.6","depends_on_id":"clack-y25l.5","type":"blocks","created_at":"2026-01-20T04:37:40.845357218Z","created_by":"Ryan Brodkin"}]}
{"id":"clack-y2kk","title":"Consolidate AI generator test patterns","description":"15 AI generator test files all access generator['modelTier'] (private property). Create shared test utility or parameterized base test. Remove private property access patterns - test observable behavior instead. Consider consolidating duplicate test structures across generators. Acceptance: No private property access via bracket notation, tests pass without .env.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T21:03:33.881375379Z","created_by":"vscode","updated_at":"2026-01-11T21:17:14.897219301Z","closed_at":"2026-01-11T21:17:14.897219301Z","close_reason":"Merged into clack-lwca to avoid file overlap conflicts","dependencies":[{"issue_id":"clack-y2kk","depends_on_id":"clack-82ep","type":"parent-child","created_at":"2026-01-11T21:04:05.414112588Z","created_by":"vscode"}]}
{"id":"clack-y3q","title":"ColorBarService caching ineffective - new instance created per frame generation","description":"## Problem\n\nEach call to `generateFrame()` creates a new `ColorBarService` instance, making the 24-hour cache ineffective. This causes a ~2.4s AI API call for every frame generation.\n\n## Investigation Findings\n\nPerformance breakdown:\n- Baseline (skip both HA + AI): 237ms\n- With HA only: 820ms (+600ms for WebSocket + state query)\n- With AI only: ~2.6s (+2.4s for AI color generation)\n- With both: ~3s\n\nThe HA connection is fast. The bottleneck is the AI provider call for seasonal colors.\n\n## Root Cause\n\nIn `src/content/frame/frame-generator.ts:54`:\n```typescript\nconst colorService = new ColorBarService(options.aiProvider);\n```\n\nA new instance is created for each frame generation, so the instance-level cache (`private cache: SeasonalColors | null = null`) is never populated from a previous run.\n\n## Impact\n\n- CLI `npm run frame`: 2-3 second delay per run\n- Production major updates: Same ~2.4s delay for each update\n\n## Suggested Fix\n\n1. Make ColorBarService a singleton or inject a shared instance\n2. Or add persistent caching (file/database) that survives instance recreation\n3. Or pre-warm the cache on app startup","status":"tombstone","priority":2,"issue_type":"bug","created_at":"2025-11-26T19:56:46.268399049Z","updated_at":"2026-01-03T21:41:47.645866918Z","labels":["caching","performance"],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"bug"}
{"id":"clack-y4i","title":"Write Unit Tests for Vestaboard Client","description":"Create unit tests for VestaboardClient orchestrator with mocked dependencies (HTTP client and character converter). Target: 80%+ coverage.","design":"## Test Strategy\nUse mock factories from tests/__mocks__/vestaboard.ts\n\nCoverage areas:\n1. sendLayout() delegates to httpClient\n2. sendText() converts then sends\n3. validateConnection() delegates\n4. Error propagation from dependencies\n5. Integration of converter + httpClient\n\nFocus on orchestration logic, not implementation details.","acceptance_criteria":"- tests/unit/api/vestaboard/client.test.ts created\n- Test constructor accepts httpClient and converter dependencies\n- Test sendLayout() calls converter.layoutToCharacterCodes()\n- Test sendLayout() calls httpClient.sendMessage() with converted codes\n- Test sendText() creates layout from text\n- Test sendText() converts and sends\n- Test validateConnection() delegates to httpClient\n- Test error propagation from converter (unsupported character)\n- Test error propagation from httpClient (auth error)\n- Test error propagation from httpClient (connection error)\n- Uses createMockVestaboardHTTPClient() and createMockCharacterConverter()\n- 80%+ coverage achieved\n- All tests pass\n- No real HTTP or character conversion (mocked dependencies)","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-11-26T05:25:39.497642679Z","updated_at":"2026-01-03T21:41:47.645866918Z","close_reason":"Verified complete by code review","dependencies":[{"issue_id":"clack-y4i","depends_on_id":"clack-745","type":"blocks","created_at":"2025-11-26T05:25:39.498615387Z","created_by":"daemon"},{"issue_id":"clack-y4i","depends_on_id":"clack-suz","type":"blocks","created_at":"2025-11-26T05:25:39.499537262Z","created_by":"daemon"},{"issue_id":"clack-y4i","depends_on_id":"clack-jc1","type":"blocks","created_at":"2025-11-26T05:25:39.500173387Z","created_by":"daemon"},{"issue_id":"clack-y4i","depends_on_id":"clack-z37n","type":"parent-child","created_at":"2025-11-29T07:01:18.224450929Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-y4k","title":"Implement State Query Methods","description":"Implement getState(entityId) for single entity and getAllStates() for all entities, with error handling and response validation.","acceptance_criteria":"- getState(entityId) method\n- getAllStates() method\n- Error handling for invalid entity IDs\n- Response type validation\n- Optional state caching","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-11-24T00:18:45.991389179Z","updated_at":"2026-01-03T21:41:47.645866918Z","dependencies":[{"issue_id":"clack-y4k","depends_on_id":"clack-ar9","type":"blocks","created_at":"2025-11-24T00:19:54.357162002Z","created_by":"daemon"},{"issue_id":"clack-y4k","depends_on_id":"clack-4qv","type":"blocks","created_at":"2025-11-24T00:19:55.184396628Z","created_by":"daemon"},{"issue_id":"clack-y4k","depends_on_id":"clack-0nr","type":"parent-child","created_at":"2025-11-24T04:19:07.038716628Z","created_by":"vscode"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-y8qe","title":"Parameterize duplicate test patterns","description":"NARROW SCOPE: Focus on model-tier-selector.test.ts which has 6 nearly identical tests (lines 31-89) that should use it.each(). For AI generator tests, structural similarity is intentional (testing same abstract interface) - only parameterize if it improves clarity without reducing readability. Target: minimum 20% line reduction in model-tier-selector.test.ts. Acceptance: model-tier-selector.test.ts uses parameterized tests, duplicate assertions consolidated.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T21:03:43.63686055Z","created_by":"vscode","updated_at":"2026-01-11T22:38:16.704707009Z","closed_at":"2026-01-11T22:38:16.704707009Z","close_reason":"Closed","dependencies":[{"issue_id":"clack-y8qe","depends_on_id":"clack-82ep","type":"parent-child","created_at":"2026-01-11T21:04:05.429624046Z","created_by":"vscode"}]}
{"id":"clack-y8rf","title":"Fix registry order-dependent tests","description":"VERIFY FIRST: ContentRegistry tests may already have proper isolation via beforeEach/afterEach with ContentRegistry.reset(). Run tests with --testSequencer=random to verify order independence. If failures occur, document which specific tests fail. If tests pass in random order, close this issue. Otherwise: Add explicit setup/teardown where missing. Acceptance: Tests pass in any execution order (verified with random sequencer).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T21:03:40.055926382Z","created_by":"vscode","updated_at":"2026-01-11T22:38:16.707827134Z","closed_at":"2026-01-11T22:38:16.707827134Z","close_reason":"Closed","dependencies":[{"issue_id":"clack-y8rf","depends_on_id":"clack-82ep","type":"parent-child","created_at":"2026-01-11T21:04:05.424623838Z","created_by":"vscode"}]}
{"id":"clack-y91","title":"Implement RSSClient with real RSS parsing","description":"Replace stub RSSClient with working implementation using rss-parser package.\n\n**Files:** `src/api/data-sources/rss.ts`\n\n**Requirements:**\n- npm install rss-parser\n- Implement `fetchFeed()` with actual RSS parsing\n- Implement `getLatestItems()` returning `RSSItem[]`\n- Handle timeouts (10s default) and parse errors gracefully\n- Return empty array on failure (graceful degradation)\n- 80%+ test coverage with mocked HTTP responses","status":"tombstone","priority":1,"issue_type":"task","assignee":"claude","created_at":"2025-11-27T09:20:30.801671259Z","updated_at":"2026-01-03T21:41:47.645866918Z","labels":["data-source","infrastructure"],"dependencies":[{"issue_id":"clack-y91","depends_on_id":"clack-viu","type":"parent-child","created_at":"2025-11-27T09:21:46.890863085Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-yib","title":"Create ContentDataProvider service for weather/color aggregation","description":"New service that pre-fetches all external data (weather, colors) before content generation.\n\n**Files:** \n- `src/services/content-data-provider.ts` (new)\n- `src/types/content-data.ts` (new)\n\n**Requirements:**\n- Uses existing `WeatherService` for weather\n- Uses existing `ColorBarService` for colors\n- Parallel fetching with Promise.all\n- Graceful degradation (capture errors in warnings array)\n- Returns `ContentData` with weather, colorBar, fetchedAt, warnings\n- 80%+ test coverage","status":"tombstone","priority":1,"issue_type":"task","assignee":"claude","created_at":"2025-11-27T09:20:30.931932759Z","updated_at":"2026-01-03T21:41:47.645866918Z","labels":["infrastructure","weather"],"dependencies":[{"issue_id":"clack-yib","depends_on_id":"clack-viu","type":"parent-child","created_at":"2025-11-27T09:21:47.016836419Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-yoo","title":"[MEDIUM] Fix CLI index.test.ts missing assertions for argument parsing","description":"**File:** tests/unit/cli/index.test.ts\n**Lines:** 54-76, 224-234\n**Category:** Doesn't Make Sense\n**Severity:** Medium\n\n## Problem\nMultiple tests only check `toHaveBeenCalled()` without verifying how arguments were parsed:\n- Lines 54-66: Claims to test boolean flag parsing but only checks function was called\n- Lines 68-76: Same issue with multiple boolean flags\n- Lines 224-234: Comment describes empty string test but tests wrong flags\n\n## Evidence\n```typescript\nit('should not capture following positional argument as boolean value', async () =\u003e {\n  await runCLI(['frame', '--skip-weather', 'TEST']);\n  expect(jest.mocked(frameCommand)).toHaveBeenCalled();  // ← No assertion on parsed args!\n});\n```\n\n## Implementation Instructions\n1. **Add assertions on parsed arguments**:\n```typescript\nexpect(jest.mocked(frameCommand)).toHaveBeenCalledWith(\n  expect.objectContaining({ \n    skipWeather: true, \n    text: 'TEST' \n  })\n);\n```\n2. **Fix line 224-234** to actually test empty string case as described in comment\n\n## Acceptance Criteria\n- [ ] Tests verify parsed argument structure, not just function call\n- [ ] Boolean flags correctly parsed without consuming positional args\n- [ ] Test descriptions match actual test behavior","notes":"3-char identifier cleanup","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-29T05:08:30.69756138Z","updated_at":"2026-01-23T22:36:20.281750666Z","closed_at":"2026-01-23T22:36:20.281762416Z","labels":["medium","testing"],"dependencies":[{"issue_id":"clack-yoo","depends_on_id":"clack-n81p","type":"parent-child","created_at":"2025-11-29T07:01:03.570702839Z","created_by":"daemon"}]}
{"id":"clack-yun","title":"Task 4.3: Create registerCoreContent function","description":"Create src/content/registry/register-core.ts to register all built-in P2 content generators at application startup.","acceptance_criteria":"- Registers MotivationalGenerator, NewsSummaryGenerator, WeatherFocusGenerator\n- Registers GreetingGenerator, other programmatic generators\n- Registers StaticFallbackGenerator as P3\n- Each with appropriate ContentRegistration metadata","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-11-26T22:16:06.221177085Z","updated_at":"2026-01-03T21:41:47.645866918Z","dependencies":[{"issue_id":"clack-yun","depends_on_id":"clack-4lg","type":"parent-child","created_at":"2025-11-26T22:16:15.346653465Z","created_by":"daemon"},{"issue_id":"clack-yun","depends_on_id":"clack-2tg","type":"blocks","created_at":"2025-11-26T22:16:15.775481881Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-yvrj","title":"[INFRA] Create output assertion helpers","description":"**Category:** Testing Infrastructure\n**Priority:** Medium\n\n## Problem\n13+ CLI tests use brittle assertions on console output with:\n- ANSI color codes (`\\x1b[32m`)\n- Complex regex for section extraction (`/P0.*?(?=P2|P3|Total:|$)/s`)\n- Exact string matching on formatted output\n\n## Implementation\n\nCreate `tests/__helpers__/outputAssertions.ts`:\n```typescript\nimport stripAnsi from 'strip-ansi';\n\n/**\n * Strip ANSI codes and normalize whitespace for assertion comparison\n */\nexport function normalizeOutput(output: string): string {\n  return stripAnsi(output)\n    .replace(/\\s+/g, ' ')\n    .trim();\n}\n\n/**\n * Assert output contains a section (case-insensitive, ANSI-stripped)\n */\nexport function expectOutputContains(output: string, expected: string): void {\n  const normalized = normalizeOutput(output);\n  expect(normalized.toLowerCase()).toContain(expected.toLowerCase());\n}\n\n/**\n * Extract a named section from CLI output (e.g., \"P0:\", \"P2:\", \"Total:\")\n */\nexport function extractSection(output: string, sectionName: string): string | null {\n  const normalized = stripAnsi(output);\n  const lines = normalized.split('\\n');\n  const sectionStart = lines.findIndex(line =\u003e \n    line.trim().startsWith(sectionName)\n  );\n  \n  if (sectionStart === -1) return null;\n  \n  const sectionEnd = lines.findIndex((line, i) =\u003e \n    i \u003e sectionStart \u0026\u0026 /^[A-Z][0-9]?:|^Total:/i.test(line.trim())\n  );\n  \n  return lines\n    .slice(sectionStart, sectionEnd === -1 ? undefined : sectionEnd)\n    .join('\\n');\n}\n\n/**\n * Assert that output has valid table structure\n */\nexport function expectValidTableOutput(output: string): void {\n  const normalized = stripAnsi(output);\n  // Check for header separator line\n  expect(normalized).toMatch(/[-─]+/);\n  // Check for consistent column alignment (pipes or spaces)\n  const lines = normalized.split('\\n').filter(l =\u003e l.trim());\n  expect(lines.length).toBeGreaterThan(1);\n}\n\n/**\n * Capture console.log output during a function call\n */\nexport async function captureConsoleOutput\u003cT\u003e(\n  fn: () =\u003e T | Promise\u003cT\u003e\n): Promise\u003c{ result: T; output: string[] }\u003e {\n  const output: string[] = [];\n  const originalLog = console.log;\n  console.log = (...args) =\u003e output.push(args.join(' '));\n  \n  try {\n    const result = await fn();\n    return { result, output };\n  } finally {\n    console.log = originalLog;\n  }\n}\n```\n\n## Dependencies\nAdd `strip-ansi` as dev dependency if not present:\n```bash\nnpm install -D strip-ansi\n```\n\n## Acceptance Criteria\n- [ ] Helper file created at `tests/__helpers__/outputAssertions.ts`\n- [ ] Exported from `tests/__helpers__/index.ts`\n- [ ] strip-ansi dependency added if needed\n- [ ] At least one CLI test updated to use helpers as example","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-11-29T05:16:41.553744968Z","updated_at":"2026-01-03T21:41:47.645866918Z","labels":["infrastructure","testing"],"dependencies":[{"issue_id":"clack-yvrj","depends_on_id":"clack-s9o","type":"parent-child","created_at":"2025-11-29T05:17:02.367767881Z","created_by":"daemon"},{"issue_id":"clack-yvrj","depends_on_id":"clack-d719","type":"parent-child","created_at":"2025-11-29T07:00:35.270067798Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-z37n","title":"VestaboardClient Refactoring","description":"Complete refactoring of VestaboardClient with factory pattern, proper abstraction, and full test coverage.\n\nSequential workflow:\n1. Create Factory Function and Public API\n2. Write Unit Tests for Factory Function\n3. Write Unit Tests for Vestaboard Client\n4. Write Integration Tests (Real Converter + Mock HTTP)\n5. Replace VestaboardClient Stub with Factory-Created Client\n6. Update TextLayoutFormatter to Use Character Converter","notes":"Created in 2025 - stale issue cleanup","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-11-29T07:00:21.350169055Z","updated_at":"2026-01-23T22:36:28.946086837Z","closed_at":"2026-01-23T22:36:28.946090004Z"}
{"id":"clack-z8jd","title":"[MEDIUM] Fix dimensions.test.ts flaky randomness test","description":"**File:** tests/unit/content/personality/dimensions.test.ts\n**Lines:** 56-74\n**Category:** Too Brittle / Flaky\n**Severity:** Medium\n\n## Problem\nTest \"should generate varying results over multiple calls\" relies on randomization producing at least 2 unique values from 50 samples. While statistically very likely, there's a non-zero chance of random failure.\n\n## Evidence\n```typescript\nit('should generate varying results over multiple calls', () =\u003e {\n  const results: PersonalityDimensions[] = [];\n  for (let i = 0; i \u003c 50; i++) {\n    results.push(generatePersonalityDimensions());\n  }\n  // With 50 samples, we should see at least 2 unique values\n  expect(uniqueMoods.size).toBeGreaterThan(1);  // ← Could theoretically fail\n});\n```\n\n## Implementation Instructions\n1. **Mock Math.random()** to return deterministic values\n2. **Or increase sample size** significantly (100+ samples)\n3. **Or test that function uses correct value pools** (already done in other tests) and remove this flaky test\n\n## Acceptance Criteria\n- [ ] Test is deterministic (uses mocked random or seeded RNG)\n- [ ] Or test removed if randomness is tested elsewhere\n- [ ] Zero chance of random test failure","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-11-29T05:09:24.674894669Z","updated_at":"2026-01-03T21:41:47.645866918Z","close_reason":"Verified complete by code review","labels":["medium","testing"],"dependencies":[{"issue_id":"clack-z8jd","depends_on_id":"clack-rokx","type":"parent-child","created_at":"2025-11-29T07:01:04.806132672Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-zbb","title":"Task 3.4: Create concrete programmatic generators","description":"Create src/content/generators/programmatic/ with GreetingGenerator (time-based), ASCIIArtGenerator (with color codes), HATemplateGenerator (Jinja templates).","acceptance_criteria":"- GreetingGenerator with morning/afternoon/evening logic\n- ASCIIArtGenerator supporting Vestaboard color codes\n- HATemplateGenerator for Home Assistant Jinja templates\n- Unit tests for each generator","status":"tombstone","priority":2,"issue_type":"task","assignee":"claude","created_at":"2025-11-26T22:15:39.769038587Z","updated_at":"2026-01-03T21:41:47.645866918Z","dependencies":[{"issue_id":"clack-zbb","depends_on_id":"clack-6vv","type":"parent-child","created_at":"2025-11-26T22:15:50.536977634Z","created_by":"daemon"},{"issue_id":"clack-zbb","depends_on_id":"clack-6oq","type":"blocks","created_at":"2025-11-26T22:15:51.391799467Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-zhvj","title":"[INFRA] Add CI test improvements - flaky detection and parallelization","description":"**Category:** CI/CD Infrastructure\n**Priority:** Low\n\n## Problem\n1. No mechanism to detect flaky tests before they cause CI failures\n2. Tests run sequentially, increasing CI time\n3. No test result artifacts for debugging\n\n## Implementation\n\n### 1. Jest Configuration for Parallel Execution\n```javascript\n// jest.config.cjs\nmodule.exports = {\n  // ... existing config ...\n  \n  // Use 50% of available CPU cores for parallel test execution\n  maxWorkers: '50%',\n  \n  // Or for CI environments with known core count:\n  // maxWorkers: process.env.CI ? 4 : '50%',\n};\n```\n\n### 2. Add Test Reporter for CI\n```bash\nnpm install -D jest-junit\n```\n\n```javascript\n// jest.config.cjs\nmodule.exports = {\n  // ... existing config ...\n  \n  reporters: [\n    'default',\n    ['jest-junit', {\n      outputDirectory: 'test-results',\n      outputName: 'junit.xml',\n    }],\n  ],\n};\n```\n\n### 3. CI Workflow Updates (if using GitHub Actions)\n```yaml\n# .github/workflows/test.yml\n- name: Run tests\n  run: npm test -- --ci --coverage --bail\n  \n- name: Upload test results\n  if: always()\n  uses: actions/upload-artifact@v3\n  with:\n    name: test-results\n    path: |\n      test-results/\n      coverage/\n\n- name: Upload coverage to Codecov\n  uses: codecov/codecov-action@v3\n  with:\n    files: coverage/lcov.info\n```\n\n### 4. Flaky Test Detection Script\nCreate `scripts/detect-flaky-tests.sh`:\n```bash\n#!/bin/bash\n# Run tests multiple times to detect flaky tests\nRUNS=5\nFAILURES=\"\"\n\nfor i in $(seq 1 $RUNS); do\n  echo \"Run $i of $RUNS...\"\n  if ! npm test -- --ci 2\u003e\u00261 | tee \"test-run-$i.log\"; then\n    FAILURES=\"$FAILURES $i\"\n  fi\ndone\n\nif [ -n \"$FAILURES\" ]; then\n  echo \"Tests failed on runs:$FAILURES\"\n  echo \"Review logs for flaky tests\"\n  exit 1\nfi\necho \"All $RUNS runs passed - no flaky tests detected\"\n```\n\n## Acceptance Criteria\n- [ ] maxWorkers configured for parallel execution\n- [ ] jest-junit reporter added for CI artifact generation\n- [ ] test-results/ added to .gitignore\n- [ ] Flaky test detection script created\n- [ ] Documentation added on how to use flaky detection","status":"tombstone","priority":3,"issue_type":"task","created_at":"2025-11-29T05:16:48.93684668Z","updated_at":"2026-01-03T21:41:47.645866918Z","labels":["ci-cd","infrastructure","testing"],"dependencies":[{"issue_id":"clack-zhvj","depends_on_id":"clack-s9o","type":"parent-child","created_at":"2025-11-29T05:17:03.152904798Z","created_by":"daemon"},{"issue_id":"clack-zhvj","depends_on_id":"clack-d719","type":"parent-child","created_at":"2025-11-29T07:00:35.596553256Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"clack-zioj","title":"Add baseline-browser-mapping dev dependency","description":"Add baseline-browser-mapping ^2.9.17 to support browser compatibility mapping in the build toolchain.","status":"closed","priority":2,"issue_type":"task","owner":"ryan@spice.cc","created_at":"2026-01-24T00:57:10.969144591Z","created_by":"Ryan Brodkin","updated_at":"2026-01-26T04:28:58.395223131Z","closed_at":"2026-01-26T04:28:58.395223131Z","close_reason":"Already completed - baseline-browser-mapping ^2.9.17 is present in develop (commit 2cc2e9c)"}
{"id":"clack-zj0t","title":"Content Submission Tool for AI Self-Validation","notes":"Tool-based content generation fully implemented in src/content/tools/","status":"closed","priority":1,"issue_type":"epic","owner":"dev@container.local","created_at":"2026-01-18T23:30:18.469200751Z","created_by":"Dev Container","updated_at":"2026-01-23T22:36:38.594013925Z","closed_at":"2026-01-23T22:36:38.594019467Z"}
{"id":"clack-zoc","title":"Epic 5: Content Orchestrator \u0026 Failover","description":"Coordinate generation pipeline with retry and failover logic. Main orchestrator handles selection, generation, retry (alternate provider), P3 failover, frame decoration, and caching.","status":"tombstone","priority":1,"issue_type":"epic","assignee":"claude","created_at":"2025-11-26T22:14:24.34007701Z","updated_at":"2026-01-03T21:41:47.645866918Z","labels":["content-system","failover","orchestrator"],"dependencies":[{"issue_id":"clack-zoc","depends_on_id":"clack-4lg","type":"blocks","created_at":"2025-11-26T22:14:35.353448085Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"clack-zoy","title":"Epic 6: Scheduler \u0026 Event Integration","description":"Integrate with existing event and scheduling infrastructure. Update EventHandler for P0 notifications, MinorUpdateGenerator for cached content, and CronScheduler wiring.","status":"tombstone","priority":1,"issue_type":"epic","assignee":"claude","created_at":"2025-11-26T22:14:24.625316261Z","updated_at":"2026-01-03T21:41:47.645866918Z","labels":["content-system","events","scheduler"],"dependencies":[{"issue_id":"clack-zoy","depends_on_id":"clack-zoc","type":"blocks","created_at":"2025-11-26T22:14:35.480003793Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"clack-zrb","title":"Implement rate limiting for API endpoints","description":"Add express-rate-limit middleware to prevent brute force attacks and DoS on API endpoints","design":"Install express-rate-limit and configure:\n- npm install express-rate-limit @types/express-rate-limit\n- Configure per-route rate limits (e.g., 100 requests per 15 minutes)\n- Apply to all /api/* routes\n- Return 429 Too Many Requests with retry-after header\n- Add tests for rate limit enforcement","acceptance_criteria":"- Rate limiting middleware installed and configured\n- API routes return 429 when limit exceeded\n- Retry-After header present in 429 responses\n- Tests verify rate limiting behavior\n- Documentation updated with rate limit policies","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-11-23T18:47:55.745019381Z","updated_at":"2026-01-03T21:41:47.645866918Z","labels":["priority-2","security","web"],"dependencies":[{"issue_id":"clack-zrb","depends_on_id":"clack-ddj","type":"parent-child","created_at":"2025-11-23T23:47:46.511340513Z","created_by":"daemon"},{"issue_id":"clack-zrb","depends_on_id":"clack-a13","type":"related","created_at":"2025-11-23T23:47:52.51929746Z","created_by":"daemon"}],"deleted_at":"2026-01-03T21:41:47.645866918Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
